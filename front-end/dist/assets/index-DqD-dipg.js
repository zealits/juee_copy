var uT=Object.defineProperty;var lT=(e,n,t)=>n in e?uT(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var dT=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var N=(e,n,t)=>lT(e,typeof n!="symbol"?n+"":n,t);var jV=dT((qV,iT)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var oo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D_={exports:{}},Mp={},I_={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qu=Symbol.for("react.element"),pT=Symbol.for("react.portal"),fT=Symbol.for("react.fragment"),hT=Symbol.for("react.strict_mode"),mT=Symbol.for("react.profiler"),gT=Symbol.for("react.provider"),vT=Symbol.for("react.context"),yT=Symbol.for("react.forward_ref"),wT=Symbol.for("react.suspense"),bT=Symbol.for("react.memo"),xT=Symbol.for("react.lazy"),gw=Symbol.iterator;function _T(e){return e===null||typeof e!="object"?null:(e=gw&&e[gw]||e["@@iterator"],typeof e=="function"?e:null)}var P_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A_=Object.assign,N_={};function Sc(e,n,t){this.props=e,this.context=n,this.refs=N_,this.updater=t||P_}Sc.prototype.isReactComponent={};Sc.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};Sc.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function M_(){}M_.prototype=Sc.prototype;function Ev(e,n,t){this.props=e,this.context=n,this.refs=N_,this.updater=t||P_}var Tv=Ev.prototype=new M_;Tv.constructor=Ev;A_(Tv,Sc.prototype);Tv.isPureReactComponent=!0;var vw=Array.isArray,L_=Object.prototype.hasOwnProperty,Dv={current:null},O_={key:!0,ref:!0,__self:!0,__source:!0};function F_(e,n,t){var r,i={},o=null,a=null;if(n!=null)for(r in n.ref!==void 0&&(a=n.ref),n.key!==void 0&&(o=""+n.key),n)L_.call(n,r)&&!O_.hasOwnProperty(r)&&(i[r]=n[r]);var s=arguments.length-2;if(s===1)i.children=t;else if(1<s){for(var c=Array(s),u=0;u<s;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in s=e.defaultProps,s)i[r]===void 0&&(i[r]=s[r]);return{$$typeof:qu,type:e,key:o,ref:a,props:i,_owner:Dv.current}}function ST(e,n){return{$$typeof:qu,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function Iv(e){return typeof e=="object"&&e!==null&&e.$$typeof===qu}function CT(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(t){return n[t]})}var yw=/\/+/g;function fh(e,n){return typeof e=="object"&&e!==null&&e.key!=null?CT(""+e.key):n.toString(36)}function yd(e,n,t,r,i){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case qu:case pT:a=!0}}if(a)return a=e,i=i(a),e=r===""?"."+fh(a,0):r,vw(i)?(t="",e!=null&&(t=e.replace(yw,"$&/")+"/"),yd(i,n,t,"",function(u){return u})):i!=null&&(Iv(i)&&(i=ST(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(yw,"$&/")+"/")+e)),n.push(i)),1;if(a=0,r=r===""?".":r+":",vw(e))for(var s=0;s<e.length;s++){o=e[s];var c=r+fh(o,s);a+=yd(o,n,t,c,i)}else if(c=_T(e),typeof c=="function")for(e=c.call(e),s=0;!(o=e.next()).done;)o=o.value,c=r+fh(o,s++),a+=yd(o,n,t,c,i);else if(o==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return a}function _l(e,n,t){if(e==null)return e;var r=[],i=0;return yd(e,r,"","",function(o){return n.call(t,o,i++)}),r}function RT(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(t){(e._status===0||e._status===-1)&&(e._status=1,e._result=t)},function(t){(e._status===0||e._status===-1)&&(e._status=2,e._result=t)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var Gn={current:null},wd={transition:null},kT={ReactCurrentDispatcher:Gn,ReactCurrentBatchConfig:wd,ReactCurrentOwner:Dv};function B_(){throw Error("act(...) is not supported in production builds of React.")}$e.Children={map:_l,forEach:function(e,n,t){_l(e,function(){n.apply(this,arguments)},t)},count:function(e){var n=0;return _l(e,function(){n++}),n},toArray:function(e){return _l(e,function(n){return n})||[]},only:function(e){if(!Iv(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};$e.Component=Sc;$e.Fragment=fT;$e.Profiler=mT;$e.PureComponent=Ev;$e.StrictMode=hT;$e.Suspense=wT;$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kT;$e.act=B_;$e.cloneElement=function(e,n,t){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=A_({},e.props),i=e.key,o=e.ref,a=e._owner;if(n!=null){if(n.ref!==void 0&&(o=n.ref,a=Dv.current),n.key!==void 0&&(i=""+n.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in n)L_.call(n,c)&&!O_.hasOwnProperty(c)&&(r[c]=n[c]===void 0&&s!==void 0?s[c]:n[c])}var c=arguments.length-2;if(c===1)r.children=t;else if(1<c){s=Array(c);for(var u=0;u<c;u++)s[u]=arguments[u+2];r.children=s}return{$$typeof:qu,type:e.type,key:i,ref:o,props:r,_owner:a}};$e.createContext=function(e){return e={$$typeof:vT,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gT,_context:e},e.Consumer=e};$e.createElement=F_;$e.createFactory=function(e){var n=F_.bind(null,e);return n.type=e,n};$e.createRef=function(){return{current:null}};$e.forwardRef=function(e){return{$$typeof:yT,render:e}};$e.isValidElement=Iv;$e.lazy=function(e){return{$$typeof:xT,_payload:{_status:-1,_result:e},_init:RT}};$e.memo=function(e,n){return{$$typeof:bT,type:e,compare:n===void 0?null:n}};$e.startTransition=function(e){var n=wd.transition;wd.transition={};try{e()}finally{wd.transition=n}};$e.unstable_act=B_;$e.useCallback=function(e,n){return Gn.current.useCallback(e,n)};$e.useContext=function(e){return Gn.current.useContext(e)};$e.useDebugValue=function(){};$e.useDeferredValue=function(e){return Gn.current.useDeferredValue(e)};$e.useEffect=function(e,n){return Gn.current.useEffect(e,n)};$e.useId=function(){return Gn.current.useId()};$e.useImperativeHandle=function(e,n,t){return Gn.current.useImperativeHandle(e,n,t)};$e.useInsertionEffect=function(e,n){return Gn.current.useInsertionEffect(e,n)};$e.useLayoutEffect=function(e,n){return Gn.current.useLayoutEffect(e,n)};$e.useMemo=function(e,n){return Gn.current.useMemo(e,n)};$e.useReducer=function(e,n,t){return Gn.current.useReducer(e,n,t)};$e.useRef=function(e){return Gn.current.useRef(e)};$e.useState=function(e){return Gn.current.useState(e)};$e.useSyncExternalStore=function(e,n,t){return Gn.current.useSyncExternalStore(e,n,t)};$e.useTransition=function(){return Gn.current.useTransition()};$e.version="18.3.1";I_.exports=$e;var oe=I_.exports;const Ia=_c(oe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ET=oe,TT=Symbol.for("react.element"),DT=Symbol.for("react.fragment"),IT=Object.prototype.hasOwnProperty,PT=ET.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,AT={key:!0,ref:!0,__self:!0,__source:!0};function z_(e,n,t){var r,i={},o=null,a=null;t!==void 0&&(o=""+t),n.key!==void 0&&(o=""+n.key),n.ref!==void 0&&(a=n.ref);for(r in n)IT.call(n,r)&&!AT.hasOwnProperty(r)&&(i[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps,n)i[r]===void 0&&(i[r]=n[r]);return{$$typeof:TT,type:e,key:o,ref:a,props:i,_owner:PT.current}}Mp.Fragment=DT;Mp.jsx=z_;Mp.jsxs=z_;D_.exports=Mp;var B=D_.exports,Wm={},j_={exports:{}},Sr={},$_={exports:{}},U_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(L,$){var k=L.length;L.push($);e:for(;0<k;){var U=k-1>>>1,X=L[U];if(0<i(X,$))L[U]=$,L[k]=X,k=U;else break e}}function t(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var $=L[0],k=L.pop();if(k!==$){L[0]=k;e:for(var U=0,X=L.length,P=X>>>1;U<P;){var ne=2*(U+1)-1,se=L[ne],te=ne+1,ce=L[te];if(0>i(se,k))te<X&&0>i(ce,se)?(L[U]=ce,L[te]=k,U=te):(L[U]=se,L[ne]=k,U=ne);else if(te<X&&0>i(ce,k))L[U]=ce,L[te]=k,U=te;else break e}}return $}function i(L,$){var k=L.sortIndex-$.sortIndex;return k!==0?k:L.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var c=[],u=[],l=1,d=null,p=3,f=!1,m=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var $=t(u);$!==null;){if($.callback===null)r(u);else if($.startTime<=L)r(u),$.sortIndex=$.expirationTime,n(c,$);else break;$=t(u)}}function b(L){if(g=!1,y(L),!m)if(t(c)!==null)m=!0,H(x);else{var $=t(u);$!==null&&W(b,$.startTime-L)}}function x(L,$){m=!1,g&&(g=!1,h(R),R=-1),f=!0;var k=p;try{for(y($),d=t(c);d!==null&&(!(d.expirationTime>$)||L&&!T());){var U=d.callback;if(typeof U=="function"){d.callback=null,p=d.priorityLevel;var X=U(d.expirationTime<=$);$=e.unstable_now(),typeof X=="function"?d.callback=X:d===t(c)&&r(c),y($)}else r(c);d=t(c)}if(d!==null)var P=!0;else{var ne=t(u);ne!==null&&W(b,ne.startTime-$),P=!1}return P}finally{d=null,p=k,f=!1}}var _=!1,C=null,R=-1,S=5,E=-1;function T(){return!(e.unstable_now()-E<S)}function I(){if(C!==null){var L=e.unstable_now();E=L;var $=!0;try{$=C(!0,L)}finally{$?F():(_=!1,C=null)}}else _=!1}var F;if(typeof w=="function")F=function(){w(I)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,j=z.port2;z.port1.onmessage=I,F=function(){j.postMessage(null)}}else F=function(){v(I,0)};function H(L){C=L,_||(_=!0,F())}function W(L,$){R=v(function(){L(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,H(x))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return t(c)},e.unstable_next=function(L){switch(p){case 1:case 2:case 3:var $=3;break;default:$=p}var k=p;p=$;try{return L()}finally{p=k}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,$){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var k=p;p=L;try{return $()}finally{p=k}},e.unstable_scheduleCallback=function(L,$,k){var U=e.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?U+k:U):k=U,L){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=k+X,L={id:l++,callback:$,priorityLevel:L,startTime:k,expirationTime:X,sortIndex:-1},k>U?(L.sortIndex=k,n(u,L),t(c)===null&&L===t(u)&&(g?(h(R),R=-1):g=!0,W(b,k-U))):(L.sortIndex=X,n(c,L),m||f||(m=!0,H(x))),L},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(L){var $=p;return function(){var k=p;p=$;try{return L.apply(this,arguments)}finally{p=k}}}})(U_);$_.exports=U_;var NT=$_.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MT=oe,_r=NT;function J(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,t=1;t<arguments.length;t++)n+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var W_=new Set,Su={};function Wa(e,n){dc(e,n),dc(e+"Capture",n)}function dc(e,n){for(Su[e]=n,e=0;e<n.length;e++)W_.add(n[e])}var uo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vm=Object.prototype.hasOwnProperty,LT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ww={},bw={};function OT(e){return Vm.call(bw,e)?!0:Vm.call(ww,e)?!1:LT.test(e)?bw[e]=!0:(ww[e]=!0,!1)}function FT(e,n,t,r){if(t!==null&&t.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function BT(e,n,t,r){if(n===null||typeof n>"u"||FT(e,n,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function qn(e,n,t,r,i,o,a){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=e,this.type=n,this.sanitizeURL=o,this.removeEmptyString=a}var yn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){yn[e]=new qn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];yn[n]=new qn(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){yn[e]=new qn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){yn[e]=new qn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){yn[e]=new qn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){yn[e]=new qn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){yn[e]=new qn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){yn[e]=new qn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){yn[e]=new qn(e,5,!1,e.toLowerCase(),null,!1,!1)});var Pv=/[\-:]([a-z])/g;function Av(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(Pv,Av);yn[n]=new qn(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(Pv,Av);yn[n]=new qn(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(Pv,Av);yn[n]=new qn(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){yn[e]=new qn(e,1,!1,e.toLowerCase(),null,!1,!1)});yn.xlinkHref=new qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){yn[e]=new qn(e,1,!1,e.toLowerCase(),null,!0,!0)});function Nv(e,n,t,r){var i=yn.hasOwnProperty(n)?yn[n]:null;(i!==null?i.type!==0:r||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(BT(n,t,i,r)&&(t=null),r||i===null?OT(n)&&(t===null?e.removeAttribute(n):e.setAttribute(n,""+t)):i.mustUseProperty?e[i.propertyName]=t===null?i.type===3?!1:"":t:(n=i.attributeName,r=i.attributeNamespace,t===null?e.removeAttribute(n):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?e.setAttributeNS(r,n,t):e.setAttribute(n,t))))}var ho=MT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sl=Symbol.for("react.element"),Ls=Symbol.for("react.portal"),Os=Symbol.for("react.fragment"),Mv=Symbol.for("react.strict_mode"),Hm=Symbol.for("react.profiler"),V_=Symbol.for("react.provider"),H_=Symbol.for("react.context"),Lv=Symbol.for("react.forward_ref"),Gm=Symbol.for("react.suspense"),qm=Symbol.for("react.suspense_list"),Ov=Symbol.for("react.memo"),Mo=Symbol.for("react.lazy"),G_=Symbol.for("react.offscreen"),xw=Symbol.iterator;function zc(e){return e===null||typeof e!="object"?null:(e=xw&&e[xw]||e["@@iterator"],typeof e=="function"?e:null)}var Dt=Object.assign,hh;function ru(e){if(hh===void 0)try{throw Error()}catch(t){var n=t.stack.trim().match(/\n( *(at )?)/);hh=n&&n[1]||""}return`
`+hh+e}var mh=!1;function gh(e,n){if(!e||mh)return"";mh=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(u){var r=u}Reflect.construct(e,[],n)}else{try{n.call()}catch(u){r=u}e.call(n.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),o=r.stack.split(`
`),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(a!==1||s!==1)do if(a--,s--,0>s||i[a]!==o[s]){var c=`
`+i[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=s);break}}}finally{mh=!1,Error.prepareStackTrace=t}return(e=e?e.displayName||e.name:"")?ru(e):""}function zT(e){switch(e.tag){case 5:return ru(e.type);case 16:return ru("Lazy");case 13:return ru("Suspense");case 19:return ru("SuspenseList");case 0:case 2:case 15:return e=gh(e.type,!1),e;case 11:return e=gh(e.type.render,!1),e;case 1:return e=gh(e.type,!0),e;default:return""}}function Km(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Os:return"Fragment";case Ls:return"Portal";case Hm:return"Profiler";case Mv:return"StrictMode";case Gm:return"Suspense";case qm:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case H_:return(e.displayName||"Context")+".Consumer";case V_:return(e._context.displayName||"Context")+".Provider";case Lv:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ov:return n=e.displayName||null,n!==null?n:Km(e.type)||"Memo";case Mo:n=e._payload,e=e._init;try{return Km(e(n))}catch{}}return null}function jT(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Km(n);case 8:return n===Mv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function ra(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function q_(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function $T(e){var n=q_(e)?"checked":"value",t=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),r=""+e[n];if(!e.hasOwnProperty(n)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,o.call(this,a)}}),Object.defineProperty(e,n,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Cl(e){e._valueTracker||(e._valueTracker=$T(e))}function K_(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var t=n.getValue(),r="";return e&&(r=q_(e)?e.checked?"true":"false":e.value),e=r,e!==t?(n.setValue(e),!0):!1}function zd(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Xm(e,n){var t=n.checked;return Dt({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??e._wrapperState.initialChecked})}function _w(e,n){var t=n.defaultValue==null?"":n.defaultValue,r=n.checked!=null?n.checked:n.defaultChecked;t=ra(n.value!=null?n.value:t),e._wrapperState={initialChecked:r,initialValue:t,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function X_(e,n){n=n.checked,n!=null&&Nv(e,"checked",n,!1)}function Qm(e,n){X_(e,n);var t=ra(n.value),r=n.type;if(t!=null)r==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+t):e.value!==""+t&&(e.value=""+t);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?Ym(e,n.type,t):n.hasOwnProperty("defaultValue")&&Ym(e,n.type,ra(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function Sw(e,n,t){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var r=n.type;if(!(r!=="submit"&&r!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,t||n===e.value||(e.value=n),e.defaultValue=n}t=e.name,t!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,t!==""&&(e.name=t)}function Ym(e,n,t){(n!=="number"||zd(e.ownerDocument)!==e)&&(t==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+t&&(e.defaultValue=""+t))}var iu=Array.isArray;function qs(e,n,t,r){if(e=e.options,n){n={};for(var i=0;i<t.length;i++)n["$"+t[i]]=!0;for(t=0;t<e.length;t++)i=n.hasOwnProperty("$"+e[t].value),e[t].selected!==i&&(e[t].selected=i),i&&r&&(e[t].defaultSelected=!0)}else{for(t=""+ra(t),n=null,i=0;i<e.length;i++){if(e[i].value===t){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}n!==null||e[i].disabled||(n=e[i])}n!==null&&(n.selected=!0)}}function Jm(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(J(91));return Dt({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Cw(e,n){var t=n.value;if(t==null){if(t=n.children,n=n.defaultValue,t!=null){if(n!=null)throw Error(J(92));if(iu(t)){if(1<t.length)throw Error(J(93));t=t[0]}n=t}n==null&&(n=""),t=n}e._wrapperState={initialValue:ra(t)}}function Q_(e,n){var t=ra(n.value),r=ra(n.defaultValue);t!=null&&(t=""+t,t!==e.value&&(e.value=t),n.defaultValue==null&&e.defaultValue!==t&&(e.defaultValue=t)),r!=null&&(e.defaultValue=""+r)}function Rw(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function Y_(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zm(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?Y_(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Rl,J_=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,t,r,i){MSApp.execUnsafeLocalFunction(function(){return e(n,t,r,i)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(Rl=Rl||document.createElement("div"),Rl.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=Rl.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function Cu(e,n){if(n){var t=e.firstChild;if(t&&t===e.lastChild&&t.nodeType===3){t.nodeValue=n;return}}e.textContent=n}var cu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},UT=["Webkit","ms","Moz","O"];Object.keys(cu).forEach(function(e){UT.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),cu[n]=cu[e]})});function Z_(e,n,t){return n==null||typeof n=="boolean"||n===""?"":t||typeof n!="number"||n===0||cu.hasOwnProperty(e)&&cu[e]?(""+n).trim():n+"px"}function eS(e,n){e=e.style;for(var t in n)if(n.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Z_(t,n[t],r);t==="float"&&(t="cssFloat"),r?e.setProperty(t,i):e[t]=i}}var WT=Dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function eg(e,n){if(n){if(WT[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(J(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(J(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(J(61))}if(n.style!=null&&typeof n.style!="object")throw Error(J(62))}}function tg(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ng=null;function Fv(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var rg=null,Ks=null,Xs=null;function kw(e){if(e=Qu(e)){if(typeof rg!="function")throw Error(J(280));var n=e.stateNode;n&&(n=zp(n),rg(e.stateNode,e.type,n))}}function tS(e){Ks?Xs?Xs.push(e):Xs=[e]:Ks=e}function nS(){if(Ks){var e=Ks,n=Xs;if(Xs=Ks=null,kw(e),n)for(e=0;e<n.length;e++)kw(n[e])}}function rS(e,n){return e(n)}function iS(){}var vh=!1;function oS(e,n,t){if(vh)return e(n,t);vh=!0;try{return rS(e,n,t)}finally{vh=!1,(Ks!==null||Xs!==null)&&(iS(),nS())}}function Ru(e,n){var t=e.stateNode;if(t===null)return null;var r=zp(t);if(r===null)return null;t=r[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(t&&typeof t!="function")throw Error(J(231,n,typeof t));return t}var ig=!1;if(uo)try{var jc={};Object.defineProperty(jc,"passive",{get:function(){ig=!0}}),window.addEventListener("test",jc,jc),window.removeEventListener("test",jc,jc)}catch{ig=!1}function VT(e,n,t,r,i,o,a,s,c){var u=Array.prototype.slice.call(arguments,3);try{n.apply(t,u)}catch(l){this.onError(l)}}var uu=!1,jd=null,$d=!1,og=null,HT={onError:function(e){uu=!0,jd=e}};function GT(e,n,t,r,i,o,a,s,c){uu=!1,jd=null,VT.apply(HT,arguments)}function qT(e,n,t,r,i,o,a,s,c){if(GT.apply(this,arguments),uu){if(uu){var u=jd;uu=!1,jd=null}else throw Error(J(198));$d||($d=!0,og=u)}}function Va(e){var n=e,t=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(t=n.return),e=n.return;while(e)}return n.tag===3?t:null}function aS(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function Ew(e){if(Va(e)!==e)throw Error(J(188))}function KT(e){var n=e.alternate;if(!n){if(n=Va(e),n===null)throw Error(J(188));return n!==e?null:e}for(var t=e,r=n;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return Ew(i),e;if(o===r)return Ew(i),n;o=o.sibling}throw Error(J(188))}if(t.return!==r.return)t=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===t){a=!0,t=i,r=o;break}if(s===r){a=!0,r=i,t=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===t){a=!0,t=o,r=i;break}if(s===r){a=!0,r=o,t=i;break}s=s.sibling}if(!a)throw Error(J(189))}}if(t.alternate!==r)throw Error(J(190))}if(t.tag!==3)throw Error(J(188));return t.stateNode.current===t?e:n}function sS(e){return e=KT(e),e!==null?cS(e):null}function cS(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=cS(e);if(n!==null)return n;e=e.sibling}return null}var uS=_r.unstable_scheduleCallback,Tw=_r.unstable_cancelCallback,XT=_r.unstable_shouldYield,QT=_r.unstable_requestPaint,Bt=_r.unstable_now,YT=_r.unstable_getCurrentPriorityLevel,Bv=_r.unstable_ImmediatePriority,lS=_r.unstable_UserBlockingPriority,Ud=_r.unstable_NormalPriority,JT=_r.unstable_LowPriority,dS=_r.unstable_IdlePriority,Lp=null,Ti=null;function ZT(e){if(Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(Lp,e,void 0,(e.current.flags&128)===128)}catch{}}var Yr=Math.clz32?Math.clz32:nD,eD=Math.log,tD=Math.LN2;function nD(e){return e>>>=0,e===0?32:31-(eD(e)/tD|0)|0}var kl=64,El=4194304;function ou(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Wd(e,n){var t=e.pendingLanes;if(t===0)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=t&268435455;if(a!==0){var s=a&~i;s!==0?r=ou(s):(o&=a,o!==0&&(r=ou(o)))}else a=t&~i,a!==0?r=ou(a):o!==0&&(r=ou(o));if(r===0)return 0;if(n!==0&&n!==r&&!(n&i)&&(i=r&-r,o=n&-n,i>=o||i===16&&(o&4194240)!==0))return n;if(r&4&&(r|=t&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=r;0<n;)t=31-Yr(n),i=1<<t,r|=e[t],n&=~i;return r}function rD(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iD(e,n){for(var t=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-Yr(o),s=1<<a,c=i[a];c===-1?(!(s&t)||s&r)&&(i[a]=rD(s,n)):c<=n&&(e.expiredLanes|=s),o&=~s}}function ag(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function pS(){var e=kl;return kl<<=1,!(kl&4194240)&&(kl=64),e}function yh(e){for(var n=[],t=0;31>t;t++)n.push(e);return n}function Ku(e,n,t){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-Yr(n),e[n]=t}function oD(e,n){var t=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<t;){var i=31-Yr(t),o=1<<i;n[i]=0,r[i]=-1,e[i]=-1,t&=~o}}function zv(e,n){var t=e.entangledLanes|=n;for(e=e.entanglements;t;){var r=31-Yr(t),i=1<<r;i&n|e[r]&n&&(e[r]|=n),t&=~i}}var ut=0;function fS(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var hS,jv,mS,gS,vS,sg=!1,Tl=[],Vo=null,Ho=null,Go=null,ku=new Map,Eu=new Map,Fo=[],aD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Dw(e,n){switch(e){case"focusin":case"focusout":Vo=null;break;case"dragenter":case"dragleave":Ho=null;break;case"mouseover":case"mouseout":Go=null;break;case"pointerover":case"pointerout":ku.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Eu.delete(n.pointerId)}}function $c(e,n,t,r,i,o){return e===null||e.nativeEvent!==o?(e={blockedOn:n,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},n!==null&&(n=Qu(n),n!==null&&jv(n)),e):(e.eventSystemFlags|=r,n=e.targetContainers,i!==null&&n.indexOf(i)===-1&&n.push(i),e)}function sD(e,n,t,r,i){switch(n){case"focusin":return Vo=$c(Vo,e,n,t,r,i),!0;case"dragenter":return Ho=$c(Ho,e,n,t,r,i),!0;case"mouseover":return Go=$c(Go,e,n,t,r,i),!0;case"pointerover":var o=i.pointerId;return ku.set(o,$c(ku.get(o)||null,e,n,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Eu.set(o,$c(Eu.get(o)||null,e,n,t,r,i)),!0}return!1}function yS(e){var n=Ra(e.target);if(n!==null){var t=Va(n);if(t!==null){if(n=t.tag,n===13){if(n=aS(t),n!==null){e.blockedOn=n,vS(e.priority,function(){mS(t)});return}}else if(n===3&&t.stateNode.current.memoizedState.isDehydrated){e.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}e.blockedOn=null}function bd(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var t=cg(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(t===null){t=e.nativeEvent;var r=new t.constructor(t.type,t);ng=r,t.target.dispatchEvent(r),ng=null}else return n=Qu(t),n!==null&&jv(n),e.blockedOn=t,!1;n.shift()}return!0}function Iw(e,n,t){bd(e)&&t.delete(n)}function cD(){sg=!1,Vo!==null&&bd(Vo)&&(Vo=null),Ho!==null&&bd(Ho)&&(Ho=null),Go!==null&&bd(Go)&&(Go=null),ku.forEach(Iw),Eu.forEach(Iw)}function Uc(e,n){e.blockedOn===n&&(e.blockedOn=null,sg||(sg=!0,_r.unstable_scheduleCallback(_r.unstable_NormalPriority,cD)))}function Tu(e){function n(i){return Uc(i,e)}if(0<Tl.length){Uc(Tl[0],e);for(var t=1;t<Tl.length;t++){var r=Tl[t];r.blockedOn===e&&(r.blockedOn=null)}}for(Vo!==null&&Uc(Vo,e),Ho!==null&&Uc(Ho,e),Go!==null&&Uc(Go,e),ku.forEach(n),Eu.forEach(n),t=0;t<Fo.length;t++)r=Fo[t],r.blockedOn===e&&(r.blockedOn=null);for(;0<Fo.length&&(t=Fo[0],t.blockedOn===null);)yS(t),t.blockedOn===null&&Fo.shift()}var Qs=ho.ReactCurrentBatchConfig,Vd=!0;function uD(e,n,t,r){var i=ut,o=Qs.transition;Qs.transition=null;try{ut=1,$v(e,n,t,r)}finally{ut=i,Qs.transition=o}}function lD(e,n,t,r){var i=ut,o=Qs.transition;Qs.transition=null;try{ut=4,$v(e,n,t,r)}finally{ut=i,Qs.transition=o}}function $v(e,n,t,r){if(Vd){var i=cg(e,n,t,r);if(i===null)Th(e,n,r,Hd,t),Dw(e,r);else if(sD(i,e,n,t,r))r.stopPropagation();else if(Dw(e,r),n&4&&-1<aD.indexOf(e)){for(;i!==null;){var o=Qu(i);if(o!==null&&hS(o),o=cg(e,n,t,r),o===null&&Th(e,n,r,Hd,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else Th(e,n,r,null,t)}}var Hd=null;function cg(e,n,t,r){if(Hd=null,e=Fv(r),e=Ra(e),e!==null)if(n=Va(e),n===null)e=null;else if(t=n.tag,t===13){if(e=aS(n),e!==null)return e;e=null}else if(t===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return Hd=e,null}function wS(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(YT()){case Bv:return 1;case lS:return 4;case Ud:case JT:return 16;case dS:return 536870912;default:return 16}default:return 16}}var zo=null,Uv=null,xd=null;function bS(){if(xd)return xd;var e,n=Uv,t=n.length,r,i="value"in zo?zo.value:zo.textContent,o=i.length;for(e=0;e<t&&n[e]===i[e];e++);var a=t-e;for(r=1;r<=a&&n[t-r]===i[o-r];r++);return xd=i.slice(e,1<r?1-r:void 0)}function _d(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Dl(){return!0}function Pw(){return!1}function Cr(e){function n(t,r,i,o,a){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(o):o[s]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Dl:Pw,this.isPropagationStopped=Pw,this}return Dt(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Dl)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Dl)},persist:function(){},isPersistent:Dl}),n}var Cc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wv=Cr(Cc),Xu=Dt({},Cc,{view:0,detail:0}),dD=Cr(Xu),wh,bh,Wc,Op=Dt({},Xu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vv,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Wc&&(Wc&&e.type==="mousemove"?(wh=e.screenX-Wc.screenX,bh=e.screenY-Wc.screenY):bh=wh=0,Wc=e),wh)},movementY:function(e){return"movementY"in e?e.movementY:bh}}),Aw=Cr(Op),pD=Dt({},Op,{dataTransfer:0}),fD=Cr(pD),hD=Dt({},Xu,{relatedTarget:0}),xh=Cr(hD),mD=Dt({},Cc,{animationName:0,elapsedTime:0,pseudoElement:0}),gD=Cr(mD),vD=Dt({},Cc,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yD=Cr(vD),wD=Dt({},Cc,{data:0}),Nw=Cr(wD),bD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xD={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_D={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function SD(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=_D[e])?!!n[e]:!1}function Vv(){return SD}var CD=Dt({},Xu,{key:function(e){if(e.key){var n=bD[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=_d(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?xD[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vv,charCode:function(e){return e.type==="keypress"?_d(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?_d(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),RD=Cr(CD),kD=Dt({},Op,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Mw=Cr(kD),ED=Dt({},Xu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vv}),TD=Cr(ED),DD=Dt({},Cc,{propertyName:0,elapsedTime:0,pseudoElement:0}),ID=Cr(DD),PD=Dt({},Op,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),AD=Cr(PD),ND=[9,13,27,32],Hv=uo&&"CompositionEvent"in window,lu=null;uo&&"documentMode"in document&&(lu=document.documentMode);var MD=uo&&"TextEvent"in window&&!lu,xS=uo&&(!Hv||lu&&8<lu&&11>=lu),Lw=" ",Ow=!1;function _S(e,n){switch(e){case"keyup":return ND.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SS(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Fs=!1;function LD(e,n){switch(e){case"compositionend":return SS(n);case"keypress":return n.which!==32?null:(Ow=!0,Lw);case"textInput":return e=n.data,e===Lw&&Ow?null:e;default:return null}}function OD(e,n){if(Fs)return e==="compositionend"||!Hv&&_S(e,n)?(e=bS(),xd=Uv=zo=null,Fs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return xS&&n.locale!=="ko"?null:n.data;default:return null}}var FD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fw(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!FD[e.type]:n==="textarea"}function CS(e,n,t,r){tS(r),n=Gd(n,"onChange"),0<n.length&&(t=new Wv("onChange","change",null,t,r),e.push({event:t,listeners:n}))}var du=null,Du=null;function BD(e){LS(e,0)}function Fp(e){var n=js(e);if(K_(n))return e}function zD(e,n){if(e==="change")return n}var RS=!1;if(uo){var _h;if(uo){var Sh="oninput"in document;if(!Sh){var Bw=document.createElement("div");Bw.setAttribute("oninput","return;"),Sh=typeof Bw.oninput=="function"}_h=Sh}else _h=!1;RS=_h&&(!document.documentMode||9<document.documentMode)}function zw(){du&&(du.detachEvent("onpropertychange",kS),Du=du=null)}function kS(e){if(e.propertyName==="value"&&Fp(Du)){var n=[];CS(n,Du,e,Fv(e)),oS(BD,n)}}function jD(e,n,t){e==="focusin"?(zw(),du=n,Du=t,du.attachEvent("onpropertychange",kS)):e==="focusout"&&zw()}function $D(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Fp(Du)}function UD(e,n){if(e==="click")return Fp(n)}function WD(e,n){if(e==="input"||e==="change")return Fp(n)}function VD(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var ni=typeof Object.is=="function"?Object.is:VD;function Iu(e,n){if(ni(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var t=Object.keys(e),r=Object.keys(n);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Vm.call(n,i)||!ni(e[i],n[i]))return!1}return!0}function jw(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $w(e,n){var t=jw(e);e=0;for(var r;t;){if(t.nodeType===3){if(r=e+t.textContent.length,e<=n&&r>=n)return{node:t,offset:n-e};e=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=jw(t)}}function ES(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?ES(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function TS(){for(var e=window,n=zd();n instanceof e.HTMLIFrameElement;){try{var t=typeof n.contentWindow.location.href=="string"}catch{t=!1}if(t)e=n.contentWindow;else break;n=zd(e.document)}return n}function Gv(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function HD(e){var n=TS(),t=e.focusedElem,r=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&ES(t.ownerDocument.documentElement,t)){if(r!==null&&Gv(t)){if(n=r.start,e=r.end,e===void 0&&(e=n),"selectionStart"in t)t.selectionStart=n,t.selectionEnd=Math.min(e,t.value.length);else if(e=(n=t.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=$w(t,o);var a=$w(t,r);i&&a&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(n=n.createRange(),n.setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(n),e.extend(a.node,a.offset)):(n.setEnd(a.node,a.offset),e.addRange(n)))}}for(n=[],e=t;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<n.length;t++)e=n[t],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var GD=uo&&"documentMode"in document&&11>=document.documentMode,Bs=null,ug=null,pu=null,lg=!1;function Uw(e,n,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;lg||Bs==null||Bs!==zd(r)||(r=Bs,"selectionStart"in r&&Gv(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),pu&&Iu(pu,r)||(pu=r,r=Gd(ug,"onSelect"),0<r.length&&(n=new Wv("onSelect","select",null,n,t),e.push({event:n,listeners:r}),n.target=Bs)))}function Il(e,n){var t={};return t[e.toLowerCase()]=n.toLowerCase(),t["Webkit"+e]="webkit"+n,t["Moz"+e]="moz"+n,t}var zs={animationend:Il("Animation","AnimationEnd"),animationiteration:Il("Animation","AnimationIteration"),animationstart:Il("Animation","AnimationStart"),transitionend:Il("Transition","TransitionEnd")},Ch={},DS={};uo&&(DS=document.createElement("div").style,"AnimationEvent"in window||(delete zs.animationend.animation,delete zs.animationiteration.animation,delete zs.animationstart.animation),"TransitionEvent"in window||delete zs.transitionend.transition);function Bp(e){if(Ch[e])return Ch[e];if(!zs[e])return e;var n=zs[e],t;for(t in n)if(n.hasOwnProperty(t)&&t in DS)return Ch[e]=n[t];return e}var IS=Bp("animationend"),PS=Bp("animationiteration"),AS=Bp("animationstart"),NS=Bp("transitionend"),MS=new Map,Ww="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ca(e,n){MS.set(e,n),Wa(n,[e])}for(var Rh=0;Rh<Ww.length;Rh++){var kh=Ww[Rh],qD=kh.toLowerCase(),KD=kh[0].toUpperCase()+kh.slice(1);ca(qD,"on"+KD)}ca(IS,"onAnimationEnd");ca(PS,"onAnimationIteration");ca(AS,"onAnimationStart");ca("dblclick","onDoubleClick");ca("focusin","onFocus");ca("focusout","onBlur");ca(NS,"onTransitionEnd");dc("onMouseEnter",["mouseout","mouseover"]);dc("onMouseLeave",["mouseout","mouseover"]);dc("onPointerEnter",["pointerout","pointerover"]);dc("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var au="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XD=new Set("cancel close invalid load scroll toggle".split(" ").concat(au));function Vw(e,n,t){var r=e.type||"unknown-event";e.currentTarget=t,qT(r,n,void 0,e),e.currentTarget=null}function LS(e,n){n=(n&4)!==0;for(var t=0;t<e.length;t++){var r=e[t],i=r.event;r=r.listeners;e:{var o=void 0;if(n)for(var a=r.length-1;0<=a;a--){var s=r[a],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;Vw(i,s,u),o=c}else for(a=0;a<r.length;a++){if(s=r[a],c=s.instance,u=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;Vw(i,s,u),o=c}}}if($d)throw e=og,$d=!1,og=null,e}function bt(e,n){var t=n[mg];t===void 0&&(t=n[mg]=new Set);var r=e+"__bubble";t.has(r)||(OS(n,e,2,!1),t.add(r))}function Eh(e,n,t){var r=0;n&&(r|=4),OS(t,e,r,n)}var Pl="_reactListening"+Math.random().toString(36).slice(2);function Pu(e){if(!e[Pl]){e[Pl]=!0,W_.forEach(function(t){t!=="selectionchange"&&(XD.has(t)||Eh(t,!1,e),Eh(t,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Pl]||(n[Pl]=!0,Eh("selectionchange",!1,n))}}function OS(e,n,t,r){switch(wS(n)){case 1:var i=uD;break;case 4:i=lD;break;default:i=$v}t=i.bind(null,n,t,e),i=void 0,!ig||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(n,t,{capture:!0,passive:i}):e.addEventListener(n,t,!0):i!==void 0?e.addEventListener(n,t,{passive:i}):e.addEventListener(n,t,!1)}function Th(e,n,t,r,i){var o=r;if(!(n&1)&&!(n&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var s=r.stateNode.containerInfo;if(s===i||s.nodeType===8&&s.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;a=a.return}for(;s!==null;){if(a=Ra(s),a===null)return;if(c=a.tag,c===5||c===6){r=o=a;continue e}s=s.parentNode}}r=r.return}oS(function(){var u=o,l=Fv(t),d=[];e:{var p=MS.get(e);if(p!==void 0){var f=Wv,m=e;switch(e){case"keypress":if(_d(t)===0)break e;case"keydown":case"keyup":f=RD;break;case"focusin":m="focus",f=xh;break;case"focusout":m="blur",f=xh;break;case"beforeblur":case"afterblur":f=xh;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Aw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=fD;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=TD;break;case IS:case PS:case AS:f=gD;break;case NS:f=ID;break;case"scroll":f=dD;break;case"wheel":f=AD;break;case"copy":case"cut":case"paste":f=yD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Mw}var g=(n&4)!==0,v=!g&&e==="scroll",h=g?p!==null?p+"Capture":null:p;g=[];for(var w=u,y;w!==null;){y=w;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,h!==null&&(b=Ru(w,h),b!=null&&g.push(Au(w,b,y)))),v)break;w=w.return}0<g.length&&(p=new f(p,m,null,t,l),d.push({event:p,listeners:g}))}}if(!(n&7)){e:{if(p=e==="mouseover"||e==="pointerover",f=e==="mouseout"||e==="pointerout",p&&t!==ng&&(m=t.relatedTarget||t.fromElement)&&(Ra(m)||m[lo]))break e;if((f||p)&&(p=l.window===l?l:(p=l.ownerDocument)?p.defaultView||p.parentWindow:window,f?(m=t.relatedTarget||t.toElement,f=u,m=m?Ra(m):null,m!==null&&(v=Va(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=u),f!==m)){if(g=Aw,b="onMouseLeave",h="onMouseEnter",w="mouse",(e==="pointerout"||e==="pointerover")&&(g=Mw,b="onPointerLeave",h="onPointerEnter",w="pointer"),v=f==null?p:js(f),y=m==null?p:js(m),p=new g(b,w+"leave",f,t,l),p.target=v,p.relatedTarget=y,b=null,Ra(l)===u&&(g=new g(h,w+"enter",m,t,l),g.target=y,g.relatedTarget=v,b=g),v=b,f&&m)t:{for(g=f,h=m,w=0,y=g;y;y=os(y))w++;for(y=0,b=h;b;b=os(b))y++;for(;0<w-y;)g=os(g),w--;for(;0<y-w;)h=os(h),y--;for(;w--;){if(g===h||h!==null&&g===h.alternate)break t;g=os(g),h=os(h)}g=null}else g=null;f!==null&&Hw(d,p,f,g,!1),m!==null&&v!==null&&Hw(d,v,m,g,!0)}}e:{if(p=u?js(u):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var x=zD;else if(Fw(p))if(RS)x=WD;else{x=$D;var _=jD}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(x=UD);if(x&&(x=x(e,u))){CS(d,x,t,l);break e}_&&_(e,p,u),e==="focusout"&&(_=p._wrapperState)&&_.controlled&&p.type==="number"&&Ym(p,"number",p.value)}switch(_=u?js(u):window,e){case"focusin":(Fw(_)||_.contentEditable==="true")&&(Bs=_,ug=u,pu=null);break;case"focusout":pu=ug=Bs=null;break;case"mousedown":lg=!0;break;case"contextmenu":case"mouseup":case"dragend":lg=!1,Uw(d,t,l);break;case"selectionchange":if(GD)break;case"keydown":case"keyup":Uw(d,t,l)}var C;if(Hv)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Fs?_S(e,t)&&(R="onCompositionEnd"):e==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(xS&&t.locale!=="ko"&&(Fs||R!=="onCompositionStart"?R==="onCompositionEnd"&&Fs&&(C=bS()):(zo=l,Uv="value"in zo?zo.value:zo.textContent,Fs=!0)),_=Gd(u,R),0<_.length&&(R=new Nw(R,e,null,t,l),d.push({event:R,listeners:_}),C?R.data=C:(C=SS(t),C!==null&&(R.data=C)))),(C=MD?LD(e,t):OD(e,t))&&(u=Gd(u,"onBeforeInput"),0<u.length&&(l=new Nw("onBeforeInput","beforeinput",null,t,l),d.push({event:l,listeners:u}),l.data=C))}LS(d,n)})}function Au(e,n,t){return{instance:e,listener:n,currentTarget:t}}function Gd(e,n){for(var t=n+"Capture",r=[];e!==null;){var i=e,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Ru(e,t),o!=null&&r.unshift(Au(e,o,i)),o=Ru(e,n),o!=null&&r.push(Au(e,o,i))),e=e.return}return r}function os(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Hw(e,n,t,r,i){for(var o=n._reactName,a=[];t!==null&&t!==r;){var s=t,c=s.alternate,u=s.stateNode;if(c!==null&&c===r)break;s.tag===5&&u!==null&&(s=u,i?(c=Ru(t,o),c!=null&&a.unshift(Au(t,c,s))):i||(c=Ru(t,o),c!=null&&a.push(Au(t,c,s)))),t=t.return}a.length!==0&&e.push({event:n,listeners:a})}var QD=/\r\n?/g,YD=/\u0000|\uFFFD/g;function Gw(e){return(typeof e=="string"?e:""+e).replace(QD,`
`).replace(YD,"")}function Al(e,n,t){if(n=Gw(n),Gw(e)!==n&&t)throw Error(J(425))}function qd(){}var dg=null,pg=null;function fg(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var hg=typeof setTimeout=="function"?setTimeout:void 0,JD=typeof clearTimeout=="function"?clearTimeout:void 0,qw=typeof Promise=="function"?Promise:void 0,ZD=typeof queueMicrotask=="function"?queueMicrotask:typeof qw<"u"?function(e){return qw.resolve(null).then(e).catch(eI)}:hg;function eI(e){setTimeout(function(){throw e})}function Dh(e,n){var t=n,r=0;do{var i=t.nextSibling;if(e.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){e.removeChild(i),Tu(n);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Tu(n)}function qo(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function Kw(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var t=e.data;if(t==="$"||t==="$!"||t==="$?"){if(n===0)return e;n--}else t==="/$"&&n++}e=e.previousSibling}return null}var Rc=Math.random().toString(36).slice(2),Si="__reactFiber$"+Rc,Nu="__reactProps$"+Rc,lo="__reactContainer$"+Rc,mg="__reactEvents$"+Rc,tI="__reactListeners$"+Rc,nI="__reactHandles$"+Rc;function Ra(e){var n=e[Si];if(n)return n;for(var t=e.parentNode;t;){if(n=t[lo]||t[Si]){if(t=n.alternate,n.child!==null||t!==null&&t.child!==null)for(e=Kw(e);e!==null;){if(t=e[Si])return t;e=Kw(e)}return n}e=t,t=e.parentNode}return null}function Qu(e){return e=e[Si]||e[lo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function js(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(J(33))}function zp(e){return e[Nu]||null}var gg=[],$s=-1;function ua(e){return{current:e}}function _t(e){0>$s||(e.current=gg[$s],gg[$s]=null,$s--)}function vt(e,n){$s++,gg[$s]=e.current,e.current=n}var ia={},On=ua(ia),tr=ua(!1),Ma=ia;function pc(e,n){var t=e.type.contextTypes;if(!t)return ia;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===n)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=n[o];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=i),i}function nr(e){return e=e.childContextTypes,e!=null}function Kd(){_t(tr),_t(On)}function Xw(e,n,t){if(On.current!==ia)throw Error(J(168));vt(On,n),vt(tr,t)}function FS(e,n,t){var r=e.stateNode;if(n=n.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in n))throw Error(J(108,jT(e)||"Unknown",i));return Dt({},t,r)}function Xd(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ia,Ma=On.current,vt(On,e),vt(tr,tr.current),!0}function Qw(e,n,t){var r=e.stateNode;if(!r)throw Error(J(169));t?(e=FS(e,n,Ma),r.__reactInternalMemoizedMergedChildContext=e,_t(tr),_t(On),vt(On,e)):_t(tr),vt(tr,t)}var ro=null,jp=!1,Ih=!1;function BS(e){ro===null?ro=[e]:ro.push(e)}function rI(e){jp=!0,BS(e)}function la(){if(!Ih&&ro!==null){Ih=!0;var e=0,n=ut;try{var t=ro;for(ut=1;e<t.length;e++){var r=t[e];do r=r(!0);while(r!==null)}ro=null,jp=!1}catch(i){throw ro!==null&&(ro=ro.slice(e+1)),uS(Bv,la),i}finally{ut=n,Ih=!1}}return null}var Us=[],Ws=0,Qd=null,Yd=0,Tr=[],Dr=0,La=null,ao=1,so="";function wa(e,n){Us[Ws++]=Yd,Us[Ws++]=Qd,Qd=e,Yd=n}function zS(e,n,t){Tr[Dr++]=ao,Tr[Dr++]=so,Tr[Dr++]=La,La=e;var r=ao;e=so;var i=32-Yr(r)-1;r&=~(1<<i),t+=1;var o=32-Yr(n)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,ao=1<<32-Yr(n)+i|t<<i|r,so=o+e}else ao=1<<o|t<<i|r,so=e}function qv(e){e.return!==null&&(wa(e,1),zS(e,1,0))}function Kv(e){for(;e===Qd;)Qd=Us[--Ws],Us[Ws]=null,Yd=Us[--Ws],Us[Ws]=null;for(;e===La;)La=Tr[--Dr],Tr[Dr]=null,so=Tr[--Dr],Tr[Dr]=null,ao=Tr[--Dr],Tr[Dr]=null}var br=null,mr=null,St=!1,Kr=null;function jS(e,n){var t=Mr(5,null,null,0);t.elementType="DELETED",t.stateNode=n,t.return=e,n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)}function Yw(e,n){switch(e.tag){case 5:var t=e.type;return n=n.nodeType!==1||t.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,br=e,mr=qo(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,br=e,mr=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(t=La!==null?{id:ao,overflow:so}:null,e.memoizedState={dehydrated:n,treeContext:t,retryLane:1073741824},t=Mr(18,null,null,0),t.stateNode=n,t.return=e,e.child=t,br=e,mr=null,!0):!1;default:return!1}}function vg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function yg(e){if(St){var n=mr;if(n){var t=n;if(!Yw(e,n)){if(vg(e))throw Error(J(418));n=qo(t.nextSibling);var r=br;n&&Yw(e,n)?jS(r,t):(e.flags=e.flags&-4097|2,St=!1,br=e)}}else{if(vg(e))throw Error(J(418));e.flags=e.flags&-4097|2,St=!1,br=e}}}function Jw(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;br=e}function Nl(e){if(e!==br)return!1;if(!St)return Jw(e),St=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!fg(e.type,e.memoizedProps)),n&&(n=mr)){if(vg(e))throw $S(),Error(J(418));for(;n;)jS(e,n),n=qo(n.nextSibling)}if(Jw(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(J(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var t=e.data;if(t==="/$"){if(n===0){mr=qo(e.nextSibling);break e}n--}else t!=="$"&&t!=="$!"&&t!=="$?"||n++}e=e.nextSibling}mr=null}}else mr=br?qo(e.stateNode.nextSibling):null;return!0}function $S(){for(var e=mr;e;)e=qo(e.nextSibling)}function fc(){mr=br=null,St=!1}function Xv(e){Kr===null?Kr=[e]:Kr.push(e)}var iI=ho.ReactCurrentBatchConfig;function Vc(e,n,t){if(e=t.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(J(309));var r=t.stateNode}if(!r)throw Error(J(147,e));var i=r,o=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===o?n.ref:(n=function(a){var s=i.refs;a===null?delete s[o]:s[o]=a},n._stringRef=o,n)}if(typeof e!="string")throw Error(J(284));if(!t._owner)throw Error(J(290,e))}return e}function Ml(e,n){throw e=Object.prototype.toString.call(n),Error(J(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function Zw(e){var n=e._init;return n(e._payload)}function US(e){function n(h,w){if(e){var y=h.deletions;y===null?(h.deletions=[w],h.flags|=16):y.push(w)}}function t(h,w){if(!e)return null;for(;w!==null;)n(h,w),w=w.sibling;return null}function r(h,w){for(h=new Map;w!==null;)w.key!==null?h.set(w.key,w):h.set(w.index,w),w=w.sibling;return h}function i(h,w){return h=Yo(h,w),h.index=0,h.sibling=null,h}function o(h,w,y){return h.index=y,e?(y=h.alternate,y!==null?(y=y.index,y<w?(h.flags|=2,w):y):(h.flags|=2,w)):(h.flags|=1048576,w)}function a(h){return e&&h.alternate===null&&(h.flags|=2),h}function s(h,w,y,b){return w===null||w.tag!==6?(w=Fh(y,h.mode,b),w.return=h,w):(w=i(w,y),w.return=h,w)}function c(h,w,y,b){var x=y.type;return x===Os?l(h,w,y.props.children,b,y.key):w!==null&&(w.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Mo&&Zw(x)===w.type)?(b=i(w,y.props),b.ref=Vc(h,w,y),b.return=h,b):(b=Dd(y.type,y.key,y.props,null,h.mode,b),b.ref=Vc(h,w,y),b.return=h,b)}function u(h,w,y,b){return w===null||w.tag!==4||w.stateNode.containerInfo!==y.containerInfo||w.stateNode.implementation!==y.implementation?(w=Bh(y,h.mode,b),w.return=h,w):(w=i(w,y.children||[]),w.return=h,w)}function l(h,w,y,b,x){return w===null||w.tag!==7?(w=Aa(y,h.mode,b,x),w.return=h,w):(w=i(w,y),w.return=h,w)}function d(h,w,y){if(typeof w=="string"&&w!==""||typeof w=="number")return w=Fh(""+w,h.mode,y),w.return=h,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Sl:return y=Dd(w.type,w.key,w.props,null,h.mode,y),y.ref=Vc(h,null,w),y.return=h,y;case Ls:return w=Bh(w,h.mode,y),w.return=h,w;case Mo:var b=w._init;return d(h,b(w._payload),y)}if(iu(w)||zc(w))return w=Aa(w,h.mode,y,null),w.return=h,w;Ml(h,w)}return null}function p(h,w,y,b){var x=w!==null?w.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return x!==null?null:s(h,w,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Sl:return y.key===x?c(h,w,y,b):null;case Ls:return y.key===x?u(h,w,y,b):null;case Mo:return x=y._init,p(h,w,x(y._payload),b)}if(iu(y)||zc(y))return x!==null?null:l(h,w,y,b,null);Ml(h,y)}return null}function f(h,w,y,b,x){if(typeof b=="string"&&b!==""||typeof b=="number")return h=h.get(y)||null,s(w,h,""+b,x);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Sl:return h=h.get(b.key===null?y:b.key)||null,c(w,h,b,x);case Ls:return h=h.get(b.key===null?y:b.key)||null,u(w,h,b,x);case Mo:var _=b._init;return f(h,w,y,_(b._payload),x)}if(iu(b)||zc(b))return h=h.get(y)||null,l(w,h,b,x,null);Ml(w,b)}return null}function m(h,w,y,b){for(var x=null,_=null,C=w,R=w=0,S=null;C!==null&&R<y.length;R++){C.index>R?(S=C,C=null):S=C.sibling;var E=p(h,C,y[R],b);if(E===null){C===null&&(C=S);break}e&&C&&E.alternate===null&&n(h,C),w=o(E,w,R),_===null?x=E:_.sibling=E,_=E,C=S}if(R===y.length)return t(h,C),St&&wa(h,R),x;if(C===null){for(;R<y.length;R++)C=d(h,y[R],b),C!==null&&(w=o(C,w,R),_===null?x=C:_.sibling=C,_=C);return St&&wa(h,R),x}for(C=r(h,C);R<y.length;R++)S=f(C,h,R,y[R],b),S!==null&&(e&&S.alternate!==null&&C.delete(S.key===null?R:S.key),w=o(S,w,R),_===null?x=S:_.sibling=S,_=S);return e&&C.forEach(function(T){return n(h,T)}),St&&wa(h,R),x}function g(h,w,y,b){var x=zc(y);if(typeof x!="function")throw Error(J(150));if(y=x.call(y),y==null)throw Error(J(151));for(var _=x=null,C=w,R=w=0,S=null,E=y.next();C!==null&&!E.done;R++,E=y.next()){C.index>R?(S=C,C=null):S=C.sibling;var T=p(h,C,E.value,b);if(T===null){C===null&&(C=S);break}e&&C&&T.alternate===null&&n(h,C),w=o(T,w,R),_===null?x=T:_.sibling=T,_=T,C=S}if(E.done)return t(h,C),St&&wa(h,R),x;if(C===null){for(;!E.done;R++,E=y.next())E=d(h,E.value,b),E!==null&&(w=o(E,w,R),_===null?x=E:_.sibling=E,_=E);return St&&wa(h,R),x}for(C=r(h,C);!E.done;R++,E=y.next())E=f(C,h,R,E.value,b),E!==null&&(e&&E.alternate!==null&&C.delete(E.key===null?R:E.key),w=o(E,w,R),_===null?x=E:_.sibling=E,_=E);return e&&C.forEach(function(I){return n(h,I)}),St&&wa(h,R),x}function v(h,w,y,b){if(typeof y=="object"&&y!==null&&y.type===Os&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Sl:e:{for(var x=y.key,_=w;_!==null;){if(_.key===x){if(x=y.type,x===Os){if(_.tag===7){t(h,_.sibling),w=i(_,y.props.children),w.return=h,h=w;break e}}else if(_.elementType===x||typeof x=="object"&&x!==null&&x.$$typeof===Mo&&Zw(x)===_.type){t(h,_.sibling),w=i(_,y.props),w.ref=Vc(h,_,y),w.return=h,h=w;break e}t(h,_);break}else n(h,_);_=_.sibling}y.type===Os?(w=Aa(y.props.children,h.mode,b,y.key),w.return=h,h=w):(b=Dd(y.type,y.key,y.props,null,h.mode,b),b.ref=Vc(h,w,y),b.return=h,h=b)}return a(h);case Ls:e:{for(_=y.key;w!==null;){if(w.key===_)if(w.tag===4&&w.stateNode.containerInfo===y.containerInfo&&w.stateNode.implementation===y.implementation){t(h,w.sibling),w=i(w,y.children||[]),w.return=h,h=w;break e}else{t(h,w);break}else n(h,w);w=w.sibling}w=Bh(y,h.mode,b),w.return=h,h=w}return a(h);case Mo:return _=y._init,v(h,w,_(y._payload),b)}if(iu(y))return m(h,w,y,b);if(zc(y))return g(h,w,y,b);Ml(h,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,w!==null&&w.tag===6?(t(h,w.sibling),w=i(w,y),w.return=h,h=w):(t(h,w),w=Fh(y,h.mode,b),w.return=h,h=w),a(h)):t(h,w)}return v}var hc=US(!0),WS=US(!1),Jd=ua(null),Zd=null,Vs=null,Qv=null;function Yv(){Qv=Vs=Zd=null}function Jv(e){var n=Jd.current;_t(Jd),e._currentValue=n}function wg(e,n,t){for(;e!==null;){var r=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,r!==null&&(r.childLanes|=n)):r!==null&&(r.childLanes&n)!==n&&(r.childLanes|=n),e===t)break;e=e.return}}function Ys(e,n){Zd=e,Qv=Vs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(Zn=!0),e.firstContext=null)}function Fr(e){var n=e._currentValue;if(Qv!==e)if(e={context:e,memoizedValue:n,next:null},Vs===null){if(Zd===null)throw Error(J(308));Vs=e,Zd.dependencies={lanes:0,firstContext:e}}else Vs=Vs.next=e;return n}var ka=null;function Zv(e){ka===null?ka=[e]:ka.push(e)}function VS(e,n,t,r){var i=n.interleaved;return i===null?(t.next=t,Zv(n)):(t.next=i.next,i.next=t),n.interleaved=t,po(e,r)}function po(e,n){e.lanes|=n;var t=e.alternate;for(t!==null&&(t.lanes|=n),t=e,e=e.return;e!==null;)e.childLanes|=n,t=e.alternate,t!==null&&(t.childLanes|=n),t=e,e=e.return;return t.tag===3?t.stateNode:null}var Lo=!1;function ey(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function HS(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function co(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Ko(e,n,t){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ye&2){var i=r.pending;return i===null?n.next=n:(n.next=i.next,i.next=n),r.pending=n,po(e,t)}return i=r.interleaved,i===null?(n.next=n,Zv(r)):(n.next=i.next,i.next=n),r.interleaved=n,po(e,t)}function Sd(e,n,t){if(n=n.updateQueue,n!==null&&(n=n.shared,(t&4194240)!==0)){var r=n.lanes;r&=e.pendingLanes,t|=r,n.lanes=t,zv(e,t)}}function e1(e,n){var t=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=a:o=o.next=a,t=t.next}while(t!==null);o===null?i=o=n:o=o.next=n}else i=o=n;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},e.updateQueue=t;return}e=t.lastBaseUpdate,e===null?t.firstBaseUpdate=n:e.next=n,t.lastBaseUpdate=n}function ep(e,n,t,r){var i=e.updateQueue;Lo=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,u=c.next;c.next=null,a===null?o=u:a.next=u,a=c;var l=e.alternate;l!==null&&(l=l.updateQueue,s=l.lastBaseUpdate,s!==a&&(s===null?l.firstBaseUpdate=u:s.next=u,l.lastBaseUpdate=c))}if(o!==null){var d=i.baseState;a=0,l=u=c=null,s=o;do{var p=s.lane,f=s.eventTime;if((r&p)===p){l!==null&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,g=s;switch(p=n,f=t,g.tag){case 1:if(m=g.payload,typeof m=="function"){d=m.call(f,d,p);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,p=typeof m=="function"?m.call(f,d,p):m,p==null)break e;d=Dt({},d,p);break e;case 2:Lo=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,p=i.effects,p===null?i.effects=[s]:p.push(s))}else f={eventTime:f,lane:p,tag:s.tag,payload:s.payload,callback:s.callback,next:null},l===null?(u=l=f,c=d):l=l.next=f,a|=p;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;p=s,s=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(l===null&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=l,n=i.shared.interleaved,n!==null){i=n;do a|=i.lane,i=i.next;while(i!==n)}else o===null&&(i.shared.lanes=0);Fa|=a,e.lanes=a,e.memoizedState=d}}function t1(e,n,t){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var r=e[n],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(J(191,i));i.call(r)}}}var Yu={},Di=ua(Yu),Mu=ua(Yu),Lu=ua(Yu);function Ea(e){if(e===Yu)throw Error(J(174));return e}function ty(e,n){switch(vt(Lu,n),vt(Mu,e),vt(Di,Yu),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:Zm(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=Zm(n,e)}_t(Di),vt(Di,n)}function mc(){_t(Di),_t(Mu),_t(Lu)}function GS(e){Ea(Lu.current);var n=Ea(Di.current),t=Zm(n,e.type);n!==t&&(vt(Mu,e),vt(Di,t))}function ny(e){Mu.current===e&&(_t(Di),_t(Mu))}var Rt=ua(0);function tp(e){for(var n=e;n!==null;){if(n.tag===13){var t=n.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Ph=[];function ry(){for(var e=0;e<Ph.length;e++)Ph[e]._workInProgressVersionPrimary=null;Ph.length=0}var Cd=ho.ReactCurrentDispatcher,Ah=ho.ReactCurrentBatchConfig,Oa=0,Tt=null,Kt=null,an=null,np=!1,fu=!1,Ou=0,oI=0;function _n(){throw Error(J(321))}function iy(e,n){if(n===null)return!1;for(var t=0;t<n.length&&t<e.length;t++)if(!ni(e[t],n[t]))return!1;return!0}function oy(e,n,t,r,i,o){if(Oa=o,Tt=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Cd.current=e===null||e.memoizedState===null?uI:lI,e=t(r,i),fu){o=0;do{if(fu=!1,Ou=0,25<=o)throw Error(J(301));o+=1,an=Kt=null,n.updateQueue=null,Cd.current=dI,e=t(r,i)}while(fu)}if(Cd.current=rp,n=Kt!==null&&Kt.next!==null,Oa=0,an=Kt=Tt=null,np=!1,n)throw Error(J(300));return e}function ay(){var e=Ou!==0;return Ou=0,e}function wi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return an===null?Tt.memoizedState=an=e:an=an.next=e,an}function Br(){if(Kt===null){var e=Tt.alternate;e=e!==null?e.memoizedState:null}else e=Kt.next;var n=an===null?Tt.memoizedState:an.next;if(n!==null)an=n,Kt=e;else{if(e===null)throw Error(J(310));Kt=e,e={memoizedState:Kt.memoizedState,baseState:Kt.baseState,baseQueue:Kt.baseQueue,queue:Kt.queue,next:null},an===null?Tt.memoizedState=an=e:an=an.next=e}return an}function Fu(e,n){return typeof n=="function"?n(e):n}function Nh(e){var n=Br(),t=n.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=e;var r=Kt,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var s=a=null,c=null,u=o;do{var l=u.lane;if((Oa&l)===l)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:l,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(s=c=d,a=r):c=c.next=d,Tt.lanes|=l,Fa|=l}u=u.next}while(u!==null&&u!==o);c===null?a=r:c.next=s,ni(r,n.memoizedState)||(Zn=!0),n.memoizedState=r,n.baseState=a,n.baseQueue=c,t.lastRenderedState=r}if(e=t.interleaved,e!==null){i=e;do o=i.lane,Tt.lanes|=o,Fa|=o,i=i.next;while(i!==e)}else i===null&&(t.lanes=0);return[n.memoizedState,t.dispatch]}function Mh(e){var n=Br(),t=n.queue;if(t===null)throw Error(J(311));t.lastRenderedReducer=e;var r=t.dispatch,i=t.pending,o=n.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do o=e(o,a.action),a=a.next;while(a!==i);ni(o,n.memoizedState)||(Zn=!0),n.memoizedState=o,n.baseQueue===null&&(n.baseState=o),t.lastRenderedState=o}return[o,r]}function qS(){}function KS(e,n){var t=Tt,r=Br(),i=n(),o=!ni(r.memoizedState,i);if(o&&(r.memoizedState=i,Zn=!0),r=r.queue,sy(YS.bind(null,t,r,e),[e]),r.getSnapshot!==n||o||an!==null&&an.memoizedState.tag&1){if(t.flags|=2048,Bu(9,QS.bind(null,t,r,i,n),void 0,null),sn===null)throw Error(J(349));Oa&30||XS(t,n,i)}return i}function XS(e,n,t){e.flags|=16384,e={getSnapshot:n,value:t},n=Tt.updateQueue,n===null?(n={lastEffect:null,stores:null},Tt.updateQueue=n,n.stores=[e]):(t=n.stores,t===null?n.stores=[e]:t.push(e))}function QS(e,n,t,r){n.value=t,n.getSnapshot=r,JS(n)&&ZS(e)}function YS(e,n,t){return t(function(){JS(n)&&ZS(e)})}function JS(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!ni(e,t)}catch{return!0}}function ZS(e){var n=po(e,1);n!==null&&Jr(n,e,1,-1)}function n1(e){var n=wi();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fu,lastRenderedState:e},n.queue=e,e=e.dispatch=cI.bind(null,Tt,e),[n.memoizedState,e]}function Bu(e,n,t,r){return e={tag:e,create:n,destroy:t,deps:r,next:null},n=Tt.updateQueue,n===null?(n={lastEffect:null,stores:null},Tt.updateQueue=n,n.lastEffect=e.next=e):(t=n.lastEffect,t===null?n.lastEffect=e.next=e:(r=t.next,t.next=e,e.next=r,n.lastEffect=e)),e}function e2(){return Br().memoizedState}function Rd(e,n,t,r){var i=wi();Tt.flags|=e,i.memoizedState=Bu(1|n,t,void 0,r===void 0?null:r)}function $p(e,n,t,r){var i=Br();r=r===void 0?null:r;var o=void 0;if(Kt!==null){var a=Kt.memoizedState;if(o=a.destroy,r!==null&&iy(r,a.deps)){i.memoizedState=Bu(n,t,o,r);return}}Tt.flags|=e,i.memoizedState=Bu(1|n,t,o,r)}function r1(e,n){return Rd(8390656,8,e,n)}function sy(e,n){return $p(2048,8,e,n)}function t2(e,n){return $p(4,2,e,n)}function n2(e,n){return $p(4,4,e,n)}function r2(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function i2(e,n,t){return t=t!=null?t.concat([e]):null,$p(4,4,r2.bind(null,n,e),t)}function cy(){}function o2(e,n){var t=Br();n=n===void 0?null:n;var r=t.memoizedState;return r!==null&&n!==null&&iy(n,r[1])?r[0]:(t.memoizedState=[e,n],e)}function a2(e,n){var t=Br();n=n===void 0?null:n;var r=t.memoizedState;return r!==null&&n!==null&&iy(n,r[1])?r[0]:(e=e(),t.memoizedState=[e,n],e)}function s2(e,n,t){return Oa&21?(ni(t,n)||(t=pS(),Tt.lanes|=t,Fa|=t,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,Zn=!0),e.memoizedState=t)}function aI(e,n){var t=ut;ut=t!==0&&4>t?t:4,e(!0);var r=Ah.transition;Ah.transition={};try{e(!1),n()}finally{ut=t,Ah.transition=r}}function c2(){return Br().memoizedState}function sI(e,n,t){var r=Qo(e);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},u2(e))l2(n,t);else if(t=VS(e,n,t,r),t!==null){var i=Hn();Jr(t,e,r,i),d2(t,n,r)}}function cI(e,n,t){var r=Qo(e),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(u2(e))l2(n,i);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=n.lastRenderedReducer,o!==null))try{var a=n.lastRenderedState,s=o(a,t);if(i.hasEagerState=!0,i.eagerState=s,ni(s,a)){var c=n.interleaved;c===null?(i.next=i,Zv(n)):(i.next=c.next,c.next=i),n.interleaved=i;return}}catch{}finally{}t=VS(e,n,i,r),t!==null&&(i=Hn(),Jr(t,e,r,i),d2(t,n,r))}}function u2(e){var n=e.alternate;return e===Tt||n!==null&&n===Tt}function l2(e,n){fu=np=!0;var t=e.pending;t===null?n.next=n:(n.next=t.next,t.next=n),e.pending=n}function d2(e,n,t){if(t&4194240){var r=n.lanes;r&=e.pendingLanes,t|=r,n.lanes=t,zv(e,t)}}var rp={readContext:Fr,useCallback:_n,useContext:_n,useEffect:_n,useImperativeHandle:_n,useInsertionEffect:_n,useLayoutEffect:_n,useMemo:_n,useReducer:_n,useRef:_n,useState:_n,useDebugValue:_n,useDeferredValue:_n,useTransition:_n,useMutableSource:_n,useSyncExternalStore:_n,useId:_n,unstable_isNewReconciler:!1},uI={readContext:Fr,useCallback:function(e,n){return wi().memoizedState=[e,n===void 0?null:n],e},useContext:Fr,useEffect:r1,useImperativeHandle:function(e,n,t){return t=t!=null?t.concat([e]):null,Rd(4194308,4,r2.bind(null,n,e),t)},useLayoutEffect:function(e,n){return Rd(4194308,4,e,n)},useInsertionEffect:function(e,n){return Rd(4,2,e,n)},useMemo:function(e,n){var t=wi();return n=n===void 0?null:n,e=e(),t.memoizedState=[e,n],e},useReducer:function(e,n,t){var r=wi();return n=t!==void 0?t(n):n,r.memoizedState=r.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},r.queue=e,e=e.dispatch=sI.bind(null,Tt,e),[r.memoizedState,e]},useRef:function(e){var n=wi();return e={current:e},n.memoizedState=e},useState:n1,useDebugValue:cy,useDeferredValue:function(e){return wi().memoizedState=e},useTransition:function(){var e=n1(!1),n=e[0];return e=aI.bind(null,e[1]),wi().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,t){var r=Tt,i=wi();if(St){if(t===void 0)throw Error(J(407));t=t()}else{if(t=n(),sn===null)throw Error(J(349));Oa&30||XS(r,n,t)}i.memoizedState=t;var o={value:t,getSnapshot:n};return i.queue=o,r1(YS.bind(null,r,o,e),[e]),r.flags|=2048,Bu(9,QS.bind(null,r,o,t,n),void 0,null),t},useId:function(){var e=wi(),n=sn.identifierPrefix;if(St){var t=so,r=ao;t=(r&~(1<<32-Yr(r)-1)).toString(32)+t,n=":"+n+"R"+t,t=Ou++,0<t&&(n+="H"+t.toString(32)),n+=":"}else t=oI++,n=":"+n+"r"+t.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},lI={readContext:Fr,useCallback:o2,useContext:Fr,useEffect:sy,useImperativeHandle:i2,useInsertionEffect:t2,useLayoutEffect:n2,useMemo:a2,useReducer:Nh,useRef:e2,useState:function(){return Nh(Fu)},useDebugValue:cy,useDeferredValue:function(e){var n=Br();return s2(n,Kt.memoizedState,e)},useTransition:function(){var e=Nh(Fu)[0],n=Br().memoizedState;return[e,n]},useMutableSource:qS,useSyncExternalStore:KS,useId:c2,unstable_isNewReconciler:!1},dI={readContext:Fr,useCallback:o2,useContext:Fr,useEffect:sy,useImperativeHandle:i2,useInsertionEffect:t2,useLayoutEffect:n2,useMemo:a2,useReducer:Mh,useRef:e2,useState:function(){return Mh(Fu)},useDebugValue:cy,useDeferredValue:function(e){var n=Br();return Kt===null?n.memoizedState=e:s2(n,Kt.memoizedState,e)},useTransition:function(){var e=Mh(Fu)[0],n=Br().memoizedState;return[e,n]},useMutableSource:qS,useSyncExternalStore:KS,useId:c2,unstable_isNewReconciler:!1};function Hr(e,n){if(e&&e.defaultProps){n=Dt({},n),e=e.defaultProps;for(var t in e)n[t]===void 0&&(n[t]=e[t]);return n}return n}function bg(e,n,t,r){n=e.memoizedState,t=t(r,n),t=t==null?n:Dt({},n,t),e.memoizedState=t,e.lanes===0&&(e.updateQueue.baseState=t)}var Up={isMounted:function(e){return(e=e._reactInternals)?Va(e)===e:!1},enqueueSetState:function(e,n,t){e=e._reactInternals;var r=Hn(),i=Qo(e),o=co(r,i);o.payload=n,t!=null&&(o.callback=t),n=Ko(e,o,i),n!==null&&(Jr(n,e,i,r),Sd(n,e,i))},enqueueReplaceState:function(e,n,t){e=e._reactInternals;var r=Hn(),i=Qo(e),o=co(r,i);o.tag=1,o.payload=n,t!=null&&(o.callback=t),n=Ko(e,o,i),n!==null&&(Jr(n,e,i,r),Sd(n,e,i))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var t=Hn(),r=Qo(e),i=co(t,r);i.tag=2,n!=null&&(i.callback=n),n=Ko(e,i,r),n!==null&&(Jr(n,e,r,t),Sd(n,e,r))}};function i1(e,n,t,r,i,o,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,o,a):n.prototype&&n.prototype.isPureReactComponent?!Iu(t,r)||!Iu(i,o):!0}function p2(e,n,t){var r=!1,i=ia,o=n.contextType;return typeof o=="object"&&o!==null?o=Fr(o):(i=nr(n)?Ma:On.current,r=n.contextTypes,o=(r=r!=null)?pc(e,i):ia),n=new n(t,o),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Up,e.stateNode=n,n._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),n}function o1(e,n,t,r){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(t,r),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(t,r),n.state!==e&&Up.enqueueReplaceState(n,n.state,null)}function xg(e,n,t,r){var i=e.stateNode;i.props=t,i.state=e.memoizedState,i.refs={},ey(e);var o=n.contextType;typeof o=="object"&&o!==null?i.context=Fr(o):(o=nr(n)?Ma:On.current,i.context=pc(e,o)),i.state=e.memoizedState,o=n.getDerivedStateFromProps,typeof o=="function"&&(bg(e,n,o,t),i.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(n=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),n!==i.state&&Up.enqueueReplaceState(i,i.state,null),ep(e,t,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function gc(e,n){try{var t="",r=n;do t+=zT(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:n,stack:i,digest:null}}function Lh(e,n,t){return{value:e,source:null,stack:t??null,digest:n??null}}function _g(e,n){try{console.error(n.value)}catch(t){setTimeout(function(){throw t})}}var pI=typeof WeakMap=="function"?WeakMap:Map;function f2(e,n,t){t=co(-1,t),t.tag=3,t.payload={element:null};var r=n.value;return t.callback=function(){op||(op=!0,Ag=r),_g(e,n)},t}function h2(e,n,t){t=co(-1,t),t.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=n.value;t.payload=function(){return r(i)},t.callback=function(){_g(e,n)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){_g(e,n),typeof r!="function"&&(Xo===null?Xo=new Set([this]):Xo.add(this));var a=n.stack;this.componentDidCatch(n.value,{componentStack:a!==null?a:""})}),t}function a1(e,n,t){var r=e.pingCache;if(r===null){r=e.pingCache=new pI;var i=new Set;r.set(n,i)}else i=r.get(n),i===void 0&&(i=new Set,r.set(n,i));i.has(t)||(i.add(t),e=kI.bind(null,e,n,t),n.then(e,e))}function s1(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function c1(e,n,t,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===n?e.flags|=65536:(e.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(n=co(-1,1),n.tag=2,Ko(t,n,1))),t.lanes|=1),e)}var fI=ho.ReactCurrentOwner,Zn=!1;function Vn(e,n,t,r){n.child=e===null?WS(n,null,t,r):hc(n,e.child,t,r)}function u1(e,n,t,r,i){t=t.render;var o=n.ref;return Ys(n,i),r=oy(e,n,t,r,o,i),t=ay(),e!==null&&!Zn?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,fo(e,n,i)):(St&&t&&qv(n),n.flags|=1,Vn(e,n,r,i),n.child)}function l1(e,n,t,r,i){if(e===null){var o=t.type;return typeof o=="function"&&!gy(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(n.tag=15,n.type=o,m2(e,n,o,r,i)):(e=Dd(t.type,null,r,n,n.mode,i),e.ref=n.ref,e.return=n,n.child=e)}if(o=e.child,!(e.lanes&i)){var a=o.memoizedProps;if(t=t.compare,t=t!==null?t:Iu,t(a,r)&&e.ref===n.ref)return fo(e,n,i)}return n.flags|=1,e=Yo(o,r),e.ref=n.ref,e.return=n,n.child=e}function m2(e,n,t,r,i){if(e!==null){var o=e.memoizedProps;if(Iu(o,r)&&e.ref===n.ref)if(Zn=!1,n.pendingProps=r=o,(e.lanes&i)!==0)e.flags&131072&&(Zn=!0);else return n.lanes=e.lanes,fo(e,n,i)}return Sg(e,n,t,r,i)}function g2(e,n,t){var r=n.pendingProps,i=r.children,o=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(Gs,dr),dr|=t;else{if(!(t&1073741824))return e=o!==null?o.baseLanes|t:t,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,vt(Gs,dr),dr|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,vt(Gs,dr),dr|=r}else o!==null?(r=o.baseLanes|t,n.memoizedState=null):r=t,vt(Gs,dr),dr|=r;return Vn(e,n,i,t),n.child}function v2(e,n){var t=n.ref;(e===null&&t!==null||e!==null&&e.ref!==t)&&(n.flags|=512,n.flags|=2097152)}function Sg(e,n,t,r,i){var o=nr(t)?Ma:On.current;return o=pc(n,o),Ys(n,i),t=oy(e,n,t,r,o,i),r=ay(),e!==null&&!Zn?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~i,fo(e,n,i)):(St&&r&&qv(n),n.flags|=1,Vn(e,n,t,i),n.child)}function d1(e,n,t,r,i){if(nr(t)){var o=!0;Xd(n)}else o=!1;if(Ys(n,i),n.stateNode===null)kd(e,n),p2(n,t,r),xg(n,t,r,i),r=!0;else if(e===null){var a=n.stateNode,s=n.memoizedProps;a.props=s;var c=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=Fr(u):(u=nr(t)?Ma:On.current,u=pc(n,u));var l=t.getDerivedStateFromProps,d=typeof l=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==r||c!==u)&&o1(n,a,r,u),Lo=!1;var p=n.memoizedState;a.state=p,ep(n,r,a,i),c=n.memoizedState,s!==r||p!==c||tr.current||Lo?(typeof l=="function"&&(bg(n,t,l,r),c=n.memoizedState),(s=Lo||i1(n,t,s,r,p,c,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(n.flags|=4194308)):(typeof a.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=r,n.memoizedState=c),a.props=r,a.state=c,a.context=u,r=s):(typeof a.componentDidMount=="function"&&(n.flags|=4194308),r=!1)}else{a=n.stateNode,HS(e,n),s=n.memoizedProps,u=n.type===n.elementType?s:Hr(n.type,s),a.props=u,d=n.pendingProps,p=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=Fr(c):(c=nr(t)?Ma:On.current,c=pc(n,c));var f=t.getDerivedStateFromProps;(l=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(s!==d||p!==c)&&o1(n,a,r,c),Lo=!1,p=n.memoizedState,a.state=p,ep(n,r,a,i);var m=n.memoizedState;s!==d||p!==m||tr.current||Lo?(typeof f=="function"&&(bg(n,t,f,r),m=n.memoizedState),(u=Lo||i1(n,t,u,r,p,m,c)||!1)?(l||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,c)),typeof a.componentDidUpdate=="function"&&(n.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&p===e.memoizedState||(n.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&p===e.memoizedState||(n.flags|=1024),n.memoizedProps=r,n.memoizedState=m),a.props=r,a.state=m,a.context=c,r=u):(typeof a.componentDidUpdate!="function"||s===e.memoizedProps&&p===e.memoizedState||(n.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&p===e.memoizedState||(n.flags|=1024),r=!1)}return Cg(e,n,t,r,o,i)}function Cg(e,n,t,r,i,o){v2(e,n);var a=(n.flags&128)!==0;if(!r&&!a)return i&&Qw(n,t,!1),fo(e,n,o);r=n.stateNode,fI.current=n;var s=a&&typeof t.getDerivedStateFromError!="function"?null:r.render();return n.flags|=1,e!==null&&a?(n.child=hc(n,e.child,null,o),n.child=hc(n,null,s,o)):Vn(e,n,s,o),n.memoizedState=r.state,i&&Qw(n,t,!0),n.child}function y2(e){var n=e.stateNode;n.pendingContext?Xw(e,n.pendingContext,n.pendingContext!==n.context):n.context&&Xw(e,n.context,!1),ty(e,n.containerInfo)}function p1(e,n,t,r,i){return fc(),Xv(i),n.flags|=256,Vn(e,n,t,r),n.child}var Rg={dehydrated:null,treeContext:null,retryLane:0};function kg(e){return{baseLanes:e,cachePool:null,transitions:null}}function w2(e,n,t){var r=n.pendingProps,i=Rt.current,o=!1,a=(n.flags&128)!==0,s;if((s=a)||(s=e!==null&&e.memoizedState===null?!1:(i&2)!==0),s?(o=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),vt(Rt,i&1),e===null)return yg(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(a=r.children,e=r.fallback,o?(r=n.mode,o=n.child,a={mode:"hidden",children:a},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=Hp(a,r,0,null),e=Aa(e,r,t,null),o.return=n,e.return=n,o.sibling=e,n.child=o,n.child.memoizedState=kg(t),n.memoizedState=Rg,e):uy(n,a));if(i=e.memoizedState,i!==null&&(s=i.dehydrated,s!==null))return hI(e,n,a,r,s,i,t);if(o){o=r.fallback,a=n.mode,i=e.child,s=i.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&n.child!==i?(r=n.child,r.childLanes=0,r.pendingProps=c,n.deletions=null):(r=Yo(i,c),r.subtreeFlags=i.subtreeFlags&14680064),s!==null?o=Yo(s,o):(o=Aa(o,a,t,null),o.flags|=2),o.return=n,r.return=n,r.sibling=o,n.child=r,r=o,o=n.child,a=e.child.memoizedState,a=a===null?kg(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=e.childLanes&~t,n.memoizedState=Rg,r}return o=e.child,e=o.sibling,r=Yo(o,{mode:"visible",children:r.children}),!(n.mode&1)&&(r.lanes=t),r.return=n,r.sibling=null,e!==null&&(t=n.deletions,t===null?(n.deletions=[e],n.flags|=16):t.push(e)),n.child=r,n.memoizedState=null,r}function uy(e,n){return n=Hp({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function Ll(e,n,t,r){return r!==null&&Xv(r),hc(n,e.child,null,t),e=uy(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function hI(e,n,t,r,i,o,a){if(t)return n.flags&256?(n.flags&=-257,r=Lh(Error(J(422))),Ll(e,n,a,r)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(o=r.fallback,i=n.mode,r=Hp({mode:"visible",children:r.children},i,0,null),o=Aa(o,i,a,null),o.flags|=2,r.return=n,o.return=n,r.sibling=o,n.child=r,n.mode&1&&hc(n,e.child,null,a),n.child.memoizedState=kg(a),n.memoizedState=Rg,o);if(!(n.mode&1))return Ll(e,n,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var s=r.dgst;return r=s,o=Error(J(419)),r=Lh(o,r,void 0),Ll(e,n,a,r)}if(s=(a&e.childLanes)!==0,Zn||s){if(r=sn,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,po(e,i),Jr(r,e,i,-1))}return my(),r=Lh(Error(J(421))),Ll(e,n,a,r)}return i.data==="$?"?(n.flags|=128,n.child=e.child,n=EI.bind(null,e),i._reactRetry=n,null):(e=o.treeContext,mr=qo(i.nextSibling),br=n,St=!0,Kr=null,e!==null&&(Tr[Dr++]=ao,Tr[Dr++]=so,Tr[Dr++]=La,ao=e.id,so=e.overflow,La=n),n=uy(n,r.children),n.flags|=4096,n)}function f1(e,n,t){e.lanes|=n;var r=e.alternate;r!==null&&(r.lanes|=n),wg(e.return,n,t)}function Oh(e,n,t,r,i){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=n,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function b2(e,n,t){var r=n.pendingProps,i=r.revealOrder,o=r.tail;if(Vn(e,n,r.children,t),r=Rt.current,r&2)r=r&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&f1(e,t,n);else if(e.tag===19)f1(e,t,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(vt(Rt,r),!(n.mode&1))n.memoizedState=null;else switch(i){case"forwards":for(t=n.child,i=null;t!==null;)e=t.alternate,e!==null&&tp(e)===null&&(i=t),t=t.sibling;t=i,t===null?(i=n.child,n.child=null):(i=t.sibling,t.sibling=null),Oh(n,!1,i,t,o);break;case"backwards":for(t=null,i=n.child,n.child=null;i!==null;){if(e=i.alternate,e!==null&&tp(e)===null){n.child=i;break}e=i.sibling,i.sibling=t,t=i,i=e}Oh(n,!0,t,null,o);break;case"together":Oh(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function kd(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function fo(e,n,t){if(e!==null&&(n.dependencies=e.dependencies),Fa|=n.lanes,!(t&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(J(153));if(n.child!==null){for(e=n.child,t=Yo(e,e.pendingProps),n.child=t,t.return=n;e.sibling!==null;)e=e.sibling,t=t.sibling=Yo(e,e.pendingProps),t.return=n;t.sibling=null}return n.child}function mI(e,n,t){switch(n.tag){case 3:y2(n),fc();break;case 5:GS(n);break;case 1:nr(n.type)&&Xd(n);break;case 4:ty(n,n.stateNode.containerInfo);break;case 10:var r=n.type._context,i=n.memoizedProps.value;vt(Jd,r._currentValue),r._currentValue=i;break;case 13:if(r=n.memoizedState,r!==null)return r.dehydrated!==null?(vt(Rt,Rt.current&1),n.flags|=128,null):t&n.child.childLanes?w2(e,n,t):(vt(Rt,Rt.current&1),e=fo(e,n,t),e!==null?e.sibling:null);vt(Rt,Rt.current&1);break;case 19:if(r=(t&n.childLanes)!==0,e.flags&128){if(r)return b2(e,n,t);n.flags|=128}if(i=n.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),vt(Rt,Rt.current),r)break;return null;case 22:case 23:return n.lanes=0,g2(e,n,t)}return fo(e,n,t)}var x2,Eg,_2,S2;x2=function(e,n){for(var t=n.child;t!==null;){if(t.tag===5||t.tag===6)e.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break;for(;t.sibling===null;){if(t.return===null||t.return===n)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Eg=function(){};_2=function(e,n,t,r){var i=e.memoizedProps;if(i!==r){e=n.stateNode,Ea(Di.current);var o=null;switch(t){case"input":i=Xm(e,i),r=Xm(e,r),o=[];break;case"select":i=Dt({},i,{value:void 0}),r=Dt({},r,{value:void 0}),o=[];break;case"textarea":i=Jm(e,i),r=Jm(e,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=qd)}eg(t,r);var a;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var s=i[u];for(a in s)s.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Su.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in r){var c=r[u];if(s=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&c!==s&&(c!=null||s!=null))if(u==="style")if(s){for(a in s)!s.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&s[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(o||(o=[]),o.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,s=s?s.__html:void 0,c!=null&&s!==c&&(o=o||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Su.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&bt("scroll",e),o||s===c||(o=[])):(o=o||[]).push(u,c))}t&&(o=o||[]).push("style",t);var u=o;(n.updateQueue=u)&&(n.flags|=4)}};S2=function(e,n,t,r){t!==r&&(n.flags|=4)};function Hc(e,n){if(!St)switch(e.tailMode){case"hidden":n=e.tail;for(var t=null;n!==null;)n.alternate!==null&&(t=n),n=n.sibling;t===null?e.tail=null:t.sibling=null;break;case"collapsed":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Sn(e){var n=e.alternate!==null&&e.alternate.child===e.child,t=0,r=0;if(n)for(var i=e.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=t,n}function gI(e,n,t){var r=n.pendingProps;switch(Kv(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(n),null;case 1:return nr(n.type)&&Kd(),Sn(n),null;case 3:return r=n.stateNode,mc(),_t(tr),_t(On),ry(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Nl(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Kr!==null&&(Lg(Kr),Kr=null))),Eg(e,n),Sn(n),null;case 5:ny(n);var i=Ea(Lu.current);if(t=n.type,e!==null&&n.stateNode!=null)_2(e,n,t,r,i),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!r){if(n.stateNode===null)throw Error(J(166));return Sn(n),null}if(e=Ea(Di.current),Nl(n)){r=n.stateNode,t=n.type;var o=n.memoizedProps;switch(r[Si]=n,r[Nu]=o,e=(n.mode&1)!==0,t){case"dialog":bt("cancel",r),bt("close",r);break;case"iframe":case"object":case"embed":bt("load",r);break;case"video":case"audio":for(i=0;i<au.length;i++)bt(au[i],r);break;case"source":bt("error",r);break;case"img":case"image":case"link":bt("error",r),bt("load",r);break;case"details":bt("toggle",r);break;case"input":_w(r,o),bt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},bt("invalid",r);break;case"textarea":Cw(r,o),bt("invalid",r)}eg(t,o),i=null;for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];a==="children"?typeof s=="string"?r.textContent!==s&&(o.suppressHydrationWarning!==!0&&Al(r.textContent,s,e),i=["children",s]):typeof s=="number"&&r.textContent!==""+s&&(o.suppressHydrationWarning!==!0&&Al(r.textContent,s,e),i=["children",""+s]):Su.hasOwnProperty(a)&&s!=null&&a==="onScroll"&&bt("scroll",r)}switch(t){case"input":Cl(r),Sw(r,o,!0);break;case"textarea":Cl(r),Rw(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=qd)}r=i,n.updateQueue=r,r!==null&&(n.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Y_(t)),e==="http://www.w3.org/1999/xhtml"?t==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(t,{is:r.is}):(e=a.createElement(t),t==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,t),e[Si]=n,e[Nu]=r,x2(e,n,!1,!1),n.stateNode=e;e:{switch(a=tg(t,r),t){case"dialog":bt("cancel",e),bt("close",e),i=r;break;case"iframe":case"object":case"embed":bt("load",e),i=r;break;case"video":case"audio":for(i=0;i<au.length;i++)bt(au[i],e);i=r;break;case"source":bt("error",e),i=r;break;case"img":case"image":case"link":bt("error",e),bt("load",e),i=r;break;case"details":bt("toggle",e),i=r;break;case"input":_w(e,r),i=Xm(e,r),bt("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Dt({},r,{value:void 0}),bt("invalid",e);break;case"textarea":Cw(e,r),i=Jm(e,r),bt("invalid",e);break;default:i=r}eg(t,i),s=i;for(o in s)if(s.hasOwnProperty(o)){var c=s[o];o==="style"?eS(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&J_(e,c)):o==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Cu(e,c):typeof c=="number"&&Cu(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Su.hasOwnProperty(o)?c!=null&&o==="onScroll"&&bt("scroll",e):c!=null&&Nv(e,o,c,a))}switch(t){case"input":Cl(e),Sw(e,r,!1);break;case"textarea":Cl(e),Rw(e);break;case"option":r.value!=null&&e.setAttribute("value",""+ra(r.value));break;case"select":e.multiple=!!r.multiple,o=r.value,o!=null?qs(e,!!r.multiple,o,!1):r.defaultValue!=null&&qs(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=qd)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Sn(n),null;case 6:if(e&&n.stateNode!=null)S2(e,n,e.memoizedProps,r);else{if(typeof r!="string"&&n.stateNode===null)throw Error(J(166));if(t=Ea(Lu.current),Ea(Di.current),Nl(n)){if(r=n.stateNode,t=n.memoizedProps,r[Si]=n,(o=r.nodeValue!==t)&&(e=br,e!==null))switch(e.tag){case 3:Al(r.nodeValue,t,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Al(r.nodeValue,t,(e.mode&1)!==0)}o&&(n.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Si]=n,n.stateNode=r}return Sn(n),null;case 13:if(_t(Rt),r=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(St&&mr!==null&&n.mode&1&&!(n.flags&128))$S(),fc(),n.flags|=98560,o=!1;else if(o=Nl(n),r!==null&&r.dehydrated!==null){if(e===null){if(!o)throw Error(J(318));if(o=n.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(J(317));o[Si]=n}else fc(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Sn(n),o=!1}else Kr!==null&&(Lg(Kr),Kr=null),o=!0;if(!o)return n.flags&65536?n:null}return n.flags&128?(n.lanes=t,n):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(n.child.flags|=8192,n.mode&1&&(e===null||Rt.current&1?Xt===0&&(Xt=3):my())),n.updateQueue!==null&&(n.flags|=4),Sn(n),null);case 4:return mc(),Eg(e,n),e===null&&Pu(n.stateNode.containerInfo),Sn(n),null;case 10:return Jv(n.type._context),Sn(n),null;case 17:return nr(n.type)&&Kd(),Sn(n),null;case 19:if(_t(Rt),o=n.memoizedState,o===null)return Sn(n),null;if(r=(n.flags&128)!==0,a=o.rendering,a===null)if(r)Hc(o,!1);else{if(Xt!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(a=tp(e),a!==null){for(n.flags|=128,Hc(o,!1),r=a.updateQueue,r!==null&&(n.updateQueue=r,n.flags|=4),n.subtreeFlags=0,r=t,t=n.child;t!==null;)o=t,e=r,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t=t.sibling;return vt(Rt,Rt.current&1|2),n.child}e=e.sibling}o.tail!==null&&Bt()>vc&&(n.flags|=128,r=!0,Hc(o,!1),n.lanes=4194304)}else{if(!r)if(e=tp(a),e!==null){if(n.flags|=128,r=!0,t=e.updateQueue,t!==null&&(n.updateQueue=t,n.flags|=4),Hc(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!St)return Sn(n),null}else 2*Bt()-o.renderingStartTime>vc&&t!==1073741824&&(n.flags|=128,r=!0,Hc(o,!1),n.lanes=4194304);o.isBackwards?(a.sibling=n.child,n.child=a):(t=o.last,t!==null?t.sibling=a:n.child=a,o.last=a)}return o.tail!==null?(n=o.tail,o.rendering=n,o.tail=n.sibling,o.renderingStartTime=Bt(),n.sibling=null,t=Rt.current,vt(Rt,r?t&1|2:t&1),n):(Sn(n),null);case 22:case 23:return hy(),r=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(n.flags|=8192),r&&n.mode&1?dr&1073741824&&(Sn(n),n.subtreeFlags&6&&(n.flags|=8192)):Sn(n),null;case 24:return null;case 25:return null}throw Error(J(156,n.tag))}function vI(e,n){switch(Kv(n),n.tag){case 1:return nr(n.type)&&Kd(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return mc(),_t(tr),_t(On),ry(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return ny(n),null;case 13:if(_t(Rt),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(J(340));fc()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return _t(Rt),null;case 4:return mc(),null;case 10:return Jv(n.type._context),null;case 22:case 23:return hy(),null;case 24:return null;default:return null}}var Ol=!1,In=!1,yI=typeof WeakSet=="function"?WeakSet:Set,ae=null;function Hs(e,n){var t=e.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Mt(e,n,r)}else t.current=null}function Tg(e,n,t){try{t()}catch(r){Mt(e,n,r)}}var h1=!1;function wI(e,n){if(dg=Vd,e=TS(),Gv(e)){if("selectionStart"in e)var t={start:e.selectionStart,end:e.selectionEnd};else e:{t=(t=e.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var a=0,s=-1,c=-1,u=0,l=0,d=e,p=null;t:for(;;){for(var f;d!==t||i!==0&&d.nodeType!==3||(s=a+i),d!==o||r!==0&&d.nodeType!==3||(c=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)p=d,d=f;for(;;){if(d===e)break t;if(p===t&&++u===i&&(s=a),p===o&&++l===r&&(c=a),(f=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=f}t=s===-1||c===-1?null:{start:s,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(pg={focusedElem:e,selectionRange:t},Vd=!1,ae=n;ae!==null;)if(n=ae,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,ae=e;else for(;ae!==null;){n=ae;try{var m=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,v=m.memoizedState,h=n.stateNode,w=h.getSnapshotBeforeUpdate(n.elementType===n.type?g:Hr(n.type,g),v);h.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var y=n.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(J(163))}}catch(b){Mt(n,n.return,b)}if(e=n.sibling,e!==null){e.return=n.return,ae=e;break}ae=n.return}return m=h1,h1=!1,m}function hu(e,n,t){var r=n.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,o!==void 0&&Tg(n,t,o)}i=i.next}while(i!==r)}}function Wp(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var t=n=n.next;do{if((t.tag&e)===e){var r=t.create;t.destroy=r()}t=t.next}while(t!==n)}}function Dg(e){var n=e.ref;if(n!==null){var t=e.stateNode;switch(e.tag){case 5:e=t;break;default:e=t}typeof n=="function"?n(e):n.current=e}}function C2(e){var n=e.alternate;n!==null&&(e.alternate=null,C2(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Si],delete n[Nu],delete n[mg],delete n[tI],delete n[nI])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function R2(e){return e.tag===5||e.tag===3||e.tag===4}function m1(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||R2(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ig(e,n,t){var r=e.tag;if(r===5||r===6)e=e.stateNode,n?t.nodeType===8?t.parentNode.insertBefore(e,n):t.insertBefore(e,n):(t.nodeType===8?(n=t.parentNode,n.insertBefore(e,t)):(n=t,n.appendChild(e)),t=t._reactRootContainer,t!=null||n.onclick!==null||(n.onclick=qd));else if(r!==4&&(e=e.child,e!==null))for(Ig(e,n,t),e=e.sibling;e!==null;)Ig(e,n,t),e=e.sibling}function Pg(e,n,t){var r=e.tag;if(r===5||r===6)e=e.stateNode,n?t.insertBefore(e,n):t.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Pg(e,n,t),e=e.sibling;e!==null;)Pg(e,n,t),e=e.sibling}var pn=null,Gr=!1;function ko(e,n,t){for(t=t.child;t!==null;)k2(e,n,t),t=t.sibling}function k2(e,n,t){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(Lp,t)}catch{}switch(t.tag){case 5:In||Hs(t,n);case 6:var r=pn,i=Gr;pn=null,ko(e,n,t),pn=r,Gr=i,pn!==null&&(Gr?(e=pn,t=t.stateNode,e.nodeType===8?e.parentNode.removeChild(t):e.removeChild(t)):pn.removeChild(t.stateNode));break;case 18:pn!==null&&(Gr?(e=pn,t=t.stateNode,e.nodeType===8?Dh(e.parentNode,t):e.nodeType===1&&Dh(e,t),Tu(e)):Dh(pn,t.stateNode));break;case 4:r=pn,i=Gr,pn=t.stateNode.containerInfo,Gr=!0,ko(e,n,t),pn=r,Gr=i;break;case 0:case 11:case 14:case 15:if(!In&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&Tg(t,n,a),i=i.next}while(i!==r)}ko(e,n,t);break;case 1:if(!In&&(Hs(t,n),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(s){Mt(t,n,s)}ko(e,n,t);break;case 21:ko(e,n,t);break;case 22:t.mode&1?(In=(r=In)||t.memoizedState!==null,ko(e,n,t),In=r):ko(e,n,t);break;default:ko(e,n,t)}}function g1(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var t=e.stateNode;t===null&&(t=e.stateNode=new yI),n.forEach(function(r){var i=TI.bind(null,e,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Vr(e,n){var t=n.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=e,a=n,s=a;e:for(;s!==null;){switch(s.tag){case 5:pn=s.stateNode,Gr=!1;break e;case 3:pn=s.stateNode.containerInfo,Gr=!0;break e;case 4:pn=s.stateNode.containerInfo,Gr=!0;break e}s=s.return}if(pn===null)throw Error(J(160));k2(o,a,i),pn=null,Gr=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(u){Mt(i,n,u)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)E2(n,e),n=n.sibling}function E2(e,n){var t=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Vr(n,e),ci(e),r&4){try{hu(3,e,e.return),Wp(3,e)}catch(g){Mt(e,e.return,g)}try{hu(5,e,e.return)}catch(g){Mt(e,e.return,g)}}break;case 1:Vr(n,e),ci(e),r&512&&t!==null&&Hs(t,t.return);break;case 5:if(Vr(n,e),ci(e),r&512&&t!==null&&Hs(t,t.return),e.flags&32){var i=e.stateNode;try{Cu(i,"")}catch(g){Mt(e,e.return,g)}}if(r&4&&(i=e.stateNode,i!=null)){var o=e.memoizedProps,a=t!==null?t.memoizedProps:o,s=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{s==="input"&&o.type==="radio"&&o.name!=null&&X_(i,o),tg(s,a);var u=tg(s,o);for(a=0;a<c.length;a+=2){var l=c[a],d=c[a+1];l==="style"?eS(i,d):l==="dangerouslySetInnerHTML"?J_(i,d):l==="children"?Cu(i,d):Nv(i,l,d,u)}switch(s){case"input":Qm(i,o);break;case"textarea":Q_(i,o);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?qs(i,!!o.multiple,f,!1):p!==!!o.multiple&&(o.defaultValue!=null?qs(i,!!o.multiple,o.defaultValue,!0):qs(i,!!o.multiple,o.multiple?[]:"",!1))}i[Nu]=o}catch(g){Mt(e,e.return,g)}}break;case 6:if(Vr(n,e),ci(e),r&4){if(e.stateNode===null)throw Error(J(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(g){Mt(e,e.return,g)}}break;case 3:if(Vr(n,e),ci(e),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Tu(n.containerInfo)}catch(g){Mt(e,e.return,g)}break;case 4:Vr(n,e),ci(e);break;case 13:Vr(n,e),ci(e),i=e.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(py=Bt())),r&4&&g1(e);break;case 22:if(l=t!==null&&t.memoizedState!==null,e.mode&1?(In=(u=In)||l,Vr(n,e),In=u):Vr(n,e),ci(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!l&&e.mode&1)for(ae=e,l=e.child;l!==null;){for(d=ae=l;ae!==null;){switch(p=ae,f=p.child,p.tag){case 0:case 11:case 14:case 15:hu(4,p,p.return);break;case 1:Hs(p,p.return);var m=p.stateNode;if(typeof m.componentWillUnmount=="function"){r=p,t=p.return;try{n=r,m.props=n.memoizedProps,m.state=n.memoizedState,m.componentWillUnmount()}catch(g){Mt(r,t,g)}}break;case 5:Hs(p,p.return);break;case 22:if(p.memoizedState!==null){y1(d);continue}}f!==null?(f.return=p,ae=f):y1(d)}l=l.sibling}e:for(l=null,d=e;;){if(d.tag===5){if(l===null){l=d;try{i=d.stateNode,u?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(s=d.stateNode,c=d.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,s.style.display=Z_("display",a))}catch(g){Mt(e,e.return,g)}}}else if(d.tag===6){if(l===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Mt(e,e.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;l===d&&(l=null),d=d.return}l===d&&(l=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Vr(n,e),ci(e),r&4&&g1(e);break;case 21:break;default:Vr(n,e),ci(e)}}function ci(e){var n=e.flags;if(n&2){try{e:{for(var t=e.return;t!==null;){if(R2(t)){var r=t;break e}t=t.return}throw Error(J(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Cu(i,""),r.flags&=-33);var o=m1(e);Pg(e,o,i);break;case 3:case 4:var a=r.stateNode.containerInfo,s=m1(e);Ig(e,s,a);break;default:throw Error(J(161))}}catch(c){Mt(e,e.return,c)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function bI(e,n,t){ae=e,T2(e)}function T2(e,n,t){for(var r=(e.mode&1)!==0;ae!==null;){var i=ae,o=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||Ol;if(!a){var s=i.alternate,c=s!==null&&s.memoizedState!==null||In;s=Ol;var u=In;if(Ol=a,(In=c)&&!u)for(ae=i;ae!==null;)a=ae,c=a.child,a.tag===22&&a.memoizedState!==null?w1(i):c!==null?(c.return=a,ae=c):w1(i);for(;o!==null;)ae=o,T2(o),o=o.sibling;ae=i,Ol=s,In=u}v1(e)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ae=o):v1(e)}}function v1(e){for(;ae!==null;){var n=ae;if(n.flags&8772){var t=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:In||Wp(5,n);break;case 1:var r=n.stateNode;if(n.flags&4&&!In)if(t===null)r.componentDidMount();else{var i=n.elementType===n.type?t.memoizedProps:Hr(n.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;o!==null&&t1(n,o,r);break;case 3:var a=n.updateQueue;if(a!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}t1(n,a,t)}break;case 5:var s=n.stateNode;if(t===null&&n.flags&4){t=s;var c=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var u=n.alternate;if(u!==null){var l=u.memoizedState;if(l!==null){var d=l.dehydrated;d!==null&&Tu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(J(163))}In||n.flags&512&&Dg(n)}catch(p){Mt(n,n.return,p)}}if(n===e){ae=null;break}if(t=n.sibling,t!==null){t.return=n.return,ae=t;break}ae=n.return}}function y1(e){for(;ae!==null;){var n=ae;if(n===e){ae=null;break}var t=n.sibling;if(t!==null){t.return=n.return,ae=t;break}ae=n.return}}function w1(e){for(;ae!==null;){var n=ae;try{switch(n.tag){case 0:case 11:case 15:var t=n.return;try{Wp(4,n)}catch(c){Mt(n,t,c)}break;case 1:var r=n.stateNode;if(typeof r.componentDidMount=="function"){var i=n.return;try{r.componentDidMount()}catch(c){Mt(n,i,c)}}var o=n.return;try{Dg(n)}catch(c){Mt(n,o,c)}break;case 5:var a=n.return;try{Dg(n)}catch(c){Mt(n,a,c)}}}catch(c){Mt(n,n.return,c)}if(n===e){ae=null;break}var s=n.sibling;if(s!==null){s.return=n.return,ae=s;break}ae=n.return}}var xI=Math.ceil,ip=ho.ReactCurrentDispatcher,ly=ho.ReactCurrentOwner,Or=ho.ReactCurrentBatchConfig,Ye=0,sn=null,Wt=null,gn=0,dr=0,Gs=ua(0),Xt=0,zu=null,Fa=0,Vp=0,dy=0,mu=null,Qn=null,py=0,vc=1/0,no=null,op=!1,Ag=null,Xo=null,Fl=!1,jo=null,ap=0,gu=0,Ng=null,Ed=-1,Td=0;function Hn(){return Ye&6?Bt():Ed!==-1?Ed:Ed=Bt()}function Qo(e){return e.mode&1?Ye&2&&gn!==0?gn&-gn:iI.transition!==null?(Td===0&&(Td=pS()),Td):(e=ut,e!==0||(e=window.event,e=e===void 0?16:wS(e.type)),e):1}function Jr(e,n,t,r){if(50<gu)throw gu=0,Ng=null,Error(J(185));Ku(e,t,r),(!(Ye&2)||e!==sn)&&(e===sn&&(!(Ye&2)&&(Vp|=t),Xt===4&&Bo(e,gn)),rr(e,r),t===1&&Ye===0&&!(n.mode&1)&&(vc=Bt()+500,jp&&la()))}function rr(e,n){var t=e.callbackNode;iD(e,n);var r=Wd(e,e===sn?gn:0);if(r===0)t!==null&&Tw(t),e.callbackNode=null,e.callbackPriority=0;else if(n=r&-r,e.callbackPriority!==n){if(t!=null&&Tw(t),n===1)e.tag===0?rI(b1.bind(null,e)):BS(b1.bind(null,e)),ZD(function(){!(Ye&6)&&la()}),t=null;else{switch(fS(r)){case 1:t=Bv;break;case 4:t=lS;break;case 16:t=Ud;break;case 536870912:t=dS;break;default:t=Ud}t=O2(t,D2.bind(null,e))}e.callbackPriority=n,e.callbackNode=t}}function D2(e,n){if(Ed=-1,Td=0,Ye&6)throw Error(J(327));var t=e.callbackNode;if(Js()&&e.callbackNode!==t)return null;var r=Wd(e,e===sn?gn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||n)n=sp(e,r);else{n=r;var i=Ye;Ye|=2;var o=P2();(sn!==e||gn!==n)&&(no=null,vc=Bt()+500,Pa(e,n));do try{CI();break}catch(s){I2(e,s)}while(!0);Yv(),ip.current=o,Ye=i,Wt!==null?n=0:(sn=null,gn=0,n=Xt)}if(n!==0){if(n===2&&(i=ag(e),i!==0&&(r=i,n=Mg(e,i))),n===1)throw t=zu,Pa(e,0),Bo(e,r),rr(e,Bt()),t;if(n===6)Bo(e,r);else{if(i=e.current.alternate,!(r&30)&&!_I(i)&&(n=sp(e,r),n===2&&(o=ag(e),o!==0&&(r=o,n=Mg(e,o))),n===1))throw t=zu,Pa(e,0),Bo(e,r),rr(e,Bt()),t;switch(e.finishedWork=i,e.finishedLanes=r,n){case 0:case 1:throw Error(J(345));case 2:ba(e,Qn,no);break;case 3:if(Bo(e,r),(r&130023424)===r&&(n=py+500-Bt(),10<n)){if(Wd(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){Hn(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=hg(ba.bind(null,e,Qn,no),n);break}ba(e,Qn,no);break;case 4:if(Bo(e,r),(r&4194240)===r)break;for(n=e.eventTimes,i=-1;0<r;){var a=31-Yr(r);o=1<<a,a=n[a],a>i&&(i=a),r&=~o}if(r=i,r=Bt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*xI(r/1960))-r,10<r){e.timeoutHandle=hg(ba.bind(null,e,Qn,no),r);break}ba(e,Qn,no);break;case 5:ba(e,Qn,no);break;default:throw Error(J(329))}}}return rr(e,Bt()),e.callbackNode===t?D2.bind(null,e):null}function Mg(e,n){var t=mu;return e.current.memoizedState.isDehydrated&&(Pa(e,n).flags|=256),e=sp(e,n),e!==2&&(n=Qn,Qn=t,n!==null&&Lg(n)),e}function Lg(e){Qn===null?Qn=e:Qn.push.apply(Qn,e)}function _I(e){for(var n=e;;){if(n.flags&16384){var t=n.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!ni(o(),i))return!1}catch{return!1}}}if(t=n.child,n.subtreeFlags&16384&&t!==null)t.return=n,n=t;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Bo(e,n){for(n&=~dy,n&=~Vp,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var t=31-Yr(n),r=1<<t;e[t]=-1,n&=~r}}function b1(e){if(Ye&6)throw Error(J(327));Js();var n=Wd(e,0);if(!(n&1))return rr(e,Bt()),null;var t=sp(e,n);if(e.tag!==0&&t===2){var r=ag(e);r!==0&&(n=r,t=Mg(e,r))}if(t===1)throw t=zu,Pa(e,0),Bo(e,n),rr(e,Bt()),t;if(t===6)throw Error(J(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,ba(e,Qn,no),rr(e,Bt()),null}function fy(e,n){var t=Ye;Ye|=1;try{return e(n)}finally{Ye=t,Ye===0&&(vc=Bt()+500,jp&&la())}}function Ba(e){jo!==null&&jo.tag===0&&!(Ye&6)&&Js();var n=Ye;Ye|=1;var t=Or.transition,r=ut;try{if(Or.transition=null,ut=1,e)return e()}finally{ut=r,Or.transition=t,Ye=n,!(Ye&6)&&la()}}function hy(){dr=Gs.current,_t(Gs)}function Pa(e,n){e.finishedWork=null,e.finishedLanes=0;var t=e.timeoutHandle;if(t!==-1&&(e.timeoutHandle=-1,JD(t)),Wt!==null)for(t=Wt.return;t!==null;){var r=t;switch(Kv(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Kd();break;case 3:mc(),_t(tr),_t(On),ry();break;case 5:ny(r);break;case 4:mc();break;case 13:_t(Rt);break;case 19:_t(Rt);break;case 10:Jv(r.type._context);break;case 22:case 23:hy()}t=t.return}if(sn=e,Wt=e=Yo(e.current,null),gn=dr=n,Xt=0,zu=null,dy=Vp=Fa=0,Qn=mu=null,ka!==null){for(n=0;n<ka.length;n++)if(t=ka[n],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var a=o.next;o.next=i,r.next=a}t.pending=r}ka=null}return e}function I2(e,n){do{var t=Wt;try{if(Yv(),Cd.current=rp,np){for(var r=Tt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}np=!1}if(Oa=0,an=Kt=Tt=null,fu=!1,Ou=0,ly.current=null,t===null||t.return===null){Xt=1,zu=n,Wt=null;break}e:{var o=e,a=t.return,s=t,c=n;if(n=gn,s.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,l=s,d=l.tag;if(!(l.mode&1)&&(d===0||d===11||d===15)){var p=l.alternate;p?(l.updateQueue=p.updateQueue,l.memoizedState=p.memoizedState,l.lanes=p.lanes):(l.updateQueue=null,l.memoizedState=null)}var f=s1(a);if(f!==null){f.flags&=-257,c1(f,a,s,o,n),f.mode&1&&a1(o,u,n),n=f,c=u;var m=n.updateQueue;if(m===null){var g=new Set;g.add(c),n.updateQueue=g}else m.add(c);break e}else{if(!(n&1)){a1(o,u,n),my();break e}c=Error(J(426))}}else if(St&&s.mode&1){var v=s1(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),c1(v,a,s,o,n),Xv(gc(c,s));break e}}o=c=gc(c,s),Xt!==4&&(Xt=2),mu===null?mu=[o]:mu.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,n&=-n,o.lanes|=n;var h=f2(o,c,n);e1(o,h);break e;case 1:s=c;var w=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof w.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Xo===null||!Xo.has(y)))){o.flags|=65536,n&=-n,o.lanes|=n;var b=h2(o,s,n);e1(o,b);break e}}o=o.return}while(o!==null)}N2(t)}catch(x){n=x,Wt===t&&t!==null&&(Wt=t=t.return);continue}break}while(!0)}function P2(){var e=ip.current;return ip.current=rp,e===null?rp:e}function my(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),sn===null||!(Fa&268435455)&&!(Vp&268435455)||Bo(sn,gn)}function sp(e,n){var t=Ye;Ye|=2;var r=P2();(sn!==e||gn!==n)&&(no=null,Pa(e,n));do try{SI();break}catch(i){I2(e,i)}while(!0);if(Yv(),Ye=t,ip.current=r,Wt!==null)throw Error(J(261));return sn=null,gn=0,Xt}function SI(){for(;Wt!==null;)A2(Wt)}function CI(){for(;Wt!==null&&!XT();)A2(Wt)}function A2(e){var n=L2(e.alternate,e,dr);e.memoizedProps=e.pendingProps,n===null?N2(e):Wt=n,ly.current=null}function N2(e){var n=e;do{var t=n.alternate;if(e=n.return,n.flags&32768){if(t=vI(t,n),t!==null){t.flags&=32767,Wt=t;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Xt=6,Wt=null;return}}else if(t=gI(t,n,dr),t!==null){Wt=t;return}if(n=n.sibling,n!==null){Wt=n;return}Wt=n=e}while(n!==null);Xt===0&&(Xt=5)}function ba(e,n,t){var r=ut,i=Or.transition;try{Or.transition=null,ut=1,RI(e,n,t,r)}finally{Or.transition=i,ut=r}return null}function RI(e,n,t,r){do Js();while(jo!==null);if(Ye&6)throw Error(J(327));t=e.finishedWork;var i=e.finishedLanes;if(t===null)return null;if(e.finishedWork=null,e.finishedLanes=0,t===e.current)throw Error(J(177));e.callbackNode=null,e.callbackPriority=0;var o=t.lanes|t.childLanes;if(oD(e,o),e===sn&&(Wt=sn=null,gn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Fl||(Fl=!0,O2(Ud,function(){return Js(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=Or.transition,Or.transition=null;var a=ut;ut=1;var s=Ye;Ye|=4,ly.current=null,wI(e,t),E2(t,e),HD(pg),Vd=!!dg,pg=dg=null,e.current=t,bI(t),QT(),Ye=s,ut=a,Or.transition=o}else e.current=t;if(Fl&&(Fl=!1,jo=e,ap=i),o=e.pendingLanes,o===0&&(Xo=null),ZT(t.stateNode),rr(e,Bt()),n!==null)for(r=e.onRecoverableError,t=0;t<n.length;t++)i=n[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(op)throw op=!1,e=Ag,Ag=null,e;return ap&1&&e.tag!==0&&Js(),o=e.pendingLanes,o&1?e===Ng?gu++:(gu=0,Ng=e):gu=0,la(),null}function Js(){if(jo!==null){var e=fS(ap),n=Or.transition,t=ut;try{if(Or.transition=null,ut=16>e?16:e,jo===null)var r=!1;else{if(e=jo,jo=null,ap=0,Ye&6)throw Error(J(331));var i=Ye;for(Ye|=4,ae=e.current;ae!==null;){var o=ae,a=o.child;if(ae.flags&16){var s=o.deletions;if(s!==null){for(var c=0;c<s.length;c++){var u=s[c];for(ae=u;ae!==null;){var l=ae;switch(l.tag){case 0:case 11:case 15:hu(8,l,o)}var d=l.child;if(d!==null)d.return=l,ae=d;else for(;ae!==null;){l=ae;var p=l.sibling,f=l.return;if(C2(l),l===u){ae=null;break}if(p!==null){p.return=f,ae=p;break}ae=f}}}var m=o.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}ae=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,ae=a;else e:for(;ae!==null;){if(o=ae,o.flags&2048)switch(o.tag){case 0:case 11:case 15:hu(9,o,o.return)}var h=o.sibling;if(h!==null){h.return=o.return,ae=h;break e}ae=o.return}}var w=e.current;for(ae=w;ae!==null;){a=ae;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,ae=y;else e:for(a=w;ae!==null;){if(s=ae,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Wp(9,s)}}catch(x){Mt(s,s.return,x)}if(s===a){ae=null;break e}var b=s.sibling;if(b!==null){b.return=s.return,ae=b;break e}ae=s.return}}if(Ye=i,la(),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(Lp,e)}catch{}r=!0}return r}finally{ut=t,Or.transition=n}}return!1}function x1(e,n,t){n=gc(t,n),n=f2(e,n,1),e=Ko(e,n,1),n=Hn(),e!==null&&(Ku(e,1,n),rr(e,n))}function Mt(e,n,t){if(e.tag===3)x1(e,e,t);else for(;n!==null;){if(n.tag===3){x1(n,e,t);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Xo===null||!Xo.has(r))){e=gc(t,e),e=h2(n,e,1),n=Ko(n,e,1),e=Hn(),n!==null&&(Ku(n,1,e),rr(n,e));break}}n=n.return}}function kI(e,n,t){var r=e.pingCache;r!==null&&r.delete(n),n=Hn(),e.pingedLanes|=e.suspendedLanes&t,sn===e&&(gn&t)===t&&(Xt===4||Xt===3&&(gn&130023424)===gn&&500>Bt()-py?Pa(e,0):dy|=t),rr(e,n)}function M2(e,n){n===0&&(e.mode&1?(n=El,El<<=1,!(El&130023424)&&(El=4194304)):n=1);var t=Hn();e=po(e,n),e!==null&&(Ku(e,n,t),rr(e,t))}function EI(e){var n=e.memoizedState,t=0;n!==null&&(t=n.retryLane),M2(e,t)}function TI(e,n){var t=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(J(314))}r!==null&&r.delete(n),M2(e,t)}var L2;L2=function(e,n,t){if(e!==null)if(e.memoizedProps!==n.pendingProps||tr.current)Zn=!0;else{if(!(e.lanes&t)&&!(n.flags&128))return Zn=!1,mI(e,n,t);Zn=!!(e.flags&131072)}else Zn=!1,St&&n.flags&1048576&&zS(n,Yd,n.index);switch(n.lanes=0,n.tag){case 2:var r=n.type;kd(e,n),e=n.pendingProps;var i=pc(n,On.current);Ys(n,t),i=oy(null,n,r,e,i,t);var o=ay();return n.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,nr(r)?(o=!0,Xd(n)):o=!1,n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ey(n),i.updater=Up,n.stateNode=i,i._reactInternals=n,xg(n,r,e,t),n=Cg(null,n,r,!0,o,t)):(n.tag=0,St&&o&&qv(n),Vn(null,n,i,t),n=n.child),n;case 16:r=n.elementType;e:{switch(kd(e,n),e=n.pendingProps,i=r._init,r=i(r._payload),n.type=r,i=n.tag=II(r),e=Hr(r,e),i){case 0:n=Sg(null,n,r,e,t);break e;case 1:n=d1(null,n,r,e,t);break e;case 11:n=u1(null,n,r,e,t);break e;case 14:n=l1(null,n,r,Hr(r.type,e),t);break e}throw Error(J(306,r,""))}return n;case 0:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:Hr(r,i),Sg(e,n,r,i,t);case 1:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:Hr(r,i),d1(e,n,r,i,t);case 3:e:{if(y2(n),e===null)throw Error(J(387));r=n.pendingProps,o=n.memoizedState,i=o.element,HS(e,n),ep(n,r,null,t);var a=n.memoizedState;if(r=a.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},n.updateQueue.baseState=o,n.memoizedState=o,n.flags&256){i=gc(Error(J(423)),n),n=p1(e,n,r,t,i);break e}else if(r!==i){i=gc(Error(J(424)),n),n=p1(e,n,r,t,i);break e}else for(mr=qo(n.stateNode.containerInfo.firstChild),br=n,St=!0,Kr=null,t=WS(n,null,r,t),n.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(fc(),r===i){n=fo(e,n,t);break e}Vn(e,n,r,t)}n=n.child}return n;case 5:return GS(n),e===null&&yg(n),r=n.type,i=n.pendingProps,o=e!==null?e.memoizedProps:null,a=i.children,fg(r,i)?a=null:o!==null&&fg(r,o)&&(n.flags|=32),v2(e,n),Vn(e,n,a,t),n.child;case 6:return e===null&&yg(n),null;case 13:return w2(e,n,t);case 4:return ty(n,n.stateNode.containerInfo),r=n.pendingProps,e===null?n.child=hc(n,null,r,t):Vn(e,n,r,t),n.child;case 11:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:Hr(r,i),u1(e,n,r,i,t);case 7:return Vn(e,n,n.pendingProps,t),n.child;case 8:return Vn(e,n,n.pendingProps.children,t),n.child;case 12:return Vn(e,n,n.pendingProps.children,t),n.child;case 10:e:{if(r=n.type._context,i=n.pendingProps,o=n.memoizedProps,a=i.value,vt(Jd,r._currentValue),r._currentValue=a,o!==null)if(ni(o.value,a)){if(o.children===i.children&&!tr.current){n=fo(e,n,t);break e}}else for(o=n.child,o!==null&&(o.return=n);o!==null;){var s=o.dependencies;if(s!==null){a=o.child;for(var c=s.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=co(-1,t&-t),c.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var l=u.pending;l===null?c.next=c:(c.next=l.next,l.next=c),u.pending=c}}o.lanes|=t,c=o.alternate,c!==null&&(c.lanes|=t),wg(o.return,t,n),s.lanes|=t;break}c=c.next}}else if(o.tag===10)a=o.type===n.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(J(341));a.lanes|=t,s=a.alternate,s!==null&&(s.lanes|=t),wg(a,t,n),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===n){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Vn(e,n,i.children,t),n=n.child}return n;case 9:return i=n.type,r=n.pendingProps.children,Ys(n,t),i=Fr(i),r=r(i),n.flags|=1,Vn(e,n,r,t),n.child;case 14:return r=n.type,i=Hr(r,n.pendingProps),i=Hr(r.type,i),l1(e,n,r,i,t);case 15:return m2(e,n,n.type,n.pendingProps,t);case 17:return r=n.type,i=n.pendingProps,i=n.elementType===r?i:Hr(r,i),kd(e,n),n.tag=1,nr(r)?(e=!0,Xd(n)):e=!1,Ys(n,t),p2(n,r,i),xg(n,r,i,t),Cg(null,n,r,!0,e,t);case 19:return b2(e,n,t);case 22:return g2(e,n,t)}throw Error(J(156,n.tag))};function O2(e,n){return uS(e,n)}function DI(e,n,t,r){this.tag=e,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mr(e,n,t,r){return new DI(e,n,t,r)}function gy(e){return e=e.prototype,!(!e||!e.isReactComponent)}function II(e){if(typeof e=="function")return gy(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Lv)return 11;if(e===Ov)return 14}return 2}function Yo(e,n){var t=e.alternate;return t===null?(t=Mr(e.tag,n,e.key,e.mode),t.elementType=e.elementType,t.type=e.type,t.stateNode=e.stateNode,t.alternate=e,e.alternate=t):(t.pendingProps=n,t.type=e.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=e.flags&14680064,t.childLanes=e.childLanes,t.lanes=e.lanes,t.child=e.child,t.memoizedProps=e.memoizedProps,t.memoizedState=e.memoizedState,t.updateQueue=e.updateQueue,n=e.dependencies,t.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},t.sibling=e.sibling,t.index=e.index,t.ref=e.ref,t}function Dd(e,n,t,r,i,o){var a=2;if(r=e,typeof e=="function")gy(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Os:return Aa(t.children,i,o,n);case Mv:a=8,i|=8;break;case Hm:return e=Mr(12,t,n,i|2),e.elementType=Hm,e.lanes=o,e;case Gm:return e=Mr(13,t,n,i),e.elementType=Gm,e.lanes=o,e;case qm:return e=Mr(19,t,n,i),e.elementType=qm,e.lanes=o,e;case G_:return Hp(t,i,o,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case V_:a=10;break e;case H_:a=9;break e;case Lv:a=11;break e;case Ov:a=14;break e;case Mo:a=16,r=null;break e}throw Error(J(130,e==null?e:typeof e,""))}return n=Mr(a,t,n,i),n.elementType=e,n.type=r,n.lanes=o,n}function Aa(e,n,t,r){return e=Mr(7,e,r,n),e.lanes=t,e}function Hp(e,n,t,r){return e=Mr(22,e,r,n),e.elementType=G_,e.lanes=t,e.stateNode={isHidden:!1},e}function Fh(e,n,t){return e=Mr(6,e,null,n),e.lanes=t,e}function Bh(e,n,t){return n=Mr(4,e.children!==null?e.children:[],e.key,n),n.lanes=t,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function PI(e,n,t,r,i){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yh(0),this.expirationTimes=yh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yh(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function vy(e,n,t,r,i,o,a,s,c){return e=new PI(e,n,t,s,c),n===1?(n=1,o===!0&&(n|=8)):n=0,o=Mr(3,null,null,n),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},ey(o),e}function AI(e,n,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ls,key:r==null?null:""+r,children:e,containerInfo:n,implementation:t}}function F2(e){if(!e)return ia;e=e._reactInternals;e:{if(Va(e)!==e||e.tag!==1)throw Error(J(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(nr(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(J(171))}if(e.tag===1){var t=e.type;if(nr(t))return FS(e,t,n)}return n}function B2(e,n,t,r,i,o,a,s,c){return e=vy(t,r,!0,e,i,o,a,s,c),e.context=F2(null),t=e.current,r=Hn(),i=Qo(t),o=co(r,i),o.callback=n??null,Ko(t,o,i),e.current.lanes=i,Ku(e,i,r),rr(e,r),e}function Gp(e,n,t,r){var i=n.current,o=Hn(),a=Qo(i);return t=F2(t),n.context===null?n.context=t:n.pendingContext=t,n=co(o,a),n.payload={element:e},r=r===void 0?null:r,r!==null&&(n.callback=r),e=Ko(i,n,a),e!==null&&(Jr(e,i,a,o),Sd(e,i,a)),a}function cp(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function _1(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var t=e.retryLane;e.retryLane=t!==0&&t<n?t:n}}function yy(e,n){_1(e,n),(e=e.alternate)&&_1(e,n)}function NI(){return null}var z2=typeof reportError=="function"?reportError:function(e){console.error(e)};function wy(e){this._internalRoot=e}qp.prototype.render=wy.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(J(409));Gp(e,n,null,null)};qp.prototype.unmount=wy.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;Ba(function(){Gp(null,e,null,null)}),n[lo]=null}};function qp(e){this._internalRoot=e}qp.prototype.unstable_scheduleHydration=function(e){if(e){var n=gS();e={blockedOn:null,target:e,priority:n};for(var t=0;t<Fo.length&&n!==0&&n<Fo[t].priority;t++);Fo.splice(t,0,e),t===0&&yS(e)}};function by(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Kp(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function S1(){}function MI(e,n,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var u=cp(a);o.call(u)}}var a=B2(n,r,e,0,null,!1,!1,"",S1);return e._reactRootContainer=a,e[lo]=a.current,Pu(e.nodeType===8?e.parentNode:e),Ba(),a}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var s=r;r=function(){var u=cp(c);s.call(u)}}var c=vy(e,0,!1,null,null,!1,!1,"",S1);return e._reactRootContainer=c,e[lo]=c.current,Pu(e.nodeType===8?e.parentNode:e),Ba(function(){Gp(n,c,t,r)}),c}function Xp(e,n,t,r,i){var o=t._reactRootContainer;if(o){var a=o;if(typeof i=="function"){var s=i;i=function(){var c=cp(a);s.call(c)}}Gp(n,a,e,i)}else a=MI(t,n,e,i,r);return cp(a)}hS=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var t=ou(n.pendingLanes);t!==0&&(zv(n,t|1),rr(n,Bt()),!(Ye&6)&&(vc=Bt()+500,la()))}break;case 13:Ba(function(){var r=po(e,1);if(r!==null){var i=Hn();Jr(r,e,1,i)}}),yy(e,1)}};jv=function(e){if(e.tag===13){var n=po(e,134217728);if(n!==null){var t=Hn();Jr(n,e,134217728,t)}yy(e,134217728)}};mS=function(e){if(e.tag===13){var n=Qo(e),t=po(e,n);if(t!==null){var r=Hn();Jr(t,e,n,r)}yy(e,n)}};gS=function(){return ut};vS=function(e,n){var t=ut;try{return ut=e,n()}finally{ut=t}};rg=function(e,n,t){switch(n){case"input":if(Qm(e,t),n=t.name,t.type==="radio"&&n!=null){for(t=e;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<t.length;n++){var r=t[n];if(r!==e&&r.form===e.form){var i=zp(r);if(!i)throw Error(J(90));K_(r),Qm(r,i)}}}break;case"textarea":Q_(e,t);break;case"select":n=t.value,n!=null&&qs(e,!!t.multiple,n,!1)}};rS=fy;iS=Ba;var LI={usingClientEntryPoint:!1,Events:[Qu,js,zp,tS,nS,fy]},Gc={findFiberByHostInstance:Ra,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},OI={bundleType:Gc.bundleType,version:Gc.version,rendererPackageName:Gc.rendererPackageName,rendererConfig:Gc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ho.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=sS(e),e===null?null:e.stateNode},findFiberByHostInstance:Gc.findFiberByHostInstance||NI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bl.isDisabled&&Bl.supportsFiber)try{Lp=Bl.inject(OI),Ti=Bl}catch{}}Sr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LI;Sr.createPortal=function(e,n){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!by(n))throw Error(J(200));return AI(e,n,null,t)};Sr.createRoot=function(e,n){if(!by(e))throw Error(J(299));var t=!1,r="",i=z2;return n!=null&&(n.unstable_strictMode===!0&&(t=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),n=vy(e,1,!1,null,null,t,!1,r,i),e[lo]=n.current,Pu(e.nodeType===8?e.parentNode:e),new wy(n)};Sr.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(J(188)):(e=Object.keys(e).join(","),Error(J(268,e)));return e=sS(n),e=e===null?null:e.stateNode,e};Sr.flushSync=function(e){return Ba(e)};Sr.hydrate=function(e,n,t){if(!Kp(n))throw Error(J(200));return Xp(null,e,n,!0,t)};Sr.hydrateRoot=function(e,n,t){if(!by(e))throw Error(J(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",a=z2;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),n=B2(n,null,e,1,t??null,i,!1,o,a),e[lo]=n.current,Pu(e),r)for(e=0;e<r.length;e++)t=r[e],i=t._getVersion,i=i(t._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i);return new qp(n)};Sr.render=function(e,n,t){if(!Kp(n))throw Error(J(200));return Xp(null,e,n,!1,t)};Sr.unmountComponentAtNode=function(e){if(!Kp(e))throw Error(J(40));return e._reactRootContainer?(Ba(function(){Xp(null,null,e,!1,function(){e._reactRootContainer=null,e[lo]=null})}),!0):!1};Sr.unstable_batchedUpdates=fy;Sr.unstable_renderSubtreeIntoContainer=function(e,n,t,r){if(!Kp(t))throw Error(J(200));if(e==null||e._reactInternals===void 0)throw Error(J(38));return Xp(e,n,t,!1,r)};Sr.version="18.3.1-next-f1338f8080-20240426";function j2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(j2)}catch(e){console.error(e)}}j2(),j_.exports=Sr;var FI=j_.exports,C1=FI;Wm.createRoot=C1.createRoot,Wm.hydrateRoot=C1.hydrateRoot;/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var BI={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zI=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Fi=(e,n)=>{const t=oe.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:s="",children:c,...u},l)=>oe.createElement("svg",{ref:l,...BI,width:i,height:i,stroke:r,strokeWidth:a?Number(o)*24/Number(i):o,className:["lucide",`lucide-${zI(e)}`,s].join(" "),...u},[...n.map(([d,p])=>oe.createElement(d,p)),...Array.isArray(c)?c:[c]]));return t.displayName=`${e}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=Fi("CameraOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16",key:"qmtpty"}],["path",{d:"M9.5 4h5L17 7h3a2 2 0 0 1 2 2v7.5",key:"1ufyfc"}],["path",{d:"M14.121 15.121A3 3 0 1 1 9.88 10.88",key:"11zox6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jI=Fi("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $2=Fi("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U2=Fi("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $I=Fi("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=Fi("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=Fi("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WI=Fi("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V2=Fi("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VI=Fi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),HI=({onJoinRoom:e})=>{const[n,t]=oe.useState(""),[r,i]=oe.useState("user"),[o,a]=oe.useState(!0),[s,c]=oe.useState(!0),[u,l]=oe.useState(null),[d,p]=oe.useState("candidate"),f=oe.useRef(null);oe.useEffect(()=>((async()=>{try{const w=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});l(w),f.current&&(f.current.srcObject=w)}catch(w){console.error("Error accessing media devices:",w),w.name==="NotAllowedError"&&(a(!1),c(!1))}})(),()=>{u&&u.getTracks().forEach(w=>w.stop())}),[]);const m=()=>{if(u){const h=u.getVideoTracks()[0];h&&(h.enabled=!o,a(!o))}},g=()=>{if(u){const h=u.getAudioTracks()[0];h&&(h.enabled=!s,c(!s))}},v=()=>{n.trim()&&e(n,r,{isCameraEnabled:o,isMicEnabled:s,localStream:u,userRole:d})};return B.jsx("div",{className:"w-full max-w-md",children:B.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl shadow-xl border border-slate-700 p-8",children:[B.jsx("div",{className:"flex justify-center mb-6",children:B.jsx("div",{className:"h-20 w-20 rounded-full bg-gradient-to-br from-blue-500 to-teal-400 flex items-center justify-center",children:B.jsx(V2,{size:40,className:"text-white"})})}),B.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Join Meeting"}),B.jsxs("div",{className:"relative overflow-hidden rounded-lg mb-6 bg-black aspect-video",children:[B.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,className:`w-full h-full object-cover ${o?"":"invisible"}`}),!o&&B.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-800",children:B.jsx(Og,{size:48,className:"text-slate-500"})}),B.jsxs("div",{className:"absolute bottom-3 left-1/2 transform -translate-x-1/2 flex space-x-2",children:[B.jsx("button",{onClick:m,className:`p-3 rounded-full transition-all ${o?"bg-slate-700":"bg-red-500"}`,children:o?B.jsx(jI,{size:20,className:"text-white"}):B.jsx(Og,{size:20,className:"text-white"})}),B.jsx("button",{onClick:g,className:`p-3 rounded-full transition-all ${s?"bg-slate-700":"bg-red-500"}`,children:s?B.jsx(U2,{size:20,className:"text-white"}):B.jsx($2,{size:20,className:"text-white"})})]})]}),B.jsxs("div",{className:"space-y-4",children:[B.jsxs("div",{className:"space-y-2",children:[B.jsx("label",{htmlFor:"room-input",className:"block text-sm font-medium text-slate-300",children:"Room Name"}),B.jsx("div",{className:"relative",children:B.jsx("input",{id:"room-input",placeholder:"Enter room name",type:"text",value:n,onChange:h=>t(h.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-slate-400"})})]}),B.jsxs("div",{className:"space-y-2",children:[B.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-slate-300",children:"Your Name"}),B.jsxs("div",{className:"relative",children:[B.jsx("input",{id:"username",value:r,type:"text",onChange:h=>i(h.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-slate-400 pl-10"}),B.jsx("div",{className:"absolute inset-y-0 left-3 flex items-center pointer-events-none",children:B.jsx(UI,{size:18,className:"text-slate-400"})})]})]}),B.jsxs("div",{className:"space-y-2",children:[B.jsx("label",{htmlFor:"user-role",className:"block text-sm font-medium text-slate-300",children:"Your Role"}),B.jsxs("div",{className:"relative",children:[B.jsxs("select",{id:"user-role",value:d,onChange:h=>p(h.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white appearance-none",children:[B.jsx("option",{value:"candidate",children:"Candidate"}),B.jsx("option",{value:"interviewer",children:"Interviewer"}),B.jsx("option",{value:"recruiter",children:"Recruiter"})]}),B.jsx("div",{className:"absolute inset-y-0 right-3 flex items-center pointer-events-none",children:B.jsx("svg",{className:"h-5 w-5 text-slate-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:B.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),B.jsx("button",{onClick:v,className:"w-full mt-6 px-4 py-3 bg-gradient-to-r from-blue-500 to-teal-400 text-white rounded-lg font-medium hover:from-blue-600 hover:to-teal-500 transition-all shadow-lg hover:shadow-blue-500/25 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-slate-800",children:"Join Meeting"})]})]})})},GI=({onMuteAudio:e,onToggleCamera:n,onEndCall:t,isAudioMuted:r,isCameraEnabled:i,isFeedSending:o,userRole:a})=>{const s=a?a.charAt(0).toUpperCase()+a.slice(1):"Candidate",c=a==="interviewer"?"bg-blue-500/90":a==="recruiter"?"bg-purple-500/90":"bg-green-500/90";return B.jsxs("div",{className:"flex items-center justify-between",children:[B.jsx("div",{className:"flex items-center space-x-2",children:B.jsx("span",{className:`px-3 py-1 text-sm rounded-full ${c}`,children:s})}),B.jsxs("div",{className:"flex items-center space-x-2",children:[B.jsx("button",{onClick:e,disabled:!o,className:`p-3 rounded-full transition-all ${r?"bg-red-600":"bg-slate-700 hover:bg-slate-600"} ${o?"":"opacity-50 cursor-not-allowed"}`,children:r?B.jsx($2,{size:20,className:"text-white"}):B.jsx(U2,{size:20,className:"text-white"})}),B.jsx("button",{onClick:n,disabled:!o,className:`p-3 rounded-full transition-all ${i?"bg-slate-700 hover:bg-slate-600":"bg-red-600"} ${o?"":"opacity-50 cursor-not-allowed"}`,children:i?B.jsx(V2,{size:20,className:"text-white"}):B.jsx(WI,{size:20,className:"text-white"})}),B.jsx("button",{onClick:t,className:"bg-red-600 hover:bg-red-700 p-3 rounded-full transition-all",children:B.jsx($I,{size:20,className:"text-white rotate-225 transform"})})]}),B.jsx("div",{className:"w-[70px]"})," "]})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var H2=function(e,n){return(H2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(e,n)};function ri(e,n){function t(){this.constructor=e}H2(e,n),e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function ue(e,n,t,r){return new(t||(t=Promise))(function(i,o){function a(u){try{c(r.next(u))}catch(l){o(l)}}function s(u){try{c(r.throw(u))}catch(l){o(l)}}function c(u){u.done?i(u.value):new t(function(l){l(u.value)}).then(a,s)}c((r=r.apply(e,[])).next())})}function le(e,n){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(u){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(l[0]===6&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(d){l=[6,d],r=0}finally{t=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([c,u])}}}var qI=function(){function e(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(n,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},e.prototype.registerFlag=function(n,t,r){if(this.flagRegistry[n]={evaluationFn:t,setHook:r},this.urlFlags[n]!=null){var i=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+i+"."),this.set(n,i)}},e.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},e.prototype.getNumber=function(n){return this.get(n)},e.prototype.getBool=function(n){return this.get(n)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(n,t){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(t)},e.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},e.prototype.setFlags=function(n){this.flags=Object.assign({},n)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return KI(r,a[0],a[1]),a.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var a=o.split(":"),s=a[0],c=a[1];n.urlFlags[s]=function(u,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+u+".")}(s,c)})}},e}();function KI(e,n,t){e[decodeURIComponent(n)]=decodeURIComponent(t||"")}function K(){return G2}var G2=null,up=new Map,Fg=new Map;function q2(e,n){var t=X2(e,n);return up.get(t)}function XI(e){return Fg.get(e)}function R1(e){for(var n=up.entries(),t=[];;){var r=n.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===e&&t.push(s)}return t}function K2(e){var n=e.kernelName,t=e.backendName,r=X2(n,t);if(up.has(r))throw new Error("The kernel '"+n+"' for backend '"+t+"' is already registered");up.set(r,e)}function QI(e){var n=e.kernelName;Fg.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),Fg.set(n,e)}function X2(e,n){return n+"_"+e}function Bg(e,n,t){return Math.max(e,Math.min(n,t))}function Q2(e){return e%2==0?e:e+1}function YI(e){for(var n=0,t=0;t<e.length;t++)n+=e[t];return n}function A(e,n){if(!e)throw new Error(typeof n=="string"?n:n())}function ot(e,n,t){t===void 0&&(t=""),A(cn(e,n),function(){return t+" Shapes "+e+" and "+n+" must match"})}function kc(e){A(e!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function yc(e,n,t){if(n===void 0&&(n=[]),t===void 0&&(t=!1),n==null&&(n=[]),Array.isArray(e)||Ii(e)&&!t)for(var r=0;r<e.length;++r)yc(e[r],n,t);else n.push(e);return n}function he(e){if(e.length===0)return 1;for(var n=e[0],t=1;t<e.length;t++)n*=e[t];return n}function cn(e,n){if(e===n)return!0;if(e==null||n==null||e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function zt(e){return e%1==0}function JI(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var n=Math.exp(2*e);return(n-1)/(n+1)}function zg(e){var n=Math.ceil(Math.sqrt(e));return[n,Math.ceil(e/n)]}function Zs(e,n){return n<=e.length?e:e+" ".repeat(n-e.length)}function k1(e,n,t){return n===void 0&&(n=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(e())r();else{o++;var s=n(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function ZI(e,n){for(var t=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)t*=e[i];else if(e[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(r===-1){if(n>0&&n!==t)throw Error("Size("+n+") must match the product of shape "+e);return e}if(t===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(n%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+t);var o=e.slice();return o[r]=n/t,o}function en(e,n){var t=n.length;return A((e=e==null?n.map(function(r,i){return i}):[].concat(e)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+e}),A(e.every(function(r){return zt(r)}),function(){return"All values in axis param must be integers but got axis "+e}),e.map(function(r){return r<0?t+r:r})}function Sa(e,n){for(var t=[],r=[],i=n!=null&&Array.isArray(n)&&n.length===0,o=n==null||i?null:en(n,e).sort(),a=0,s=0;s<e.length;++s){if(o!=null){if(o[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(o[a]==null||o[a]>s)&&e[s]===1&&(t.push(e[s]),r.push(s)),o[a]<=s&&a++}e[s]!==1&&(t.push(e[s]),r.push(s))}return{newShape:t,keptDims:r}}function ju(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);t=new Uint8Array(n)}return t}function lp(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else if(e==="bool")t=new Uint8Array(n);else{if(e!=="string")throw new Error("Unknown data type "+e);t=new Array(n)}return t}function eP(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function tP(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function nP(e,n){return n!=="complex64"&&(n!=="float32"||e==="complex64")&&(n!=="int32"||e==="float32"||e==="complex64")&&(n!=="bool"||e!=="bool")}function Ii(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Y2(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function rP(e){if(e==null)return 0;var n=0;return e.forEach(function(t){return n+=t.length}),n}function xy(e){return typeof e=="string"||e instanceof String}function iP(e){return typeof e=="boolean"}function oP(e){return typeof e=="number"}function Ju(e){return Array.isArray(e)?Ju(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":oP(e)?"float32":xy(e)?"string":iP(e)?"bool":"float32"}function jg(e){return!!(e&&e.constructor&&e.call&&e.apply)}function $g(e,n){for(var t=n;t<e;++t)if(e%t==0)return t;return e}function Pi(e){var n=e.length;if(n<2)return[];var t=new Array(n-1);t[n-2]=e[n-1];for(var r=n-3;r>=0;--r)t[r]=t[r+1]*e[r+1];return t}function J2(e,n,t){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=yc(e)),t&&eP(e,n),function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"}(e,n))return e;if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool"){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)Math.round(e[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+n)}function E1(e,n){if(e.length===0)return n[0];var t=e.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==n.length)throw new Error("["+e+"] does not match the input size.");return function r(i,o,a){var s=new Array;if(o.length===1)for(var c=o[0],u=0;u<c;u++)s[u]=a[i+u];else{c=o[0];var l=o.slice(1),d=l.reduce(function(p,f){return p*f});for(u=0;u<c;u++)s[u]=r(i+u*d,l,a)}return s}(0,e,n)}function Z2(e,n){for(var t=Zu(e,n),r=0;r<t.length;r++)t[r]=1;return t}function Zu(e,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+n)}function _i(){return K().platform.now()}function eC(e){e.forEach(function(n){A(Number.isInteger(n)&&n>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."})})}function aP(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",K().platform.encode(e,n)}function dp(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",K().platform.decode(e,n)}function T1(e,n,t){if(n===0)return 0;if(n===1)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=t[i]*e[i];return r}function sP(e,n,t){if(n===0)return[];if(n===1)return[e];for(var r=new Array(n),i=0;i<r.length-1;++i)r[i]=Math.floor(e/t[i]),e-=r[i]*t[i];return r[r.length-1]=e,r}var cP=function(){function e(n,t){this.backendTimer=n,this.logger=t,t==null&&(this.logger=new uP)}return e.prototype.profileKernel=function(n,t,r){var i,o=this,a=this.backendTimer.time(function(){i=r()});return i.forEach(function(s){s.data().then(function(c){(function(u,l,d){if(l!=="float32")return!1;for(var p=0;p<u.length;p++){var f=u[p];if(isNaN(f)||!isFinite(f))return console.warn("Found "+f+" in the result of '"+d+"'"),!0}})(c,s.dtype,n),a.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),o.logger.logKernelProfile(n,s,c,u.kernelMs,t,l)})})}),i},e}(),uP=function(){function e(){}return e.prototype.logKernelProfile=function(n,t,r,i,o,a){var s=typeof i=="number"?Zs(i+"ms",9):i.error,c=Zs(n,25),u=t.rank,l=t.size,d=Zs(t.shape.toString(),14),p="";for(var f in o){var m=o[f].shape||t.shape,g=m.length;p+=f+": "+g+"D "+(g>0?m:"")+" "}console.log("%c"+c+"	%c"+s+"	%c"+u+"D "+d+"	%c"+l+"	%c"+p+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}(),D1=20,qc=3,zh=7;function lP(e,n,t,r){var i=Pi(n),o=function(u,l,d,p){var f=he(l),m=p[p.length-1],g=new Array(m).fill(0),v=l.length,h=d==="complex64"?Xc(u):u;if(v>1)for(var w=0;w<f/m;w++)for(var y=w*m,b=0;b<m;b++)g[b]=Math.max(g[b],Kc(h[y+b],0,d).length);return g}(e,n,t,i),a=n.length,s=function u(l,d,p,f,m,g){g===void 0&&(g=!0);var v=p==="complex64"?2:1,h=d[0],w=d.length;if(w===0)return p==="complex64"?[Kc(Xc(l)[0],0,p)]:p==="bool"?[tC(l[0])]:[l[0].toString()];if(w===1){if(h>D1){var y=qc*v,b=Array.from(l.slice(0,y)),x=Array.from(l.slice((h-qc)*v,h*v));return p==="complex64"&&(b=Xc(b),x=Xc(x)),["["+b.map(function(j,H){return Kc(j,m[H],p)}).join(", ")+", ..., "+x.map(function(j,H){return Kc(j,m[h-qc+H],p)}).join(", ")+"]"]}return["["+(p==="complex64"?Xc(l):Array.from(l)).map(function(j,H){return Kc(j,m[H],p)}).join(", ")+"]"]}var _=d.slice(1),C=f.slice(1),R=f[0]*v,S=[];if(h>D1){for(var E=0;E<qc;E++){var T=(I=E*R)+R;S.push.apply(S,u(l.slice(I,T),_,p,C,m,!1))}for(S.push("..."),E=h-qc;E<h;E++)T=(I=E*R)+R,S.push.apply(S,u(l.slice(I,T),_,p,C,m,E===h-1))}else for(E=0;E<h;E++){var I;T=(I=E*R)+R,S.push.apply(S,u(l.slice(I,T),_,p,C,m,E===h-1))}var F=w===2?",":"";for(S[0]="["+S[0]+F,E=1;E<S.length-1;E++)S[E]=" "+S[E]+F;var z=`,
`;for(E=2;E<w;E++)z+=`
`;return S[S.length-1]=" "+S[S.length-1]+"]"+(g?"":z),S}(e,n,t,i,o),c=["Tensor"];return r&&(c.push("  dtype: "+t),c.push("  rank: "+a),c.push("  shape: ["+n+"]"),c.push("  values:")),c.push(s.map(function(u){return"    "+u}).join(`
`)),c.join(`
`)}function Kc(e,n,t){return Zs(Array.isArray(e)?parseFloat(e[0].toFixed(zh))+" + "+parseFloat(e[1].toFixed(zh))+"j":xy(e)?"'"+e+"'":t==="bool"?tC(e):parseFloat(e.toFixed(zh)).toString(),n)}function tC(e){return e===0?"false":"true"}function Xc(e){for(var n=[],t=0;t<e.length;t+=2)n.push([e[t],e[t+1]]);return n}var $u=function(){function e(n,t,r){var i=this;if(this.dtype=t,this.shape=n.slice(),this.size=he(n),r!=null){var o=r.length;A(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||lp(t,this.size),this.strides=Pi(n)}return e.prototype.set=function(n){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),A(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=n},e.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length===0&&(n=[0]);for(var r=0,i=0,o=n;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var c=n[n.length-1],u=0;u<n.length-1;++u)c+=this.strides[u]*n[u];return this.values[c]},e.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var t=n[n.length-1],r=0;r<n.length-1;++r)t+=this.strides[r]*n[r];return t},e.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(n/this.strides[r]),n-=t[r]*this.strides[r];return t[t.length-1]=n,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return Ci().makeTensor(this.values,this.shape,this.dtype)},e}(),Ci=null,G=null,nC=null,kt=function(){function e(n,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=he(n),this.strides=Pi(n),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},e.prototype.as3D=function(n,t,r){return this.throwIfDisposed(),this.reshape([n,t,r])},e.prototype.as4D=function(n,t,r,i){return this.throwIfDisposed(),this.reshape([n,t,r,i])},e.prototype.as5D=function(n,t,r,i,o){return this.throwIfDisposed(),this.reshape([n,t,r,i,o])},e.prototype.asType=function(n){return this.throwIfDisposed(),G.cast(this,n)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return ue(this,void 0,void 0,function(){var n;return le(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,G.buffer(this.shape,this.dtype,n)]}})})},e.prototype.bufferSync=function(){return G.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return ue(this,void 0,void 0,function(){var n;return le(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,E1(this.shape,n)]}})})},e.prototype.arraySync=function(){return E1(this.shape,this.dataSync())},e.prototype.data=function(){return ue(this,void 0,void 0,function(){var n,t;return le(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=Ci().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:t=r.sent();try{return[2,t.map(function(i){return dp(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}})})},e.prototype.dataSync=function(){this.throwIfDisposed();var n=Ci().readSync(this.dataId);if(this.dtype==="string")try{return n.map(function(t){return dp(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},e.prototype.bytes=function(){return ue(this,void 0,void 0,function(){var n;return le(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Ci().read(this.dataId)];case 1:return n=t.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}})})},e.prototype.dispose=function(){this.isDisposed||(Ci().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(n){return n===void 0&&(n=!1),G.print(this,n)},e.prototype.reshape=function(n){return this.throwIfDisposed(),G.reshape(this,n)},e.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},e.prototype.expandDims=function(n){return n===void 0&&(n=0),G.expandDims(this,n)},e.prototype.cumsum=function(n,t,r){return n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1),G.cumsum(this,n,t,r)},e.prototype.squeeze=function(n){return this.throwIfDisposed(),G.squeeze(this,n)},e.prototype.clone=function(){return this.throwIfDisposed(),G.clone(this)},e.prototype.oneHot=function(n,t,r){return this.throwIfDisposed(),G.oneHot(this,n,t,r)},e.prototype.toString=function(n){return n===void 0&&(n=!1),lP(this.dataSync(),this.shape,this.dtype,n)},e.prototype.tile=function(n){return this.throwIfDisposed(),G.tile(this,n)},e.prototype.gather=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.gather(this,n,t)},e.prototype.matMul=function(n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),G.matMul(this,n,t,r)},e.prototype.dot=function(n){return this.throwIfDisposed(),G.dot(this,n)},e.prototype.norm=function(n,t,r){return n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),G.norm(this,n,t,r)},e.prototype.slice=function(n,t){return this.throwIfDisposed(),G.slice(this,n,t)},e.prototype.reverse=function(n){return this.throwIfDisposed(),G.reverse(this,n)},e.prototype.concat=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),n instanceof e&&(n=[n]),G.concat([this].concat(n),t)},e.prototype.split=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),G.split(this,n,t)},e.prototype.stack=function(n,t){return t===void 0&&(t=0),G.stack([this,n],t)},e.prototype.unstack=function(n){return n===void 0&&(n=0),G.unstack(this,n)},e.prototype.pad=function(n,t){return t===void 0&&(t=0),G.pad(this,n,t)},e.prototype.batchNormalization=function(n,t,r,i,o){return r===void 0&&(r=.001),nC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,o,i,r)},e.prototype.batchNorm=function(n,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),G.batchNorm(this,n,t,r,i,o)},e.prototype.all=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.all(this,n,t)},e.prototype.any=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.any(this,n,t)},e.prototype.logSumExp=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.logSumExp(this,n,t)},e.prototype.sum=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.sum(this,n,t)},e.prototype.prod=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.prod(this,n,t)},e.prototype.mean=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.mean(this,n,t)},e.prototype.min=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.min(this,n,t)},e.prototype.max=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),G.max(this,n,t)},e.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),G.argMin(this,n)},e.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),G.argMax(this,n)},e.prototype.cast=function(n){return this.throwIfDisposed(),G.cast(this,n)},e.prototype.add=function(n){return this.throwIfDisposed(),G.add(this,n)},e.prototype.addStrict=function(n){return this.throwIfDisposed(),G.addStrict(this,n)},e.prototype.atan2=function(n){return this.throwIfDisposed(),G.atan2(this,n)},e.prototype.sub=function(n){return this.throwIfDisposed(),G.sub(this,n)},e.prototype.subStrict=function(n){return this.throwIfDisposed(),G.subStrict(this,n)},e.prototype.pow=function(n){return this.throwIfDisposed(),G.pow(this,n)},e.prototype.powStrict=function(n){return this.throwIfDisposed(),G.powStrict(this,n)},e.prototype.mul=function(n){return this.throwIfDisposed(),G.mul(this,n)},e.prototype.mulStrict=function(n){return this.throwIfDisposed(),G.mulStrict(this,n)},e.prototype.div=function(n){return this.throwIfDisposed(),G.div(this,n)},e.prototype.divNoNan=function(n){return this.throwIfDisposed(),G.divNoNan(this,n)},e.prototype.floorDiv=function(n){return this.throwIfDisposed(),G.floorDiv(this,n)},e.prototype.divStrict=function(n){return this.throwIfDisposed(),G.divStrict(this,n)},e.prototype.minimum=function(n){return this.throwIfDisposed(),G.minimum(this,n)},e.prototype.minimumStrict=function(n){return this.throwIfDisposed(),G.minimumStrict(this,n)},e.prototype.maximum=function(n){return this.throwIfDisposed(),G.maximum(this,n)},e.prototype.maximumStrict=function(n){return this.throwIfDisposed(),G.maximumStrict(this,n)},e.prototype.mod=function(n){return this.throwIfDisposed(),G.mod(this,n)},e.prototype.modStrict=function(n){return this.throwIfDisposed(),G.modStrict(this,n)},e.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),G.squaredDifferenceStrict(this,n)},e.prototype.transpose=function(n){return this.throwIfDisposed(),G.transpose(this,n)},e.prototype.notEqual=function(n){return this.throwIfDisposed(),G.notEqual(this,n)},e.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),G.notEqualStrict(this,n)},e.prototype.less=function(n){return this.throwIfDisposed(),G.less(this,n)},e.prototype.lessStrict=function(n){return this.throwIfDisposed(),G.lessStrict(this,n)},e.prototype.equal=function(n){return this.throwIfDisposed(),G.equal(this,n)},e.prototype.equalStrict=function(n){return this.throwIfDisposed(),G.equalStrict(this,n)},e.prototype.lessEqual=function(n){return this.throwIfDisposed(),G.lessEqual(this,n)},e.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),G.lessEqualStrict(this,n)},e.prototype.greater=function(n){return this.throwIfDisposed(),G.greater(this,n)},e.prototype.greaterStrict=function(n){return this.throwIfDisposed(),G.greaterStrict(this,n)},e.prototype.greaterEqual=function(n){return this.throwIfDisposed(),G.greaterEqual(this,n)},e.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),G.greaterEqualStrict(this,n)},e.prototype.logicalAnd=function(n){return this.throwIfDisposed(),G.logicalAnd(this,n)},e.prototype.logicalOr=function(n){return this.throwIfDisposed(),G.logicalOr(this,n)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),G.logicalNot(this)},e.prototype.logicalXor=function(n){return this.throwIfDisposed(),G.logicalXor(this,n)},e.prototype.where=function(n,t){return this.throwIfDisposed(),G.where(n,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),G.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),G.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),G.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),G.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),G.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),G.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),G.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),G.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),G.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),G.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),G.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),G.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),G.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),G.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),G.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),G.abs(this)},e.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),G.clipByValue(this,n,t)},e.prototype.relu=function(){return this.throwIfDisposed(),G.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),G.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),G.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),G.selu(this)},e.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),G.leakyRelu(this,n)},e.prototype.prelu=function(n){return this.throwIfDisposed(),G.prelu(this,n)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),G.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),G.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),G.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),G.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),G.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),G.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),G.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),G.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),G.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),G.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),G.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),G.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),G.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),G.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),G.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),G.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),G.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),G.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),G.round(this)},e.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),G.step(this,n)},e.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),G.softmax(this,n)},e.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),G.logSoftmax(this,n)},e.prototype.resizeBilinear=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeBilinear(this,n,t)},e.prototype.resizeNearestNeighbor=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),G.image.resizeNearestNeighbor(this,n,t)},e.prototype.conv1d=function(n,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),G.conv1d(this,n,t,r,i,o,a)},e.prototype.conv2d=function(n,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),G.conv2d(this,n,t,r,i,o,a)},e.prototype.conv2dTranspose=function(n,t,r,i,o){return this.throwIfDisposed(),G.conv2dTranspose(this,n,t,r,i,o)},e.prototype.depthwiseConv2D=function(n,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),G.depthwiseConv2d(this,n,t,r,i,o,a)},e.prototype.separableConv2d=function(n,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),G.separableConv2d(this,n,t,r,i,o,a)},e.prototype.avgPool=function(n,t,r,i){return this.throwIfDisposed(),G.avgPool(this,n,t,r,i)},e.prototype.maxPool=function(n,t,r,i){return this.throwIfDisposed(),G.maxPool(this,n,t,r,i)},e.prototype.localResponseNormalization=function(n,t,r,i){return n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),G.localResponseNormalization(this,n,t,r,i)},e.prototype.pool=function(n,t,r,i,o){return this.throwIfDisposed(),G.pool(this,n,t,r,i,o)},e.prototype.variable=function(n,t,r){return n===void 0&&(n=!0),this.throwIfDisposed(),Ci().makeVariable(this,n,t,r)},e.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),G.unsortedSegmentSum(this,n,t)},e.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),G.batchToSpaceND(this,n,t)},e.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),G.spaceToBatchND(this,n,t)},e.prototype.topk=function(n,t){return n===void 0&&(n=1),t===void 0&&(t=!0),this.throwIfDisposed(),G.topk(this,n,t)},e.prototype.stridedSlice=function(n,t,r,i,o,a,s,c){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),c===void 0&&(c=0),this.throwIfDisposed(),G.stridedSlice(this,n,t,r,i,o,a,s,c)},e.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),G.depthToSpace(this,n,t)},e.prototype.fft=function(){return this.throwIfDisposed(),G.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),G.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),G.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),G.spectral.irfft(this)},e}();Object.defineProperty(kt,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var I1,Ug,Wg,Vg,Hg,wc=function(e){function n(t,r,i,o){var a=e.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=r,a.name=i,a}return ri(n,e),n.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!cn(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ci().disposeTensor(this),this.dataId=t.dataId,Ci().incRef(this,null)},n.prototype.dispose=function(){Ci().disposeVariable(this),this.isDisposedInternal=!0},n}(kt);Object.defineProperty(wc,Symbol.hasInstance,{value:function(e){return e instanceof kt&&e.assign!=null&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(I1||(I1={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Ug||(Ug={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Wg||(Wg={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Vg||(Vg={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Hg||(Hg={}));var dP={float32:Vg,int32:Ug,bool:Wg,complex64:Hg};function hn(e,n){if(e==="string"||n==="string"){if(e==="string"&&n==="string")return"string";throw new Error("Can not upcast "+e+" with "+n)}return dP[e][n]}function jh(e){return hn(e,"int32")}function It(e,n){if(e.dtype===n.dtype)return[e,n];var t=hn(e.dtype,n.dtype);return[e.cast(t),n.cast(t)]}function pP(e,n){A(e.dtype===n.dtype,function(){return"The dtypes of the first("+e.dtype+") and second("+n.dtype+") input must match"})}function rC(e){var n=[];return function t(r,i,o){if(r!=null){if(r instanceof kt)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var c in s){var u=s[c];o.has(u)||(o.add(u),t(u,i,o))}}}}(e,n,new Set),n}var $h,P1=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},e}(),fP=function(){function e(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new P1}return e.prototype.ready=function(){return ue(this,void 0,void 0,function(){var n,t,r;return le(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),t=0,i.label=1;case 1:return t<n.length?(r=n[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},e.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},e.prototype.registerBackend=function(n,t,r){return r===void 0&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:r},!0)},e.prototype.setBackend=function(n){return ue(this,void 0,void 0,function(){var t,r,i;return le(this,function(o){switch(o.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new cP(this.backendInstance),[2,!0]}})})},e.prototype.setupRegisteredKernels=function(){var n=this;R1(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(n.backendInstance)})},e.prototype.disposeRegisteredKernels=function(n){var t=this;R1(n).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[n])})},e.prototype.initializeBackend=function(n){var t=this,r=this.registryFactory[n];if(r==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[n]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return n.registryFactory[r].priority-n.registryFactory[t].priority})},e.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var r=n[t],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(n,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=n,n.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(n,t){var r,i=this,o=null;if(t==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");t=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=n}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},e.prototype.scopedRun=function(n,t,r){n();try{var i=r();return t(),i}catch(o){throw t(),o}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),r={x:n};return this.addTapeNode(this.state.activeScope.name,r,[t],function(i){return{x:function(){return i.toFloat()}}},[]),t},e.prototype.runKernel=function(n,t,r,i,o){return this.runKernelFunc(null,t,null,n,r,i,o)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(n,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(c){o+=c.dtype==="complex64"?3:1});var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},e.prototype.runKernelFunc=function(n,t,r,i,o,a,s){var c,u=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],d=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var p,f=function(w){d&&(l=w.map(function(y){return u.keep(u.clone(y))}))},m=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,h=q2(i,this.backendName);return p=h!=null?function(){var w=u.backend.numDataIds();v=h.kernelFunc({inputs:t,attrs:o,backend:u.backend});var y=Array.isArray(v)?v:[v];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,w,y);var b=y.map(function(_){var C=_.dataId,R=_.shape,S=_.dtype;return u.makeTensorFromDataId(C,R,S)}),x=b.filter(function(_,C){return s[C]});return f((a||[]).slice().concat(x)),b}:function(){var w=u.backend.numDataIds();v=u.tidy(function(){return n(u.backend,f)});var y=Array.isArray(v)?v:[v];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(i,w,y),y},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){c=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(i,t,function(){return p()}):p()}),d&&this.addTapeNode(i,t,c,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(w){return t[w].shape}),outputShapes:c.map(function(w){return w.shape})}),Array.isArray(v)?c:c[0]},e.prototype.makeTensor=function(n,t,r,i){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=n;r==="string"&&xy(n[0])&&(o=n.map(function(l){return aP(l)}));var a=i.write(o,t,r),s=new kt(t,r,a,this.nextTensorId());if(this.incRef(s,i),r==="string"){var c=this.state.tensorInfo.get(a),u=rP(o);this.state.numBytes+=u-c.bytes,c.bytes=u}return s},e.prototype.makeTensorFromDataId=function(n,t,r,i){var o=new kt(t,r=r||"float32",n,this.nextTensorId());return this.incRef(o,i),o},e.prototype.makeVariable=function(n,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==n.dtype&&(n=n.asType(i));var o=new wc(n,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},e.prototype.incRef=function(n,t){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(i=n.size*Y2(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof wc||this.track(n)},e.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var t=this.state.registeredVariables[n];this.disposeVariable(t)}},e.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},e.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},e.prototype.profile=function(n){return ue(this,void 0,void 0,function(){var t,r;return le(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(n,t,r,i,o){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:r,saved:o},c=XI(n);c!=null&&(i=c.gradFunc),i!=null&&(s.gradient=function(u){return u=u.map(function(l,d){if(l==null){var p=r[d],f=Zu(p.size,p.dtype);return a.makeTensor(f,p.shape,p.dtype)}return l}),i(u.length>1?u:u[0],o)}),this.state.activeTape.push(s)},e.prototype.keep=function(n){return n.kept=!0,n},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(n){for(var t=this,r=rC(n),i=new Set(r.map(function(c){return c.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(c){c.kept||c.scopeId!==s.id||t.track(c)})},e.prototype.gradients=function(n,t,r,i){var o=this;if(i===void 0&&(i=!1),A(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",n)});A(a instanceof kt,function(){return"The result y returned by f() must be a tensor."});var s=function(c,u,l){for(var d={},p={},f=0;f<u.length;f++)d[u[f].id]=!0;for(f=0;f<c.length;f++){var m=(_=c[f]).inputs;for(var g in m){for(var v=m[g],h=!1,w=0;w<u.length;w++)if(d[v.id]){_.outputs.forEach(function(E){return d[E.id]=!0}),h=!0,p[_.id]=!0;break}if(h)break}}var y={};y[l.id]=!0;var b={};for(f=c.length-1;f>=0;f--)for(m=(_=c[f]).inputs,w=0;w<_.outputs.length;w++)if(y[_.outputs[w].id]){for(var g in m)y[m[g].id]=!0,b[_.id]=!0;break}var x=[];for(f=0;f<c.length;f++){var _;if(p[(_=c[f]).id]&&b[_.id]){var C={};for(var g in _.inputs){var R=_.inputs[g];d[R.id]&&(C[g]=R)}var S=Object.assign({},_);S.inputs=C,S.outputs=_.outputs,x.push(S)}}return x}(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var c,u,l={};l[a.id]=r??(c=a.shape,u=Z2(he(c),"float32"),O.makeTensor(u,c,"float32")),function(p,f,m){for(var g=function(h){var w=f[h],y=[];if(w.outputs.forEach(function(C){var R=p[C.id];R!=null?y.push(R):y.push(null)}),w.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+w.kernelName+".");var b=w.gradient(y),x=function(C){if(!(C in b))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(b)+".");var R=m(function(){return b[C]()});if(R.dtype!=="float32")throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input "+C+" must have 'float32' dtype, but has '"+R.dtype+"'");var S=w.inputs[C];if(!cn(R.shape,S.shape))throw new Error("Error in gradient for op "+w.kernelName+". The gradient of input '"+C+"' has shape '"+R.shape+"', which does not match the shape of the input '"+S.shape+"'");if(p[S.id]==null)p[S.id]=R;else{var E=p[S.id];p[S.id]=E.add(R),E.dispose()}};for(var _ in w.inputs)x(_)},v=f.length-1;v>=0;v--)g(v)}(l,s,function(p){return o.tidy(p)});var d=t.map(function(p){return l[p.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(p){for(var f=0,m=p.saved;f<m.length;f++)m[f].dispose()}),o.state.activeTape=null),{value:a,grads:d}})},e.prototype.customGrad=function(n){var t=this;return A(jg(n),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];A(i.every(function(s){return s instanceof kt}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,c){a[c]=s}),t.runKernelFunc(function(s,c){return A((r=n.apply(void 0,i.concat([c]))).value instanceof kt,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),A(jg(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,c){var u=r.gradFunc(s,c),l=Array.isArray(u)?u:[u];A(l.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),A(l.every(function(p){return p instanceof kt}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return l.forEach(function(p,f){d[f]=function(){return p}}),d})}},e.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},e.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},e.prototype.time=function(n){return ue(this,void 0,void 0,function(){var t,r;return le(this,function(i){switch(i.label){case 0:return t=_i(),[4,this.backend.time(n)];case 1:return(r=i.sent()).wallMs=_i()-t,[2,r]}})})},e.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new P1,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),O=function(){var e=function(){if($h==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}$h=t}return $h}();if(e._tfengine==null){var n=new qI(e);e._tfengine=new fP(n)}return function(t){G2=t}(e._tfengine.ENV),Ci=function(){return e._tfengine},e._tfengine}();function iC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Qi=K();Qi.registerFlag("DEBUG",function(){return!1},function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Qi.registerFlag("IS_BROWSER",function(){return iC()}),Qi.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Qi.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Qi.registerFlag("PROD",function(){return!1}),Qi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Qi.getBool("DEBUG")}),Qi.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Qi.registerFlag("IS_TEST",function(){return!1});var Uu,gr,hr,xa={},Uh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hP(e,n){xa[e]=n}function Bi(e){e in xa||(xa[e]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete xa[t]},!1),t===1?r.getContext("webgl",Uh)||r.getContext("experimental-webgl",Uh):r.getContext("webgl2",Uh)}(e));var n=xa[e];return n.isContextLost()?(delete xa[e],Bi(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),xa[e])}function Qp(e,n){return[n,e]}function vu(e){var n=he(e);return zg(Math.ceil(n/4))}function el(e,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(e/2))]}function _y(e,n){var t,r,i,o,a,s,c,u,l,d=e;return K().getNumber("WEBGL_VERSION")===2?(t=d.R32F,r=d.R16F,i=d.RGBA16F,o=d.RGBA32F,a=d.RED,s=4,c=1,u=d.HALF_FLOAT,l=d.FLOAT):(t=e.RGBA,r=e.RGBA,i=e.RGBA,o=d.RGBA,a=e.RGBA,s=4,c=4,u=n!=null?n.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:c,textureTypeHalfFloat:u,textureTypeFloat:l}}function me(e,n,t){var r=t();return n&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+yP(i,o))}(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Uu||(Uu={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(gr||(gr={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(hr||(hr={}));var mP=596e-10,gP=65504;function vP(e){return!!(K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||mP<Math.abs(e)&&Math.abs(e)<gP)}function yP(e,n){switch(n){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function zl(e,n,t){return mo(e,n,function(){return e.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function wP(e,n,t){var r=mo(e,n,function(){return e.createShader(e.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(me(e,n,function(){return e.shaderSource(r,t)}),me(e,n,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function bP(e,n,t){var r=mo(e,n,function(){return e.createShader(e.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(me(e,n,function(){return e.shaderSource(r,t)}),me(e,n,function(){return e.compileShader(r)}),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw function(i,o){var a=xP.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],c=i.split(`
`),u=c.length.toString().length+2,l=c.map(function(v,h){return Zs((h+1).toString(),u)+v}),d=0,p=0;p<l.length;p++)d=Math.max(l[p].length,d);var f=l.slice(0,s-1),m=l.slice(s-1,s),g=l.slice(s);console.log(f.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Zs(m[0],d),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(g.join(`
`))}(t,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Wh,Vh,xP=/ERROR: [0-9]+:([0-9]+):/g;function _P(e,n){return mo(e,n,function(){return e.createProgram()},"Unable to create WebGLProgram.")}function SP(e,n,t){if(me(e,n,function(){return e.linkProgram(t)}),e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Hh(e,n,t){if(me(e,n,function(){return e.validateProgram(t)}),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function CP(e,n,t){var r=mo(e,n,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return me(e,n,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),me(e,n,function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)}),r}function RP(e,n,t){var r=mo(e,n,function(){return e.createBuffer()},"Unable to create WebGLBuffer");return me(e,n,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)}),me(e,n,function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)}),r}function kP(e,n){return mo(e,n,function(){return e.createTexture()},"Unable to create WebGLTexture.")}function EP(e,n){var t=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||n<=0){var r="["+e+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>t||n>t)throw r="["+e+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function TP(e,n){return mo(e,n,function(){return e.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function A1(e,n,t,r,i,o,a,s){var c=e.getAttribLocation(t,r);return c!==-1&&(me(e,n,function(){return e.bindBuffer(e.ARRAY_BUFFER,i)}),me(e,n,function(){return e.vertexAttribPointer(c,o,e.FLOAT,!1,a,s)}),me(e,n,function(){return e.enableVertexAttribArray(c)}),!0)}function DP(e,n,t,r){MP(e,r),me(e,n,function(){return e.activeTexture(e.TEXTURE0+r)}),me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,t)})}function IP(e,n,t,r){return mo(e,n,function(){return e.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function PP(e,n,t){return e.getUniformLocation(n,t)}function AP(e,n,t,r,i,o){me(e,n,function(){return DP(e,n,r,o)}),me(e,n,function(){return e.uniform1i(i,o)})}function Gh(e,n,t,r){me(e,n,function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)}),me(e,n,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)})}function N1(e,n,t){me(e,n,function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)}),me(e,n,function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)})}function jl(e){var n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+NP(e,n))}function NP(e,n){switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function mo(e,n,t,r){var i=me(e,n,function(){return t()});if(i==null)throw new Error(r);return i}function MP(e,n){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+e.TEXTURE0;if(r<e.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function pp(e,n){return n===void 0&&(n=2),he(e.slice(0,e.length-n))}function fp(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function qh(e){var n=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(n=[pp(e)].concat(fp(e))),n}function LP(e,n){var t;n===void 0&&(n=!1);var r=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,(e=e.map(function(u,l){return l>=e.length-2?Q2(e[l]):e[l]})).length===1&&(e=[2,e[0]])),e.length!==2){var i=Sa(e);e=i.newShape}var o=he(e);if(e.length<=1&&o<=r)return[1,o];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(n){var a=pp(e),s=2,c=2;return e.length&&(s=(t=fp(e))[0],c=t[1]),zg(o=a*(s/2)*(c/2)).map(function(u){return 2*u})}return zg(o)}function $l(e){return e%2==0}function Ul(e,n){if(cn(e=e.slice(-2),n=n.slice(-2))||!e.length||!n.length||e[0]===0||e[1]===0||n[0]===0||n[1]===0)return!0;if(e.length!==n.length){var t=e.slice(-1)[0],r=n.slice(-1)[0];if(t===r||$l(t)&&$l(r)&&(e[0]===1||n[0]===1))return!0}return e[1]===n[1]&&$l(e[0])&&$l(n[0])}function OP(e){if(Wh==null){var n=Bi(e);Wh=n.getParameter(n.MAX_TEXTURE_SIZE)}return Wh}function FP(e){if(Vh==null){var n=Bi(e);Vh=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Vh)}function BP(e){if(e===0)return 0;var n=Bi(e);return Lr(n,"EXT_disjoint_timer_query_webgl2")&&e===2?2:Lr(n,"EXT_disjoint_timer_query")?1:0}function Lr(e,n){return e.getExtension(n)!=null}function M1(e){try{if(Bi(e)!=null)return!0}catch{return!1}return!1}function zP(e){if(e===0)return!1;var n=Bi(e);if(e===1){if(!Lr(n,"OES_texture_float"))return!1}else if(!Lr(n,"EXT_color_buffer_float"))return!1;return Gg(n)}function jP(e){if(e===0)return!1;var n=Bi(e);if(e!==1){if(Lr(n,"EXT_color_buffer_float"))return Gg(n);if(Lr(n,"EXT_color_buffer_half_float")){var t=n.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=_y(r,i),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var c=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),c}(n,t)}return!1}return!!Lr(n,"OES_texture_float")&&!!Lr(n,"WEBGL_color_buffer_float")&&Gg(n)}function Gg(e){var n=_y(e),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(r),i}function $P(e){return e===2&&Bi(e).fenceSync!=null}var De=K();function oC(e){K().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ie(e,n){return O.tidy(e,n)}function ir(e){rC(e).forEach(function(n){return n.dispose()})}function UP(e){return O.keep(e)}function hp(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];K().getBool("IS_TEST")||console.warn.apply(console,e)}function da(e,n){var t=e;if(Ii(e))return n==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(t)||Ii(t)&&n!=="string";)r.push(t.length),t=t[0];return Array.isArray(e)&&K().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!Ii(o))return void A(a.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"});A(a.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),A(o.length===a[0],function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"});for(var c=a.slice(1),u=0;u<o.length;++u)i(o[u],c,s.concat(u))}(e,r,[]),r}function L1(e,n,t,r){if(e!=null&&(e!=="numeric"&&e!==n||e==="numeric"&&n==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+e+" tensor, but got "+n+" tensor")}function D(e,n,t,r){if(r===void 0&&(r="numeric"),e instanceof kt)return L1(r,e.dtype,n,t),e;var i=Ju(e);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),L1(r,i,n,t),e==null||!Ii(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var o=e==null?"null":e.constructor.name;throw new Error("Argument '"+n+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=da(e,i);Ii(e)||Array.isArray(e)||(e=[e]);var s=i!=="string"?J2(e,i,K().getBool("DEBUG")):yc(e,[],!0);return O.makeTensor(s,a,i)}function mp(e,n,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+n+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return e.map(function(i,o){return D(i,n+"["+o+"]",t)},r)}function aC(e,n){for(var t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0}function WP(e,n,t){for(var r=e.length+n.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(e[o++]):i.push(n[a++]);return i}function Dn(e,n){for(var t=[],r=e.length,i=0;i<r;i++)n.indexOf(i)===-1&&t.push(e[i]);return[t,n.map(function(o){return e[o]})]}function ar(e,n){return WP(e,n.map(function(t){return 1}),n)}function fr(e,n,t){A(aC(n,t),function(){return e+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."})}function zi(e,n){if(aC(e,n))return null;for(var t=[],r=0;r<n;++r)e.indexOf(r)===-1&&t.push(r);return e.forEach(function(i){return t.push(i)}),t}function Sy(e){return e.map(function(n,t){return[t,n]}).sort(function(n,t){return n[1]-t[1]}).map(function(n){return n[0]})}function ji(e,n){for(var t=[],r=n-e;r<n;++r)t.push(r);return t}function VP(e,n){var t=e[0].length;e.forEach(function(i,o){A(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),A(n>=0&&n<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=e[0];e.forEach(function(i,o){for(var a=0;a<t;a++)A(a===n||i[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function bc(e,n){for(var t=e[0].slice(),r=1;r<e.length;r++)t[n]+=e[r][n];return t}function M(e){var n=Object.keys(e);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var t=n[0],r=e[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];O.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),O.endScope(s),s}catch(c){throw O.endScope(null),c}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}De.registerFlag("HAS_WEBGL",function(){return De.getNumber("WEBGL_VERSION")>0}),De.registerFlag("WEBGL_VERSION",function(){return M1(2)?2:M1(1)?1:0}),De.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return De.get("WEBGL_VERSION")===2}),De.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),De.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),De.registerFlag("WEBGL_PACK",function(){return De.getBool("HAS_WEBGL")}),De.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_CLIP",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),De.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_PACK_REDUCE",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_LAZILY_UNPACK",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_CONV_IM2COL",function(){return De.getBool("WEBGL_PACK")}),De.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return OP(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return FP(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var e=De.getNumber("WEBGL_VERSION");return e===0?0:BP(e)}),De.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return De.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e}),De.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return zP(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!De.getBool("WEBGL_FORCE_F16_TEXTURES")&&De.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),De.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return jP(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return $P(De.getNumber("WEBGL_VERSION"))}),De.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return De.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),nC=oC;var fn=M({complex_:function(e,n){var t=D(e,"real","complex"),r=D(n,"imag","complex");return ot(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),O.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),Nr=M({real_:function(e){var n=D(e,"input","real");return O.runKernelFunc(function(t){return t.real(n)},{$input:n})}}),Ri=M({imag_:function(e){var n=D(e,"input","imag");return O.runKernelFunc(function(t){return t.imag(n)},{$input:n})}});function mn(e,n,t){return pa(e,n,da(e,t),t)}function pa(e,n,t,r){if(r==null&&(r=Ju(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ii(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){eC(n);var i=he(n),o=he(t);A(i===o,function(){return"Based on the provided shape, ["+n+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],c=a!==t.length-1||s!==he(n.slice(a));A(t[a]===n[a]||!c,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+n+"). "})}}return Ii(e)||Array.isArray(e)||(e=[e]),n=n||t,e=r!=="string"?J2(e,r,K().getBool("DEBUG")):yc(e,[],!0),O.makeTensor(e,n,r)}function re(e,n){if((Ii(e)&&n!=="string"||Array.isArray(e))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Ii(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return pa(e,[],[],n)}function Vt(e,n){kc(e);var t=da(e,n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return pa(e,null,t,n)}function Jo(e,n,t){if(kc(e),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=da(e,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return pa(e,n,r,t)}function Cy(e,n,t){if(kc(e),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=da(e,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return pa(e,n,r,t)}function Yn(e,n,t){if(kc(e),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=da(e,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return pa(e,n,r,t)}function HP(e,n,t){if(kc(e),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=da(e,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return pa(e,n,r,t)}function GP(e,n,t){if(kc(e),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=da(e,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return pa(e,n=n||r,r,t)}function qP(e,n,t,r){return n===void 0&&(n=!0),O.makeVariable(e,n,t,r)}function Ec(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=Ec(e,"float32"),r=xt(e,"float32");return fn(t,r)}var i=Z2(he(e),n);return O.makeTensor(i,e,n)}function xt(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=xt(e,"float32"),r=xt(e,"float32");return fn(t,r)}var i=Zu(he(e),n);return O.makeTensor(i,e,n)}function Ai(e,n,t){return O.runKernelFunc(function(r){return r.fill(e,n,t)},{})}function KP(e,n,t){if(t<=0)throw new Error("The number of values should be positive.");return O.runKernelFunc(function(r){return r.linspace(e,n,t)},{})}function gp(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(e===n||e<n&&t<0||n<e&&t>1)return xt([0],r);var i=Zu(Math.abs(Math.ceil((n-e)/t)),r);n<e&&t===1&&(t=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Vt(i,r)}var sC=M({onesLike_:function(e){var n=D(e,"x","onesLike");if(n.dtype==="complex64"){var t=sC(Nr(n)),r=Ke(Ri(n));return fn(t,r)}return O.runKernelFunc(function(i){return i.onesLike(n)},{$x:n},function(i,o){return{$x:function(){return Ke(i)}}})}}),Ke=M({zerosLike_:function(e){var n=D(e,"x","zerosLike");return O.runKernelFunc(function(t){return t.zerosLike(n)},{$x:n},function(t,r){return{$x:function(){return Ke(t)}}})}}),Qt=M({concat_:function(e,n){n===void 0&&(n=0),A(e.length>=1,function(){return"Pass at least one tensor to concat"});var t=mp(e,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),n=en(n,t[0].shape)[0];var r=bc(t.map(function(s){return s.shape}),n);if(he(r)===0)return mn([],r);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});VP(i,n);var o=t,a={axis:n};return O.runKernelFunc(function(s){return s.concat(t,n)},o,function(s){var c=i.map(function(u){return u[n]});return Ry(s,c,n).map(function(u){return function(){return u}})},"Concat",a)}}),XP=M({concat1d_:function(e){return Qt(e,0)}}),QP=M({concat2d_:function(e,n){return Qt(e,n)}}),YP=M({concat3d_:function(e,n){return Qt(e,n)}}),JP=M({concat4d_:function(e,n){return Qt(e,n)}}),Ry=M({split_:function(e,n,t){t===void 0&&(t=0);var r,i=D(e,"x","split");return t=en(t,i.shape)[0],typeof n=="number"?(A(i.shape[t]%n==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(n).fill(i.shape[t]/n)):(A(i.shape[t]===n.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=n),O.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return Qt(o,t)}}})}});function Ha(e,n){return e(n={exports:{}},n.exports),n.exports}var ZP=Ha(function(e){(function(n,t,r){function i(s){var c,u=this,l=(c=4022871197,function(d){d=d.toString();for(var p=0;p<d.length;p++){var f=.02519603282416938*(c+=d.charCodeAt(p));f-=c=f>>>0,c=(f*=c)>>>0,c+=4294967296*(f-=c)}return 23283064365386963e-26*(c>>>0)});u.next=function(){var d=2091639*u.s0+23283064365386963e-26*u.c;return u.s0=u.s1,u.s1=u.s2,u.s2=d-(u.c=0|d)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(s),u.s0<0&&(u.s0+=1),u.s1-=l(s),u.s1<0&&(u.s1+=1),u.s2-=l(s),u.s2<0&&(u.s2+=1),l=null}function o(s,c){return c.c=s.c,c.s0=s.s0,c.s1=s.s1,c.s2=s.s2,c}function a(s,c){var u=new i(s),l=c&&c.state,d=u.next;return d.int32=function(){return 4294967296*u.next()|0},d.double=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.quick=d,l&&(typeof l=="object"&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.alea=a})(0,e)}),eA=Ha(function(e){(function(n,t,r){function i(s){var c=this,u="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var d=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^d^d>>>8},s===(0|s)?c.x=s:u+=s;for(var l=0;l<u.length+64;l++)c.x^=0|u.charCodeAt(l),c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c}function a(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.xor128=a})(0,e)}),tA=Ha(function(e){(function(n,t,r){function i(s){var c=this,u="";c.next=function(){var d=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^d^d<<1)|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,s===(0|s)?c.x=s:u+=s;for(var l=0;l<u.length+64;l++)c.x^=0|u.charCodeAt(l),l==u.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function o(s,c){return c.x=s.x,c.y=s.y,c.z=s.z,c.w=s.w,c.v=s.v,c.d=s.d,c}function a(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.xorwow=a})(0,e)}),nA=Ha(function(e){(function(n,t,r){function i(s){var c=this;c.next=function(){var u,l,d=c.x,p=c.i;return u=d[p],l=(u^=u>>>7)^u<<24,l^=(u=d[p+1&7])^u>>>10,l^=(u=d[p+3&7])^u>>>3,l^=(u=d[p+4&7])^u<<7,u=d[p+7&7],l^=(u^=u<<13)^u<<9,d[p]=l,c.i=p+1&7,l},function(u,l){var d,p=[];if(l===(0|l))p[0]=l;else for(l=""+l,d=0;d<l.length;++d)p[7&d]=p[7&d]<<15^l.charCodeAt(d)+p[d+1&7]<<13;for(;p.length<8;)p.push(0);for(d=0;d<8&&p[d]===0;++d);for(d==8?p[7]=-1:p[d],u.x=p,u.i=0,d=256;d>0;--d)u.next()}(c,s)}function o(s,c){return c.x=s.x.slice(),c.i=s.i,c}function a(s,c){s==null&&(s=+new Date);var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,l&&(l.x&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.xorshift7=a})(0,e)}),rA=Ha(function(e){(function(n,t,r){function i(s){var c=this;c.next=function(){var u,l,d=c.w,p=c.X,f=c.i;return c.w=d=d+1640531527|0,l=p[f+34&127],u=p[f=f+1&127],l^=l<<13,u^=u<<17,l^=l>>>15,u^=u>>>12,l=p[f]=l^u,c.i=f,l+(d^d>>>16)|0},function(u,l){var d,p,f,m,g,v=[],h=128;for(l===(0|l)?(p=l,l=null):(l+="\0",p=0,h=Math.max(h,l.length)),f=0,m=-32;m<h;++m)l&&(p^=l.charCodeAt((m+32)%l.length)),m===0&&(g=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(g=g+1640531527|0,f=(d=v[127&m]^=p+g)==0?f+1:0);for(f>=128&&(v[127&(l&&l.length||0)]=-1),f=127,m=512;m>0;--m)p=v[f+34&127],d=v[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,v[f]=p^d;u.w=g,u.X=v,u.i=f}(c,s)}function o(s,c){return c.i=s.i,c.w=s.w,c.X=s.X.slice(),c}function a(s,c){s==null&&(s=+new Date);var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,l&&(l.X&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.xor4096=a})(0,e)}),iA=Ha(function(e){(function(n,t,r){function i(s){var c=this,u="";c.next=function(){var d=c.b,p=c.c,f=c.d,m=c.a;return d=d<<25^d>>>7^p,p=p-f|0,f=f<<24^f>>>8^m,m=m-d|0,c.b=d=d<<20^d>>>12^p,c.c=p=p-f|0,c.d=f<<16^p>>>16^m,c.a=m-d|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,s===Math.floor(s)?(c.a=s/4294967296|0,c.b=0|s):u+=s;for(var l=0;l<u.length+20;l++)c.b^=0|u.charCodeAt(l),c.next()}function o(s,c){return c.a=s.a,c.b=s.b,c.c=s.c,c.d=s.d,c}function a(s,c){var u=new i(s),l=c&&c.state,d=function(){return(u.next()>>>0)/4294967296};return d.double=function(){do var p=((u.next()>>>11)+(u.next()>>>0)/4294967296)/2097152;while(p===0);return p},d.int32=u.next,d.quick=d,l&&(typeof l=="object"&&o(l,u),d.state=function(){return o(u,{})}),d}t&&t.exports?t.exports=a:this.tychei=a})(0,e)}),_a=Ha(function(e){(function(n,t){var r,i=this,o=256,a=6,s="random",c=t.pow(o,a),u=t.pow(2,52),l=2*u,d=o-1;function p(h,w,y){var b=[],x=g(function R(S,E){var T,I=[],F=typeof S;if(E&&F=="object")for(T in S)try{I.push(R(S[T],E-1))}catch{}return I.length?I:F=="string"?S:S+"\0"}((w=w==1?{entropy:!0}:w||{}).entropy?[h,v(n)]:h??function(){try{var R;return r&&(R=r.randomBytes)?R=R(o):(R=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(R)),v(R)}catch{var S=i.navigator,E=S&&S.plugins;return[+new Date,i,E,i.screen,v(n)]}}(),3),b),_=new f(b),C=function(){for(var R=_.g(a),S=c,E=0;R<u;)R=(R+E)*o,S*=o,E=_.g(1);for(;R>=l;)R/=2,S/=2,E>>>=1;return(R+E)/S};return C.int32=function(){return 0|_.g(4)},C.quick=function(){return _.g(4)/4294967296},C.double=C,g(v(_.S),n),(w.pass||y||function(R,S,E,T){return T&&(T.S&&m(T,_),R.state=function(){return m(_,{})}),E?(t[s]=R,S):R})(C,x,"global"in w?w.global:this==t,w.state)}function f(h){var w,y=h.length,b=this,x=0,_=b.i=b.j=0,C=b.S=[];for(y||(h=[y++]);x<o;)C[x]=x++;for(x=0;x<o;x++)C[x]=C[_=d&_+h[x%y]+(w=C[x])],C[_]=w;(b.g=function(R){for(var S,E=0,T=b.i,I=b.j,F=b.S;R--;)S=F[T=d&T+1],E=E*o+F[d&(F[T]=F[I=d&I+S])+(F[I]=S)];return b.i=T,b.j=I,E})(o)}function m(h,w){return w.i=h.i,w.j=h.j,w.S=h.S.slice(),w}function g(h,w){for(var y,b=h+"",x=0;x<b.length;)w[d&x]=d&(y^=19*w[d&x])+b.charCodeAt(x++);return v(w)}function v(h){return String.fromCharCode.apply(0,h)}if(t["seed"+s]=p,g(t.random(),n),e.exports){e.exports=p;try{r=require("crypto")}catch{}}})([],Math)});_a.alea=ZP,_a.xor128=eA,_a.xorwow=tA,_a.xorshift7=nA,_a.xor4096=rA,_a.tychei=iA;var Yp=_a.alea,ky=function(){function e(n,t,r,i,o){this.mean=n,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=Yp(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var c=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*c,r=this.mean+this.stdDev*a*c,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},e.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},e.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},e}(),oA=function(){function e(n,t,r,i){this.alpha=n,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=Yp(o.toString()),this.randn=new ky(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var n,t,r,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(n=i*i)*n,r=.5*n+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},e}(),aA=function(){function e(n,t,r,i){var o=this;if(n===void 0&&(n=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=n,this.range=t-n,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=Yp(i)}return e.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Me(e,n,t){return n===void 0&&(n="float32"),n=n||"float32",eC(e),new $u(e,n,t)}function sA(e,n){n===void 0&&(n=!1),console.log(e.toString(n))}var cC=M({batchToSpaceND_:function(e,n,t){var r=D(e,"x","batchToSpaceND"),i=n.reduce(function(o,a){return o*a});return A(r.rank>=1+n.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length}),A(t.length===n.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length}),A(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+i}),O.runKernelFunc(function(o){return o.batchToSpaceND(r,n,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(n,t)}}})}}),cA=M({broadcastTo_:function(e,n){var t=D(e,"broadcastTo","x"),r=t.shape;if(n.some(function(c){return!(c>0)||c%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<t.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+t.rank+".");if(n.length>t.rank){for(var i=t.shape.slice();i.length<n.length;)i.unshift(1);t=t.reshape(i)}for(var o=Array.from(n),a=n.length-1;a>=0;a--)if(t.shape[a]===n[a])o[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=o.map(function(c,u){return c>1?u:-1}).filter(function(c){return c>=0});return s.length===0?t.clone():O.runKernelFunc(function(c){return c.tile(t,o)},{input:t},function(c){return{input:function(){return c.sum(s,!0)}}})}}),uA=M({cast_:function(e,n){var t=D(e,"x","cast");if(!tP(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&t.dtype!=="string"||n!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:n};return O.runKernelFunc(function(i){return i.cast(t,n)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),lA=M({clone_:function(e){var n=D(e,"x","clone",null);return O.runKernelFunc(function(){return O.makeTensorFromDataId(n.dataId,n.shape,n.dtype)},{$x:n},function(t){return{$x:function(){return t.toFloat()}}})}}),dA=M({cumsum_:function(e,n,t,r){n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=D(e,"x","cumsum"),o=zi([n|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ji(1,i.rank)[0],c=O.runKernelFunc(function(u){return u.cumsum(a,s,t,r)},{permutedX:a},function(u){return{permutedX:function(){return u.cumsum(n,t,!r)}}});return o!=null&&(c=c.transpose(o)),c}}),pA=M({depthToSpace_:function(e,n,t){t===void 0&&(t="NHWC");var r=D(e,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return A(i*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+n+`  for depthToSpace with input shape
      `+r.shape}),A(o*n>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+n+` for depthToSpace with input shape
          `+r.shape}),A(a%(n*n)==0,function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape}),O.runKernelFunc(function(s){return s.depthToSpace(r,n,t)},{$x:r})}}),Ir=M({expandDims_:function(e,n){n===void 0&&(n=0);var t=D(e,"x","expandDims",null);A(n<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return n<0&&(A(-(t.rank+1)<=n,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),n=t.rank+n+1),r.splice(n,0,1),Qr(t,r)}}),uC=M({eye_:function(e,n,t,r){r===void 0&&(r="float32"),n==null&&(n=e);for(var i=Me([e,n],r),o=e<=n?e:n,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(e,n);if(t==null)return s;if(t.length===1)return ec(Ir(s,0),[t[0],1,1]);if(t.length===2)return ec(Ir(Ir(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return ec(Ir(Ir(Ir(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),fA=M({multinomial_:function(e,n,t,r){r===void 0&&(r=!1);var i=D(e,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,c=O.runKernelFunc(function(u){return u.multinomial(s,r,n,t)},{logits2D:s});return a===1?c.as1D():c}}),qg=M({oneHot_:function(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var i=D(e,"indices","oneHot","int32"),o=i.shape.concat([n]);return i=i.flatten(),O.runKernelFunc(function(a){return a.oneHot(i,n,t,r)},{$indices:i},function(a){return{$indices:function(){return xt(i.shape,"float32")}}}).reshape(o)}}),Ga=M({pad_:function(e,n,t){t===void 0&&(t=0);var r=D(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:n,constantValue:t};return O.runKernelFunc(function(o){return o.pad(r,n,t)},{x:r},function(o){var a=n.map(function(s){return s[0]});return{x:function(){return o.slice(a,r.shape)}}},"PadV2",i)}}),hA=M({pad1d_:function(e,n,t){return t===void 0&&(t=0),A(n.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Ga(e,[n],t)}}),mA=M({pad2d_:function(e,n,t){return t===void 0&&(t=0),A(n.length===2&&n[0].length===2&&n[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ga(e,n,t)}}),gA=M({pad3d_:function(e,n,t){return t===void 0&&(t=0),A(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ga(e,n,t)}}),vA=M({pad4d_:function(e,n,t){return t===void 0&&(t=0),A(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ga(e,n,t)}}),yA=M({rand_:function(e,n,t){var r=he(e),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=n();return O.makeTensor(i,e,t)}}),wA=M({randomNormal_:function(e,n,t,r,i){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new ky(n,t,r,!1,i),a=Me(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),bA=M({randomGamma_:function(e,n,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new oA(n,t,r,i),a=Me(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),lC=M({randomUniform_:function(e,n,t,r,i){n===void 0&&(n=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=Me(e,r),a=new aA(n,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Qr=M({reshape_:function(e,n){var t=D(e,"x","reshape",null);n=ZI(n,t.size),A(t.size===he(n),function(){return"new shape and old shape must have the same number of elements."});var r={shape:n};return O.runKernelFunc(function(i){return i.reshape(t,n)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",r)}}),dC=M({spaceToBatchND_:function(e,n,t){var r=D(e,"x","spaceToBatchND");return A(r.rank>=1+n.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length}),A(t.length===n.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length}),A(r.shape.reduce(function(i,o,a){return a>0&&a<=n.length?i&&(o+t[a-1][0]+t[a-1][1])%n[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()}),O.runKernelFunc(function(i){return i.spaceToBatchND(r,n,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(n,t)}}})}}),pC=M({squeeze_:function(e,n){var t=D(e,"x","squeeze");return Qr(t,Sa(t.shape,n).newShape)}}),xr=M({stack_:function(e,n){n===void 0&&(n=0);var t=mp(e,"tensors","stack");if(A(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(n);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;A(n<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){ot(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){A(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(n)});return Qt(a,n)}}),ec=M({tile_:function(e,n){var t=D(e,"x","tile",null);A(t.rank===n.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+n+"."});var r=[t],i={reps:n};return O.runKernelFunc(function(o,a){var s=o.tile(t,n);return a([t]),s},{x:t},function(o,a){var s=a[0];return{x:function(){var c=Ke(s);if(s.rank===1)for(var u=0;u<n[0];++u)c=c.add(o.slice([u*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(u=0;u<n[0];++u)for(var l=0;l<n[1];++l)c=c.add(o.slice([u*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(u=0;u<n[0];++u)for(l=0;l<n[1];++l)for(var d=0;d<n[2];++d)c=c.add(o.slice([u*s.shape[0],l*s.shape[1],d*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(u=0;u<n[0];++u)for(l=0;l<n[1];++l)for(d=0;d<n[2];++d)for(var p=0;p<n[3];++p)c=c.add(o.slice([u*s.shape[0],l*s.shape[1],d*s.shape[2],p*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return c}}},"Tile",i,r)}}),xA=M({truncatedNormal_:function(e,n,t,r,i){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new ky(n,t,r,!0,i),a=Me(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Yt=M({unstack_:function(e,n){n===void 0&&(n=0),n=n||0;var t=D(e,"x","unstack");A(n>=-t.shape.length&&n<t.shape.length,function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),n<0&&(n+=t.shape.length);var r={axis:n};return O.runKernelFunc(function(i){return i.unstack(t,n)},{x:t},function(i){return{x:function(){return xr(i,n)}}},"Unpack",r)}}),_A=function(e,n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s,c,u,l,d;return le(this,function(p){switch(p.label){case 0:return t=D(e,"x","setdiff1d"),r=D(n,"y","setdiff1d"),A(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),A(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),A(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=p.sent(),[4,r.data()];case 2:for(o=p.sent(),a=new Set(o),s=0,l=0;l<i.length;l++)a.has(i[l])||s++;for(c=new $u([s],t.dtype),u=new $u([s],"int32"),l=0,d=0;l<i.length;l++)a.has(i[l])||(c.values[d]=i[l],u.values[d]=l,d++);return[2,[c.toTensor(),u.toTensor()]]}})})};function vp(e,n,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(n.slice(0))).push(e[0]/t),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var o=n.length,a=0;a<o;++a)i=i.concat([e[a+1]/n[a],n[a]]);i=i.concat(e.slice(o+1))}return i}function yp(e,n,t){t===void 0&&(t=!0);var r=[];if(t){r.push(n);for(var i=n+1;i<e;++i)i<=2*n?(r.push(i),r.push(i-(n+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<e;++i)i>=2*n+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function wp(e,n,t,r){r===void 0&&(r=!0);var i=[];r?i.push(e[0]/t):i.push(e[0]*t);for(var o=1;o<e.length;++o)o<=n.length?r?i.push(n[o-1]*e[o]):i.push(e[o]/n[o-1]):i.push(e[o]);return i}function fC(e,n){for(var t=[0],r=0;r<n;++r)t.push(e[r][0]);return t}function hC(e,n,t){for(var r=e.slice(0,1),i=0;i<t;++i)r.push(e[i+1]-n[i][0]-n[i][1]);return r}function mC(e,n){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var t=n.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=e.shape,s=t.slice();s.pop();var c=1;for(o=r;o<e.rank;++o)c*=a[o],s.push(a[o]);var u=Pi(e.shape).map(function(l){return l/c}).concat([1]).slice(0,r);return[s,i,c,u]}var gC=30;function Kh(e){return e<=gC?e:$g(e,Math.floor(Math.sqrt(e)))}function SA(e,n,t){var r=n.rank>1?n.shape[n.rank-1]:1,i=n.rank>1?n.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+n.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(e.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+e.length-r)throw new Error(o+" update.rank != "+(i+e.length-r));for(var a=0;a<i;++a)if(t.shape[a]!==n.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==e[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+e[a+i]+")")}function CA(e,n,t){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}SA(t,n,e)}function bp(e,n,t){for(var r=n.shape.length,i=r>1?n.shape[r-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var c=i<1?1:i;return{sliceRank:i,numUpdates:he(n.shape)/c,sliceSize:a,strides:Pi(t.slice(0,i)).concat([1]),outputSize:he(t)}}function RA(e,n,t){A(e.rank===n.length,function(){return"Error in slice"+e.rank+"D: Length of begin "+n+" must match the rank of the array ("+e.rank+")."}),A(e.rank===t.length,function(){return"Error in slice"+e.rank+"D: Length of size "+t+" must match the rank of the array ("+e.rank+")."});for(var r=function(o){A(n[o]+t[o]<=e.shape[o],function(){return"Error in slice"+e.rank+"D: begin["+o+"] + size["+o+"] ("+(n[o]+t[o])+") would overflow input.shape["+o+"] ("+e.shape[o]+")"})},i=0;i<e.rank;++i)r(i)}function O1(e){for(var n=[],t=0;e>0;)1&e&&n.push(t),e/=2,t++;return n}function Ey(e,n,t){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((n[i]-e[i])/t[i]);return r}function kA(e,n,t,r,i){var o=n[i],a=t[i]||1;(e&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=Bg(0,o,s-1)}function EA(e,n,t,r,i){var o=n[i],a=t[i]||1;(e&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?Bg(0,o,s):Bg(-1,o,s-1)}function vC(e,n,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(n[i]>0||t[i]!==e[i])return!1;return!0}function yC(e,n){for(var t=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)t+=e[r]*n[r];return t}function TA(e,n){A(jg(e),function(){return"The f passed in variableGrads(f) must be a function"}),A(n==null||Array.isArray(n)&&n.every(function(l){return l instanceof wc}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=n!=null;if(!t)for(var r in n=[],O.registeredVariables)n.push(O.registeredVariables[r]);var i=t?n.filter(function(l){return!l.trainable}):null,o=n.length;A((n=n.filter(function(l){return l.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=O.gradients(e,n,null,!0),s=a.value,c=a.grads;A(c.some(function(l){return l!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),A(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var u={};return n.forEach(function(l,d){c[d]!=null&&(u[l.name]=c[d])}),i!=null&&i.forEach(function(l){return u[l.name]=null}),{value:s,grads:u}}function Jp(e){return O.customGrad(e)}var go=M({softmax_:function(e,n){n===void 0&&(n=-1);var t=D(e,"logits","softmax","float32");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+n);return O.runKernelFunc(function(r,i){var o=r.softmax(t,n);return i([o]),o},{logits:t},function(r,i){var o=i[0],a=r.mul(o);return{logits:function(){return a.sub(a.sum([n],!0).mul(o))}}},"Softmax",{dim:n},[],[!0])}}),DA=M({logSoftmax_:function(e,n){n===void 0&&(n=-1);var t=D(e,"logits","logSoftmax");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+n);return Jp(function(r,i){var o=r.max(n,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(n,!0).log());return i([s]),{value:s,gradFunc:function(c,u){var l=u[0].exp();return c.sub(c.sum(n,!0).mul(l))}}})(t)}}),wC=function(){function e(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},e.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},e.prototype.has=function(n){return this.data.has(n)},e.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),bC=function(){function e(){}return e.prototype.time=function(n){return V("time")},e.prototype.read=function(n){return V("read")},e.prototype.readSync=function(n){return V("readSync")},e.prototype.numDataIds=function(){return V("numDataIds")},e.prototype.disposeData=function(n){return V("disposeData")},e.prototype.write=function(n,t,r){return V("write")},e.prototype.move=function(n,t,r,i){return V("move")},e.prototype.memory=function(){return V("memory")},e.prototype.floatPrecision=function(){return V("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(n,t,r,i){return V("batchMatMul")},e.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,V("fusedBatchMatMul")},e.prototype.slice=function(n,t,r){return V("slice")},e.prototype.stridedSlice=function(n,t,r,i){return V("stridedSlice")},e.prototype.unstack=function(n,t){return V("unstack")},e.prototype.reverse=function(n,t){return V("reverse")},e.prototype.concat=function(n,t){return V("concat")},e.prototype.neg=function(n){return V("neg")},e.prototype.add=function(n,t){return V("add")},e.prototype.addN=function(n){return V("addN")},e.prototype.subtract=function(n,t){return V("subtract")},e.prototype.multiply=function(n,t){return V("multiply")},e.prototype.realDivide=function(n,t){return V("realDivide")},e.prototype.floorDiv=function(n,t){return V("floorDiv")},e.prototype.sum=function(n,t){return V("sum")},e.prototype.prod=function(n,t){return V("prod")},e.prototype.unsortedSegmentSum=function(n,t,r){return V("unsortedSegmentSum")},e.prototype.argMin=function(n,t){return V("argMin")},e.prototype.argMax=function(n,t){return V("argMax")},e.prototype.equal=function(n,t){return V("equal")},e.prototype.notEqual=function(n,t){return V("notEqual")},e.prototype.less=function(n,t){return V("less")},e.prototype.lessEqual=function(n,t){return V("lessEqual")},e.prototype.greater=function(n,t){return V("greater")},e.prototype.greaterEqual=function(n,t){return V("greaterEqual")},e.prototype.logicalNot=function(n){return V("logicalNot")},e.prototype.logicalAnd=function(n,t){return V("logicalAnd")},e.prototype.logicalOr=function(n,t){return V("logicalOr")},e.prototype.where=function(n){return V("where")},e.prototype.select=function(n,t,r){return V("select")},e.prototype.topk=function(n,t,r){return V("topk")},e.prototype.min=function(n,t){return V("min")},e.prototype.minimum=function(n,t){return V("minimum")},e.prototype.mod=function(n,t){return V("mod")},e.prototype.max=function(n,t){return V("max")},e.prototype.maximum=function(n,t){return V("maximum")},e.prototype.all=function(n,t){return V("all")},e.prototype.any=function(n,t){return V("any")},e.prototype.squaredDifference=function(n,t){return V("squaredDifference")},e.prototype.ceil=function(n){return V("ceil")},e.prototype.floor=function(n){return V("floor")},e.prototype.round=function(n){return V("round")},e.prototype.sign=function(n){return V("sign")},e.prototype.isNaN=function(n){return V("isNaN")},e.prototype.isInf=function(n){return V("isInf")},e.prototype.isFinite=function(n){return V("isFinite")},e.prototype.pow=function(n,t){return V("pow")},e.prototype.exp=function(n){return V("exp")},e.prototype.expm1=function(n){return V("expm1")},e.prototype.softmax=function(n,t){return V("softmax")},e.prototype.log=function(n){return V("log")},e.prototype.log1p=function(n){return V("log1p")},e.prototype.sqrt=function(n){return V("sqrt")},e.prototype.rsqrt=function(n){return V("rsqrt")},e.prototype.square=function(n){return V("square")},e.prototype.reciprocal=function(n){return V("reciprocal")},e.prototype.relu=function(n){return V("relu")},e.prototype.relu6=function(n){return V("relu6")},e.prototype.prelu=function(n,t){return V("prelu")},e.prototype.elu=function(n){return V("elu")},e.prototype.eluDer=function(n,t){return V("eluDer")},e.prototype.selu=function(n){return V("selu")},e.prototype.int=function(n){return V("int")},e.prototype.clip=function(n,t,r){return V("clip")},e.prototype.abs=function(n){return V("abs")},e.prototype.complexAbs=function(n){return V("complexAbs")},e.prototype.sigmoid=function(n){return V("sigmoid")},e.prototype.softplus=function(n){return V("softplus")},e.prototype.sin=function(n){return V("sin")},e.prototype.cos=function(n){return V("cos")},e.prototype.tan=function(n){return V("tan")},e.prototype.asin=function(n){return V("asin")},e.prototype.acos=function(n){return V("acos")},e.prototype.atan=function(n){return V("atan")},e.prototype.atan2=function(n,t){return V("atan2")},e.prototype.sinh=function(n){return V("sinh")},e.prototype.cosh=function(n){return V("cosh")},e.prototype.tanh=function(n){return V("tanh")},e.prototype.asinh=function(n){return V("asinh")},e.prototype.acosh=function(n){return V("acosh")},e.prototype.atanh=function(n){return V("atanh")},e.prototype.erf=function(n){return V("erf")},e.prototype.step=function(n,t){return V("step")},e.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,V("fusedConv2d")},e.prototype.conv2d=function(n,t,r){return V("conv2d")},e.prototype.conv2dDerInput=function(n,t,r){return V("conv2dDerInput")},e.prototype.conv2dDerFilter=function(n,t,r){return V("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,V("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(n,t,r){return V("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(n,t,r){return V("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(n,t,r){return V("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(n,t,r){return V("conv3d")},e.prototype.conv3dDerInput=function(n,t,r){return V("conv3dDerInput")},e.prototype.conv3dDerFilter=function(n,t,r){return V("conv3dDerFilter")},e.prototype.maxPool=function(n,t){return V("maxPool")},e.prototype.maxPoolBackprop=function(n,t,r,i){return V("maxPoolBackprop")},e.prototype.avgPool=function(n,t){return V("avgPool")},e.prototype.avgPoolBackprop=function(n,t,r){return V("avgPoolBackprop")},e.prototype.avgPool3d=function(n,t){return V("avgPool3d")},e.prototype.avgPool3dBackprop=function(n,t,r){return V("avgPool3dBackprop")},e.prototype.maxPool3d=function(n,t){return V("maxPool3d")},e.prototype.maxPool3dBackprop=function(n,t,r,i){return V("maxPool3dBackprop")},e.prototype.reshape=function(n,t){return V("reshape")},e.prototype.cast=function(n,t){return V("cast")},e.prototype.tile=function(n,t){return V("tile")},e.prototype.pad=function(n,t,r){return V("pad")},e.prototype.transpose=function(n,t){return V("transpose")},e.prototype.gather=function(n,t,r){return V("gather")},e.prototype.gatherND=function(n,t){return V("gatherND")},e.prototype.scatterND=function(n,t,r){return V("scatterND")},e.prototype.batchToSpaceND=function(n,t,r){return V("batchToSpaceND")},e.prototype.spaceToBatchND=function(n,t,r){return V("spaceToBatchND")},e.prototype.resizeBilinear=function(n,t,r,i){return V("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(n,t,r){return V("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(n,t,r,i){return V("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(n,t,r){return V("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(n,t,r,i,o,a){return V("batchNormalization")},e.prototype.localResponseNormalization4D=function(n,t,r,i,o){return V("localResponseNormalization4D")},e.prototype.LRNGrad=function(n,t,r,i,o,a,s){return V("LRNGrad")},e.prototype.multinomial=function(n,t,r,i){return V("multinomial")},e.prototype.oneHot=function(n,t,r,i){return V("oneHot")},e.prototype.cumsum=function(n,t,r,i){return V("cumsum")},e.prototype.nonMaxSuppression=function(n,t,r,i,o){return V("nonMaxSuppression")},e.prototype.fft=function(n){return V("fft")},e.prototype.ifft=function(n){return V("ifft")},e.prototype.complex=function(n,t){return V("complex")},e.prototype.real=function(n){return V("real")},e.prototype.imag=function(n){return V("imag")},e.prototype.cropAndResize=function(n,t,r,i,o,a){return V("cropAndResize")},e.prototype.depthToSpace=function(n,t,r){return V("depthToSpace")},e.prototype.split=function(n,t,r){return V("split")},e.prototype.sparseToDense=function(n,t,r,i){return V("sparseToDense")},e.prototype.diag=function(n){return V("diag")},e.prototype.fill=function(n,t,r){return V("fill")},e.prototype.onesLike=function(n){return V("onesLike")},e.prototype.zerosLike=function(n){return V("zerosLike")},e.prototype.linspace=function(n,t,r){return V("linspace")},e.prototype.dispose=function(){return V("dispose")},e}();function V(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function $o(e,n){for(var t=e.length,r=[],i=0;i<t;i++){var o=t-1-i,a=e[o]||1;(n[n.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function Jt(e,n){for(var t=[],r=0;r<n.length;r++){var i=e[e.length-r-1],o=n.length-r-1,a=n[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function je(e,n){for(var t=[],r=Math.max(e.length,n.length),i=0;i<r;i++){var o=e[e.length-i-1];o==null&&(o=1);var a=n[n.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+n+".");t.unshift(o)}}return t}function Wu(e,n,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,c=Sp(n),u=c[0],l=c[1];if(a==="channelsLast")s=[u,l,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[u,l,e[1],e[1]]}return qa(e,s,t,r,i,o,!1,a)}function xp(e,n,t,r,i,o,a){a===void 0&&(a="NDHWC");var s,c,u=Kg(n),l=u[0],d=u[1],p=u[2];if(a==="NDHWC")c="channelsLast",s=[l,d,p,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);c="channelsFirst",s=[l,d,p,e[1],e[1]]}return _p(e,s,t,r,i,!1,c,o)}function qa(e,n,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var c=[-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],p=c[3];if(s==="channelsLast")u=e[0],l=e[1],d=e[2],p=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=e[0],p=e[1],l=e[2],d=e[3]}var f,m=n[0],g=n[1],v=n[3],h=Sp(t),w=h[0],y=h[1],b=Sp(r),x=b[0],_=b[1],C=tc(m,x),R=tc(g,_),S=function(z,j,H,W,L,$,k,U){var X,P,ne;if(typeof z=="number"){X={top:z,bottom:z,left:z,right:z,type:z===0?"VALID":"NUMBER"};var se=function(Pe,He,Ue,at,Ze){at==null&&(at=xC(Pe,He,Ue));var st=Pe[0],bn=Pe[1],Lt=yu((st-He+2*at)/Ue+1,Ze);A(zt(Lt),function(){return"The output # of rows ("+Lt+") must be an integer. Change the stride and/or zero pad parameters"});var tn=yu((bn-He+2*at)/Ue+1,Ze);return A(zt(tn),function(){return"The output # of columns ("+tn+") must be an integer. Change the stride and/or zero pad parameters"}),[Lt,tn]}([j,H],$,W,z,U);P=se[0],ne=se[1]}else if(z==="same"){P=Math.ceil(j/W),ne=Math.ceil(H/L);var te=Math.max(0,(P-1)*W+$-j),ce=Math.max(0,(ne-1)*L+k-H),ye=Math.floor(te/2),Re=te-ye,Je=Math.floor(ce/2);X={top:ye,bottom:Re,left:Je,right:ce-Je,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);X={top:0,bottom:0,left:0,right:0,type:"VALID"},P=Math.ceil((j-$+1)/W),ne=Math.ceil((H-k+1)/L)}return{padInfo:X,outHeight:P,outWidth:ne}}(i,l,d,w,y,C,R,o),E=S.padInfo,T=S.outHeight,I=S.outWidth,F=a?v*p:v;return s==="channelsFirst"?f=[u,F,T,I]:s==="channelsLast"&&(f=[u,T,I,F]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:d,inChannels:p,outHeight:T,outWidth:I,outChannels:F,padInfo:E,strideHeight:w,strideWidth:y,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:x,dilationWidth:_,inShape:e,outShape:f,filterShape:n}}function _p(e,n,t,r,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var c=[-1,-1,-1,-1,-1],u=c[0],l=c[1],d=c[2],p=c[3],f=c[4];if(a==="channelsLast")u=e[0],l=e[1],d=e[2],p=e[3],f=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=e[0],f=e[1],l=e[2],d=e[3],p=e[4]}var m,g=n[0],v=n[1],h=n[2],w=n[4],y=Kg(t),b=y[0],x=y[1],_=y[2],C=Kg(r),R=C[0],S=C[1],E=C[2],T=tc(g,R),I=tc(v,S),F=tc(h,E),z=function(k,U,X,P,ne,se,te,ce,ye,Re,Je){var Pe,He,Ue,at;if(typeof k=="number"){Pe={top:k,bottom:k,left:k,right:k,front:k,back:k,type:k===0?"VALID":"NUMBER"};var Ze=function(kr,Un,_o,q,Y,we){Y==null&&(Y=xC(kr,Un,q));var We=kr[0],Xe=kr[1],ln=kr[2],Wn=yu((We-Un+2*Y)/q+1,we);A(zt(Wn),function(){return"The output # of depths ("+Wn+") must be an integer. Change the stride and/or zero pad parameters"});var xn=yu((Xe-Un+2*Y)/q+1,we);A(zt(xn),function(){return"The output # of rows ("+xn+") must be an integer. Change the stride and/or zero pad parameters"});var nn=yu((ln-Un+2*Y)/q+1,we);return A(zt(nn),function(){return"The output # of columns ("+nn+") must be an integer. Change the stride and/or zero pad parameters"}),[Wn,xn,nn,_o]}([U,X,P,1],ce,1,ne,k,Je);He=Ze[0],Ue=Ze[1],at=Ze[2]}else if(k==="same"){He=Math.ceil(U/ne),Ue=Math.ceil(X/se),at=Math.ceil(P/te);var st=(He-1)*ne+ce-U,bn=(Ue-1)*se+ye-X,Lt=(at-1)*te+Re-P,tn=Math.floor(st/2),Rr=st-tn,zn=Math.floor(bn/2),jn=bn-zn,$n=Math.floor(Lt/2);Pe={top:zn,bottom:jn,left:$n,right:Lt-$n,front:tn,back:Rr,type:"SAME"}}else{if(k!=="valid")throw Error("Unknown padding parameter: "+k);Pe={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},He=Math.ceil((U-ce+1)/ne),Ue=Math.ceil((X-ye+1)/se),at=Math.ceil((P-Re+1)/te)}return{padInfo:Pe,outDepth:He,outHeight:Ue,outWidth:at}}(i,l,d,p,b,x,_,T,I,F,s),j=z.padInfo,H=z.outDepth,W=z.outHeight,L=z.outWidth,$=o?w*f:w;return a==="channelsFirst"?m=[u,$,H,W,L]:a==="channelsLast"&&(m=[u,H,W,L,$]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:d,inWidth:p,inChannels:f,outDepth:H,outHeight:W,outWidth:L,outChannels:$,padInfo:j,strideDepth:b,strideHeight:x,strideWidth:_,filterDepth:g,filterHeight:v,filterWidth:h,effectiveFilterDepth:T,effectiveFilterHeight:I,effectiveFilterWidth:F,dilationDepth:R,dilationHeight:S,dilationWidth:E,inShape:e,outShape:m,filterShape:n}}function xC(e,n,t,r){r===void 0&&(r=1);var i=tc(n,r);return Math.floor((e[0]*(t-1)-t+i)/2)}function Sp(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function Kg(e){return typeof e=="number"?[e,e,e]:e}function tc(e,n){return n<=1?e:e+(e-1)*(n-1)}function yu(e,n){if(!n)return e;switch(n){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+n)}}function xc(e){var n=Sp(e),t=n[0],r=n[1],i=n[2];return t===1&&r===1&&i===1}function sr(e,n){return xc(e)||xc(n)}function Ty(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function _C(e,n,t){if(n==="complex64"){if(e.dtype==="complex64")return e.clone();var r=xt(e.shape),i=e.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!nP(e.dtype,n))return O.makeTensorFromDataId(e.dataId,e.shape,n);if(e.dtype==="complex64"){var a=t.real(e);return o=a.cast(n),a.dispose(),o}if(n==="int32")return t.int(e);if(n==="bool"){var s=re(0,e.dtype);return o=t.notEqual(e,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+n)}function Xg(e,n){return O.makeTensorFromDataId(e.dataId,n,e.dtype)}function SC(e,n,t){var r=(n-e)/(t-1),i=Zu(t,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Vt(i,"float32")}function Qg(e,n){if(e.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+n.length+".");for(var t=new Float32Array(2*e.length),r=0;r<t.length;r+=2)t[r]=e[r/2],t[r+1]=n[r/2];return t}function F1(e,n){return{real:e[2*n],imag:e[2*n+1]}}function IA(e,n,t,r){e[2*r]=n,e[2*r+1]=t}function PA(e,n,t){var r=(t?2:-2)*Math.PI*(e/n);return{real:Math.cos(r),imag:Math.sin(r)}}function AA(e,n,t){var r=function(o,a,s){return function(c,u,l){for(var d=0,p=c.length,f=0,m=!1;d<p;){var g=l(u,c[f=d+(p-d>>>1)]);g>0?d=f+1:(p=f,m=!g)}return m?d:-d-1}(o,a,s||NA)}(e,n,t),i=r<0?-(r+1):r;e.splice(i,0,n)}function NA(e,n){return e>n?1:e<n?-1:0}function Dy(e,n,t,r,i){return CC(e,n,t,r,i,0).selectedIndices}function Iy(e,n,t,r,i,o){var a=CC(e,n,t,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function CC(e,n,t,r,i,o,a,s){s===void 0&&(s=!1);for(var c=Array.from(n).map(function(b,x){return{score:b,boxIndex:x,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(B1),u=o>0?-.5/o:0,l=[],d=[];l.length<t&&c.length>0;){var p=c.pop(),f=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(f<i)break;for(var v=!1,h=l.length-1;h>=g;--h){var w=MA(e,m,l[h]);if(w>=r){v=!0;break}if(p.score=p.score*LA(r,u,w),p.score<=i)break}p.suppressBeginIndex=l.length,v||(p.score===f?(l.push(m),d.push(p.score)):p.score>i&&AA(c,p,B1))}var y=l.length;return s&&(l.fill(0,y),d.fill(0,y)),{selectedIndices:Vt(l,"int32"),selectedScores:Vt(d,"float32"),numValidOutputs:re(y,"int32")}}function MA(e,n,t){var r=e.subarray(4*n,4*n+4),i=e.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),u=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),d=Math.max(i[0],i[2]),p=Math.max(i[1],i[3]),f=(s-o)*(c-a),m=(d-u)*(p-l);if(f<=0||m<=0)return 0;var g=Math.max(o,u),v=Math.max(a,l),h=Math.min(s,d),w=Math.min(c,p),y=Math.max(h-g,0)*Math.max(w-v,0);return y/(f+m-y)}function LA(e,n,t){var r=Math.exp(n*t*t);return t<=e?r:0}function B1(e,n){return e.score-n.score||e.score===n.score&&n.boxIndex-e.boxIndex}function RC(e,n,t){var r=new Array(e.rank).fill(0),i=e.shape.slice();return n.map(function(o){i[t]=o;var a=e.slice(r,i);return r[t]+=o,a})}function kC(e,n){for(var t=new Array(e.rank),r=0;r<t.length;r++)t[r]=e.shape[r]*n[r];var i=Me(t,e.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=o[s]%e.shape[s];var c=e.locToIndex(a);i.values[r]=e.values[c]}return i.toTensor()}function EC(e,n,t,r,i){for(var o=n[n.length-1],a=[e.length/o,o],s=a[0],c=a[1],u=ju(t,s*r),l=ju("int32",s*r),d=0;d<s;d++){for(var p=d*c,f=e.subarray(p,p+c),m=[],g=0;g<f.length;g++)m.push({value:f[g],index:g});m.sort(function(b,x){return x.value-b.value});var v=d*r,h=u.subarray(v,v+r),w=l.subarray(v,v+r);for(g=0;g<r;g++)h[g]=m[g].value,w[g]=m[g].index}var y=n.slice();return y[y.length-1]=r,[mn(u,y,t),mn(l,y,"int32")]}function Py(e,n){for(var t=[],r=0;r<n.length;r++)n[r]&&t.push(r);var i=Me(e,"int32"),o=Me([t.length,e.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*e.length;o.values.set(a,s)}return o.toTensor()}var OA=function(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},FA=function(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},BA=function(e,n,t){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,o=e.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=n==="max"?">":"<",c=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+c+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function TC(e,n){return["x","y","z","w","u","v"].slice(0,n).map(function(t){return e+"."+t})}function Jn(e,n){return n===1?[e]:TC(e,n)}function An(){var e,n,t,r,i,o,a,s,c,u;return K().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",n="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,c="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",n="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:n,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:c,defineRound:u}}function Ta(e,n,t){t===void 0&&(t="index");var r=Pi(n);return r.map(function(i,o){return"int "+e[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+e[o+1]+" = "+t+" - "+e[o]+" * "+i:"index -= "+e[o]+" * "+i)+";"}).join("")}function Ay(e){var n=Pi(e).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var DC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function zA(e,n,t,r){var i=[];e.forEach(function(f){var m=he(f.shapeInfo.logicalShape);f.shapeInfo.isUniform?i.push("uniform float "+f.name+(m>1?"["+m+"]":"")+";"):(i.push("uniform sampler2D "+f.name+";"),i.push("uniform int offset"+f.name+";"))});var o,a,s=i.join(`
`),c=e.map(function(f){return function(m,g,v){v===void 0&&(v=!1);var h="";h+=v?IC(m):Ps(m);var w=m.shapeInfo.logicalShape,y=g.logicalShape;return w.length<=y.length&&(h+=v?function(b,x){var _,C=b.name,R=C.charAt(0).toUpperCase()+C.slice(1),S="get"+R+"AtOutCoords",E=b.shapeInfo.logicalShape.length,T=x.logicalShape.length,I=$o(b.shapeInfo.logicalShape,x.logicalShape),F=wt(T),z=T-E,j=["x","y","z","w","u","v"];_=E===0?"":T<2&&I.length>=1?"coords = 0;":I.map(function(X){return"coords."+j[X+z]+" = 0;"}).join(`
`);var H="";H=T<2&&E>0?"coords":b.shapeInfo.logicalShape.map(function(X,P){return"coords."+j[P+z]}).join(", ");var W="return outputValue;",L=he(b.shapeInfo.logicalShape)===1,$=he(x.logicalShape)===1;if(E!==1||L||$){if(L&&!$)W=T===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(I.length){var k=E-2,U=E-1;I.indexOf(k)>-1&&I.indexOf(U)>-1?W="return vec4(outputValue.x);":I.indexOf(k)>-1?W="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":I.indexOf(U)>-1&&(W="return vec4(outputValue.xx, outputValue.zz);")}}else W=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+S+`() {
      `+F+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+R+"("+H+`);
      `+W+`
    }
  `}(m,g):function(b,x){var _=b.name,C=_.charAt(0).toUpperCase()+_.slice(1),R="get"+C+"AtOutCoords",S=x.texShape,E=b.shapeInfo.texShape,T=b.shapeInfo.logicalShape.length,I=x.logicalShape.length;if(!b.shapeInfo.isUniform&&T===I&&b.shapeInfo.flatOffset==null&&cn(E,S))return`
      float `+R+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var F,z=wt(I),j=$o(b.shapeInfo.logicalShape,x.logicalShape),H=I-T,W=["x","y","z","w","u","v"];F=T===0?"":I<2&&j.length>=1?"coords = 0;":j.map(function($){return"coords."+W[$+H]+" = 0;"}).join(`
`);var L="";return L=I<2&&T>0?"coords":b.shapeInfo.logicalShape.map(function($,k){return"coords."+W[k+H]}).join(", "),`
    float `+R+`() {
      `+z+` coords = getOutputCoords();
      `+F+`
      return get`+C+"("+L+`);
    }
  `}(m,g)),h}(f,n,r)}).join(`
`),u=n.texShape,l=An(),d=function(f){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+f.texture2D+`(textureSampler, uv).r;
    }
  `}(l),p=function(f){return f.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+f.varyingFs+` vec2 resultUV;
    `+f.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+f.defineSpecialNaN+`
    `+f.defineSpecialInf+`
    `+f.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+jA+`
    `+$A+`
    `+UA+`
  `}(l);return n.isPacked?(o=function(f,m){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `}(0,m);case 2:return function(b,x){var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)];if(cn(b,x))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var C=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec2(r, c);
    }
  `}(f,m);case 3:return g=f,v=m,h=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],w=Math.ceil(g[2]/2),y=w*Math.ceil(g[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+h[0]+", "+h[1]+`));
      int index = resTexRC.x * `+h[1]+` + resTexRC.y;

      int b = index / `+y+`;
      index -= b * `+y+`;

      int r = 2 * (index / `+w+`);
      int c = imod(index, `+w+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,x){for(var _=[Math.ceil(x[0]/2),Math.ceil(x[1]/2)],C=Math.ceil(b[b.length-1]/2),R=C*Math.ceil(b[b.length-2]/2),S=R,E="",T="b, r, c",I=2;I<b.length-1;I++)S*=b[b.length-I-1],E=`
      int b`+I+" = index / "+S+`;
      index -= b`+I+" * "+S+`;
    `+E,T="b"+I+", "+T;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+E+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec`+b.length+"("+T+`);
    }
  `}(f,m)}var g,v,h,w,y}(n.logicalShape,u),a=function(f){return`
    void setOutput(vec4 val) {
      `+f.output+` = val;
    }
  `}(l)):(o=function(f,m){switch(f.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(h,w){return w[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+w[1]+`.0);
      }
    `:w[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+w[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      return resTexRC.x * `+w[1]+` + resTexRC.y;
    }
  `}(0,m);case 2:return function(h,w){return cn(h,w)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+w[0]+", "+w[1]+`));
      }
    `:h[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:h[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+w[0]+", "+w[1]+`));
        int index = resTexRC.x * `+w[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      int r = index / `+h[1]+`;
      int c = index - r * `+h[1]+`;
      return ivec2(r, c);
    }
  `}(f,m);case 3:return g=m,v=Ta(["r","c","d"],f),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(h,w){var y=Ta(["r","c","d","d2"],h);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+y+`
      return ivec4(r, c, d, d2);
    }
  `}(f,m);case 5:return function(h,w){var y=Ta(["r","c","d","d2","d3"],h);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+w[0]+`,
                             `+w[1]+`));

      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+y+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(f,m);case 6:return function(h,w){var y=Ta(["r","c","d","d2","d3","d4"],h);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;

      `+y+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(f,m);default:throw new Error(f.length+"-D output sampling is not yet supported")}var g,v}(n.logicalShape,u),a=function(f){return`
    void setOutput(float val) {
      `+f.output+` = vec4(val, 0, 0, 0);
    }
  `}(l)),r&&(p+=WA),[p,d,a,s,o,c,t].join(`
`)}function Ps(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=t.shapeInfo.texShape,u=c[0],l=c[1],d=va(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+u+", "+l+", "+d+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+as(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var c=va(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+c+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+c+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+c+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(e);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&cn(r,a)){var s=a[0],c=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var u=Sa(r),l=u.newShape,d=u.keptDims,p=l;if(p.length<r.length){var f=As(t,p);return`
      `+Ps(f)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Ns(["row","col"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+as(t)+`
      }
    `;var m=a[0],g=a[1],v=va(i);return g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:m===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+g+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+m+", "+g+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(e);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],c=Sa(r),u=c.newShape,l=c.keptDims,d=u;if(d.length<r.length){var p=As(t,d);return`
        `+Ps(p)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Ns(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+as(t)+`
      }
    `;var f=t.shapeInfo.texShape,m=f[0],g=f[1],v=t.shapeInfo.flatOffset;if(g===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+g+".0, "+m+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(g===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+g+".0, "+m+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var h=va(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+h+`;
        vec2 uv = uvFromFlat(`+m+", "+g+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(e);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,c=r[1]*s,u=Sa(r),l=u.newShape,d=u.keptDims;if(l.length<r.length){var p=As(t,l);return`
      `+Ps(p)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Ns(["row","col","depth","depth2"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+c+", "+s+", "+a+`, 1)));
        `+as(t)+`
      }
    `;var f=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],v=m[1];if(v===c&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&f==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var h=va(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+g+", "+v+", index + "+h+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(e);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,c=r[2]*s,u=r[1]*c,l=Sa(r),d=l.newShape,p=l.keptDims;if(d.length<r.length){var f=As(t,d);return`
      `+Ps(f)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Ns(["row","col","depth","depth2","depth3"],p)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+u+", "+c+", "+s+", "+a+`)) +
          depth3;
        `+as(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,v=g[0],h=g[1];if(h===u&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+c+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+h+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(h===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+h+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var w=va(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+c+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+w+`;
      vec2 uv = uvFromFlat(`+v+", "+h+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(e);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Sa(r),s=a.newShape,c=a.keptDims;if(s.length<r.length){var u=As(t,s);return`
      `+Ps(u)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Ns(["row","col","depth","depth2","depth3","depth4"],c)+`);
      }
    `}var l=r[5],d=r[4]*l,p=r[3]*d,f=r[2]*p,m=r[1]*f;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+m+", "+f+", "+p+", "+d+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+as(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,h=v[0],w=v[1];if(w===m&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+f+", "+p+", "+d+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+w+".0, "+h+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(w===l&&g==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+w+".0, "+h+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=va(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+m+" + col * "+f+" + depth * "+p+` +
          depth2 * `+d+" + depth3 * "+l+" + depth4 + "+y+`;
      vec2 uv = uvFromFlat(`+h+", "+w+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function IC(e){var n,t,r;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),r=An(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,c=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=An();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+c[0]+", "+c[1]+`, index);
      return `+u.texture2D+"("+o+`, uv);
    }
  `}(e);case 2:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),c=i.shapeInfo.texShape,u=c[0],l=c[1],d=An();if(c!=null&&cn(o,c))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+u+`.0);

        return `+d.texture2D+"("+a+`, uv);
      }
    `;var p=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],f=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+f+", "+p[0]+", "+p[1]+`, row, col);
      return `+d.texture2D+"("+a+`, uv);
    }
  `}(e);case 3:return function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),c=i.shapeInfo.texShape,u=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(o[0]===1){var l=o.slice(1),d=As(i,l);return`
        `+IC(d)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+Ns(["b","row","col"],[1,2])+`);
        }
      `}var p=u[0],f=u[1],m=Math.ceil(o[2]/2),g=m*Math.ceil(o[1]/2),v=An();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+p+", "+f+", "+g+", "+m+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `}(e);default:return function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,c="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=l[0],p=l[1],f=Math.ceil(o[a-1]/2),m=f*Math.ceil(o[a-2]/2),g="int b, int row, int col",v="b * "+m+" + (row / 2) * "+f+" + (col / 2)",h=2;h<a-1;h++)g="int b"+h+", "+g,m*=o[a-h-1],v="b"+h+" * "+m+" + "+v;var w=An();return`
    vec4 `+c+"("+g+`) {
      int index = `+v+`;
      int texR = index / `+p+`;
      int texC = index - texR * `+p+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+p+", "+d+`);
      return `+w.texture2D+"("+s+`, uv);
    }
  `}(e)}}var jA=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$A=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,UA=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,WA=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function va(e){return"offset"+e}function as(e){var n=e.name,t=he(e.shapeInfo.logicalShape);return t<2?"return "+n+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function wt(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function As(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function Ns(e,n){return n.map(function(t){return e[t]}).join(", ")}var VA=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,c=this.outputShape,u=c.length,l=wt(u),d=Jn("coords",u);if(o===1){var p=wt(s=u+1);a=`
        `+p+" sourceLocR = "+p+"("+d.join()+`, 0);
        ++`+d[u-1]+`;
        `+p+" sourceLocG = "+p+"("+d.join()+`, 0);
        ++`+d[u-2]+`;
        `+p+" sourceLocA = "+p+"("+d.join()+`, 0);
        --`+d[u-1]+`;
        `+p+" sourceLocB = "+p+"("+d.join()+`, 0);
        --`+d[u-2]+";"}else s=u,a=`
        `+l+` sourceLocR = coords;
        ++`+d[u-1]+`;
        `+l+` sourceLocG = coords;
        ++`+d[u-2]+`;
        `+l+` sourceLocA = coords;
        --`+d[u-1]+`;
        `+l+` sourceLocB = coords;
        --`+d[u-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),m="."+f[s-1],g=f.map(function(R){return"int "+R}),v=Jn("sourceLocR",s-1).concat("inIdx.r"),h=Jn("sourceLocG",s-1).concat("inIdx.g"),w=Jn("sourceLocB",s-1).concat("inIdx.b"),y=Jn("sourceLocA",s-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",x=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+h.join()+`),
                             getBestIndicesAChannel(`+w.join()+`),
                             getBestIndicesAChannel(`+y.join()+")));",_=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+h.join()+`) : 0.,
            hasNextRow ? getAChannel(`+w.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+y.join()+") : 0.)",C=r?"":`
      float getBestIndicesAChannel(`+g.join()+`) {
        return getChannel(getBestIndicesA(`+f.join()+`),
                                          vec2(`+f.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+g.join()+`) {
        return getChannel(getA(`+f.join()+`),
                               vec2(`+f.slice(-2).join()+`));
      }
      `+C+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+d[u-1]+" < "+(c[u-1]-1)+`;
        bool hasNextRow = `+d[u-2]+" < "+(c[u-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+x+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},HA=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=s-1-e.padInfo.top,l=c-1-e.padInfo.left,d=1/(n*t);this.userCode=`
      const ivec2 pads = ivec2(`+u+", "+l+`);
      const float avgMultiplier = float(`+d+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+c+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},GA=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=l-1-e.padInfo.front,m=d-1-e.padInfo.top,g=p-1-e.padInfo.left,v=1/(n*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+m+", "+g+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+d+`;
              wR += `+c+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+p+`;
                wC += `+u+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},qA=function(e,n,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],je(e,n),je(e,t);var a="0.0";r!=null&&(je(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(je(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},KA=function(e,n,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],je(e,n),je(e,t);var a="vec4(0.0)";r!=null&&(je(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(je(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},XA="return areal * breal - aimag * bimag;",QA="return areal * bimag + aimag * breal;",z1=function(e,n,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=je(n,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Xh="return a + b;",Qh="return a - b;",j1="return a * b;",PC="return (a < 0.) ? b * a : a;",Nt=function(e,n,t){this.variableNames=["A","B"],this.outputShape=je(n,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},AC=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,to=function(e,n,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=je(n,t);var i=this.outputShape.length,o="";if(r)if(i===0||he(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+wt(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Jn("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},YA=function(){function e(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,n),i.gl.uniform1f(r.maxLoc,t)}},e}(),JA=function(){function e(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,n),i.gl.uniform1f(r.maxLoc,t)}},e}(),ZA=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},eN=function(e){this.outputShape=[],this.outputShape=bc(e,1),this.variableNames=e.map(function(s,c){return"T"+c});var n=new Array(e.length-1);n[0]=e[0][1];for(var t=1;t<n.length;t++)n[t]=n[t-1]+e[t][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<n.length;t++){var i=n[t-1];r.push("else if (yC < "+n[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=n.length,a=n[n.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},tN=function(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=bc(e,n);var t=this.outputShape,r=t.length,i=wt(r),o=Jn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map(function(v,h){return"T"+h});var s=new Array(e.length-1);s[0]=e[0][n];for(var c=1;c<s.length;c++)s[c]=s[c-1]+e[c][n];var u=a[n],l=a.slice(-2),d=a.join(),p="if ("+u+" < "+s[0]+`) {
        return getChannel(
            getT0(`+d+"), vec2("+l.join()+`));
        }`;for(c=1;c<s.length;c++){var f=s[c-1];p+=`
        if (`+u+" < "+s[c]+"  && "+u+" >= "+s[c-1]+`) {
          return getChannel(
            getT`+c+"("+Wl(a,u,f)+`),
            vec2(`+Wl(l,u,f)+`));
        }`}var m=s.length,g=s[s.length-1];p+=`
        return getChannel(
          getT`+m+"("+Wl(a,u,g)+`),
          vec2(`+Wl(l,u,g)+"));",this.userCode=`
      float getValue(`+a.map(function(v){return"int "+v})+`) {
        `+p+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Wl(e,n,t){var r=e.indexOf(n);return e.map(function(i,o){return o===r?i+" - "+t:i}).join()}var nN=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},rN=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,s=t-1-e.padInfo.left,c=o?1:2,u=o?2:3,l=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+c+"], coords["+u+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},iN=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+i+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},oN=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=n-1-e.padInfo.front,c=t-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+c+", "+u+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},aN=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},sN=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=t-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},$1=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterHeight,d=e.filterWidth,p=4*Math.floor(e.inChannels/4),f=e.inChannels%4,m=e.dataFormat==="channelsLast",g=m?1:2,v=m?2:3,h=m?3:1,w="",y="";t&&(w=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,y="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+h+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+v+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+p+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+m+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(f===1)+`) {

              if (`+m+`) {
                dotProd +=
                    getX(batch, xR, xC, `+p+`) *
                    getW(wR, wC, `+p+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+p+`, xR, xC) *
                    getW(wR, wC, `+p+`, d2);
              }

            } else if (`+(f===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2)
              );

              if (`+m+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(f===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+p+`, d2),
                getW(wR, wC, `+p+` + 1, d2),
                getW(wR, wC, `+p+` + 2, d2)
              );

              if (`+m+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+p+`),
                  getX(batch, xR, xC, `+p+` + 1),
                  getX(batch, xR, xC, `+p+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+p+`, xR, xC),
                  getX(batch, `+p+` + 1, xR, xC),
                  getX(batch, `+p+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+y+`
        setOutput(result);
      }
    `},cN=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var n=e.padInfo.front,t=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.filterDepth,d=e.filterHeight,p=e.filterWidth,f=4*Math.floor(e.inChannels/4),m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+n+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`; wR++) {
            int xR = xRCorner + wR * `+c+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`; wC++) {
              int xC = xCCorner + wC * `+u+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+f+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+f+`) *
                  getW(wF, wR, wC, `+f+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+f+`),
                  getX(batch, xF, xR, xC, `+f+` + 1),
                  getX(batch, xF, xR, xC, `+f+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+f+`, d2),
                  getW(wF, wR, wC, `+f+` + 1, d2),
                  getW(wF, wR, wC, `+f+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},U1=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,o=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=e.outChannels/e.inChannels,g="",v="";t&&(g=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,v="result = activation(result);");var h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+g+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+m+`;
        int q = d2 - d1 * `+m+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+p+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+d+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+h+`
        `+v+`
        setOutput(result);
      }
    `},W1=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,o=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,c=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=f,g="int xR; int xC; int xCOffset;",v=0;v<p;v++)for(var h=0;h<f;h++)g+=`
          vec4 xTexelR`+v+"C"+2*h+` = vec4(0.);
          vec4 wR`+v+"C"+h+` = vec4(0.);
          vec4 xR`+v+"C"+h+" = vec4(0.);";for(v=0;v<p;v++)for(var w=0;w<m;w++){if(g+=`
          xR = xRCorner + `+v*l+`;
          xC = xCCorner + `+(h=2*w)*d+`;
        `,u===1){if(h<f&&(g+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+v+"C"+h+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+v+"C"+h+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+v+"C"+h+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+v+"C"+h+" = vec4(previous.zw, xTexelR"+v+"C"+h+`.xy);
                } else {
                  xR`+v+"C"+h+" = vec4(0, 0, xTexelR"+v+"C"+h+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+v+"C"+h+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+h+` = vec4(0.);
                }

                xR`+v+"C"+h+" = xTexelR"+v+"C"+h+`;
              `,h+1<f)){var y=s%2==0?Q2(d):d;d%2==0&&s%2==1||d%2!=0&&s%2!=1?(g+=`
                  xCOffset = xC + `+s%2+" + "+y+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(h+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,d>1&&(g+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+v+"C"+h+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+v+"C"+h+` = vec4(0.);
                    }
                  `),g+=`
                  xR`+v+"C"+(h+1)+` = vec4(
                    xTexelR`+v+"C"+h+".zw, xTexelR"+v+"C"+(h+2)+`.xy);
                `):g+=`
                  xCOffset = xC + `+y+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(h+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+v+"C"+(h+1)+" = xTexelR"+v+"C"+(h+2)+`;
                `}}else h<f&&(g+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(g+=`
                xCOffset = xC + 1 - `+u+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+h+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+h+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+v+"C"+(h+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+v+"C"+(h+2)+` = vec4(0.);
                }

                xR`+v+"C"+h+` = vec4(
                  xTexelR`+v+"C"+h+".zw, xTexelR"+v+"C"+(h+2)+`.zw);
              `,h+1<f&&(g+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+u+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+v+"C"+(h+1)+" = vec4(xTexelR"+v+"C"+(h+2)+`.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+v+"C"+h+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+h+` = vec4(0.);
                }

                xCOffset = xC + `+u+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+(h+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+(h+2)+` = vec4(0.);
                }

                xR`+v+"C"+h+` = vec4(
                  xTexelR`+v+"C"+h+".xy, xTexelR"+v+"C"+(h+2)+`.xy);
              `,h+1<f&&(g+=`
                  xR`+v+"C"+(h+1)+` = vec4(
                    xTexelR`+v+"C"+h+".zw, xTexelR"+v+"C"+(h+2)+`.zw);
                `)),g+="}");h<f&&(g+=`
            vec4 wTexelR`+v+"C"+h+" = getW("+v+", "+h+`, d1, q);
            wR`+v+"C"+h+" = vec4(wTexelR"+v+"C"+h+".xz, wTexelR"+v+"C"+h+`.xz);
          `,h+1<f&&(g+=`
              vec4 wTexelR`+v+"C"+(h+1)+" = getW("+v+", "+(h+1)+`, d1, q);
              wR`+v+"C"+(h+1)+` =
                vec4(wTexelR`+v+"C"+(h+1)+".xz, wTexelR"+v+"C"+(h+1)+".xz);"))}for(v=0;v<p;v++)for(h=0;h<f;h++)g+="dotProd += xR"+v+"C"+h+" * wR"+v+"C"+h+";";var b="",x="";t&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,x="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+c+", "+u+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+g+`

        vec4 result = dotProd;
        `+_+`
        `+x+`
        setOutput(result);
      }
    `},uN=function(e,n,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=e[0],a=e[1],s=e[2],c=e[3],u=n[0],l=t[0],d=t[1];this.outputShape=[u,l,d,c];var p=r==="bilinear"?1:0,f=[a-1+".0",s-1+".0"],m=f[0],g=f[1],v=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+m+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+m],h=v[0],w=v[1],y=v[2],b=d>1?[""+(s-1)/(d-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],x=b[0],_=b[1],C=b[2];this.userCode=`
      const float height_ratio = float(`+h+`);
      const float width_ratio = float(`+x+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+w+`;
        float width_scale = `+_+`;

        float in_y = `+y+`;
        if( in_y < 0.0 || in_y > `+m+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+C+`;
        if( in_x < 0.0 || in_x > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+p+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},lN=function(e,n,t){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+wt(r)+` coords = getOutputCoords();
        int end = `+V1(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+V1(r,"coords")+` = idx;
          val += getX(`+function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function V1(e,n){if(e===1)return""+n;if(e===2)return n+".y";if(e===3)return n+".z";if(e===4)return n+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var dN=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Uu.DENSE;var n=vu(e),t=An();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ta(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},pN=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Uu.DENSE;var n=vu(e),t=An();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Ta(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},fN=function(){function e(n,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),hN=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},mN=function(e){this.variableNames=["A"],this.outTexUsage=gr.DOWNLOAD;var n=An();this.outputShape=e,this.userCode=`
      `+DC+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},gN=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gr.DOWNLOAD;var n=An();this.outputShape=e,this.userCode=`
      `+DC+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},vN=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=An(),i=n[0],o=n[1];this.outputShape=e;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ay(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},yN=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=An(),i=n[0],o=n[1];this.outputShape=e;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var c=0;c<=1;c++)for(var u=0;u<=1;u++){var l=2*c+u;a+=`
          localCoords = coords;
          if(localCoords[2] + `+u+" < "+e[2]+`) {
            localCoords[2] += `+u+`;
            if(localCoords[1] + `+c+" < "+e[1]+`) {
              localCoords[1] += `+c+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ay(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},wN="return real * expR - imag * expI;",bN="return real * expI + imag * expR;",H1=function(e,n,t){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},xN=function(){function e(n,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,n)}},e}(),_N=function(e,n,t){this.variableNames=["A","indices"];var r=e.slice();r[t]=n,this.outputShape=r,this.rank=r.length;var i=wt(this.rank),o=function(a,s){var c=a.length;if(c>4)throw Error("Gather for rank "+c+" is not yet supported");if(c===1)return"int(getIndices(resRC))";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],d=0;d<a.length;d++)d===s?l.push("int(getIndices("+u[d]+"))"):l.push(""+u[d]);return l.join()}(e,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},SN=function(e,n,t){this.sliceDim=e,this.strides=n,this.variableNames=["x","indices"],this.outputShape=t;var r=wt(n.length),i=wt(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function CN(e,n){var t=An();return wP(e,n,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function RN(e,n){return CP(e,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function kN(e,n){return RP(e,n,new Uint16Array([0,1,2,2,1,3]))}function tl(e,n,t,r,i,o,a){EP(t,r);var s=kP(e,n),c=e.TEXTURE_2D;return me(e,n,function(){return e.bindTexture(c,s)}),me(e,n,function(){return e.texParameteri(c,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)}),me(e,n,function(){return e.texParameteri(c,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}),me(e,n,function(){return e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.NEAREST)}),me(e,n,function(){return e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST)}),me(e,n,function(){return e.texImage2D(c,0,i,t,r,0,o,a,null)}),me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,null)}),s}function EN(e,n,t,r,i){var o=Qp(t,r);return tl(e,n,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function TN(e,n,t,r,i){var o=Qp(t,r);return tl(e,n,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function DN(e,n,t,r,i){var o=Qp(t,r);return tl(e,n,o[0],o[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function IN(e,n,t,r,i){var o=el(t,r);return tl(e,n,o[0],o[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function PN(e,n,t,r,i){var o=el(t,r);return tl(e,n,o[0],o[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function AN(e,n,t,r){return me(e,n,function(){return e.bindBuffer(e.ARRAY_BUFFER,r)}),A1(e,n,t,"clipSpacePos",r,3,20,0)&&A1(e,n,t,"uv",r,2,20,12)}function NN(e,n,t,r,i,o,a){var s,c,u;me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),c=e.UNSIGNED_BYTE,u=e.RGBA):(s=new Float32Array(r*i*4),c=e.FLOAT,u=a.internalFormatPackedFloat),s.set(o),me(e,n,function(){return e.texImage2D(e.TEXTURE_2D,0,u,r,i,0,e.RGBA,c,s)}),me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function MN(e,n,t,r){me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,t)}),r.data instanceof Uint8Array?me(e,n,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)}):me(e,n,function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}),me(e,n,function(){return e.bindTexture(e.TEXTURE_2D,null)})}function LN(e,n,t,r,i){var o=e.createBuffer();me(e,n,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,o)});var a=16*t*r;return me(e,n,function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)}),me(e,n,function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,0)}),me(e,n,function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}),o}function ON(e,n,t){var r=e,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function FN(e,n,t,r,i){var o=Qp(t,r),a=o[0],s=o[1],c=new Uint8Array(t*r*4);return me(e,n,function(){return e.readPixels(0,0,a,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,c)}),new Float32Array(c.buffer)}function BN(e,n,t,r,i,o,a,s){var c=e,u=new Float32Array(function(l,d){var p=el(l,d);return p[0]*p[1]*4}(o,a));return c.bindBuffer(c.PIXEL_PACK_BUFFER,n),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,u),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),u}function zN(e,n,t,r){var i=new Float32Array(t*r*4);return me(e,n,function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,i)}),i}var jN=function(){function e(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=K().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,hP(t,n)):this.gl=Bi(t);var r="WEBGL_color_buffer_float";if(K().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=zl(this.gl,this.debug,"OES_texture_float"),Lr(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=zl(this.gl,this.debug,"OES_texture_half_float");else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Lr(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=zl(this.gl,this.debug,"EXT_color_buffer_half_float");else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Lr(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Lr(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=RN(this.gl,this.debug),this.indexBuffer=kN(this.gl,this.debug),this.framebuffer=TP(this.gl,this.debug),this.textureConfig=_y(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return K().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;me(t,this.debug,function(){return t.finish()}),me(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),me(t,this.debug,function(){return t.deleteFramebuffer(n.framebuffer)}),me(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),me(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),me(t,this.debug,function(){return t.deleteBuffer(n.indexBuffer)}),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),EN(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),TN(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),DN(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),MN(this.gl,this.debug,n,t)},e.prototype.uploadDenseMatrixToTexture=function(n,t,r,i){this.throwIfDisposed(),NN(this.gl,this.debug,n,t,r,i,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),PN(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),IN(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(N1(this.gl,this.debug,this.framebuffer),this.outputTexture=null),me(this.gl,this.debug,function(){return t.gl.deleteTexture(n)})},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,r){var i=this;return this.downloadMatrixDriver(n,function(){return FN(i.gl,i.debug,t,r,i.textureConfig)})},e.prototype.downloadPackedMatrixFromBuffer=function(n,t,r,i,o,a){return BN(this.gl,n,0,0,0,o,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return ON(this.gl,n,t)},e.prototype.createBufferFromTexture=function(n,t,r){this.bindTextureToFrameBuffer(n);var i=LN(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},e.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},e.prototype.createFence=function(n){var t,r,i=this;if(K().getBool("WEBGL_FENCE_API_ENABLED")){var o=n,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(n,t,r){var i=this;return this.downloadMatrixDriver(n,function(){return zN(i.gl,i.debug,t,r)})},e.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,r=bP(t,this.debug,n),i=CN(t,this.debug),o=_P(t,this.debug);return me(t,this.debug,function(){return t.attachShader(o,i)}),me(t,this.debug,function(){return t.attachShader(o,r)}),SP(t,this.debug,o),this.debug&&Hh(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=AN(t,this.debug,this.program,this.vertexBuffer)),o},e.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&me(this.gl,this.debug,function(){return t.gl.deleteProgram(n)})},e.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&Hh(this.gl,this.debug,this.program),me(this.gl,this.debug,function(){return t.gl.useProgram(n)})},e.prototype.getUniformLocation=function(n,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?IP(this.gl,this.debug,n,t):PP(this.gl,n,t)},e.prototype.getAttributeLocation=function(n,t){var r=this;return this.throwIfDisposed(),me(this.gl,this.debug,function(){return r.gl.getAttribLocation(n,t)})},e.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},e.prototype.setInputMatrixTexture=function(n,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),AP(this.gl,this.debug,this.program,n,t,r)},e.prototype.setOutputMatrixTexture=function(n,t,r){this.setOutputMatrixTextureDriver(n,r,t)},e.prototype.setOutputPackedMatrixTexture=function(n,t,r){this.throwIfDisposed();var i=el(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(n,o,a)},e.prototype.setOutputMatrixWriteRegion=function(n,t,r,i){this.setOutputMatrixWriteRegionDriver(r,n,i,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(n,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Hh(this.gl,this.debug,this.program),jl(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),me(n,this.debug,function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)})},e.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),me(this.gl,this.debug,function(){return n.gl.finish()})},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=zl(this.gl,this.debug,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},e.prototype.endQuery=function(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(n){return ue(this,void 0,void 0,function(){var t=this;return le(this,function(r){switch(r.label){case 0:return[4,k1(function(){return t.disposed||t.isQueryAvailable(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},e.prototype.getQueryTime=function(n,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(n,i.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(n,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},e.prototype.pollFence=function(n){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return n.isFencePassed()},function(){return r()})})},e.prototype.pollItems=function(){for(var n=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},e.prototype.addItemToPoll=function(n,t){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||k1(function(){return r.pollItems(),r.itemsToPoll.length===0})},e.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Gh(this.gl,this.debug,n,this.framebuffer),this.debug&&jl(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Gh(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&jl(this.gl)):N1(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var r=t();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(n,t,r){this.throwIfDisposed();var i=this.gl;Gh(i,this.debug,n,this.framebuffer),this.debug&&jl(i),this.outputTexture=n,me(i,this.debug,function(){return i.viewport(0,0,t,r)}),me(i,this.debug,function(){return i.scissor(0,0,t,r)})},e.prototype.setOutputMatrixWriteRegionDriver=function(n,t,r,i){var o=this;this.throwIfDisposed(),me(this.gl,this.debug,function(){return o.gl.scissor(n,t,r,i)})},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e}();function G1(e,n){if(e.length!==n.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+n.length+" inputs");e.forEach(function(t,r){var i=t.logicalShape,o=n[r],a=o.shape;if(!cn(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,c=o.isUniform?null:o.texData.texShape;if(!cn(s,c))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+c+" must match")}})}var $N=function(e,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,c=t.outWidth,u=t.dilationWidth,l=t.dilationHeight,d=t.dataFormat,p=s.left,f=s.top,m=i*r,g=An(),v=d==="channelsLast",h=v?0:1,w=v?1:2,y="",b=0;b<=1;b++)for(var x=0;x<=1;x++)y+=`
          blockIndex = rc.y + `+x+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+c+")) * "+a+" - "+f+`;
            d0 = offsetY + `+l+" * (pos / "+m+`);

            if(d0 < `+n[h]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+c+".) * "+o+". - "+p+`.);
              d1 = offsetX + `+u+" * (int(mod(float(pos), "+m+".) / "+i+`.));

              if(d1 < `+n[w]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+v+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+x)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+x)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+y+`

        `+g.output+` = result;
      }
    `},UN=function(e,n,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=n,s=e[3]-1;this.outputShape=e;var c="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},WN=function(e,n,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},VN=function(e,n,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=n,s=e[3]-1;this.outputShape=e;var c="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+c+")":i===1?"1.0/("+c+")":"exp(log("+c+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},HN=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideHeight,t=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,s=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+c+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},GN=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=s-1-e.padInfo.front,d=c-1-e.padInfo.top,p=u-1-e.padInfo.left,f=s*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+d+", "+p+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+c+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+u+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+f+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+c+" * "+u+` +
                  wR * `+u+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Yh=function(e,n,t,r,i,o,a){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=t?e[1]:e[2],c=Math.ceil(s/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",d=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],p=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",m="";o&&(f=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,m="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+f+`

      const float sharedDimension = `+c+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+c+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+p[0]+`);
          result += (`+d[1]+" * "+p[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+m+`

        setOutput(result);
      }
    `},qN=function(){function e(n,t,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,n)}},e}(),KN=function(e,n,t,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},XN=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var n=e.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Jn("rc",n),r=wt(n),i=function(s,c,u){if(s===1)return"rc > "+c[0];for(var l="",d=s-2;d<s;d++)l+=u[d]+" >= "+c[d],d<s-1&&(l+="||");return l}(n,e,t),o=function(s,c,u,l){if(s===1)return"";var d=l.slice(-2);return`
    int r = `+d[0]+`;
    int c = `+d[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+c+`;
    bool rEdge = rp1 >= `+u+`;
  `}(n,e[e.length-1],e[e.length-2],t),a=function(s,c){var u=s.length,l=function(d,p){for(var f=[],m=0;m<=1;m++)for(var g=0;g<=1;g++){for(var v=(m===0?"r":"rp1")+", "+(g===0?"c":"cp1"),h=2;h<d;h++)v=p[p.length-1-h]+","+v;f.push(v)}return f}(u,c);return u===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"}(e,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},QN=function(e,n,t){this.variableNames=["x"],this.outputShape=n.map(function(c,u){return c[0]+e[u]+c[1]});var r=e.length,i=wt(r),o=n.map(function(c){return c[0]}).join(","),a=n.map(function(c,u){return c[0]+e[u]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},YN=function(e,n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map(function(v,h){return v[0]+e[h]+v[1]});for(var r=e.length,i=wt(r),o=n.map(function(v){return v[0]}).join(","),a=n.map(function(v,h){return v[0]+e[h]}).join(","),s=Jn("rc",r),c=Jn("source",r),u=s[r-1]+" < "+this.outputShape[r-1],l=r===1?"source":"vec2("+c.slice(-2).join()+")",d=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+u+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+u+") {"],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,g=r===1?2:4;m<g;m++)f+=`
        `+d[m]+`
        if (`+p+`) {
          result[`+m+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+m+"] = getChannel(getX("+c.join()+"), "+l+`);
        }
      `;f+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+f+`
        setOutput(result);
      }
    `},Jh=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var p=n==="avg",f="0.0";if(p||(f="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+l+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+u+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+u+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var m=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(m="avgValue / count");var g=4*Math.floor(r/4),v=r%4,h=`
      if (`+p+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+l+", "+d+`);
      const float initializationValue = `+f+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+f+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+g+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+h+`
          }

          int xC = xCCorner + `+g+`;
          if (`+(v===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+h+`
          } else if (`+(v===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+h+`
          } else if (`+(v===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+h+`
          }
        }
        setOutput(`+m+`);
      }
    `}},Zh=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,d=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,m=e.padInfo.top,g=e.padInfo.left;this.outputShape=e.outShape;var v=n==="avg",h="0.0";if(v||(h="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+i+", "+o+", "+a+`);
        const ivec3 pads = ivec3(`+f+", "+m+", "+g+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+p+`;
                  wC += `+u+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+d+" * "+p+` +
                      wR * `+p+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var w=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(w="avgValue / count");var y=4*Math.floor(r/4),b=r%4,x=`
      if (`+v+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+f+", "+m+", "+g+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+y+`; wC += 4) {
              int xC = xCCorner + wC * `+u+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+u+`, ch)
              );

              `+x+`
            }

            int xC = xCCorner + `+y+`;
            if (`+(b===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(b===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                initializationValue,
                initializationValue
              );

              `+x+`
            } else if (`+(b===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+u+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+u+`, ch),
                initializationValue
              );

              `+x+`
            }
          }
          setOutput(`+w+`);
        }
      }
    `}},JN=function(e,n){this.variableNames=["x"];var t=e.windowSize,r=e.batchSize,i=e.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",s="min"):n==="max"&&(a="-1.0 / 1e-20",s="max");var c=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");var u=4*Math.floor(t/4),l=t%4,d=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,p="vec4";n==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):n==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var f="";i%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+u+`; i += 4) {
          int inIdx = inOffset + i;
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+d+`
        }

        int inIdx = inOffset + `+u+`;
        if (`+(l===1)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===2)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+d+`
        } else if (`+(l===3)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+d+`
        }
        setOutput(`+c+`);
      }
    `},ZN=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Ta(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+Ay(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+t+`

        setOutput(result);
      }
    `},e3=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,i=r[1],o=r[2],a=e.shape,s=a[1],c=a[2],u=[t&&s>1?i-1:i,t&&c>1?o-1:o],l=[t&&s>1?s-1:s,t&&c>1?c-1:c],d=u[0]/l[0],p=u[1]/l[1],f=1/d,m=1/p,g=2*Math.ceil(f)+2,v=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},t3=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,n,t,s];var c=[r&&n>1?o-1:o,r&&t>1?a-1:a],u=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},n3=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,n,t,s];var c=[r&&n>1?o-1:o,r&&t>1?a-1:a],u=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`,
          `+c[1]/u[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},r3=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,i=r[1],o=r[2],a=e.shape,s=a[1],c=a[2],u=[t&&s>1?i-1:i,t&&c>1?o-1:o],l=[t&&s>1?s-1:s,t&&c>1?c-1:c],d=u[0]/l[0],p=u[1]/l[1],f=1/d,m=1/p,g=2*Math.ceil(f)+2,v=2*Math.ceil(m)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+d+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+f+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+g+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+c+`) {
              continue;
            }

            float sourceFracRow =
              float(`+u[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+u[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},i3=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var i=e[0],o=e[1],a=e[2],s=e[3];this.outputShape=[i,n,t,s];var c=[r&&n>1?o-1:o,r&&t>1?a-1:a],u=[r&&n>1?n-1:n,r&&t>1?t-1:t],l=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+c[0]/u[0]+`,
          `+c[1]/u[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},o3=function(e,n){this.variableNames=["x"];var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=e,t!==1){var r=e.map(function(o,a){return function(s){return n.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(a)}).join(","),i=wt(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},a3=function(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=e;var r=Jn("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=wt(t);function s(c){var u=e.map(function(l,d){return function(p,f){return n.indexOf(p)!==-1&&e[p]!==1?e[p]+" - "+f[p]+" - 1":""+f[p]}(d,c)});return"getChannel(getX("+u.join(",")+"), vec2("+u.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(c){return s(c)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",s(c)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(c){return c[t-2]="("+c[t-2]+" + 1)",s(c)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(c){return c[t-1]="("+c[t-1]+" + 1)",c[t-2]="("+c[t-2]+" + 1)",s(c)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},q1=function(e,n,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=wt(i.length),c=wt(o.length),u="";t===1?u="i":t===2&&(u="i, j");var l="getIndices("+u+")",d="";r===1?d="i":r===2&&(d="i, coords[1]");var p="getUpdates("+d+")",f=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+c+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+f+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+p+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},s3=function(e,n){this.variableNames=["x","segmentIds"];var t=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),c=t%4,u=`
        sumValue += dot(values, segFilter);
    `,l="";i%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+u+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(c===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+u+`
        } else if (`+(c===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+u+`
        } else if (`+(c===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+u+`
        }
        setOutput(sumValue);
      }
    `},c3=function(e,n,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=n,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],c=0;c<n.length;c++)s.push(""+o[c]),c<e&&a.push(""+o[c]);r=a.join(),i=s.join()}var u=wt(t);this.userCode=`
      void main() {
        `+u+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},u3=function(){function e(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,r=wt(this.rank),i="uniform int start["+this.rank+"];",o=function(a){if(a===1)return"sourceLoc";if(a<=6)return em.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+n.map(function(a,s){return"sourceLoc."+em[s]+" = start["+s+"] + coords."+em[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e}(),em=["x","y","z","w","u","v"],l3=function(){function e(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=wt(this.rank),r=Jn("coords",this.rank),i=Jn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,c=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            `+t+"("+n.map(function(l,d){return"start["+d+"]"}).join()+");":n.map(function(l,d){return i[d]+" = "+r[d]+" + start["+d+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+u+`
        vec4 result = vec4(0.);
        `+s+`
        `+c+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e}(),d3=function(e,n,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=wt(t.length),o=wt(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map(function(c,u){return s++,t.length===1?"coords * strides["+u+"] + begin["+u+"]":"coords["+(s-1)+"] * strides["+u+"] + begin["+u+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+e+`);
      `+i+" strides = "+i+"("+n+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},p3=function(){function e(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(n,t,r){var i,o=K1(t,r),a=X1(n,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===hr.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===hr.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===hr.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===hr.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===hr.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(i),i},e.prototype.releaseTexture=function(n,t,r,i){if(this.freeTextures!=null){var o=X1(t,K1(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){n.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){n.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function K1(e,n){if(e===gr.UPLOAD)return hr.PACKED_2X2_FLOAT32;if(e===gr.RENDER||e==null)return function(t){return K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?hr.PACKED_2X2_FLOAT32:hr.UNPACKED_FLOAT32:t?hr.PACKED_2X2_FLOAT16:hr.UNPACKED_FLOAT16}(n);if(e===gr.DOWNLOAD||e===gr.PIXELS)return hr.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function X1(e,n,t){return e[0]+"_"+e[1]+"_"+n+"_"+t}var f3=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[r]*n[r];this.outputShape=t,this.rank=t.length;var i=wt(this.rank),o=function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],u=[],l=0;l<a.length;l++)u.push("imod("+c[l]+", "+a[l]+")");return u.join()}(e);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},h3=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];this.outputShape=t,this.rank=t.length;var i=wt(this.rank),o=function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var c=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],u=new Array(s),l=0;l<a.length;l++)u[a[l]]=c[l];return u.join()}(n);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},m3=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=wt(this.rank),o=TC("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",c="++"+o[this.rank-1]+" < "+t[this.rank-1],u="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+u+`;
      if(`+c+`) {
        result[1] = `+u+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+u+`;
        if(`+c+`) {
          result[3] = `+u+`;
        }
      }
      setOutput(result);
    }
    `},Ny=1.7580993408473768,My=1.0507009873554805,Oe=function(e,n){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},ii="if (isnan(x)) return x;",g3="return x;",Q1="return abs(x);",NC=ii+`
  return (x < 0.0) ? 0.0 : x;
`,MC=ii+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,LC="return (x >= 0.0) ? x : (exp(x) - 1.0);",v3=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Ny+`;
  float scale = `+My+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Y1="return -x;",J1="return ceil(x);",Z1="return floor(x);",eb="return exp(x);",tb="return exp(x) - 1.0;",y3=ii+`
  return sin(x);
`,w3=ii+`
  return cos(x);
`,b3=ii+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,x3=ii+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,_3=ii+`
  return atan(x);
`,S3=ii+"return log(x + sqrt(x * x + 1.0));",C3=ii+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,R3=ii+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Vl="return x;",k3="return x;",OC=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FC=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,BC=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Qc=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},E3=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var n=e.length,t=Jn("rc",n),r=wt(n),i=function(s,c){if(s===1)return"rc";for(var u="",l=0;l<s;l++)u+=c[l],l<s-1&&(u+=",");return u}(n,t),o=t.slice(-2),a=n<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},Hl={};function Gl(e,n){if(n===void 0&&(n=!1),e==="linear")return n?k3:g3;if(e==="relu")return n?OC:NC;if(e==="elu")return n?BC:LC;if(e==="relu6")return n?FC:MC;if(e==="prelu")return n?AC:PC;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var T3=600,D3=function(e){function n(t){var r,i=e.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!K().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=Bi(K().getNumber("WEBGL_VERSION"));i.binaryCache=((r=K().getNumber("WEBGL_VERSION"))in Hl||(Hl[r]={}),Hl[r]),i.gpgpu=new jN(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new p3(i.gpgpu),i.numMBBeforeWarning=K().global.screen==null?1024:K().global.screen.height*K().global.screen.width*window.devicePixelRatio*T3/1024/1024,i.texData=new wC(i,O),i}return ri(n,e),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(t,r,i){if(K().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:gr.UPLOAD}),o},n.prototype.move=function(t,r,i,o){if(K().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:gr.UPLOAD})},n.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,a=r.complexTensors,s=r.slice,c=r.shape,u=r.isPacked;if(s!=null){var l=void 0;l=u?new Qc(c,Vl):new Oe(c,Vl);var d=this.runWebGLProgram(l,[{dataId:t,shape:c,dtype:o}],o),p=this.readSync(d.dataId);return this.disposeData(d.dataId),p}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var f,m,g=this.activeTimers!=null;return g&&(f=_i()),o==="complex64"?m=Qg(a.real.dataSync(),a.imag.dataSync()):m=this.getValuesFromTexture(t),g&&(this.downloadWaitMs+=_i()-f),this.convertAndCacheOnCPU(t,m)},n.prototype.read=function(t){return ue(this,void 0,void 0,function(){var r,i,o,a,s,c,u,l,d,p,f,m,g,v,h,w,y,b,x,_,C,R;return le(this,function(S){switch(S.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(E){return r.push(E)})];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,c=i.dtype,u=i.complexTensors,l=i.isPacked,s!=null)return d=void 0,d=l?new Qc(a,Vl):new Oe(a,Vl),p=this.runWebGLProgram(d,[{dataId:t,shape:a,dtype:c}],c),f=this.read(p.dataId),this.disposeData(p.dataId),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&K().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,c!=="complex64"&&K().get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(t),v=this.texData.get(g.dataId),m=(R=this.gpgpu).createBufferFromTexture.apply(R,[v.texture].concat(vu(a)))),this.pendingRead.set(t,[]),c==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:S.sent(),S.label=2;case 2:return c!=="complex64"?[3,4]:[4,Promise.all([u.real.data(),u.imag.data()])];case 3:return w=S.sent(),y=w[0],b=w[1],h=Qg(y,b),[3,5];case 4:m==null?h=this.getValuesFromTexture(t):(x=he(a),h=this.gpgpu.downloadFloat32MatrixFromBuffer(m,x)),S.label=5;case 5:return g!=null&&this.disposeData(g.dataId),_=this.convertAndCacheOnCPU(t,h),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach(function(E){return E(_)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}})})},n.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!vP(i))throw K().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,c=he(o);if(K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),l=this.texData.get(u.dataId),d=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(vu(o))).subarray(0,c);return this.disposeData(u.dataId),d}var p=K().getBool("WEBGL_PACK")&&s===!0,f=p?qh(o):o,m=p?new gN(f):new mN(f),g=this.runWebGLProgram(m,[{shape:f,dtype:a,dataId:t}],"float32"),v=this.texData.get(g.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,c);return this.disposeData(g.dataId),h},n.prototype.time=function(t){return ue(this,void 0,void 0,function(){var r,i,o,a,s,c,u;return le(this,function(l){switch(l.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=yc(this.activeTimers.map(function(d){return d.query})).filter(function(d){return d!=null}),s=yc(this.activeTimers.map(function(d){return d.name})).filter(function(d){return d!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return u=l.sent(),c.kernelMs=YI(u),c.getExtraProfileInfo=function(){return u.map(function(d,p){return{name:s[p],ms:d}}).map(function(d){return d.name+": "+d.ms}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:_i(),endMs:null}},n.prototype.endTimer=function(t){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=_i(),t)},n.prototype.getQueryTime=function(t){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},n.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,a=r.texShape,s=r.usage,c=r.isPacked,u=r.slice,l=u&&u.origDataId||t,d=this.dataRefCount.get(l);d>1?this.dataRefCount.set(l,d-1):(this.dataRefCount.delete(l),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,c)));var p=this.texData.get(t);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getDataInfo=function(t){return this.texData.get(t)},n.prototype.getCPUBackend=function(){return K().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=O.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(o){return i.texData.get(o.dataId).texture==null&&o.size<r})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:O.keep(t.clone()),imag:O.keep(r.clone())},i},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(he(i)===0)return mn([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=vC(t.shape,r,i);if(o||!a){var s=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new l3(i):new u3(i),c=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,c)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},n.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var c=yC(r,t.strides);o.slice&&(c+=o.slice.flatOffset),s.slice={flatOffset:c,origDataId:o.slice&&o.slice.origDataId||t.dataId};var u=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,u+1),a},n.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var a=Ey(r,i,o);if(a.some(function(c){return c===0}))return mn([],a);var s=new d3(r,o,a);return this.compileAndRun(s,[t])},n.prototype.reverse=function(t,r){var i=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new a3(t.shape,r):new o3(t.shape,r);return this.compileAndRun(i,[t])},n.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map(function(f){return Nr(f)}),o=t.map(function(f){return Ri(f)});return fn(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),c=this.concat(t.slice(a),r);return this.concat([s,c],r)}if(K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new tN(t.map(function(f){return f.shape}),r);return this.compileAndRun(u,t)}var l=bc(t.map(function(f){return f.shape}),r),d=t.map(function(f){return f.as2D(-1,he(f.shape.slice(r)))}),p=new eN(d.map(function(f){return f.shape}));return this.compileAndRun(p,d).reshape(l)},n.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Y1,t.dtype);var r=new Oe(t.shape,Y1);return this.compileAndRun(r,[t])},n.prototype.batchMatMul=function(t,r,i,o){var a=i?t.shape[2]:t.shape[1],s=o?r.shape[1]:r.shape[2],c=i?t.shape[1]:t.shape[2],u=t.shape[0];if((a===1||s===1)&&c>1e3){i&&(t=t.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var l=s===1?t:t.as3D(u,c,1),d=s===1?2:1,p=s===1?r.as3D(u,1,c):r;return this.multiply(l,p).sum(d,!0)}var f=hn(t.dtype,r.dtype),m=new Yh(t.shape,[u,a,s],i,o);return this.compileAndRun(m,[t,r],f)},n.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=o?r.shape[2]:r.shape[1],d=a?i.shape[1]:i.shape[2],p=r.shape[0],f=hn(r.dtype,i.dtype),m=s!=null,g=u!=null,v=c?Gl(c,!0):null,h=new Yh(r.shape,[p,l,d],o,a,m,v,g),w=[r,i];return s&&w.push(s),u&&w.push(u),this.compileAndRun(h,w,f)},n.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),a=new z1(XA,t.shape,r.shape),s=new z1(QA,t.shape,r.shape),c=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],u=this.compileAndRun(a,c),l=this.compileAndRun(s,c),d=this.complex(u,l);return u.dispose(),l.dispose(),d}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,j1,t.dtype);var p=new Nt(j1,t.shape,r.shape);return this.compileAndRun(p,[t,r],t.dtype)},n.prototype.batchNormalization=function(t,r,i,o,a,s){var c=[t,r,i],u=null;s!=null&&(u=s.shape,c.push(s));var l=null;if(a!=null&&(l=a.shape,c.push(a)),K().getBool("WEBGL_PACK_NORMALIZATION")){var d=new KA(t.shape,r.shape,i.shape,u,l,o);return this.compileAndRun(d,c)}var p=new qA(t.shape,r.shape,i.shape,u,l,o);return this.compileAndRun(p,c)},n.prototype.localResponseNormalization4D=function(t,r,i,o,a){var s=K().getBool("WEBGL_PACK_NORMALIZATION")?new VN(t.shape,r,i,o,a):new UN(t.shape,r,i,o,a);return this.compileAndRun(s,[t])},n.prototype.LRNGrad=function(t,r,i,o,a,s,c){var u=new WN(r.shape,o,a,s,c);return this.compileAndRun(u,[r,i,t])},n.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(a){return dp(a)});return kC(Me(t.shape,t.dtype,i),r)}var o=new f3(t.shape,r);return this.compileAndRun(o,[t])},n.prototype.pad=function(t,r,i){var o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new YN(t.shape,r,i):new QN(t.shape,r,i);return this.compileAndRun(o,[t])},n.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var i=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new m3(t.shape,r):new h3(t.shape,r);return this.compileAndRun(i,[t])},n.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new _N(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},n.prototype.batchToSpaceND=function(t,r,i){A(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(d,p){return d*p}),a=vp(t.shape,r,o),s=yp(a.length,r.length),c=wp(t.shape,r,o),u=fC(i,r.length),l=hC(c,i,r.length);return t.reshape(a).transpose(s).reshape(c).slice(u,l)},n.prototype.spaceToBatchND=function(t,r,i){A(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(p,f){return p*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var c=t.pad(a),u=vp(c.shape,r,o,!1),l=yp(u.length,r.length,!1),d=wp(c.shape,r,o,!1);return c.reshape(u).transpose(l).reshape(d)},n.prototype.reduce=function(t,r,i){var o=t.shape[0],a=t.shape[1],s=Kh(a),c=new JN({windowSize:s,inSize:a,batchSize:o},r),u=this.compileAndRun(c,[t],i);return u.shape[1]===1?u:this.reduce(u,r,i)},n.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=Kh(a),c=new BA({windowSize:s,inSize:a,batchSize:o},r,i==null),u=[t];i!=null&&u.push(i);var l=this.compileAndRun(c,u,"int32");return l.shape[1]===1?l:this.argReduce(t,r,l)},n.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=Kh(o[o.length-1]),s=new VA(o,a,r,i==null),c=i==null?[t]:[t,i],u=this.compileAndRun(s,c,"int32");return u.rank===t.rank?this.argReducePacked(t,r,u):u},n.prototype.sum=function(t,r){fr("sum",r,t.rank);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a),c=jh(t.dtype);return this.reduce(s,"sum",c).reshape(o)},n.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a),c=jh(t.dtype);return this.reduce(s,"prod",c).reshape(o)},n.prototype.unsortedSegmentSum=function(t,r,i){var o=0,a=zi([o],t.rank),s=t;a!=null&&(s=t.transpose(a),o=ji(1,t.rank)[0]);var c=function(f,m,g){for(var v=[],h=f.length,w=0;w<h;w++)w!==m?v.push(f[w]):v.push(g);return v}(s.shape,o,i),u=he([s.shape[o]]),l=s.as2D(-1,u),d=jh(t.dtype),p=this.segOpCompute(l,"unsortedSegmentSum",r,d,i).reshape(c);return a!=null&&(p=p.transpose(Sy(a))),p},n.prototype.segOpCompute=function(t,r,i,o,a){var s=t.shape[0],c=t.shape[1],u=function(p,f){var m,g=!1;for(p<=gC?(m=p,g=!0):m=$g(p,Math.floor(Math.sqrt(p)));!g;)m>f||m===p?g=!0:m=$g(p,m+1);return m}(c,a),l=new s3({windowSize:u,inSize:c,batchSize:s,numSegments:a}),d=this.compileAndRun(l,[t,i],o);return d.shape[1]===a?d:(i=gp(0,a).tile([c/u]),this.segOpCompute(d,r,i,o,a))},n.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(fr("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!K().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Dn(t.shape,o),s=a[0],c=he(a[1]),u=t.as2D(-1,c);return this.argReduce(u,i).reshape(s)}return this.argReducePacked(t,i)},n.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},n.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},n.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new lN(t.shape,i,o);return this.compileAndRun(a,[t])},n.prototype.equal=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new Nt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.notEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new Nt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new Nt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.lessEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new Nt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new Nt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.greaterEqual=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new Nt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.logicalNot=function(t){var r=new Oe(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},n.prototype.logicalAnd=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new Nt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.logicalOr=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new Nt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},n.prototype.select=function(t,r,i){var o=new c3(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],hn(r.dtype,i.dtype))},n.prototype.where=function(t){hp("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Py(t.shape,r)},n.prototype.topk=function(t,r,i){return EC(t.dataSync(),t.shape,t.dtype,r)},n.prototype.min=function(t,r){fr("min",r,t.rank);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},n.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Nt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.mod=function(t,r){var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Nt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);fr("max",r,t.rank);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},n.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Nt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.all=function(t,r){fr("all",r,t.rank);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},n.prototype.any=function(t,r){fr("any",r,t.rank);var i=Dn(t.shape,r),o=i[0],a=he(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},n.prototype.realDivide=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var i=new Nt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"float32")},n.prototype.floorDiv=function(t,r){if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new Nt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},n.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Xh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=hn(t.dtype,r.dtype);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Xh,i);var o=new Nt(Xh,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},n.prototype.packedUnaryOp=function(t,r,i){var o=new Qc(t.shape,r);return this.compileAndRun(o,[t],i)},n.prototype.packedBinaryOp=function(t,r,i,o,a){a===void 0&&(a=!1);var s=new to(i,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],o)},n.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),c=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map(function(p){var f=p[0],m=p[1],g=o.makeComplexComponentTensorInfo(t,f),v=o.makeComplexComponentTensorInfo(r,m),h=new Nt(i,t.shape,r.shape);return o.compileAndRun(h,[g,v],hn(f.dtype,m.dtype))}),u=c[0],l=c[1],d=this.complex(u,l);return u.dispose(),l.dispose(),d},n.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},n.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>K().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var a=t.map(function(u){return u.dtype}).reduce(function(u,l){return hn(u,l)}),s=t.map(function(u){return u.shape}),c=K().getBool("WEBGL_PACK")?new FA(t[0].shape,s):new OA(t[0].shape,s);return this.compileAndRun(c,t,a)},n.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Qh);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=hn(t.dtype,r.dtype);if(K().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Qh,t.dtype);var o=new Nt(Qh,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},n.prototype.pow=function(t,r){var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Nt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=hn(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},n.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,J1,t.dtype);var r=new Oe(t.shape,J1);return this.compileAndRun(r,[t])},n.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Z1,t.dtype);var r=new Oe(t.shape,Z1);return this.compileAndRun(r,[t])},n.prototype.sign=function(t){var r=new Oe(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},n.prototype.isNaN=function(t){var r=new Oe(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isInf=function(t){var r=new Oe(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isFinite=function(t){var r=new Oe(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.round=function(t){var r=new Oe(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},n.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eb,t.dtype);var r=new Oe(t.shape,eb);return this.compileAndRun(r,[t])},n.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,tb,t.dtype);var r=new Oe(t.shape,tb);return this.compileAndRun(r,[t])},n.prototype.softmax=function(t,r){var i=en([r],t.shape),o=this.max(t,i),a=ar(o.shape,i),s=this.subtract(t,o.reshape(a)),c=this.exp(s),u=this.sum(c,i).reshape(a);return this.realDivide(c,u)},n.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Oe(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},n.prototype.log1p=function(t){var r=new Oe(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},n.prototype.sqrt=function(t){var r=new Oe(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Oe(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},n.prototype.reciprocal=function(t){var r=new Oe(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},n.prototype.relu=function(t){var r;return r=K().getBool("WEBGL_PACK")?new Qc(t.shape,OC):new Oe(t.shape,NC),this.compileAndRun(r,[t])},n.prototype.relu6=function(t){var r;return r=K().getBool("WEBGL_PACK")?new Qc(t.shape,FC):new Oe(t.shape,MC),this.compileAndRun(r,[t])},n.prototype.prelu=function(t,r){var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(AC,t.shape,r.shape):new Nt(PC,t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.elu=function(t){if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,BC,t.dtype);var r=new Oe(t.shape,LC);return this.compileAndRun(r,[t])},n.prototype.eluDer=function(t,r){var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new Nt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.selu=function(t){var r=new Oe(t.shape,v3);return this.compileAndRun(r,[t])},n.prototype.int=function(t){var r=new Oe(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},n.prototype.clip=function(t,r,i){var o,a=(o=K().getBool("WEBGL_PACK_CLIP")?new JA(t.shape):new YA(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,a)},n.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Q1,t.dtype);var r=new Oe(t.shape,Q1);return this.compileAndRun(r,[t])},n.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new ZA(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},n.prototype.sigmoid=function(t){var r=new Oe(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},n.prototype.softplus=function(t){var r=new Oe(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},n.prototype.sin=function(t){var r=new Oe(t.shape,y3);return this.compileAndRun(r,[t])},n.prototype.cos=function(t){var r=new Oe(t.shape,w3);return this.compileAndRun(r,[t])},n.prototype.tan=function(t){var r=new Oe(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},n.prototype.asin=function(t){var r=new Oe(t.shape,b3);return this.compileAndRun(r,[t])},n.prototype.acos=function(t){var r=new Oe(t.shape,x3);return this.compileAndRun(r,[t])},n.prototype.atan=function(t){var r=new Oe(t.shape,_3);return this.compileAndRun(r,[t])},n.prototype.atan2=function(t,r){var i=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Nt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},n.prototype.sinh=function(t){var r=new Oe(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.cosh=function(t){var r=new Oe(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.tanh=function(t){var r=new Oe(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},n.prototype.asinh=function(t){var r=new Oe(t.shape,S3);return this.compileAndRun(r,[t])},n.prototype.acosh=function(t){var r=new Oe(t.shape,C3);return this.compileAndRun(r,[t])},n.prototype.atanh=function(t){var r=new Oe(t.shape,R3);return this.compileAndRun(r,[t])},n.prototype.erf=function(t){var r=new Oe(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},n.prototype.step=function(t,r){var i=new Oe(t.shape,function(o){return o===void 0&&(o=0),ii+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[t])},n.prototype.conv2dByMatMul=function(t,r,i,o,a,s){var c=t.shape,u=this.texData.get(t.dataId),l=i.inChannels,d=c[0]*c[1]*c[2],p=i.outChannels,f=i.dataFormat==="channelsLast",m=(d===1||p===1)&&l>1e3,g=c[2]%2!=0&&!!u.isPacked;if(m||!K().getBool("WEBGL_LAZILY_UNPACK")||!K().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!g){var v=f?c[0]*c[1]*c[2]:c[0]*c[2]*c[3],h=this.reshape(t,[1,v,i.inChannels]),w=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:h,b:w,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var y=f?c[0]*c[1]*(c[2]+1):c[0]*c[2]*(c[3]+1),b={dataId:t.dataId,shape:[1,y,i.inChannels],dtype:t.dtype},x=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,A(Ul(u.shape,b.shape),function(){return"packed reshape "+u.shape+" to "+b.shape+" isn't free"});var _=this.reshape(r,[1,i.inChannels,i.outChannels]),C=this.fusedBatchMatMul({a:b,b:_,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),R=this.texData.get(C.dataId);return A(R.isPacked,function(){return"batchMatMul result is expected to be packed"}),u.shape=x,R.shape=i.outShape,O.makeTensorFromDataId(C.dataId,i.outShape,C.dtype)},n.prototype.conv2dWithIm2Row=function(t,r,i,o,a,s){var c=i.filterWidth,u=i.filterHeight,l=i.inChannels,d=i.outWidth,p=i.outHeight,f=i.dataFormat==="channelsLast",m=c*u*l,g=p*d,v=[m,g],h=t.squeeze([0]),w=r.reshape([1,m,-1]),y=new $N(v,h.shape,i),b=this.compileAndRun(y,[h]).reshape([1,v[0],v[1]]),x=o!=null,_=s!=null,C=a?Gl(a,!0):null,R=new Yh(b.shape,[1,g,i.outChannels],!0,!1,x,C,_),S=[b,w];o&&S.push(o),_&&S.push(s);var E=this.compileAndRun(R,S);return f?E.reshape([1,p,d,i.outChannels]):E.reshape([1,i.outChannels,p,d])},n.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,c=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,a,s,c);if(K().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,a,s,c);var u=a!=null,l=c!=null,d=s?Gl(s,!1):null,p=new $1(o,u,d,l),f=[r,i];return a&&f.push(a),c&&f.push(c),this.compileAndRun(p,f)},n.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(K().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new $1(i);return this.compileAndRun(o,[t,r])},n.prototype.conv2dDerInput=function(t,r,i){var o=new rN(i);return this.compileAndRun(o,[t,r])},n.prototype.conv2dDerFilter=function(t,r,i){var o=new nN(i);return this.compileAndRun(o,[t,r])},n.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,d=c?Gl(c,l):null,p=[i,o],f=s!=null,m=u!=null;return f&&p.push(s),m&&p.push(u),l?(r=new W1(a,f,d,m),this.compileAndRun(r,p)):(r=new U1(a,f,d,m),this.compileAndRun(r,p))},n.prototype.depthwiseConv2D=function(t,r,i){var o;return K().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new W1(i),this.compileAndRun(o,[t,r])):(o=new U1(i),this.compileAndRun(o,[t,r]))},n.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new sN(i);return this.compileAndRun(o,[t,r])},n.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new aN(i);return this.compileAndRun(o,[t,r])},n.prototype.conv3d=function(t,r,i){var o=new cN(i);return this.compileAndRun(o,[t,r])},n.prototype.conv3dDerInput=function(t,r,i){var o=new oN(i);return this.compileAndRun(o,[t,r])},n.prototype.conv3dDerFilter=function(t,r,i){var o=new iN(i);return this.compileAndRun(o,[t,r])},n.prototype.maxPool=function(t,r){var i=new Jh(r,"max",!1);return this.compileAndRun(i,[t])},n.prototype.avgPool=function(t,r){var i=new Jh(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},n.prototype.maxPoolBackprop=function(t,r,i,o){var a=new Jh(o,"max",!0),s=this.compileAndRun(a,[r]),c=new HN(o),u=this.compileAndRun(c,[t,s],r.dtype);return s.dispose(),u},n.prototype.avgPoolBackprop=function(t,r,i){var o=new HA(i);return this.compileAndRun(o,[t],r.dtype)},n.prototype.cast=function(t,r){return _C(t,r,this)},n.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var c=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var l=new Array(i);for(s=0;s<l.length;s++)c[r]=s,l[s]=this.slice(t,c,u).reshape(o);return l},n.prototype.avgPool3d=function(t,r){var i=new Zh(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},n.prototype.avgPool3dBackprop=function(t,r,i){var o=new GA(i);return this.compileAndRun(o,[t],r.dtype)},n.prototype.maxPool3d=function(t,r){var i=new Zh(r,"max",!1);return this.compileAndRun(i,[t],"float32")},n.prototype.maxPool3dBackprop=function(t,r,i,o){var a=new Zh(o,"max",!0),s=this.compileAndRun(a,[r]),c=new GN(o),u=this.compileAndRun(c,[t,s],r.dtype);return s.dispose(),u},n.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!Ul(t.shape,r)&&(i.texture===null||!Ul(i.shape,r))){var o=this.packedReshape(t,r);return O.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return Xg(t,r)},n.prototype.resizeBilinear=function(t,r,i,o){var a=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new n3(t.shape,r,i,o):new t3(t.shape,r,i,o);return this.compileAndRun(a,[t],"float32")},n.prototype.resizeBilinearBackprop=function(t,r,i){var o=new e3(t,r,i);return this.compileAndRun(o,[t])},n.prototype.resizeNearestNeighbor=function(t,r,i,o){var a=new i3(t.shape,r,i,o);return this.compileAndRun(a,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new r3(t,r,i);return this.compileAndRun(o,[t])},n.prototype.multinomial=function(t,r,i,o){var a=r?t:go(t),s=a.shape[0],c=a.shape[1],u=new qN(s,c,i),l=u.getCustomSetupFunc(o);return this.compileAndRun(u,[a],"int32",l)},n.prototype.oneHot=function(t,r,i,o){var a=new KN(t.size,r,i,o);return this.compileAndRun(a,[t])},n.prototype.diag=function(t){var r=new hN(t.size);return this.compileAndRun(r,[t])},n.prototype.nonMaxSuppression=function(t,r,i,o,a){return hp("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Dy(t.dataSync(),r.dataSync(),i,o,a)},n.prototype.cropAndResize=function(t,r,i,o,a,s){var c=new uN(t.shape,r.shape,o,a,s);return this.compileAndRun(c,[t,r,i],"float32")},n.prototype.depthToSpace=function(t,r,i){A(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],c=i==="NHWC"?t.shape[3]:t.shape[1],u=a*r,l=s*r,d=c/(r*r),p=new fN(i==="NHWC"?[o,u,l,d]:[o,d,u,l],r,i);return this.compileAndRun(p,[t])},n.prototype.split=function(t,r,i){return RC(t,r,i)},n.prototype.scatterND=function(t,r,i){var o=bp(0,t,i),a=o.sliceRank,s=o.numUpdates,c=o.sliceSize,u=o.strides,l=o.outputSize,d=[l/c,c],p=t.reshape([s,a]),f=r.reshape([s,c]);if(l===0)return Xg(mn([]),i);var m=re(0),g=new q1(s,a,p.rank,f.rank,u,d);return this.compileAndRun(g,[f,p,m]).reshape(i)},n.prototype.sparseToDense=function(t,r,i,o){var a=bp(0,t,i),s=a.sliceRank,c=a.numUpdates,u=a.strides,l=a.outputSize,d=new q1(c,s,t.rank,r.rank,u,[l,1]);return this.compileAndRun(d,[r,t,o]).reshape(i)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new H1(wN,t.shape,r),a=new H1(bN,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],c=this.compileAndRun(o,s),u=this.compileAndRun(a,s),l=this.complex(c,u).as2D(t.shape[0],t.shape[1]);return c.dispose(),u.dispose(),l},n.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=mC(t,r),s=a[0],c=a[1],u=a[2],l=a[3],d=r.reshape([c,o]),p=t.reshape([t.size/u,u]),f=new SN(o,l,[c,u]);return this.compileAndRun(f,[p,d]).reshape(s)},n.prototype.fill=function(t,r,i){if((i=i||Ju(r))==="string"){var o=lp(i,he(t));return o.fill(r),O.makeTensor(o,t,i,this)}var a=new xN(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],i,s)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.linspace=function(t,r,i){return SC(t,r,i)},n.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},n.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return O.makeTensorFromDataId(i,t,r,this)},n.prototype.unpackTensor=function(t){var r=new E3(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},n.prototype.packTensor=function(t){var r=new XN(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},n.prototype.packedReshape=function(t,r){var i=[pp(t.shape)].concat(fp(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[pp(r)].concat(fp(r)),s=new ZN(a,i),c=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}},n.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,c=qh(a);return r=o?new pN(c):new dN(c),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:c,dtype:s,dataId:t}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(t,r,i,o,a){var s=this;a===void 0&&(a=!1);var c=this.makeTensorInfo(t.outputShape,i),u=this.texData.get(c.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Uu.DENSE){var l=vu(t.outputShape);u.texShape=l.map(function(y){return 2*y})}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),he(c.shape)===0)return u.values=ju(c.dtype,0),c;var d=[],p=r.map(function(y){if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=s.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&he(y.shape)<=K().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}else if(!!b.isPacked!=!!t.packedInputs)y=b.isPacked?s.unpackTensor(y):s.packTensor(y),d.push(y),b=s.texData.get(y.dataId);else if(b.isPacked&&!Ul(b.shape,y.shape)){var x=y,_=y.shape;y.shape=b.shape,y=s.packedReshape(y,_),d.push(y),b=s.texData.get(y.dataId),x.shape=_}return s.uploadToGPU(y.dataId),{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(c.dataId);var f,m={shape:c.shape,texData:u,isUniform:!1},g=function(y,b,x){var _="";b.concat(x).forEach(function(S){var E=S.texData!=null&&S.texData.slice!=null&&S.texData.slice.flatOffset>0,T=S.isUniform?"uniform":S.texData.texShape;_+=S.shape+"_"+T+"_"+E});var C=y.userCode,R=y.constructor.name;return R+="_"+_+"_"+C}(t,p,m),v=this.getAndSaveBinary(g,function(){return function(y,b,x,_){var C=b.userCode,R=x.map(function(L,$){var k={logicalShape:L.shape,texShape:L.isUniform?null:L.texData.texShape,isUniform:L.isUniform,isPacked:!L.isUniform&&L.texData.isPacked,flatOffset:null};return L.texData!=null&&L.texData.slice!=null&&L.texData.slice.flatOffset>0&&(k.flatOffset=L.texData.slice.flatOffset),{name:b.variableNames[$],shapeInfo:k}}),S=R.map(function(L){return L.shapeInfo}),E={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},T=zA(R,E,C,b.packedInputs),I=y.createProgram(T),F=null,z=y.getUniformLocation(I,"NAN",!1);K().getNumber("WEBGL_VERSION")===1&&(F=y.getUniformLocation(I,"INFINITY",!1));for(var j={},H=0;H<b.variableNames.length;H++){var W=b.variableNames[H];j[W]=y.getUniformLocation(I,W,!1),j["offset"+W]=y.getUniformLocation(I,"offset"+W,!1)}return{program:b,source:T,webGLProgram:I,uniformLocations:j,inShapeInfos:S,outShapeInfo:E,infLoc:F,nanLoc:z}}(s.gpgpu,t,p,m)}),h=this.activeTimers!=null;if(h&&(f=this.startTimer()),function(y,b,x,_,C){G1(b.inShapeInfos,x),G1([b.outShapeInfo],[_]);var R=_.texData.texture,S=_.texData.texShape;_.texData.isPacked?y.setOutputPackedMatrixTexture(R,S[0],S[1]):y.setOutputMatrixTexture(R,S[0],S[1]),y.setProgram(b.webGLProgram),K().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&y.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&y.gl.uniform1f(b.nanLoc,NaN),x.forEach(function(E,T){var I=b.program.variableNames[T],F=b.uniformLocations[I],z=b.uniformLocations["offset"+I];if(F!=null)if(E.isUniform)if(he(E.shape)<2)y.gl.uniform1f(F,E.uniformValues[0]);else{var j=E.uniformValues;j instanceof Float32Array||(j=new Float32Array(j)),y.gl.uniform1fv(F,j)}else E.texData.slice!=null&&z!=null&&y.gl.uniform1i(z,E.texData.slice.flatOffset),y.setInputMatrixTexture(E.texData.texture,F,T)}),C!=null&&C(y,b.webGLProgram),y.executeProgram()}(this.gpgpu,v,p,m,o),d.forEach(function(y){return s.disposeData(y.dataId)}),h&&(f=this.endTimer(f),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(f)})),!K().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&a===!1){var w=this.unpackTensor(c);return this.disposeData(c.dataId),w}return c},n.prototype.compileAndRun=function(t,r,i,o,a){a===void 0&&(a=!1),i=i||r[0].dtype;var s=this.runWebGLProgram(t,r,i,o,a);return O.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var t=this;this.disposed||(K().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ie(function(){if(!K().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=K().getBool("DEBUG");K().set("DEBUG",!1);var i=t.abs(re(1e-8)).dataSync()[0];if(K().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,c=i.texture,u=i.usage,l=i.isPacked;if(c==null){var d,p=this.activeTimers!=null;p&&(d=_i());var f=i.texShape;if(f==null&&(f=LP(o,l),i.texShape=f),s!=null){var m=qh(o),g=void 0,v=f[1],h=f[0],w=s instanceof Uint8Array;l?(v=(r=el(f[0],f[1]))[0],h=r[1],g=new yN(m,[h,v],w)):g=new vN(m,[h,v],w);var y=this.makeTensorInfo([h,v],a);this.texData.get(y.dataId).usage=w?gr.PIXELS:gr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),v,h,s);var b=this.runWebGLProgram(g,[y],a,null,!0),x=this.texData.get(b.dataId);i.texture=x.texture,i.texShape=x.texShape,i.isPacked=x.isPacked,i.usage=x.usage,this.disposeData(y.dataId),this.texData.delete(b.dataId),i.values=null,p&&(this.uploadWaitMs+=_i()-d)}else{var _=this.acquireTexture(f,u,a,l);i.texture=_}}},n.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var c=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),u=0;u<c.length;++u)c[u]=Math.round(a[u]);return c}throw new Error("Unknown dtype "+s)}(r,o)),i.values},n.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},n.prototype.computeBytes=function(t,r){return t[0]*t[1]*Y2(r)},n}(bC);iC()&&O.registerBackend("webgl",function(){return new D3},2);var I3=M({square_:function(e){var n=D(e,"x","square"),t=[n];return O.runKernelFunc(function(r,i){return i([n]),r.square(n)},{x:n},null,"Square",{},t,[])}}),Vu="SquaredDifference",zC=M({squaredDifference_:function(e,n){var t,r=D(e,"a","squaredDifference"),i=D(n,"b","squaredDifference");t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return O.runKernelFunc(function(s,c){var u=s.squaredDifference(r,i);return c([r,i]),u},o,function(s,c){var u=c[0],l=c[1],d=re(2);return{a:function(){return s.mul(u.sub(l).mul(d))},b:function(){return s.mul(l.sub(u).mul(d))}}},Vu,{},a,[])}}),P3=M({abs_:function(e){var n=D(e,"x","abs");return n.dtype==="complex64"?O.runKernelFunc(function(t){return t.complexAbs(n)},{$x:n}):O.runKernelFunc(function(t,r){var i=t.abs(n);return r([n]),i},{x:n},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),A3=M({acos_:function(e){var n=D(e,"x","acos");return O.runKernelFunc(function(t,r){var i=t.acos(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),N3=M({acosh_:function(e){var n=D(e,"x","acosh");return O.runKernelFunc(function(t,r){var i=t.acosh(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),M3=M({asin_:function(e){var n=D(e,"x","asin");return O.runKernelFunc(function(t,r){var i=t.asin(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).sub(i.toFloat().square()).sqrt())}}})}}),L3=M({asinh_:function(e){var n=D(e,"x","asinh");return O.runKernelFunc(function(t,r){var i=t.asinh(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(re(1).add(i.toFloat().square()).sqrt())}}})}}),O3=M({atan_:function(e){var n=D(e,"x","atan");return O.runKernelFunc(function(t,r){var i=t.atan(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),F3=M({atanh_:function(e){var n=D(e,"x","atanh");return O.runKernelFunc(function(t,r){var i=t.atanh(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(re(1).sub(i.toFloat().square()))}}})}}),B3=M({ceil_:function(e){var n=D(e,"x","ceil");return O.runKernelFunc(function(t){return t.ceil(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),Ly=M({clipByValue_:function(e,n,t){var r=D(e,"x","clipByValue");A(n<=t,function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+t+")."});var i=[r],o={min:n,max:t};return O.runKernelFunc(function(a,s){var c=a.clip(r,n,t);return s([r]),c},{x:r},function(a,s){var c=s[0];return{x:function(){return a.where(c.greaterEqual(n).logicalAnd(c.lessEqual(t)),Ke(a))}}},"ClipByValue",o,i)}}),z3=M({cos_:function(e){var n=D(e,"x","cos"),t=[n];return O.runKernelFunc(function(r,i){var o=r.cos(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),j3=M({cosh_:function(e){var n=D(e,"x","cosh");return O.runKernelFunc(function(t,r){var i=t.cosh(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),$3=M({erf_:function(e){var n=D(e,"x","erf");return A(n.dtype==="int32"||n.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),n.dtype==="int32"&&(n=n.toFloat()),O.runKernelFunc(function(t,r){var i=t.erf(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Yg=M({exp_:function(e){var n=D(e,"x","exp");return O.runKernelFunc(function(t,r){var i=t.exp(n);return r([i]),i},{x:n},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),U3=M({expm1_:function(e){var n=D(e,"x","expm1");return O.runKernelFunc(function(t,r){var i=t.expm1(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),W3=M({floor_:function(e){var n=D(e,"x","floor");return O.runKernelFunc(function(t){return t.floor(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),V3=M({log_:function(e){var n=D(e,"x","log"),t=[n];return O.runKernelFunc(function(r,i){var o=r.log(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},t)}}),H3=M({log1p_:function(e){var n=D(e,"x","log1p");return O.runKernelFunc(function(t,r){var i=t.log1p(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),G3=M({logSigmoid_:function(e){var n=D(e,"x","logSigmoid");return O.runKernelFunc(function(t,r){var i=t.softplus(n.neg()).neg();return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),Cp=M({neg_:function(e){var n=D(e,"x","neg"),t=[n];return O.runKernelFunc(function(r){return r.neg(n)},{x:n},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),q3=M({reciprocal_:function(e){var n=D(e,"x","reciprocal");return O.runKernelFunc(function(t,r){var i=t.reciprocal(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),K3=M({round_:function(e){var n=D(e,"x","round");return O.runKernelFunc(function(t){return t.round(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),jC=M({rsqrt_:function(e){var n=D(e,"x","rsqrt"),t=[n];return O.runKernelFunc(function(r,i){var o=r.rsqrt(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),$C=M({sigmoid_:function(e){var n=D(e,"x","sigmoid");return O.runKernelFunc(function(t,r){var i=t.sigmoid(n);return r([i]),i},{x:n},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(re(1).sub(i)))}}},"Sigmoid")}}),X3=M({sign_:function(e){var n=D(e,"x","sign");return O.runKernelFunc(function(t){return t.sign(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),Q3=M({isNaN_:function(e){var n=D(e,"x","isNaN");return O.runKernelFunc(function(t){return t.isNaN(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),Y3=M({isInf_:function(e){var n=D(e,"x","isInf");return O.runKernelFunc(function(t){return t.isInf(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),J3=M({isFinite_:function(e){var n=D(e,"x","isFinite");return O.runKernelFunc(function(t){return t.isFinite(n)},{$x:n},function(t){return{$x:function(){return Ke(t)}}})}}),Z3=M({sin_:function(e){var n=D(e,"x","sin"),t=[n];return O.runKernelFunc(function(r,i){var o=r.sin(n);return i([n]),o},{x:n},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},t)}}),eM=M({sinh_:function(e){var n=D(e,"x","sinh");return O.runKernelFunc(function(t,r){var i=t.sinh(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),tM=M({softplus_:function(e){var n=D(e,"x","softplus");return O.runKernelFunc(function(t,r){var i=t.softplus(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),nM=M({sqrt_:function(e){var n=D(e,"x","sqrt");return O.runKernelFunc(function(t,r){var i=t.sqrt(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),rM=M({step_:function(e,n){n===void 0&&(n=0);var t=D(e,"x","step");return O.runKernelFunc(function(r){return r.step(t,n)},{$x:t},function(r){return{$x:function(){return Ke(r)}}})}}),iM=M({tan_:function(e){var n=D(e,"x","tan");return O.runKernelFunc(function(t,r){var i=t.tan(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),oM=M({tanh_:function(e){var n=D(e,"x","tanh");return O.runKernelFunc(function(t,r){var i=t.tanh(n);return r([i]),i},{x:n},function(t,r){var i=r[0];return{x:function(){return re(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function UC(e,n,t,r,i,o){var a,s,c=D(e,"x","batchNorm"),u=D(n,"mean","batchNorm"),l=D(t,"variance","batchNorm");return i!=null&&(a=D(i,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),A(c.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),A(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+u.rank+"."}),A(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),a!=null&&A(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&A(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),nl(c,u,l,s,a,o)}function WC(e,n,t,r,i,o){var a,s,c=D(e,"x","batchNorm"),u=D(n,"mean","batchNorm"),l=D(t,"variance","batchNorm");return i!=null&&(a=D(i,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),A(c.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+c.rank+"."}),A(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+u.rank+"."}),A(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),a!=null&&A(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&A(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),nl(c,u,l,s,a,o)}function VC(e,n,t,r,i,o){var a,s,c=D(e,"x","batchNorm"),u=D(n,"mean","batchNorm"),l=D(t,"variance","batchNorm");return i!=null&&(a=D(i,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),A(c.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+c.rank+"."}),A(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+u.rank+"."}),A(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),a!=null&&A(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&A(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),nl(c,u,l,s,a,o)}function nl(e,n,t,r,i,o){o==null&&(o=.001);var a,s,c,u=D(e,"x","batchNorm"),l=D(n,"mean","batchNorm"),d=D(t,"variance","batchNorm");i!=null&&(a=D(i,"scale","batchNorm")),r!=null&&(s=D(r,"offset","batchNorm")),A(l.rank===d.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),A(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),A(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),c=u.rank===0||u.rank===1?u.as4D(1,1,1,u.size):u.rank===2?u.as4D(1,1,u.shape[0],u.shape[1]):u.rank===3?u.as4D(1,u.shape[0],u.shape[1],u.shape[2]):u;var p=[u,l,d,a];return O.runKernelFunc(function(f,m){var g=f.batchNormalization(c,ql(l),ql(d),o,ql(a),ql(s));return m([u,l,d,a]),g},{x:u,mean:l,variance:d,scale:a,offset:s},function(f,m){var g=m,v=g[0],h=g[1],w=g[2],y=g[3],b=y??re(1),x=Jt(h.shape,c.shape),_=[];if(h.rank===1){for(var C=0;C<c.shape.length-1;++C)_.push(c.shape[C]);_.push(1)}var R=v.sub(h),S=f.mul(b),E=jC(w.add(re(o))),T=E.mul(E).mul(E).mul(re(-.5));return{x:function(){return h.rank===1?f.mul(ec(E.as4D(1,1,1,h.shape[0]),_)).mul(b).reshape(v.shape):f.mul(E).mul(b).reshape(v.shape)},mean:function(){var I=E.mul(re(-1)).mul(S);return h.rank===1&&(I=I.sum(x)),I.reshape(h.shape)},variance:function(){var I=T.mul(R).mul(S);return h.rank===1&&(I=I.sum(x)),I.reshape(h.shape)},scale:function(){var I=R.mul(E),F=f.mul(I);return h.rank===1&&(F=F.sum(x)),F.reshape(h.shape)},offset:function(){var I=f;return h.rank===1&&(I=I.sum(x)),I.reshape(h.shape)}}},"BatchNormalization",{varianceEpsilon:o},p).reshape(u.shape)}function ql(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function Zp(){oC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var aM=M({batchNormalization2d_:function(e,n,t,r,i,o){return r===void 0&&(r=.001),Zp(),UC(e,n,t,o,i,r)}}),sM=M({batchNormalization3d_:function(e,n,t,r,i,o){return r===void 0&&(r=.001),Zp(),WC(e,n,t,o,i,r)}}),cM=M({batchNormalization4d_:function(e,n,t,r,i,o){return r===void 0&&(r=.001),Zp(),VC(e,n,t,o,i,r)}}),uM=M({batchNormalization_:function(e,n,t,r,i,o){return r===void 0&&(r=.001),Zp(),nl(e,n,t,o,i,r)}}),HC=M({batchNorm_:nl}),lM=M({batchNorm2d_:UC}),dM=M({batchNorm3d_:WC}),pM=M({batchNorm4d_:VC}),ef=M({logicalAnd_:function(e,n){var t=D(e,"a","logicalAnd","bool"),r=D(n,"b","logicalAnd","bool");return je(t.shape,r.shape),O.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),fM=M({logicalNot_:function(e){var n=D(e,"x","logicalNot","bool");return O.runKernelFunc(function(t){return t.logicalNot(n)},{$x:n})}}),GC=M({logicalOr_:function(e,n){var t=D(e,"a","logicalOr","bool"),r=D(n,"b","logicalOr","bool");return je(t.shape,r.shape),O.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),hM=M({logicalXor_:function(e,n){var t=D(e,"a","logicalXor","bool"),r=D(n,"b","logicalXor","bool");return je(t.shape,r.shape),GC(e,n).logicalAnd(ef(e,n).logicalNot())}}),za=M({where_:function(e,n,t){var r=D(n,"a","where"),i=D(t,"b","where"),o=D(e,"condition","where","bool");return ot(r.shape,i.shape,"Error in where: "),o.rank===1?A(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):ot(o.shape,i.shape,"Error in where: "),O.runKernelFunc(function(a,s){var c=a.select(o,r,i);return s([o]),c},{$condition:o,$a:r,$b:i},function(a,s){var c=s[0];return{$condition:function(){return Ke(c).toFloat()},$a:function(){return a.mul(c.cast(a.dtype))},$b:function(){return a.mul(c.logicalNot().cast(a.dtype))}}})}}),qC=function(e){return ue(this,void 0,void 0,function(){var n,t,r;return le(this,function(i){switch(i.label){case 0:return[4,(n=D(e,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Py(n.shape,t),e!==n&&n.dispose(),[2,r]}})})},ze=M({add_:function(e,n){var t,r=D(e,"a","add"),i=D(n,"b","add");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a){return a.add(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,c=Jt(r.shape,o);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)},b:function(){var s=a,c=Jt(i.shape,o);return c.length>0&&(s=s.sum(c)),s.reshape(i.shape)}}},"Add")}}),mM=M({addN_:function(e){A(Array.isArray(e),function(){return"The argument passed to tf.addN() must be a list of tensors"}),A(e.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length});var n=e.map(function(i,o){return D(i,"tensors"+o,"addN")}),t=n[0];n.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),n.forEach(function(i){if(!cn(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=n;return O.runKernelFunc(function(i){return i.addN(n)},r,function(i){var o={};return n.forEach(function(a,s){o[s]=function(){return i.clone()}}),o},"AddN")}}),gM=M({addStrict_:function(e,n){var t=D(e,"a","addStrict"),r=D(n,"b","addStrict");return ot(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),vM=M({atan2_:function(e,n){var t,r=D(e,"a","atan2"),i=D(n,"b","atan2");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a,s){var c=a.atan2(r,i);return s([r,i]),c},{$a:r,$b:i},function(a,s){var c=s[0],u=s[1];return{$a:function(){var l=ze(c.square(),u.square()),d=a.mul(u.div(l)),p=Jt(c.shape,o);return p.length>0&&(d=d.sum(p)),d.reshape(c.shape)},$b:function(){var l=ze(c.square(),u.square()),d=Cp(a.mul(c.div(l))),p=Jt(u.shape,o);return p.length>0&&(d=d.sum(p)),d.reshape(u.shape)}}})}}),Xr=M({div_:function(e,n){var t,r=D(e,"a","div"),i=D(n,"b","div");if(t=It(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return KC(r,i);var o=je(r.shape,i.shape);return O.runKernelFunc(function(a,s){var c=a.realDivide(r,i);return s([r,i]),c},{a:r,b:i},function(a,s){var c=s[0],u=s[1];return{a:function(){var l=a.div(u.toFloat()),d=Jt(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=a.mul(c.toFloat()),d=Jt(u.shape,o);d.length>0&&(l=l.sum(d).reshape(u.shape));var p=u.square();return l.div(p.toFloat()).neg()}}},"Div")}}),yM=M({divNoNan_:function(e,n){var t,r=D(e,"a","div"),i=D(n,"b","div");r=(t=It(r,i))[0],i=t[1];var o=Xr(r,i),a=Ke(o),s=i.equal(a);return za(s,a,o)}}),wM=M({divStrict_:function(e,n){var t=D(e,"a","div"),r=D(n,"b","div");return ot(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),KC=M({floorDiv_:function(e,n){var t,r=D(e,"a","floorDiv"),i=D(n,"b","floorDiv");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a,s){var c=a.floorDiv(r,i);return s([r,i]),c},{a:r,b:i},function(a,s){var c=s[0],u=s[1];return{a:function(){var l=a.div(u.toFloat()),d=Jt(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=a.mul(c.toFloat()),d=Jt(u.shape,o);d.length>0&&(l=l.sum(d).reshape(u.shape));var p=u.square();return l.div(p.toFloat()).neg()}}},"FloorDiv")}}),Oy=M({maximum_:function(e,n){var t,r=D(e,"a","maximum"),i=D(n,"b","maximum");return t=It(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),je(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],c=a[1];return{a:function(){return o.mul(s.greaterEqual(c).toFloat())},b:function(){return o.mul(s.less(c).toFloat())}}},"Maximum")}}),bM=M({maximumStrict_:function(e,n){var t=D(e,"a","maximumStrict"),r=D(n,"b","maximumStrict");return ot(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),XC=M({minimum_:function(e,n){var t,r=D(e,"a","minimum"),i=D(n,"b","minimum");return t=It(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),je(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],c=a[1];return{a:function(){return o.mul(s.lessEqual(c).toFloat())},b:function(){return o.mul(s.greater(c).toFloat())}}},"Minimum")}}),xM=M({minimumStrict_:function(e,n){var t=D(e,"a","minimumStrict"),r=D(n,"b","minimumStrict");return ot(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),_M=M({mod_:function(e,n){var t,r=D(e,"a","mod"),i=D(n,"b","mod");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a,s){var c=a.mod(r,i);return s([r,i]),c},{$a:r,$b:i},function(a,s){var c=s[0],u=s[1];return{$a:function(){var l=Jt(c.shape,o);return l.length>0?a.sum(l).reshape(c.shape):a},$b:function(){var l=a.mul(c.div(u).floor().neg()),d=Jt(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l}}})}}),SM=M({modStrict_:function(e,n){var t=D(e,"a","modStrict"),r=D(n,"b","modStrict");return ot(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Mn=M({mul_:function(e,n){var t,r=D(e,"a","mul"),i=D(n,"b","mul");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a,s){var c=a.multiply(r,i);return s([r,i]),c},{a:r,b:i},function(a,s){var c=s[0],u=s[1];return{a:function(){var l=a.mul(u.toFloat()),d=Jt(c.shape,o);return d.length>0?l.sum(d).reshape(c.shape):l},b:function(){var l=a.mul(c.toFloat()),d=Jt(u.shape,o);return d.length>0?l.sum(d).reshape(u.shape):l}}},"Mul")}}),CM=M({mulStrict_:function(e,n){var t=D(e,"a","mul"),r=D(n,"b","mul");return ot(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Rp=M({pow_:function(e,n){var t,r=D(e,"base","pow"),i=D(n,"exp","pow");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape),a=[r,i];return O.runKernelFunc(function(s,c){var u=s.pow(r,i);return c([r,i,u]),u},{a:r,b:i},function(s,c){var u=c[0],l=c[1],d=c[2];return{a:function(){var p=l.toFloat(),f=s.mul(p.mul(u.pow(p.sub(re(1))))),m=Jt(u.shape,o);return m.length>0&&(f=f.sum(m)),f.reshape(u.shape)},b:function(){var p=u.greater(0),f=u.log().where(p,Ke(u)),m=s.mul(d.mul(f)),g=Jt(l.shape,o);return g.length>0&&(m=m.sum(g)),m.reshape(l.shape)}}},"Pow",{},a,[!0])}}),RM=M({powStrict_:function(e,n){return ot(e.shape,n.shape,"Error in powStrict: "),e.pow(n)}}),kM=M({squaredDifferenceStrict_:function(e,n){var t=D(e,"a","squaredDifferenceStrict"),r=D(n,"b","squaredDifferenceStrict");return ot(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Zt=M({sub_:function(e,n){var t,r=D(e,"a","sub"),i=D(n,"b","sub");t=It(r,i),r=t[0],i=t[1];var o=je(r.shape,i.shape);return O.runKernelFunc(function(a){return a.subtract(r,i)},{a:r,b:i},function(a){return{a:function(){var s=a,c=Jt(r.shape,o);return c.length>0&&(s=s.sum(c)),s.reshape(r.shape)},b:function(){var s=a,c=Jt(i.shape,o);return c.length>0&&(s=s.sum(c)),s.neg().reshape(i.shape)}}},"Sub")}}),EM=M({subStrict_:function(e,n){var t=D(e,"a","subStrict"),r=D(n,"b","subStrict");return ot(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),QC=M({equal_:function(e,n){var t,r=D(e,"a","equal"),i=D(n,"b","equal");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),TM=M({equalStrict_:function(e,n){var t=D(e,"a","equalStrict"),r=D(n,"b","equalStrict");return ot(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),DM=M({greater_:function(e,n){var t,r=D(e,"a","greater"),i=D(n,"b","greater");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),YC=M({greaterEqual_:function(e,n){var t,r=D(e,"a","greaterEqual"),i=D(n,"b","greaterEqual");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{a:r,b:i},function(o,a){var s=a[0],c=a[1];return{a:function(){return Ke(s)},b:function(){return Ke(c)}}},"GreaterEqual")}}),IM=M({greaterEqualStrict_:function(e,n){var t=D(e,"a","greaterEqualStrict"),r=D(n,"b","greaterEqualStrict");return ot(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),PM=M({greaterStrict_:function(e,n){var t=D(e,"a","greaterStrict"),r=D(n,"b","greaterStrict");return ot(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),AM=M({less_:function(e,n){var t,r=D(e,"a","less"),i=D(n,"b","less");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),NM=M({lessEqual_:function(e,n){var t,r=D(e,"a","lessEqual"),i=D(n,"b","lessEqual");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o,a){var s=o.lessEqual(r,i);return a([r,i]),s},{a:r,b:i},null,"LessEqual")}}),MM=M({lessEqualStrict_:function(e,n){var t=D(e,"a","lessEqualStrict"),r=D(n,"b","lessEqualStrict");return ot(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),LM=M({lessStrict_:function(e,n){var t=D(e,"a","lessStrict"),r=D(n,"b","lessStrict");return ot(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),OM=M({notEqual_:function(e,n){var t,r=D(e,"a","notEqual"),i=D(n,"b","notEqual");return t=It(r,i),r=t[0],i=t[1],je(r.shape,i.shape),O.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),FM=M({notEqualStrict_:function(e,n){var t=D(e,"a","notEqualStrict"),r=D(n,"b","notEqualStrict");return ot(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function nb(e,n){for(var t=[],r=e;r<n;++r)t.push(r);return t}function rb(e){for(var n=[],t=0;t<e.length;++t)for(var r=0;r<e[t].length;++r)n.push(e[t][r]);return n}var Fy=M({gather_:function(e,n,t){t===void 0&&(t=0);var r=D(e,"x","gather"),i=D(n,"indices","gather","int32");t=en(t,r.shape)[0];var o=function(a,s,c){for(var u=a.shape[c],l=[],d=1,p=1,f=0;f<c;f++)l.push(a.shape[f]),d*=a.shape[f];for(f=0;f<s.rank;f++)l.push(s.shape[f]);for(f=c+1;f<a.rank;f++)l.push(a.shape[f]),p*=a.shape[f];return{batchSize:d,sliceSize:p,dimSize:u,outputShape:l}}(r,i,t);return O.runKernelFunc(function(a,s){var c=a.gather(r,i.flatten(),t);return s([i]),c},{x:r,indices:i},function(a,s){var c=s[0];return{x:function(){var u=r.shape,l=c.size,d=u.slice(0,t),p=d.length,f=u.slice(t,u.length).slice(1),m=f.length,g=nb(0,p),v=nb(p+1,p+1+m),h=rb([d,[l],f]),w=a.reshape(h),y=c.reshape([l]),b=rb([[p],g,v]),x=w.transpose(b),_=JC(x,y,r.shape[t]),C=Sy(b);return _=_.transpose(C)},indices:function(){return c}}},"Gather",{axis:t}).reshape(o.outputShape)}}),JC=M({unsortedSegmentSum_:function(e,n,t){var r=D(e,"x","unsortedSegmentSum"),i=D(n,"segmentIds","unsortedSegmentSum","int32");return A(zt(t),function(){return"numSegments must be of dtype int"}),O.runKernelFunc(function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return function(c,u){for(var l=Oy(u,Ke(u)),d=Fy(c,l),p=YC(u,re(0,"int32")),f=d.rank-p.rank,m=0;m<f;++m)p=Ir(p,m+1);p=ef(p,Ec(d.shape,"bool"));var g=Ke(d);return za(p,d,g)}(o,s)}}})}}),BM=function(e,n,t){return ue(this,void 0,void 0,function(){var r,i,o,a,s,c,u,l,d,p,f,m,g;return le(this,function(v){switch(v.label){case 0:for(r=D(e,"tensor","boolMask"),i=D(n,"mask","boolMask","bool"),o=t??0,a=i.rank,s=r.shape,A(a>0,function(){return"mask cannot be scalar"}),ot(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,u=o;u<o+a;u++)c*=s[u];return l=s.slice(0,o).concat([c],s.slice(o+a)),d=r.reshape(l),p=i.reshape([-1]),[4,qC(p)];case 1:return f=v.sent(),m=f.squeeze([1]),g=Fy(d,m,o),e!==r&&r.dispose(),n!==i&&i.dispose(),m.dispose(),d.dispose(),p.dispose(),f.dispose(),[2,g]}})})};function ZC(e,n,t,r,i,o,a){o===void 0&&(o="NHWC"),A(e.length===n.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"});var s=e,c=n,u=!1;n.rank===3&&(u=!0,c=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,e[0],e[1],e[2]]),A(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),A(c.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank}),A(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var l=o==="NHWC"?s[3]:s[1],d=o==="NHWC"?c.shape[3]:c.shape[1];A(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),A(d===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+d+") must match output depth for filter "+t.shape[3]+"."}),a!=null&&A(zt(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var p=Ty(o),f=qa(s,t.shape,r,1,i,a,!1,p),m=O.runKernelFunc(function(g,v){var h=g.conv2dDerInput(c,t,f);return v([t,c]),h},{dy4D:c,filter:t},function(g,v){var h=v[0],w=v[1];return{dy4D:function(){return zr(g,h,r,i,o,1,a)},filter:function(){return By(g,w,h.shape,r,i,o,a)}}});return u?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function tm(e){var n=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(e),t=n[0],r=n[1],i=n[2];return t===1&&r===1&&i===1}function eR(e,n,t,r,i){A(e.length===n.rank,function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"});var o=e,a=n,s=!1;n.rank===4&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),o=[1,e[0],e[1],e[2],e[3]]);var c=o[4],u=a.shape[4];A(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),A(a.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),A(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),A(c===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[3]+"."}),A(u===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+u+") must match output depth for filter "+t.shape[4]+"."});var l=_p(o,t.shape,r,1,i),d=O.runKernelFunc(function(p){return p.conv3dDerInput(a,t,l)},{dy5D:a});return s?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}var zM=M({conv1d_:function(e,n,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=D(e,"x","conv1d"),c=D(n,"filter","conv1d"),u=s,l=!1;s.rank===2&&(l=!0,u=s.as3D(1,s.shape[0],s.shape[1])),A(u.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+u.rank+"."}),A(c.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+c.rank+"."}),a!=null&&A(zt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),A(u.shape[2]===c.shape[1],function(){return"Error in conv1d: depth of input ("+u.shape[2]+") must match input depth for filter "+c.shape[1]+"."}),A(sr(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),A(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var d=c.as4D(1,c.shape[0],c.shape[1],c.shape[2]),p=u.as4D(u.shape[0],1,u.shape[1],u.shape[2]),f=zr(p,d,[1,t],r,"NHWC",[1,o],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),zr=M({conv2d_:function(e,n,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=D(e,"x","conv2d"),c=D(n,"filter","conv2d"),u=s,l=!1;s.rank===3&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(u.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+u.rank+"."}),A(c.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."}),a!=null&&A(zt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=i==="NHWC"?u.shape[3]:u.shape[1];A(d===c.shape[2],function(){return"Error in conv2d: depth of input ("+d+") must match input depth for filter "+c.shape[2]+"."}),A(sr(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var p=Ty(i),f=qa(u.shape,c.shape,t,o,r,a,!1,p),m=[c,u],g=O.runKernelFunc(function(v,h){var w=v.conv2d(u,c,f);return h([c,u]),w},{x:u,filter:c},function(v,h){var w=h,y=w[0],b=w[1];return A(xc(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return tR(b.shape,v,y,t,r,i)},filter:function(){return By(b,v,y.shape,t,r,i)}}},"Conv2D",f,m);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),jM=M({conv3d_:function(e,n,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=D(e,"x","conv3d"),s=D(n,"filter","conv3d"),c=a,u=!1;a.rank===4&&(u=!0,c=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),A(c.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),A(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),A(c.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),A(function(p,f){return tm(p)||tm(f)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),A(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var l=_p(c.shape,s.shape,t,o,r),d=O.runKernelFunc(function(p,f){var m=p.conv3d(c,s,l);return f([c,s]),m},{x:c,$filter:s},function(p,f){A(tm(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var m=f[0],g=f[1];return{x:function(){return eR(m.shape,p,g,t,r)},$filter:function(){return function(v,h,w,y,b){var x=v;v.rank===4&&(x=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var _=h;_.rank===4&&(_=h.as5D(1,h.shape[0],h.shape[1],h.shape[2],h.shape[3])),A(x.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+x.shape+"."}),A(_.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."}),A(w.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+w+"."}),A(x.shape[4]===w[3],function(){return"Error in conv3dDerFilter: depth of input "+x.shape[4]+") must match input depth in filter ("+w[3]+"."}),A(_.shape[4]===w[4],function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+w[4]+")."});var C=_p(x.shape,w,y,1,b);return O.runKernelFunc(function(R){return R.conv3dDerFilter(x,_,C)},{x5D:x,dy5D:_})}(m,p,g.shape,t,r)}}});return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),By=M({conv2dDerFilter_:function(e,n,t,r,i,o,a){o===void 0&&(o="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var c=n;c.rank===3&&(c=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),A(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),A(c.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."}),A(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var u=o==="NHWC"?s.shape[3]:s.shape[1],l=o==="NHWC"?c.shape[3]:c.shape[1];A(u===t[2],function(){return"Error in conv2dDerFilter: depth of input "+u+") must match input depth in filter ("+t[2]+"."}),A(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."}),a!=null&&A(zt(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=Ty(o),p=qa(s.shape,t,r,1,i,a,!1,d);return O.runKernelFunc(function(f){return f.conv2dDerFilter(s,c,p)},{x4D:s,dy4D:c})}}),tR=M({conv2dDerInput_:ZC}),tf=M({depthwiseConv2d_:function(e,n,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=D(e,"x","depthwiseConv2d"),c=D(n,"filter","depthwiseConv2d"),u=s,l=!1;s.rank===3&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(u.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+u.rank+"."}),A(c.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."}),A(u.shape[3]===c.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+u.shape[3]+") must match the inChannels dimension in filter "+c.shape[2]+"."}),o==null&&(o=[1,1]),A(sr(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&A(zt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var d=qa(u.shape,c.shape,t,o,r,a,!0),p=[u,c],f=O.runKernelFunc(function(m,g){var v=m.depthwiseConv2D(u,c,d);return g([u,c]),v},{x:u,filter:c},function(m,g){A(xc(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var v=g[0],h=g[1];return{x:function(){return nR(v.shape,m,h,d)},filter:function(){return rR(v,m,h.shape,d)}}},"DepthwiseConv2dNative",d,p);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),nR=M({depthwiseConv2dDerInput_:function(e,n,t,r){var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=O.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),rR=M({depthwiseConv2dDerFilter_:function(e,n,t,r){var i=e;e.rank===3&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=n;return o.rank===3&&(o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),O.runKernelFunc(function(a){return a.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),zy=M({separableConv2d_:function(e,n,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=D(e,"x","separableConv2d"),c=D(n,"depthwiseFilter","separableConv2d"),u=D(t,"pointwiseFilter","separableConv2d"),l=s,d=!1;if(s.rank===3&&(d=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),A(c.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+c.rank+"."}),A(u.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+c.rank+"."}),A(u.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+u.shape[0]+"."}),A(u.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+u.shape[1]+"."});var p=c.shape[2],f=c.shape[3];A(u.shape[2]===p*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+p*f+", but got "+u.shape[2]+"."});var m=tf(l,c,r,i,a,o),g=zr(m,u,1,"valid",a);return d?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),$M=M({conv2dTranspose_:function(e,n,t,r,i,o){return ZC(t,D(e,"x","conv2dTranspose"),D(n,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),UM=M({conv3dTranspose_:function(e,n,t,r,i){return eR(t,D(e,"x","conv3dTranspose"),D(n,"filter","conv3dTranspose"),r,i)}}),nf=M({matMul_:function(e,n,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=D(e,"a","matMul"),a=D(n,"b","matMul");i=It(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],c=r?a.shape[a.rank-1]:a.shape[a.rank-2],u=t?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],d=o.shape.slice(0,-2),p=a.shape.slice(0,-2),f=he(d),m=he(p);A(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),A(cn(d,p),function(){return"Error in matMul: outer dimensions ("+d+") and ("+p+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),A(s===c,function(){return"Error in matMul: inner shapes ("+s+") and ("+c+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var g=o.shape.slice(0,-2).concat([u,l]),v=t?o.as3D(f,s,u):o.as3D(f,u,s),h=r?a.as3D(m,l,c):a.as3D(m,c,l),w={transposeA:t,transposeB:r};return O.runKernelFunc(function(y,b){var x=y.batchMatMul(v,h,t,r);return b([v,h]),x},{a:v,b:h},function(y,b){var x=b,_=x[0],C=x[1];return t||r?!t&&r?{a:function(){return y.matMul(C,!1,!1)},b:function(){return y.matMul(_,!0,!1)}}:t&&!r?{a:function(){return C.matMul(y,!1,!0)},b:function(){return _.matMul(y,!1,!1)}}:{a:function(){return C.matMul(y,!0,!0)},b:function(){return y.matMul(_,!0,!0)}}:{a:function(){return y.matMul(C,!1,!0)},b:function(){return _.matMul(y,!0,!1)}}},"BatchMatMul",w).reshape(g)}}),WM=M({dot_:function(e,n){var t=D(e,"t1","dot"),r=D(n,"t2","dot");A(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return A(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),VM=M({outerProduct_:function(e,n){var t=D(e,"v1","outerProduct"),r=D(n,"v2","outerProduct");return A(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),rl=M({reverse_:function(e,n){var t=D(e,"x","reverse");if(t.rank===0)return t.clone();var r=en(n,t.shape);return O.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),HM=M({reverse1d_:function(e){var n=D(e,"x","reverse");return A(n.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."}),rl(n,0)}}),GM=M({reverse2d_:function(e,n){var t=D(e,"x","reverse");return A(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),rl(t,n)}}),qM=M({reverse3d_:function(e,n){var t=D(e,"x","reverse");return A(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),rl(t,n)}}),KM=M({reverse4d_:function(e,n){var t=D(e,"x","reverse");return A(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),rl(t,n)}});function iR(e,n,t,r,i,o){var a=D(e,"x","maxPool"),s=a,c=!1;a.rank===3&&(c=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),A(sr(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&A(zt(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=Wu(s.shape,n,t,r,i,o);if(u.filterWidth===1&&u.filterHeight===1&&cn(u.inShape,u.outShape))return a.clone();var l=[s],d=O.runKernelFunc(function(p,f){var m=p.maxPool(s,u);return f([s,m]),m},{x:s},function(p,f){var m=f[0],g=f[1];return{x:function(){return function(v,h,w,y,b,x,_,C){var R=D(v,"dy","maxPoolBackprop"),S=D(h,"input","maxPoolBackprop"),E=D(w,"output","maxPoolBackprop");A(S.rank===R.rank,function(){return"Rank of input ("+S.rank+") does not match rank of dy ("+R.rank+")"}),A(sr(b,x),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+x+"'"}),A(R.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."}),A(S.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+S.rank+"."});var T=Wu(S.shape,y,b,x,_,C);return O.runKernelFunc(function(I){return I.maxPoolBackprop(R,S,E,T)},{$dy:R,$input:S})}(p,m,g,n,t,r,i)}}},"MaxPool",u,l);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}function oR(e,n,t,r,i,o){var a=D(e,"x","avgPool","float32");A(sr(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,c=!1;a.rank===3&&(c=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&A(zt(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=Wu(s.shape,n,t,r,i,o);if(u.filterWidth===1&&u.filterHeight===1&&cn(u.inShape,u.outShape))return a.clone();var l=O.runKernelFunc(function(d){return d.avgPool(s,u)},{x:s},function(d){return{x:function(){return function(p,f,m,g,v,h){var w=D(p,"dy","avgPoolBackprop"),y=D(f,"input","avgPoolBackprop");A(y.rank===w.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+w.rank+")"}),A(sr(g,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+v+"'"});var b=y,x=w,_=!1;y.rank===3&&(_=!0,b=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),x=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),A(x.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+x.rank+"."}),A(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var C=Wu(b.shape,m,g,v,h),R=O.runKernelFunc(function(S){return S.avgPoolBackprop(x,b,C)},{dy4D:x,input4D:b});return _?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}(d,s,n,t,r,i)}}},"AvgPool",u);return l=l.cast(a.dtype),c?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var rn=M({maxPool_:function(e,n,t,r,i){return iR(e,n,t,1,r,i)}}),il=M({avgPool_:function(e,n,t,r,i){return oR(e,n,t,1,r,i)}}),XM=M({pool_:function(e,n,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=D(e,"x","maxPool"),s=a,c=!1;a.rank===3&&(c=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),A(sr(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var u,l=Wu(s.shape,n,o,i,r),d=[l.dilationHeight,l.dilationWidth];u=r==="same"?function(b,x){var _=b.map(function(S,E){return S+(S-1)*(x[E]-1)}).map(function(S){return S-1}),C=_.map(function(S){return Math.floor(S/2)}),R=_.map(function(S,E){return S-C[E]});return _.map(function(S,E){return[C[E],R[E]]})}([l.filterHeight,l.filterWidth],d):[[0,0],[0,0]];var p=d[0]===1&&d[1]===1,f=function(b,x,_){var C=_.map(function(z){return z[0]}),R=_.map(function(z){return z[1]}),S=b.concat(C,R),E=x.map(function(z,j){return(z-S[j]%z)%z}),T=R.map(function(z,j){return z+E[j]}),I=x.map(function(z,j){return[C[j],T[j]]}),F=x.map(function(z,j){return[0,E[j]]});return[I,F]}([l.inHeight,l.inWidth],d,u),m=f[0],g=f[1],v=p?r:"valid",h=p?s:dC(s,d,m),w=(t==="avg"?function(){return oR(h,n,o,1,v)}:function(){return iR(h,n,o,1,v)})(),y=p?w:cC(w,d,g);return c?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),QM=M({maxPool3d_:function(e,n,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=D(e,"x","maxPool3d"),c=s,u=!1;s.rank===4&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),A(c.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+c.rank+"."}),A(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),A(sr(t,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&A(zt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=xp(c.shape,n,t,a,r,i,o),d=O.runKernelFunc(function(p,f){var m=p.maxPool3d(c,l);return f([c,m]),m},{x:c},function(p,f){var m=f[0],g=f[1];return{x:function(){return function(v,h,w,y,b,x,_,C){var R=D(v,"dy","maxPool3dBackprop"),S=D(h,"input","maxPool3dBackprop"),E=D(w,"output","maxPool3dBackprop"),T=R,I=S,F=E,z=!1;S.rank===4&&(z=!0,T=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),I=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),F=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),A(T.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+T.rank+"."}),A(I.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+I.rank+"."}),A(F.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+F.rank+"."}),x==null&&(x=[1,1,1]),A(sr(b,x),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+x+"'"}),C!=null&&A(zt(_),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+_+"."});var j=xp(I.shape,y,b,x,_,C),H=O.runKernelFunc(function(W){return W.maxPool3dBackprop(T,I,F,j)},{dy5D:T,input5D:I});return z?H.as4D(H.shape[1],H.shape[2],H.shape[3],H.shape[4]):H}(p,m,g,n,t,a,r,i)}}});return u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),YM=M({avgPool3d_:function(e,n,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=D(e,"x","avgPool3d","float32"),c=s,u=!1;s.rank===4&&(u=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),A(c.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+c.rank+"."}),A(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),A(sr(t,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"}),i!=null&&A(zt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=xp(c.shape,n,t,a,r,i,o),d=O.runKernelFunc(function(p){return p.avgPool3d(c,l)},{x:c},function(p){return{x:function(){return function(f,m,g,v,h,w,y){var b=D(f,"dy","avgPool3dBackprop"),x=D(m,"input","avgPool3dBackprop"),_=b,C=x,R=!1;x.rank===4&&(R=!0,_=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),C=x.as5D(1,x.shape[0],x.shape[1],x.shape[2],x.shape[3])),A(_.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."}),A(C.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+C.rank+"."}),h==null&&(h=[1,1,1]),A(sr(v,h),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+h+"'"}),y!=null&&A(zt(w),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+w+"."});var S=xp(C.shape,g,v,h,w,y),E=O.runKernelFunc(function(T){return T.avgPool3dBackprop(_,C,S)},{dy5D:_,input5D:C});return R?E.as4D(E.shape[1],E.shape[2],E.shape[3],E.shape[4]):E}(p,c,n,t,a,r,i)}}});return d=d.cast(c.dtype),u?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),Mi=M({slice_:function(e,n,t){var r,i,o=D(e,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof n=="number"?[n].concat(new Array(o.rank-1).fill(0)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(0)):n.slice()).forEach(function(c){A(c!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(c,u){return c>=0?c:(A(c===-1,function(){return"Negative size values should be exactly -1 but got "+c+" for the slice() size at index "+u+"."}),o.shape[u]-r[u])}),RA(o,r,i);var a=o.shape,s={begin:r,size:i};return O.runKernelFunc(function(c){return c.slice(o,r,i)},{x:o},function(c){for(var u=[],l=0;l<c.rank;l++)u.push([r[l],a[l]-r[l]-i[l]]);return{x:function(){return c.pad(u)}}},"Slice",s)}}),JM=M({slice1d_:function(e,n,t){var r=D(e,"x","slice1d");return A(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Mi(r,[n],[t])}}),ZM=M({slice2d_:function(e,n,t){var r=D(e,"x","slice2d");return A(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Mi(r,n,t)}}),aR=M({slice3d_:function(e,n,t){var r=D(e,"x","slice3d");return A(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Mi(r,n,t)}}),e4=M({slice4d_:function(e,n,t){var r=D(e,"x","slice4d");return A(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Mi(r,n,t)}});function sR(e,n,t,r,i){return n.rank<t.rank&&(n=n.reshape(ar(n.shape,r))),e.rank<t.rank&&(e=e.reshape(ar(e.shape,r))),{x:function(){var o=e.mul(t.equal(n).cast(e.dtype));return i==null?o:o.transpose(i)}}}var t4=M({all_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","all","bool"),i=en(n,r.shape),o=i,a=zi(o,r.rank);a!=null&&(r=r.transpose(a),o=ji(o.length,r.rank));var s=O.runKernelFunc(function(u){return u.all(r,o)},{$x:r});if(t){var c=ar(s.shape,i);return s.reshape(c)}return s}}),n4=M({any_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","any","bool"),i=en(n,r.shape),o=i,a=zi(o,r.rank);a!=null&&(r=r.transpose(a),o=ji(o.length,r.rank));var s=O.runKernelFunc(function(u){return u.any(r,o)},{$x:r});if(t){var c=ar(s.shape,i);return s.reshape(c)}return s}}),r4=M({argMax_:function(e,n){n===void 0&&(n=0);var t=D(e,"x","argMax");n==null&&(n=0);var r=en(n,t.shape),i=zi(r,t.rank);i!=null&&(t=t.transpose(i),r=ji(r.length,t.rank));var o={axis:r[0]},a=[t];return O.runKernelFunc(function(s,c){var u=s.argMax(t,r[0]);return c([t]),u},{x:t},function(s,c){var u=c[0];return{x:function(){return Ke(u)}}},"ArgMax",o,a)}}),i4=M({argMin_:function(e,n){n===void 0&&(n=0);var t=D(e,"x","argMin");n==null&&(n=0);var r=en(n,t.shape),i=zi(r,t.rank);return i!=null&&(t=t.transpose(i),r=ji(r.length,t.rank)),O.runKernelFunc(function(o,a){var s=o.argMin(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return Ke(s)}}})}}),o4=M({logSumExp_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","logSumExp"),i=en(n,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var c=ar(s.shape,i);return s.reshape(c)}return s}}),rf=M({max_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","max"),i=r,o=en(n,r.shape),a=o,s=zi(a,r.rank);s!=null&&(r=r.transpose(s),a=ji(a.length,r.rank));var c=[r],u=O.runKernelFunc(function(d,p){var f=d.max(r,a);return p([i,f]),f},{x:r},function(d,p){return sR(d,p[1],p[0],o,s)},"Max",{axes:a},c,[!0]);if(t){var l=ar(u.shape,o);u=u.reshape(l)}return u}}),a4=M({mean_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","mean"),i=en(n,r.shape),o=he(Dn(r.shape,i)[1]);return Jp(function(a){var s=re(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,t),gradFunc:function(c){var u=a.shape.slice();return i.forEach(function(l){u[l]=1}),c.reshape(u).mul(Ec(a.shape,"float32")).div(o)}}})(r)}}),s4=M({min_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","min"),i=r,o=en(n,r.shape),a=o,s=zi(a,r.rank);s!=null&&(r=r.transpose(s),a=ji(a.length,r.rank));var c=[r],u=O.runKernelFunc(function(d,p){var f=d.min(r,a);return p([i,f]),f},{x:r},function(d,p){return sR(d,p[1],p[0],o,s)},"Min",{axes:a},c,[!0]);if(t){var l=ar(u.shape,o);u=u.reshape(l)}return u}}),c4=M({moments_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=en(n,(e=D(e,"x","moments")).shape),i=e.mean(r,t),o=i.shape;t||(o=ar(i.shape,r));var a=e.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,t)}}}),cR=M({sum_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=en(n,r.shape);return Jp(function(o){var a=zi(i,o.rank),s=i,c=o;a!=null&&(c=o.transpose(a),s=ji(s.length,o.rank));var u=function(f){var m=o.shape.slice();return i.forEach(function(g){m[g]=1}),f.reshape(m).mul(Ec(o.shape,"float32"))},l={axes:s},d=O.runKernelFunc(function(f){return f.sum(c,s)},{x:c},function(f){return{x:function(){return u(f)}}},"Sum",l);if(t){var p=ar(d.shape,i);d=d.reshape(p)}return{value:d,gradFunc:u}})(r)}}),u4=M({prod_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=D(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=en(n,r.shape),o=zi(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=ji(a.length,r.rank));var c=O.runKernelFunc(function(l){return l.prod(s,a)},{permutedX:s});if(t){var u=ar(c.shape,i);c=c.reshape(u)}return c}}),uR=M({elu_:function(e){var n=D(e,"x","elu");return O.runKernelFunc(function(t,r){var i=t.elu(n);return r([i]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){return O.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),l4=M({leakyRelu_:function(e,n){n===void 0&&(n=.2);var t=D(e,"x","leakyRelu");return Oy(re(n).mul(t),t)}}),lR=M({prelu_:function(e,n){var t=D(e,"x","prelu"),r=D(n,"alpha","prelu");return O.runKernelFunc(function(i,o){var a=i.prelu(t,r);return o([t,r]),a},{x:t,alpha:r},function(i,o){var a=o[0],s=o[1],c=a.greater(0);return{x:function(){return za(c,i,i.mul(s))},alpha:function(){var u=za(c,Ke(i),i.mul(a)),l=Jt(s.shape,i.shape);return l.length>0&&(u=u.sum(l)),u.reshape(s.shape)}}},"Prelu")}}),Et=M({relu_:function(e){var n=D(e,"x","relu");return n.dtype==="bool"?n.toInt():O.runKernelFunc(function(t,r){var i=t.relu(n);return r([n]),i},{x:n},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),dR=M({relu6_:function(e){var n=D(e,"x","relu6");return n.dtype==="bool"?n.toInt():O.runKernelFunc(function(t,r){var i=t.relu6(n);return r([n]),i},{x:n},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),d4=M({selu_:function(e){var n=D(e,"x","selu");return O.runKernelFunc(function(t,r){var i=t.selu(n);return r([n]),i},{$x:n},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(re(0)),a=re(Ny),s=re(My),c=t.mul(s),u=t.mul(a).mul(i.toFloat().exp());return za(o,c,u)}}})}}),oa=M({transpose_:function(e,n){var t=D(e,"x","transpose");if(n==null&&(n=t.shape.map(function(i,o){return o}).reverse()),A(t.rank===n.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."}),n.forEach(function(i){A(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n})}),t.rank<=1)return t.clone();var r={perm:n};return O.runKernelFunc(function(i){return i.transpose(t,n)},{x:t},function(i){var o=Sy(n);return{x:function(){return i.transpose(o)}}},"Transpose",r)}}),p4=M({localResponseNormalization_:function(e,n,t,r,i){n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=D(e,"x","localResponseNormalization");A(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),A(zt(n),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var c=O.runKernelFunc(function(u,l){var d=u.localResponseNormalization4D(a,n,t,r,i);return l([a,d]),d},{x4D:a},function(u,l){var d=l[0],p=l[1];return{x4D:function(){return O.runKernelFunc(function(f){return f.LRNGrad(u,d,p,n,t,r,i)},{})}}});return s?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),pR=M({norm_:function(e,n,t,r){n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function s(c,u,l){if(l===void 0&&(l=null),c.rank===0)return c.abs();if(c.rank!==1&&l===null)return s(c.reshape([-1]),u,l);if(c.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(u===1)return c.abs().sum(l);if(u===1/0)return c.abs().max(l);if(u===-1/0)return c.abs().min(l);if(u==="euclidean"||u===2)return c.abs().pow(re(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}if(Array.isArray(l)&&l.length===2){if(u===1)return c.abs().sum(l[0]).max(l[1]-1);if(u===1/0)return c.abs().sum(l[1]).max(l[0]);if(u===-1/0)return c.abs().sum(l[1]).min(l[0]);if(u==="fro"||u==="euclidean")return c.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+u)}throw new Error("Error in norm: invalid axis: "+l)}(e=D(e,"x","norm"),n,t),o=i.shape;if(r){var a=en(t,e.shape);o=ar(i.shape,a)}return i.reshape(o)}}),f4=M({basicLSTMCell_:function(e,n,t,r,i,o){var a=D(e,"forgetBias","basicLSTMCell"),s=D(n,"lstmKernel","basicLSTMCell"),c=D(t,"lstmBias","basicLSTMCell"),u=D(r,"data","basicLSTMCell"),l=D(i,"c","basicLSTMCell"),d=D(o,"h","basicLSTMCell"),p=u.concat(d,1).matMul(s).add(c),f=p.shape[0],m=p.shape[1]/4,g=[f,m],v=p.slice([0,0],g),h=p.slice([0,m],g),w=p.slice([0,2*m],g),y=p.slice([0,3*m],g),b=v.sigmoid().mulStrict(h.tanh()).addStrict(l.mulStrict(a.add(w).sigmoid())),x=b.tanh().mulStrict(y.sigmoid());return[b,x]}}),h4=M({multiRNNCell_:function(e,n,t,r){for(var i=D(n,"data","multiRNNCell"),o=mp(t,"c","multiRNNCell"),a=mp(r,"h","multiRNNCell"),s=i,c=[],u=0;u<e.length;u++){var l=e[u](s,o[u],a[u]);c.push(l[0]),c.push(l[1]),s=l[1]}var d=[],p=[];for(u=0;u<c.length;u+=2)d.push(c[u]),p.push(c[u+1]);return[d,p]}}),m4=M({movingAverage_:function(e,n,t,r,i){i===void 0&&(i=!0);var o=D(e,"v","movingAverage"),a=D(n,"x","movingAverage"),s=D(t,"decay","movingAverage");pP(o,a),A(cn(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var c=re(1),u=c.sub(s),l=a.sub(o).mul(u);if(i){A(r!=null,function(){return"When using zeroDebias: true, step is required."});var d=D(r,"step","movingAverage");l=l.div(c.sub(Rp(s,d)))}return o.add(l)}}),g4=M({stridedSlice_:function(e,n,t,r,i,o,a,s,c){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),c===void 0&&(c=0),r==null&&(r=new Array(n.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var u=D(e,"x","stridedSlice"),l=O1(s),d=u.shape.slice();l.forEach(function(v){n[v]=0,t[v]=1,d.splice(v,0,1)}),u=u.reshape(d);for(var p=0;p<u.rank;p++)n[p]=kA(i,n,r,u.shape,p),t[p]=EA(o,t,r,u.shape,p),r[p]=r[p]||1;var f=O1(c);f.forEach(function(v){t[v]=n[v]+1,r[v]=1});var m=Ey(n,t,r),g=m.filter(function(v,h){return f.indexOf(h)===-1});return r.every(function(v){return v===1})?Mi(u,n,m).reshape(g):O.runKernelFunc(function(v){return v.stridedSlice(u,n,t,r)},{$x:u}).reshape(g)}}),v4=M({topk_:function(e,n,t){n===void 0&&(n=1),t===void 0&&(t=!0);var r=D(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(n>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+n);var o=O.runKernelFunc(function(a){return a.topk(r,n,t)},{$x:r});return{values:o[0],indices:o[1]}}}),y4=M({scatterND_:function(e,n,t){var r=D(e,"indices","scatterND","int32"),i=D(n,"updates","scatterND");return CA(i,r,t),O.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),jy=M({fft_:function(e){A(e.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."});var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return O.runKernelFunc(function(i){return i.fft(r)},{input:e}).reshape(e.shape)}}),kp=M({ifft_:function(e){A(e.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."});var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return O.runKernelFunc(function(i){return i.ifft(r)},{input:e}).reshape(e.shape)}}),$y=M({rfft_:function(e,n){A(e.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+e.dtype});var t,r=e.shape[e.shape.length-1],i=e.size/r;if(n!=null&&n<r){var o=e.shape.map(function(h){return 0}),a=e.shape.map(function(h){return h});a[e.shape.length-1]=n,t=e.slice(o,a),r=n}else if(n!=null&&n>r){var s=e.shape.map(function(h){return h});s[e.shape.length-1]=n-r,t=e.concat(xt(s),e.shape.length-1),r=n}else t=e;var c=t.zerosLike(),u=fn(t,c).as2D(i,r),l=jy(u),d=Math.floor(r/2)+1,p=Nr(l),f=Ri(l),m=p.split([d,r-d],p.shape.length-1),g=f.split([d,r-d],f.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=d,fn(m[0],g[0]).reshape(v)}}),fR=M({irfft_:function(e){var n=e.shape[e.shape.length-1],t=e.size/n;if(n<=2){var r=e.as2D(t,n),i=kp(r);return Nr(i)}var o=[t,2*(n-1)],a=Nr(e).as2D(t,n),s=Ri(e).as2D(t,n),c=a.slice([0,1],[t,n-2]).reverse(1),u=s.slice([0,1],[t,n-2]).reverse(1).mul(re(-1)),l=a.concat(c,1),d=s.concat(u,1);return r=fn(l,d).as2D(o[0],o[1]),i=kp(r),Nr(i)}}),w4=Object.freeze({fft:jy,ifft:kp,rfft:$y,irfft:fR}),b4=M({sparseToDense_:function(e,n,t,r){r===void 0&&(r=0);var i=D(e,"sparseIndices","sparseToDense","int32"),o=D(n,"sparseValues","sparseToDense"),a=D(r,"defaultValue","sparseToDense",o.dtype);return function(s,c,u,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var d=s.rank>0?s.shape[0]:1,p=s.rank>1?s.shape[1]:1;if(u.length!==p)throw new Error("outputShape has incorrect number of elements:, "+u.length+", should be: "+p+".");var f=c.size;if(c.rank!==0&&(c.rank!==1||f!==d))throw new Error("sparseValues has incorrect shape "+c.shape+", should be [] or ["+d+"]");if(c.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,a),O.runKernelFunc(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),x4=M({gatherND_:function(e,n){var t=D(n,"indices","gatherND","int32"),r=D(e,"x","gatherND");return O.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),_4=M({diag_:function(e){var n=D(e,"x","diag").flatten(),t=e.shape.concat(e.shape);return O.runKernelFunc(function(r){return r.diag(n)},{$x:n}).reshape(t)}}),S4=M({dropout_:function(e,n,t,r){var i=D(e,"x","dropout");if(A(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),A(n>=0&&n<1,function(){return"rate must be a float in the range [0, 1), but got "+n+"."}),n===0)return e instanceof kt?i.clone():i;var o=function(c,u){if(u==null)return c.shape.slice();if(cn(c.shape,u))return u;if(c.shape.length===u.length){for(var l=[],d=0;d<c.shape.length;d++)u[d]==null&&c.shape[d]!=null?l.push(c.shape[d]):l.push(u[d]);return l}return u}(i,t),a=1-n,s=lC(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function hR(e,n,t){for(var r=1-e%2,i=new Float32Array(e),o=0;o<e;++o){var a=2*Math.PI*o/(e+r-1);i[o]=n-t*Math.cos(a)}return Vt(i,"float32")}var Uy=M({hannWindow_:function(e){return hR(e,.5,.5)}}),mR=M({hammingWindow_:function(e){return hR(e,.54,.46)}}),Wy=M({frame_:function(e,n,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+n<=e.size;)a.push(Mi(e,o,n)),o+=t;if(r)for(;o<e.size;){var s=o+n-e.size,c=Qt([Mi(e,o,n-s),Ai([s],i)]);a.push(c),o+=t}return a.length===0?Jo([],[0,n]):Qt(a).as2D(a.length,n)}}),gR=M({stft_:function(e,n,t,r,i){var o;i===void 0&&(i=Uy),r==null&&(o=n,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=Wy(e,n,t),s=Mn(a,i(n)),c=[],u=0;u<a.shape[0];u++)c.push($y(s.slice([u,0],[1,n]),r));return Qt(c)}}),C4=Object.freeze({hannWindow:Uy,hammingWindow:mR,frame:Wy,stft:gR}),Nn,R4=function(e,n,t){return t===void 0&&(t=1),ue(this,void 0,void 0,function(){var r,i,o,a,s,c,u,l,d,p,f,m,g,v;return le(this,function(h){switch(h.label){case 0:return r=D(e,"predictions","inTopK"),i=D(n,"targets","inTopK"),A(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),A(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),ot(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],A(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return a=h.sent(),[4,i.data()];case 2:for(s=h.sent(),c=[a.length/o,o],l=c[1],d=ju("bool",u=c[0]),p=0;p<u;p++){for(f=p*l,m=a.subarray(f,f+l),g=[],v=0;v<m.length;v++)g.push({value:m[v],index:v});for(g.sort(function(w,y){return y.value-w.value}),d[p]=0,v=0;v<t;v++)if(g[v].index===s[p]){d[p]=1;break}}return e!==r&&r.dispose(),n!==i&&i.dispose(),[2,mn(d,i.shape,"bool")]}})})};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Nn||(Nn={}));var k4=M({absoluteDifference_:function(e,n,t,r){r===void 0&&(r=Nn.SUM_BY_NONZERO_WEIGHTS);var i=D(e,"labels","absoluteDifference"),o=D(n,"predictions","absoluteDifference"),a=null;t!=null&&(a=D(t,"weights","absoluteDifference")),ot(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return vo(s,a,r)}}),vo=M({computeWeightedLoss_:function(e,n,t){t===void 0&&(t=Nn.SUM_BY_NONZERO_WEIGHTS);var r=D(e,"losses","computeWeightedLoss"),i=null;n!=null&&(i=D(n,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Nn.NONE)return o;if(t===Nn.SUM)return o.sum();if(t===Nn.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(re(a)):s}if(t===Nn.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(re(r.size));var c=i.mul(Ec(r.shape)).notEqual(re(0)).sum().toFloat();return o.sum().div(c)}throw Error("Unknown reduction: "+t)}}),E4=M({cosineDistance_:function(e,n,t,r,i){i===void 0&&(i=Nn.SUM_BY_NONZERO_WEIGHTS);var o=D(e,"labels","cosineDistance"),a=D(n,"predictions","cosineDistance"),s=null;r!=null&&(s=D(r,"weights","cosineDistance")),ot(o.shape,a.shape,"Error in cosineDistance: ");var c=re(1).sub(o.mul(a).sum(t,!0));return vo(c,s,i)}}),T4=M({hingeLoss_:function(e,n,t,r){r===void 0&&(r=Nn.SUM_BY_NONZERO_WEIGHTS);var i=D(e,"labels","hingeLoss"),o=D(n,"predictions","hingeLoss"),a=null;t!=null&&(a=D(t,"weights","hingeLoss")),ot(i.shape,o.shape,"Error in hingeLoss: ");var s=re(1);i=re(2).mul(i).sub(s);var c=s.sub(i.mul(o)).relu();return vo(c,a,r)}}),D4=M({huberLoss_:function(e,n,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Nn.SUM_BY_NONZERO_WEIGHTS);var o=D(e,"labels","huberLoss"),a=D(n,"predictions","huberLoss"),s=null;t!=null&&(s=D(t,"weights","huberLoss")),ot(o.shape,a.shape,"Error in huberLoss: ");var c=re(r),u=a.sub(o).abs(),l=XC(u,c),d=u.sub(l),p=re(.5).mul(l.square()).add(c.mul(d));return vo(p,s,i)}}),I4=M({logLoss_:function(e,n,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Nn.SUM_BY_NONZERO_WEIGHTS);var o=D(e,"labels","logLoss"),a=D(n,"predictions","logLoss"),s=null;t!=null&&(s=D(t,"weights","logLoss")),ot(o.shape,a.shape,"Error in logLoss: ");var c=re(1),u=re(r),l=o.mul(a.add(u).log()).neg().sub(c.sub(o).mul(c.sub(a).add(u).log()));return vo(l,s,i)}}),P4=M({meanSquaredError_:function(e,n,t,r){r===void 0&&(r=Nn.SUM_BY_NONZERO_WEIGHTS);var i=D(e,"labels","meanSquaredError"),o=D(n,"predictions","meanSquaredError"),a=null;t!=null&&(a=D(t,"weights","meanSquaredError")),ot(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return vo(s,a,r)}}),A4=M({sigmoidCrossEntropy_:function(e,n,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Nn.SUM_BY_NONZERO_WEIGHTS);var o=D(e,"multiClassLabels","sigmoidCrossEntropy"),a=D(n,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=D(t,"weights","sigmoidCrossEntropy")),ot(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var c=re(r),u=re(1),l=re(.5);o=o.mul(u.sub(c)).add(l.mul(c))}var d=function(p,f){var m=D(p,"labels","sigmoidCrossEntropyWithLogits"),g=D(f,"logits","sigmoidCrossEntropyWithLogits");ot(m.shape,g.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=g.relu(),h=g.mul(m),w=g.abs().neg().exp().log1p();return v.sub(h).add(w)}(o,a);return vo(d,s,i)}}),N4=M({softmaxCrossEntropy_:function(e,n,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Nn.SUM_BY_NONZERO_WEIGHTS);var o=D(e,"onehotLabels","softmaxCrossEntropy"),a=D(n,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=D(t,"weights","softmaxCrossEntropy")),ot(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var c=re(r),u=re(1),l=re(o.shape[1]);o=o.mul(u.sub(c)).add(c.div(l))}var d=function(p,f,m){if(m===void 0&&(m=-1),m===-1&&(m=f.rank-1),m!==f.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+f.rank+" and dim was "+m);return Jp(function(g,v,h){var w=v.logSumExp([m],!0),y=v.toFloat().sub(w);return h([g,y]),{value:y.mul(g).neg().sum([m]),gradFunc:function(b,x){var _=x[0],C=x[1],R=ar(b.shape,[m]);return[b.reshape(R).mul(_.toFloat().sub(C.exp())),b.reshape(R).mul(C.exp().sub(_.toFloat()))]}}})(p,f)}(o,a);return vo(d,s,i)}}),M4=Object.freeze({get Reduction(){return Nn},absoluteDifference:k4,computeWeightedLoss:vo,cosineDistance:E4,hingeLoss:T4,huberLoss:D4,logLoss:I4,meanSquaredError:P4,sigmoidCrossEntropy:A4,softmaxCrossEntropy:N4});function ib(e,n){return n===void 0&&(n=!1),O.tidy(function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var t=e.shape[0],r=e.shape[1],i=uC(t),o=e.clone(),a=Jo([[1]],[1,1]),s=a.clone(),c=t>=r?r:t,u=function(d){var p,f=o,m=s,g=i;p=O.tidy(function(){var v=o.slice([d,d],[t-d,1]),h=v.norm(),w=o.slice([d,d],[1,1]),y=Jo([[-1]]).where(w.greater(0),Jo([[1]])),b=w.sub(y.mul(h)),x=v.div(b);s=x.shape[0]===1?a.clone():a.concat(x.slice([1,0],[x.shape[0]-1,x.shape[1]]),0);var _=y.matMul(b).div(h).neg(),C=o.slice([d,0],[t-d,r]),R=_.mul(s);if(d===0)o=C.sub(R.matMul(s.transpose().matMul(C)));else{var S=C.sub(R.matMul(s.transpose().matMul(C)));o=o.slice([0,0],[d,r]).concat(S,0)}var E=i.slice([0,d],[t,i.shape[1]-d]);if(d===0)i=E.sub(E.matMul(s).matMul(R.transpose()));else{var T=E.sub(E.matMul(s).matMul(R.transpose()));i=i.slice([0,0],[t,d]).concat(T,1)}return[s,o,i]}),s=p[0],o=p[1],i=p[2],ir([f,m,g])},l=0;l<c;++l)u(l);return!n&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var L4=M({bandPart_:function(e,n,t){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=D(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),t<0&&(t=s);var c=gp(0,a,1,"int32").reshape([-1,1]),u=gp(0,s,1,"int32"),l=Zt(c,u),d=ef(l.lessEqual(re(+n,"int32")),l.greaterEqual(re(-t,"int32"))),p=xt([a,s],r.dtype);return xr(Yt(r.reshape([-1,a,s])).map(function(f){return za(d,f,p)})).reshape(i)}}),O4=M({gramSchmidt_:function(e){var n;if(Array.isArray(e)){n=!1,A(e!=null&&e.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=e[0].shape[0],r=function(c){A(e[c].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[c].shape[0]+" vs. "+t+")"})},i=1;i<e.length;++i)r(i)}else n=!0,e=Ry(e,e.shape[0],0).map(function(c){return pC(c,[0])});A(e.length<=e[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."});var o=[],a=e,s=function(c){o.push(O.tidy(function(){var u=a[c];if(c>0)for(var l=0;l<c;++l){var d=cR(o[l].mulStrict(u)).mul(o[l]);u=u.sub(d)}return u.div(pR(u,"euclidean"))}))};for(i=0;i<e.length;++i)s(i);return n?xr(o,0):o}}),F4=M({qr_:function(e,n){if(n===void 0&&(n=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return ib(e,n);var t=e.shape.slice(0,e.shape.length-2).reduce(function(a,s){return a*s}),r=Yt(e.reshape([t,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],o=[];return r.forEach(function(a){var s=ib(a,n),c=s[0],u=s[1];i.push(c),o.push(u)}),[xr(i,0).reshape(e.shape),xr(o,0).reshape(e.shape)]}}),B4=Object.freeze({bandPart:L4,gramSchmidt:O4,qr:F4});function of(e,n,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=e.shape[0];return t=Math.min(t,a),A(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),A(e.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"}),A(e.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]}),A(n.rank===1,function(){return"scores must be a 1D tensor"}),A(n.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]}),A(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var z4=M({resizeBilinear_:function(e,n,t){t===void 0&&(t=!1);var r=D(e,"images","resizeBilinear");A(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),A(n.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],c=O.runKernelFunc(function(u,l){return l([i]),u.resizeBilinear(i,a,s,t)},{x:i},function(u,l){return{x:function(){return O.runKernelFunc(function(d){return d.resizeBilinearBackprop(u,l[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),j4=M({resizeNearestNeighbor_:function(e,n,t){t===void 0&&(t=!1);var r=D(e,"images","resizeNearestNeighbor");A(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),A(n.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."}),A(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],c=O.runKernelFunc(function(u,l){return l([i]),u.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(u,l){return{batchImages:function(){return O.runKernelFunc(function(d){return d.resizeNearestNeighborBackprop(u,l[0],t)},{})}}});return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}}),$4=M({nonMaxSuppression_:function(e,n,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=D(e,"boxes","nonMaxSuppression"),a=D(n,"scores","nonMaxSuppression"),s=of(o,a,t,r,i);t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var c={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return O.runKernelFunc(function(u){return u.nonMaxSuppression(o,a,t,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",c)}}),U4=function(e,n,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),ue(this,void 0,void 0,function(){var o,a,s,c,u,l,d;return le(this,function(p){switch(p.label){case 0:return o=D(e,"boxes","nonMaxSuppressionAsync"),a=D(n,"scores","nonMaxSuppressionAsync"),s=of(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return c=p.sent(),u=c[0],l=c[1],d=Dy(u,l,t,r,i),o!==e&&o.dispose(),a!==n&&a.dispose(),[2,d]}})})},W4=M({nonMaxSuppressionWithScore_:function(e,n,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=D(e,"boxes","nonMaxSuppression"),s=D(n,"scores","nonMaxSuppression"),c=of(a,s,t,r,i,o),u={maxOutputSize:t=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:i=c.scoreThreshold,softNmsSigma:o=c.softNmsSigma},l=O.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},u);return{selectedIndices:l[0],selectedScores:l[1]}}}),V4=function(e,n,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),ue(this,void 0,void 0,function(){var a,s,c,u,l,d,p;return le(this,function(f){switch(f.label){case 0:return a=D(e,"boxes","nonMaxSuppressionAsync"),s=D(n,"scores","nonMaxSuppressionAsync"),c=of(a,s,t,r,i,o),t=c.maxOutputSize,r=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return u=f.sent(),l=u[0],d=u[1],p=Iy(l,d,t,r,i,o),a!==e&&a.dispose(),s!==n&&s.dispose(),[2,p]}})})},H4=M({cropAndResize_:function(e,n,t,r,i,o){var a=D(e,"image","cropAndResize"),s=D(n,"boxes","cropAndResize","float32"),c=D(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var u=s.shape[0];return A(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),A(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+u+",4] but had shape "+s.shape+"."}),A(c.rank===1&&c.shape[0]===u,function(){return"Error in cropAndResize: boxInd must be have size ["+u+"] but had shape "+s.shape+"."}),A(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),A(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),A(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),O.runKernelFunc(function(l,d){return l.cropAndResize(a,s,c,r,i,o)},{images:a,boxes:s,boxInd:c},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Vy=Object.freeze({resizeBilinear:z4,resizeNearestNeighbor:j4,nonMaxSuppression:$4,nonMaxSuppressionAsync:U4,nonMaxSuppressionWithScore:W4,nonMaxSuppressionWithScoreAsync:V4,cropAndResize:H4}),Hy=function(e,n){return!(e>0)||n==="linear"},Gy=function(e,n,t){if(t==null||t==="linear")return e;if(t==="relu")return e.mul(n.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},qy=function(e,n){var t=n,r=Jt(e.shape,n.shape);return r.length>0&&(t=t.sum(r)),t.reshape(e.shape)},Ky=function(e,n,t){if(n==="linear")return e;if(n==="relu")return Et(e);if(n==="elu")return uR(e);if(n==="relu6")return dR(e);if(n==="prelu")return lR(e,t);throw new Error("Unknown fused activation "+n+".")},G4=M({fusedMatMul_:function(e){var n,t=e.a,r=e.b,i=e.transposeA,o=i!==void 0&&i,a=e.transposeB,s=a!==void 0&&a,c=e.bias,u=e.activation,l=u===void 0?"linear":u,d=e.preluActivationWeights;if(Hy(O.state.gradientDepth,l)===!1){var p=nf(t,r,o,s);return c!=null&&(p=ze(p,c)),Ky(p,l,d)}var f=D(t,"a","fused matMul"),m=D(r,"b","fused matMul");n=It(f,m),f=n[0],m=n[1];var g=o?f.shape[f.rank-2]:f.shape[f.rank-1],v=s?m.shape[m.rank-1]:m.shape[m.rank-2],h=o?f.shape[f.rank-1]:f.shape[f.rank-2],w=s?m.shape[m.rank-2]:m.shape[m.rank-1],y=f.shape.slice(0,-2),b=m.shape.slice(0,-2),x=he(y),_=he(b);A(f.rank>=2&&m.rank>=2&&f.rank===m.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+m.rank+"."}),A(cn(y,b),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+b+") of Tensors with shapes "+f.shape+" and "+m.shape+" must match."}),A(g===v,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+v+") of Tensors with shapes "+f.shape+" and "+m.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var C,R,S=f.shape.slice(0,-2).concat([h,w]),E=o?f.as3D(x,g,h):f.as3D(x,h,g),T=s?m.as3D(_,w,v):m.as3D(_,v,w);c!=null&&je(S,(C=It(C=D(c,"bias","fused matMul"),f)[0]).shape),d!=null&&(R=D(d,"prelu weights","fused matMul"));var I={a:E,b:T};c!=null&&(I.bias=C),d!=null&&(I.preluActivationWeights=R);var F=[E,T];return O.runKernelFunc(function(z,j){var H=z.fusedBatchMatMul({a:E,b:T,transposeA:o,transposeB:s,bias:C,activation:l,preluActivationWeights:R});return j([E,T,H]),H},I,function(z,j){var H=j[0],W=j[1],L=j[2],$=Gy(z,L,l),k={};return c!=null&&(k={bias:function(){return qy(C,$)}}),Object.assign(o||s?!o&&s?{a:function(){return $.matMul(W,!1,!1)},b:function(){return $.matMul(H,!0,!1)}}:o&&!s?{a:function(){return W.matMul($,!1,!0)},b:function(){return H.matMul($,!1,!1)}}:{a:function(){return W.matMul($,!0,!0)},b:function(){return $.matMul(H,!0,!0)}}:{a:function(){return $.matMul(W,!1,!0)},b:function(){return H.matMul($,!0,!1)}},k)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:l},F,[!0]).reshape(S)}}),q4=M({fusedConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,i=e.pad,o=e.dataFormat,a=o===void 0?"NHWC":o,s=e.dilations,c=s===void 0?[1,1]:s,u=e.dimRoundingMode,l=e.bias,d=e.activation,p=d===void 0?"linear":d,f=e.preluActivationWeights;if(p=p||"linear",Hy(O.state.gradientDepth,p)===!1){var m=zr(n,t,r,i,a,c,u);return l!=null&&(m=ze(m,l)),Ky(m,p,f)}var g=D(n,"x","conv2d"),v=D(t,"filter","conv2d"),h=g,w=!1;g.rank===3&&(w=!0,h=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),A(h.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+h.rank+"."}),A(v.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),u!=null&&A(zt(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+u+" but got pad "+i+"."}),A(h.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+h.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),A(sr(r,c),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),A(a==="NHWC",function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var y,b,x=qa(h.shape,v.shape,r,c,i,u);l!=null&&(y=It(y=D(l,"bias","fused conv2d"),g)[0],je(x.outShape,y.shape)),f!=null&&(b=D(f,"prelu weights","fused conv2d"));var _={x:h,filter:v};l!=null&&(_.bias=y),f!=null&&(_.preluActivationWeights=b);var C=[v,h],R=O.runKernelFunc(function(S,E){var T=S.fusedConv2d({input:h,filter:v,convInfo:x,bias:y,activation:p,preluActivationWeights:b});return E([v,h,T]),T},_,function(S,E){var T=E,I=T[0],F=T[1],z=T[2],j=Gy(S,z,p);A(xc(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+c+"'"});var H={};return l!=null&&(H={bias:function(){return qy(y,j)}}),Object.assign({x:function(){return tR(F.shape,j,I,r,i)},filter:function(){return By(F,j,I.shape,r,i)}},H)},"FusedConv2D",{convInfo:x,activation:p},C,[!0]);return w?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),K4=M({fusedDepthwiseConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,i=e.pad,o=e.dataFormat,a=o===void 0?"NHWC":o,s=e.dilations,c=s===void 0?[1,1]:s,u=e.dimRoundingMode,l=e.bias,d=e.activation,p=d===void 0?"linear":d,f=e.preluActivationWeights;if(Hy(O.state.gradientDepth,p)===!1){var m=tf(n,t,r,i,a,c,u);return l!=null&&(m=ze(m,l)),Ky(m,p,f)}var g=D(n,"x","depthwiseConv2d"),v=D(t,"filter","depthwiseConv2d"),h=g,w=!1;g.rank===3&&(w=!0,h=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),A(h.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+h.rank+"."}),A(v.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),A(h.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+h.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),c==null&&(c=[1,1]),A(sr(r,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+c+"'"}),u!=null&&A(zt(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+u+" but got pad "+i+"."});var y,b,x=qa(h.shape,v.shape,r,c,i,u,!0);l!=null&&(y=It(y=D(l,"bias","fused conv2d"),g)[0],je(x.outShape,y.shape)),f!=null&&(b=D(f,"prelu weights","fused depthwiseConv2d"));var _={x:h,filter:v};l!=null&&(_.bias=y),f!=null&&(_.preluActivationWeights=b);var C=[v,h],R=O.runKernelFunc(function(S,E){var T=S.fusedDepthwiseConv2D({input:h,filter:v,convInfo:x,bias:y,activation:p,preluActivationWeights:b});return E([v,h,T]),T},_,function(S,E){A(xc(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+c+"'"});var T=E[0],I=E[1],F=E[2],z=Gy(S,F,p),j={};return l!=null&&(j={bias:function(){return qy(y,z)}}),Object.assign({x:function(){return nR(I.shape,z,T,x)},filter:function(){return rR(I,z,T.shape,x)}},j)},"FusedDepthwiseConv2D",{convInfo:x,activation:p},C,[!0]);return w?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),X4=Object.freeze({matMul:G4,conv2d:q4,depthwiseConv2d:K4}),Q4=Object.freeze({image:Vy,linalg:B4,losses:M4,spectral:w4,fused:X4,signal:C4,square:I3,squaredDifference:zC,conv1d:zM,conv2d:zr,conv3d:jM,depthwiseConv2d:tf,separableConv2d:zy,conv2dTranspose:$M,conv3dTranspose:UM,op:M,batchNormalization2d:aM,batchNormalization3d:sM,batchNormalization4d:cM,batchNormalization:uM,batchNorm:HC,batchNorm2d:lM,batchNorm3d:dM,batchNorm4d:pM,booleanMaskAsync:BM,complex:fn,real:Nr,imag:Ri,concat:Qt,concat1d:XP,concat2d:QP,concat3d:YP,concat4d:JP,split:Ry,matMul:nf,dot:WM,outerProduct:VM,reverse:rl,reverse1d:HM,reverse2d:GM,reverse3d:qM,reverse4d:KM,maxPool:rn,avgPool:il,pool:XM,maxPool3d:QM,avgPool3d:YM,slice:Mi,slice1d:JM,slice2d:ZM,slice3d:aR,slice4d:e4,abs:P3,acos:A3,acosh:N3,asin:M3,asinh:L3,atan:O3,atanh:F3,ceil:B3,clipByValue:Ly,cos:z3,cosh:j3,erf:$3,exp:Yg,expm1:U3,floor:W3,log:V3,log1p:H3,logSigmoid:G3,neg:Cp,reciprocal:q3,round:K3,rsqrt:jC,sigmoid:$C,sign:X3,isNaN:Q3,isInf:Y3,isFinite:J3,sin:Z3,sinh:eM,softplus:tM,sqrt:nM,step:rM,tan:iM,tanh:oM,all:t4,any:n4,argMax:r4,argMin:i4,logSumExp:o4,max:rf,mean:a4,min:s4,moments:c4,sum:cR,prod:u4,equal:QC,equalStrict:TM,greater:DM,greaterEqual:YC,greaterEqualStrict:IM,greaterStrict:PM,less:AM,lessEqual:NM,lessEqualStrict:MM,lessStrict:LM,notEqual:OM,notEqualStrict:FM,add:ze,addN:mM,addStrict:gM,atan2:vM,div:Xr,divNoNan:yM,divStrict:wM,floorDiv:KC,maximum:Oy,maximumStrict:bM,minimum:XC,minimumStrict:xM,mod:_M,modStrict:SM,mul:Mn,mulStrict:CM,pow:Rp,powStrict:RM,squaredDifferenceStrict:kM,sub:Zt,subStrict:EM,elu:uR,leakyRelu:l4,prelu:lR,relu:Et,relu6:dR,selu:d4,logicalAnd:ef,logicalNot:fM,logicalOr:GC,logicalXor:hM,where:za,whereAsync:qC,buffer:Me,print:sA,batchToSpaceND:cC,broadcastTo:cA,cast:uA,clone:lA,cumsum:dA,depthToSpace:pA,expandDims:Ir,eye:uC,multinomial:fA,oneHot:qg,pad:Ga,pad1d:hA,pad2d:mA,pad3d:gA,pad4d:vA,rand:yA,randomNormal:wA,randomGamma:bA,randomUniform:lC,reshape:Qr,spaceToBatchND:dC,squeeze:pC,stack:xr,tile:ec,truncatedNormal:xA,unstack:Yt,setdiff1dAsync:_A,fill:Ai,linspace:KP,ones:Ec,range:gp,scalar:re,tensor:mn,tensor1d:Vt,tensor2d:Jo,tensor3d:Cy,tensor4d:Yn,tensor5d:HP,tensor6d:GP,variable:qP,zeros:xt,onesLike:sC,zerosLike:Ke,transpose:oa,softmax:go,logSoftmax:DA,localResponseNormalization:p4,norm:pR,gather:Fy,unsortedSegmentSum:JC,basicLSTMCell:f4,multiRNNCell:h4,movingAverage:m4,stridedSlice:g4,topk:v4,scatterND:y4,fft:jy,ifft:kp,rfft:$y,irfft:fR,sparseToDense:b4,gatherND:x4,diag:_4,dropout:S4,hannWindow:Uy,hammingWindow:mR,frame:Wy,stft:gR,inTopKAsync:R4});function Q(e,n){Array.isArray(e)||(e=[e]),e.forEach(function(t){t!=null&&A(t.dtype!=="complex64",function(){return n+" does not support complex64 tensors."})})}function nm(e,n,t,r){if(t==="linear")return e.linear(n);if(t==="relu")return e.relu(n);if(t==="elu")return e.elu(n);if(t==="relu6")return e.relu6(n);if(t==="prelu")return e.prelu(n,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var Y4=function(e){function n(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new wC(t,O),t}return ri(n,e),n.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,K().get("IS_NODE")&&hp(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},n.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){return[2,this.readSync(t)]})})},n.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?Qg(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},n.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map(function(o){return dp(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Me(t.shape,t.dtype,i)},n.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return O.makeTensorFromDataId(o,r,i,this)},n.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){return r=_i(),t(),[2,{kernelMs:_i()-r}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:O.keep(t.clone()),imag:O.keep(r.clone())},i},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,i){if(Q(t,"slice"),vC(t.shape,r,i)){var o=yC(r,t.strides),a=he(i);return mn(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=Me(i,t.dtype),c=this.bufferSync(t),u=0;u<s.size;++u){var l=s.indexToLoc(u).map(function(d,p){return d+r[p]});s.values[u]=c.get.apply(c,l)}return s.toTensor()},n.prototype.stridedSlice=function(t,r,i,o){Q(t,"stridedSlice");var a=Ey(r,i,o);if(a.some(function(f){return f===0}))return mn([],a);for(var s=Me(a,t.dtype),c=this.bufferSync(t),u=0;u<s.size;u++){for(var l=s.indexToLoc(u),d=new Array(l.length),p=0;p<d.length;p++)d[p]=l[p]*o[p]+r[p];s.set.apply(s,[c.get.apply(c,d)].concat(l))}return s.toTensor()},n.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=Me([t.size,t.size],t.dtype),o=i.values,a=0;a<r.length;a++)o[a*t.size+a]=r[a];return i.toTensor()},n.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var c=new Array(t.rank).fill(0),u=t.shape.slice();u[r]=1;var l=new Array(i);for(s=0;s<l.length;s++)c[r]=s,l[s]=this.slice(t,c,u).reshape(o);return l},n.prototype.reverse=function(t,r){Q(t,"reverse");for(var i=Me(t.shape,t.dtype),o=this.bufferSync(t),a=function(c){var u=i.indexToLoc(c),l=u.slice();r.forEach(function(d){return l[d]=t.shape[d]-1-l[d]}),i.set.apply(i,[o.get.apply(o,l)].concat(u))},s=0;s<i.size;s++)a(s);return i.toTensor()},n.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map(function(f){return Nr(f)}),a=t.map(function(f){return Ri(f)});return fn(this.concat(o,r),this.concat(a,r))}var s=t.map(function(f){var m=he(f.shape.slice(r));return f.as2D(-1,m)}),c=bc(s.map(function(f){return f.shape}),1),u=Me(c,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach(function(f){u.set(i.readSync(f.dataId),l),l+=f.size})}else{var d=0;s.forEach(function(f){for(var m=i.readSync(f.dataId),g=0,v=0;v<f.shape[0];++v)for(var h=v*c[1]+d,w=0;w<f.shape[1];++w)u[h+w]=m[g++];d+=f.shape[1]})}var p=bc(t.map(function(f){return f.shape}),r);return mn(u,p,t[0].dtype)},n.prototype.neg=function(t){return Q(t,"neg"),this.multiply(re(-1),t)},n.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i+a,imag:o+s}}):this.broadcastedBinaryOp(t,r,hn(t.dtype,r.dtype),function(i,o){return i+o})},n.prototype.addN=function(t){var r=this;Q(t,"addN");for(var i=t.map(function(l){return r.readSync(l.dataId)}),o=Me(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var c=i[s],u=0;u<a.length;u++)a[u]+=c[u];return o.toTensor()},n.prototype.softmax=function(t,r){var i=en([r],t.shape),o=this.max(t,i),a=ar(o.shape,i),s=this.subtract(t,o.reshape(a)),c=this.exp(s),u=this.sum(c,i).reshape(a);return this.realDivide(c,u)},n.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i-a,imag:o-s}}):this.broadcastedBinaryOp(t,r,hn(t.dtype,r.dtype),function(i,o){return i-o})},n.prototype.pow=function(t,r){return Q([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},n.prototype.batchMatMul=function(t,r,i,o){Q([t,r],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],c=o?r.shape[1]:r.shape[2],u=t.shape[0],l=this.readSync(t.dataId),d=this.readSync(r.dataId),p=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],f=p[0],m=p[1],g=p[2],v=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],h=v[0],w=v[1],y=v[2],b=s*c,x=Me([u,s,c],t.dtype),_=x.values,C=this.blockSize,R=0;R<u;R++)for(var S=0;S<s;S+=C)for(var E=0;E<c;E+=C)for(var T=0;T<a;T+=C)for(var I=Math.min(S+C,s),F=Math.min(E+C,c),z=Math.min(T+C,a),j=S;j<I;j++)for(var H=E;H<F;H++){for(var W=0,L=T;L<z;L++)W+=l[R*f+j*m+L*g]*d[L*h+H*w+R*y];_[R*b+(j*c+H)]+=W}return x.toTensor()},n.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,c=t.activation,u=t.preluActivationWeights,l=this.batchMatMul(r,i,o,a);return s&&(l=this.add(l,s)),c&&(l=nm(this,l,c,u)),l},n.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}}):this.broadcastedBinaryOp(t,r,hn(t.dtype,r.dtype),function(i,o){return i*o})},n.prototype.realDivide=function(t,r){return Q([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",function(i,o){return i/o})},n.prototype.floorDiv=function(t,r){return Q([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},n.prototype.sum=function(t,r){Q(t,"sum"),fr("sum",r,t.rank);for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,hn(t.dtype,"int32")),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=0,m=0;m<c;++m)f+=l[p+m];u[d]=f}return s},n.prototype.prod=function(t,r){Q(t,"sum");for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,hn(t.dtype,"int32")),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=1,m=0;m<c;++m)f*=l[p+m];u[d]=f}return s},n.prototype.unsortedSegmentSum=function(t,r,i){Q(t,"unsortedSegmentSum");for(var o=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<i;++s){var c=re(s,"int32"),u=QC(c,r).asType("float32").mul(t).sum(0);o.push(u)}return xr(o)},n.prototype.argMin=function(t,r){Q(t,"argMin");var i=[r];fr("argMin",i,t.rank);for(var o=Dn(t.shape,i),a=o[0],s=o[1],c=xt(a,"int32"),u=he(s),l=this.readSync(c.dataId),d=this.readSync(t.dataId),p=0;p<l.length;++p){for(var f=p*u,m=d[f],g=0,v=0;v<u;++v){var h=d[f+v];h<m&&(m=h,g=v)}l[p]=g}return c},n.prototype.argMax=function(t,r){Q(t,"argMax");var i=[r];fr("argMax",i,t.rank);for(var o=Dn(t.shape,i),a=o[0],s=o[1],c=xt(a,"int32"),u=he(s),l=this.readSync(c.dataId),d=this.readSync(t.dataId),p=0;p<l.length;++p){for(var f=p*u,m=d[f],g=0,v=0;v<u;++v){var h=d[f+v];h>m&&(m=h,g=v)}l[p]=g}return c},n.prototype.cumsum=function(t,r,i,o){if(Q(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=hn(t.dtype,"int32"),s=xt(t.shape,a),c=this.readSync(s.dataId),u=this.readSync(t.dataId),l=t.shape[t.rank-1],d=o?function(v,h){return v+l-h-1}:function(v,h){return v+h},p=0;p<u.length;p+=l)for(var f=0;f<l;f++){var m=d(p,f);if(f===0)c[m]=i?0:u[m];else{var g=d(p,f-1);c[m]=i?u[g]+c[g]:u[m]+c[g]}}return s},n.prototype.equal=function(t,r){return Q([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},n.prototype.notEqual=function(t,r){return Q([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},n.prototype.less=function(t,r){return Q([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},n.prototype.lessEqual=function(t,r){return Q([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},n.prototype.greater=function(t,r){return Q([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},n.prototype.greaterEqual=function(t,r){return Q([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},n.prototype.logicalNot=function(t){Q(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},n.prototype.logicalAnd=function(t,r){return Q([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},n.prototype.logicalOr=function(t,r){return Q([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},n.prototype.select=function(t,r,i){Q([t,r,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(i.dataId),c=xt(r.shape,hn(r.dtype,i.dtype)),u=this.readSync(c.dataId),l=0,d=t.rank===0||t.rank>1||r.rank===1?1:he(r.shape.slice(1)),p=0;p<o.length;p++)for(var f=0;f<d;f++)o[p]===1?u[l++]=a[p]:u[l++]=s[p];return c},n.prototype.where=function(t){Q([t],"where");var r=this.readSync(t.dataId);return Py(t.shape,r)},n.prototype.topk=function(t,r,i){return Q(t,"topk"),EC(this.readSync(t.dataId),t.shape,t.dtype,r)},n.prototype.min=function(t,r){Q(t,"min"),fr("min",r,t.rank);for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,t.dtype),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=l[p],m=0;m<c;++m){var g=l[p+m];g<f&&(f=g)}u[d]=f}return s},n.prototype.minimum=function(t,r){return Q([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},n.prototype.mod=function(t,r){return Q([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o})},n.prototype.max=function(t,r){Q(t,"max"),fr("max",r,t.rank);for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,t.dtype),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=l[p],m=0;m<c;++m){var g=l[p+m];g>f&&(f=g)}u[d]=f}return s},n.prototype.maximum=function(t,r){return Q([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},n.prototype.all=function(t,r){Q(t,"all"),fr("all",r,t.rank);for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,t.dtype),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=l[p],m=0;m<c;++m){var g=l[p+m];f=f&&g}u[d]=f}return s},n.prototype.any=function(t,r){Q(t,"any"),fr("any",r,t.rank);for(var i=Dn(t.shape,r),o=i[0],a=i[1],s=xt(o,t.dtype),c=he(a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),d=0;d<u.length;++d){for(var p=d*c,f=l[p],m=0;m<c;++m){var g=l[p+m];f=f||g}u[d]=f}return s},n.prototype.squaredDifference=function(t,r){return Q([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var a=i-o;return a*a})},n.prototype.ceil=function(t){Q(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},n.prototype.floor=function(t){Q(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},n.prototype.sign=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},n.prototype.isNaN=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},n.prototype.isInf=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},n.prototype.isFinite=function(t){Q(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},n.prototype.round=function(t){Q(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=Math.floor(r[o]);r[o]-a<.5?i[o]=Math.floor(r[o]):r[o]-a>.5?i[o]=Math.ceil(r[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},n.prototype.exp=function(t){Q(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},n.prototype.expm1=function(t){Q(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},n.prototype.log=function(t){Q(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},n.prototype.log1p=function(t){Q(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},n.prototype.sqrt=function(t){Q(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},n.prototype.rsqrt=function(t){Q(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},n.prototype.reciprocal=function(t){Q(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){Q(t,"relu");for(var r=xt(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return r},n.prototype.relu6=function(t){Q(t,"relu");for(var r=xt(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return r},n.prototype.prelu=function(t,r){return Q([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},n.prototype.elu=function(t){Q(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},n.prototype.eluDer=function(t,r){Q([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var c=o[s];i[s]=c>=1?a[s]:a[s]*(c+1)}return this.makeOutput(i,r.shape,"float32")},n.prototype.selu=function(t){Q(t,"selu");for(var r=Ny,i=My,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var c=a[s];o[s]=c>=0?i*c:r*(Math.exp(c)-1)}return this.makeOutput(o,t.shape,"float32")},n.prototype.clip=function(t,r,i){Q(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var c=a[s];o[s]=c>i?i:c<r?r:c}return this.makeOutput(o,t.shape,"float32")},n.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];r[o]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},n.prototype.int=function(t){Q(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},n.prototype.sigmoid=function(t){Q(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},n.prototype.softplus=function(t){Q(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-r,c=o[a]<r,u=Math.exp(o[a]),l=void 0;l=c?u:s?o[a]:Math.log(1+u),i[a]=l}return this.makeOutput(i,t.shape,"float32")},n.prototype.sin=function(t){Q(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cos=function(t){Q(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tan=function(t){Q(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asin=function(t){Q(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acos=function(t){Q(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan=function(t){Q(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan2=function(t,r){return Q([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},n.prototype.sinh=function(t){Q(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cosh=function(t){Q(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tanh=function(t){Q(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=JI(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asinh=function(t){Q(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acosh=function(t){Q(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atanh=function(t){Q(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},n.prototype.erf=function(t){Q(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),c=1/(1+.3275911*s);r[o]=a*(1-((((1.061405429*c-1.453152027)*c+1.421413741)*c-.284496736)*c+.254829592)*c*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},n.prototype.step=function(t,r){r===void 0&&(r=0),Q(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:r}return this.makeOutput(i,t.shape,"float32")},n.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,c=t.preluActivationWeights,u=this.conv2d(r,i,o);return a&&(u=this.add(u,a)),s&&(u=nm(this,u,s,c)),u},n.prototype.conv2d=function(t,r,i){Q([t,r],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,c=i.dilationWidth,u=i.padInfo.left,l=i.padInfo.top,d=i.dataFormat==="channelsLast",p=Me(i.outShape,t.dtype),f=t.strides[0],m=d?t.strides[1]:t.strides[2],g=d?t.strides[2]:1,v=d?1:t.strides[1],h=p.strides[0],w=d?p.strides[1]:p.strides[2],y=d?p.strides[2]:1,b=d?1:p.strides[1],x=this.readSync(t.dataId),_=this.readSync(r.dataId),C=p.values,R=0;R<i.batchSize;++R)for(var S=R*f,E=R*h,T=0;T<i.outHeight;++T)for(var I=E+T*w,F=T*i.strideHeight-l,z=0;z<o;z++){var j=F+z*s;if(!(j<0||j>=i.inHeight))for(var H=z*r.strides[0],W=S+j*m,L=0;L<i.outWidth;++L)for(var $=I+L*y,k=L*i.strideWidth-u,U=0;U<a;U++){var X=k+U*c;if(!(X<0||X>=i.inWidth))for(var P=W+X*g,ne=H+U*r.strides[1],se=0;se<i.inChannels;++se){for(var te=x[P+se*v],ce=0;ce<i.outChannels;++ce)C[$+ce*b]+=te*_[ne+ce];ne+=i.outChannels}}}return p.toTensor()},n.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,c=i.dilationDepth,u=i.dilationHeight,l=i.dilationWidth,d=i.padInfo.front,p=i.padInfo.left,f=i.padInfo.top,m=Me(i.outShape,t.dtype),g=this.readSync(t.dataId),v=this.readSync(r.dataId),h=m.values,w=0;w<i.batchSize;++w)for(var y=w*t.strides[0],b=w*m.strides[0],x=0;x<i.outDepth;++x)for(var _=b+x*m.strides[1],C=x*i.strideDepth-d,R=0;R<o;R++){var S=C+R*c;if(!(S<0||S>=i.inDepth))for(var E=R*r.strides[0],T=y+S*t.strides[1],I=0;I<i.outHeight;++I)for(var F=_+I*m.strides[2],z=I*i.strideHeight-f,j=0;j<a;j++){var H=z+j*u;if(!(H<0||H>=i.inHeight))for(var W=E+j*r.strides[1],L=T+H*t.strides[2],$=0;$<i.outWidth;++$)for(var k=F+$*i.outChannels,U=$*i.strideWidth-p,X=0;X<s;X++){var P=U+X*l;if(!(P<0||P>=i.inWidth))for(var ne=W+X*r.strides[2],se=L+P*i.inChannels,te=ne,ce=0;ce<i.inChannels;++ce){for(var ye=g[se+ce],Re=0;Re<i.outChannels;++Re)h[k+Re]+=ye*v[te+Re];te+=i.outChannels}}}}return m.toTensor()},n.prototype.conv2dDerInput=function(t,r,i){Q([t,r],"conv2dDerInput");for(var o=Me(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),c=this.readSync(r.dataId),u=r.strides,l=u[0],d=u[1],p=u[2],f=i.batchSize,m=i.filterHeight,g=i.filterWidth,v=i.inChannels,h=i.inHeight,w=i.inWidth,y=i.outChannels,b=i.outHeight,x=i.outWidth,_=i.strideHeight,C=i.strideWidth,R=i.dataFormat,S=m-1-i.padInfo.top,E=g-1-i.padInfo.left,T=R==="channelsLast",I=o.strides[0],F=T?o.strides[1]:o.strides[2],z=T?o.strides[2]:1,j=T?1:o.strides[1],H=t.strides[0],W=T?t.strides[1]:t.strides[2],L=T?t.strides[2]:1,$=T?1:t.strides[1],k=0;k<f;++k)for(var U=0;U<v;++U)for(var X=0;X<h;++X)for(var P=X-S,ne=Math.max(0,Math.ceil(P/_)),se=Math.min(b,(m+P)/_),te=0;te<w;++te){for(var ce=te-E,ye=Math.max(0,Math.ceil(ce/C)),Re=Math.min(x,(g+ce)/C),Je=0,Pe=ne;Pe<se;++Pe)for(var He=Pe*_-P,Ue=ye;Ue<Re;++Ue)for(var at=H*k+W*Pe+L*Ue,Ze=l*(m-1-He)+d*(g-1-(Ue*C-ce))+p*U,st=0;st<y;++st)Je+=s[at+$*st]*c[Ze+st];a[I*k+F*X+z*te+j*U]=Je}return o.toTensor()},n.prototype.conv3dDerInput=function(t,r,i){for(var o=Me(i.inShape,"float32"),a=o.values,s=o.strides,c=s[0],u=s[1],l=s[2],d=s[3],p=this.readSync(t.dataId),f=t.strides,m=f[0],g=f[1],v=f[2],h=f[3],w=this.readSync(r.dataId),y=r.strides,b=y[0],x=y[1],_=y[2],C=y[3],R=i.batchSize,S=i.filterDepth,E=i.filterHeight,T=i.filterWidth,I=i.inChannels,F=i.inDepth,z=i.inHeight,j=i.inWidth,H=i.outChannels,W=i.outDepth,L=i.outHeight,$=i.outWidth,k=i.strideDepth,U=i.strideHeight,X=i.strideWidth,P=S-1-i.padInfo.front,ne=E-1-i.padInfo.top,se=T-1-i.padInfo.left,te=0;te<R;++te)for(var ce=0;ce<I;++ce)for(var ye=0;ye<F;++ye)for(var Re=ye-P,Je=Math.max(0,Math.ceil(Re/k)),Pe=Math.min(W,(S+Re)/k),He=0;He<z;++He)for(var Ue=He-ne,at=Math.max(0,Math.ceil(Ue/U)),Ze=Math.min(L,(E+Ue)/U),st=0;st<j;++st){for(var bn=st-se,Lt=Math.max(0,Math.ceil(bn/X)),tn=Math.min($,(T+bn)/X),Rr=0,zn=Je;zn<Pe;++zn)for(var jn=zn*k-Re,$n=at;$n<Ze;++$n)for(var kr=$n*U-Ue,Un=Lt;Un<tn;++Un)for(var _o=m*te+g*zn+v*$n+h*Un,q=b*(S-1-jn)+x*(E-1-kr)+_*(T-1-(Un*X-bn))+C*ce,Y=0;Y<H;++Y)Rr+=p[_o+Y]*w[q+Y];a[c*te+u*ye+l*He+d*st+ce]=Rr}return o.toTensor()},n.prototype.conv2dDerFilter=function(t,r,i){Q([t,r],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=i.dataFormat==="channelsLast",l=Me(i.filterShape,"float32"),d=i.padInfo.left,p=i.padInfo.top,f=this.bufferSync(t),m=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((p-g)/o)),h=Math.min(i.outHeight,(i.inHeight+p-g)/o),w=0;w<c;++w)for(var y=Math.max(0,Math.ceil((d-w)/a)),b=Math.min(i.outWidth,(i.inWidth+d-w)/a),x=0;x<i.inChannels;++x)for(var _=0;_<i.outChannels;++_){for(var C=0,R=0;R<i.batchSize;++R)for(var S=v;S<h;++S)for(var E=g+S*o-p,T=y;T<b;++T){var I=w+T*a-d;C+=u?f.get(R,E,I,x)*m.get(R,S,T,_):f.get(R,x,E,I)*m.get(R,_,S,T)}l.set(C,g,w,x,_)}return l.toTensor()},n.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,c=i.filterDepth,u=i.filterHeight,l=i.filterWidth,d=Me(i.filterShape,"float32"),p=d.values,f=d.strides,m=f[0],g=f[1],v=f[2],h=f[3],w=this.readSync(r.dataId),y=r.strides,b=y[0],x=y[1],_=y[2],C=y[3],R=this.readSync(t.dataId),S=t.strides,E=S[0],T=S[1],I=S[2],F=S[3],z=i.padInfo.front,j=i.padInfo.left,H=i.padInfo.top,W=0;W<c;++W)for(var L=Math.max(0,Math.ceil((z-W)/o)),$=Math.min(i.outDepth,(i.inDepth+z-W)/o),k=W*m,U=0;U<u;++U)for(var X=Math.max(0,Math.ceil((H-U)/a)),P=Math.min(i.outHeight,(i.inHeight+H-U)/a),ne=U*g+k,se=0;se<l;++se)for(var te=Math.max(0,Math.ceil((j-se)/s)),ce=Math.min(i.outWidth,(i.inWidth+j-se)/s),ye=se*v+ne,Re=0;Re<i.inChannels;++Re)for(var Je=Re*h+ye,Pe=0;Pe<i.outChannels;++Pe){for(var He=0,Ue=0;Ue<i.batchSize;++Ue)for(var at=Ue*E,Ze=Ue*b,st=L;st<$;++st)for(var bn=(W+st*o-z)*T+at,Lt=st*x+Ze,tn=X;tn<P;++tn)for(var Rr=(U+tn*a-H)*I+bn,zn=tn*_+Lt,jn=te;jn<ce;++jn){var $n=jn*C+zn;He+=R[(se+jn*s-j)*F+Rr+Re]*w[$n+Pe]}p[Je+Pe]=He}return d.toTensor()},n.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,c=t.preluActivationWeights,u=this.depthwiseConv2D(r,i,o);return a&&(u=this.add(u,a)),s&&(u=nm(this,u,s,c)),u},n.prototype.depthwiseConv2D=function(t,r,i){Q([t,r],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,c=i.dilationWidth,u=i.padInfo.left,l=i.padInfo.top,d=i.outChannels/i.inChannels,p=Me(i.outShape,t.dtype),f=this.readSync(t.dataId),m=this.readSync(r.dataId),g=p.values,v=0;v<i.batchSize;++v)for(var h=v*t.strides[0],w=v*p.strides[0],y=0;y<i.outHeight;++y)for(var b=w+y*p.strides[1],x=y*i.strideHeight-u,_=0;_<o;++_){var C=x+_*s;if(!(C<0||C>=i.inHeight))for(var R=_*r.strides[0],S=h+C*t.strides[1],E=0;E<i.outWidth;++E)for(var T=b+E*p.strides[2],I=E*i.strideWidth-l,F=0;F<a;++F){var z=I+F*c;if(!(z<0||z>=i.inWidth))for(var j=R+F*r.strides[1],H=S+z*i.inChannels,W=T,L=j,$=0;$<i.inChannels;++$){for(var k=f[H+$],U=0;U<d;++U)g[W+U]+=k*m[L+U];W+=d,L+=d}}}return p.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,r,i){Q([t,r],"depthwiseConv2DDerInput");for(var o=Me(i.inShape,"float32"),a=o.values,s=o.strides,c=s[0],u=s[1],l=s[2],d=this.readSync(t.dataId),p=t.strides,f=p[0],m=p[1],g=p[2],v=this.readSync(r.dataId),h=r.strides,w=h[0],y=h[1],b=h[2],x=i.batchSize,_=i.filterHeight,C=i.filterWidth,R=i.inChannels,S=i.inHeight,E=i.inWidth,T=i.outChannels,I=i.outHeight,F=i.outWidth,z=i.strideHeight,j=i.strideWidth,H=_-1-i.padInfo.top,W=C-1-i.padInfo.left,L=T/R,$=0;$<x;++$)for(var k=0;k<R;++k)for(var U=0;U<S;++U)for(var X=U-H,P=Math.max(0,Math.ceil(X/z)),ne=Math.min(I,(_+X)/z),se=0;se<E;++se){for(var te=se-W,ce=Math.max(0,Math.ceil(te/j)),ye=Math.min(F,(C+te)/j),Re=0,Je=P;Je<ne;++Je)for(var Pe=Je*z-X,He=ce;He<ye;++He)for(var Ue=f*$+m*Je+g*He,at=w*(_-1-Pe)+y*(C-1-(He*j-te))+b*k,Ze=0;Ze<L;++Ze)Re+=d[Ue+(k*L+Ze)]*v[at+Ze];a[c*$+u*U+l*se+k]=Re}return o.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,r,i){Q([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=Me(i.filterShape,"float32"),l=i.padInfo.left,d=i.padInfo.top,p=i.outChannels/i.inChannels,f=this.bufferSync(t),m=this.bufferSync(r),g=0;g<s;++g)for(var v=Math.max(0,Math.ceil((d-g)/o)),h=Math.min(i.outHeight,(i.inHeight+d-g)/o),w=0;w<c;++w)for(var y=Math.max(0,Math.ceil((l-w)/a)),b=Math.min(i.outWidth,(i.inWidth+l-w)/a),x=0;x<i.outChannels;++x){for(var _=Math.trunc(x/p),C=x%p,R=0,S=0;S<i.batchSize;++S)for(var E=v;E<h;++E)for(var T=g+E*o-d,I=y;I<b;++I){var F=w+I*a-l;R+=f.get(S,T,F,_)*m.get(S,E,I,x)}u.set(R,g,w,_,C)}return u.toTensor()},n.prototype.tile=function(t,r){return Q(t,"tile"),kC(this.bufferSync(t),r)},n.prototype.pad=function(t,r,i){Q(t,"pad");var o=r.map(function(p,f){return p[0]+t.shape[f]+p[1]}),a=r.map(function(p){return p[0]}),s=this.bufferSync(t),c=Me(o,t.dtype);i!==0&&c.values.fill(i);for(var u=0;u<t.size;u++){var l=s.indexToLoc(u),d=l.map(function(p,f){return p+a[f]});c.set.apply(c,[s.get.apply(s,l)].concat(d))}return c.toTensor()},n.prototype.transpose=function(t,r){Q(t,"transpose");for(var i=new Array(t.rank),o=0;o<i.length;o++)i[o]=t.shape[r[o]];var a=this.readSync(t.dataId),s=Me(i,t.dtype),c=this.bufferSync(t);for(o=0;o<t.size;++o){for(var u=c.indexToLoc(o),l=new Array(u.length),d=0;d<l.length;d++)l[d]=u[r[d]];var p=s.locToIndex(l);s.values[p]=a[o]}return s.toTensor()},n.prototype.gather=function(t,r,i){Q([t,r],"gather");var o=t.shape.slice(),a=this.readSync(r.dataId);o[i]=a.length;for(var s=Me(o,t.dtype),c=this.bufferSync(t),u=0;u<s.size;++u){var l=s.indexToLoc(u),d=l.slice();d[i]=a[l[i]];var p=c.locToIndex(d);s.values[u]=c.values[p]}return s.toTensor()},n.prototype.batchToSpaceND=function(t,r,i){Q([t],"batchToSpaceND");var o=r.reduce(function(d,p){return d*p}),a=vp(t.shape,r,o),s=yp(a.length,r.length),c=wp(t.shape,r,o),u=fC(i,r.length),l=hC(c,i,r.length);return t.reshape(a).transpose(s).reshape(c).slice(u,l)},n.prototype.spaceToBatchND=function(t,r,i){Q([t],"spaceToBatchND");var o=r.reduce(function(p,f){return p*f}),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var c=t.pad(a),u=vp(c.shape,r,o,!1),l=yp(u.length,r.length,!1),d=wp(c.shape,r,o,!1);return c.reshape(u).transpose(l).reshape(d)},n.prototype.pool=function(t,r,i){Q(t,"pool");for(var o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),g=Me(r.outShape,t.dtype),v=g.values,h=r.outShape[1]*r.outShape[2]*r.outShape[3],w=r.outShape[2]*r.outShape[3],y=r.outShape[3],b=0;b<r.batchSize;++b)for(var x=b*h,_=b*t.strides[0],C=0;C<r.inChannels;++C)for(var R=0;R<r.outHeight;++R)for(var S=R*o-d,E=Math.max(0,S),T=Math.min(r.inHeight,u+S),I=x+R*w,F=0;F<r.outWidth;++F){for(var z=F*a-p,j=Math.max(0,z),H=Math.min(r.inWidth,l+z),W=f,L=0,$=0,k=E;k<T;k+=s){for(var U=_+k*t.strides[1],X=j;X<H;X+=c){var P=m[U+X*t.strides[2]+C];i==="max"&&P>W?W=P:i==="avg"&&(L+=P,$++)}if(isNaN(W))break}v[I+F*y+C]=i==="avg"?L/$:W}return g.toTensor()},n.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},n.prototype.maxPoolPositions=function(t,r){for(var i=Me(r.outShape,"int32"),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,f=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var v=0;v<r.outHeight;++v){for(var h=v*o-d,w=h;w<0;)w+=s;for(var y=Math.min(r.inHeight,u+h),b=0;b<r.outWidth;++b){for(var x=b*a-p,_=x;_<0;)_+=c;for(var C=Math.min(r.inWidth,l+x),R=Number.NEGATIVE_INFINITY,S=-1,E=w;E<y;E+=s)for(var T=E-h,I=_;I<C;I+=c){var F=I-x,z=f.get(m,E,I,g);z>R&&(R=z,S=T*l+F)}i.set(S,m,v,b,g)}}return i.toTensor()},n.prototype.maxPoolBackprop=function(t,r,i,o){Q([r,i],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,o),s=o.strideHeight,c=o.strideWidth,u=o.dilationHeight,l=o.dilationWidth,d=o.effectiveFilterHeight,p=o.effectiveFilterWidth,f=p-1-o.padInfo.left,m=d-1-o.padInfo.top,g=Me(r.shape,"float32"),v=this.bufferSync(a),h=this.bufferSync(t),w=0;w<o.batchSize;++w)for(var y=0;y<o.inChannels;++y)for(var b=0;b<o.inHeight;++b)for(var x=0;x<o.inWidth;++x){for(var _=b-m,C=x-f,R=0,S=0;S<d;S+=u){var E=(_+S)/s;if(!(E<0||E>=o.outHeight||Math.floor(E)!==E))for(var T=0;T<p;T+=l){var I=(C+T)/c;if(!(I<0||I>=o.outWidth||Math.floor(I)!==I)){var F=d*p-1-v.get(w,E,I,y)===S*p+T?1:0;F!==0&&(R+=h.get(w,E,I,y)*F)}}}g.set(R,w,b,x,y)}return g.toTensor()},n.prototype.avgPoolBackprop=function(t,r,i){Q([t,r],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,c=i.filterWidth,u=i.dilationHeight,l=i.dilationWidth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,f=p-1-i.padInfo.left,m=d-1-i.padInfo.top,g=Me(r.shape,"float32"),v=1/(s*c),h=this.bufferSync(t),w=0;w<i.batchSize;++w)for(var y=0;y<i.inChannels;++y)for(var b=0;b<i.inHeight;++b)for(var x=0;x<i.inWidth;++x){for(var _=b-m,C=x-f,R=0,S=0;S<d;S+=u){var E=(_+S)/o;if(!(E<0||E>=i.outHeight||Math.floor(E)!==E))for(var T=0;T<p;T+=l){var I=(C+T)/a;I<0||I>=i.outWidth||Math.floor(I)!==I||(R+=h.get(w,E,I,y))}}g.set(R*v,w,b,x,y)}return g.toTensor()},n.prototype.pool3d=function(t,r,i){Q(t,"pool3d");for(var o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,h=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=this.readSync(t.dataId),y=Me(r.outShape,t.dtype),b=y.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],R=r.outShape[4],S=0;S<r.batchSize;++S)for(var E=S*x,T=S*t.strides[0],I=0;I<r.inChannels;++I)for(var F=0;F<r.outDepth;++F){for(var z=F*o-m,j=z;j<0;)j+=c;for(var H=Math.min(r.inDepth,d+z),W=E+F*_,L=0;L<r.outHeight;++L){for(var $=L*a-g,k=$;k<0;)k+=u;for(var U=Math.min(r.inHeight,p+$),X=W+L*C,P=0;P<r.outWidth;++P){for(var ne=P*s-v,se=ne;se<0;)se+=l;for(var te=Math.min(r.inWidth,f+ne),ce=X+P*R,ye=h,Re=0,Je=0,Pe=j;Pe<H;Pe+=c){for(var He=T+Pe*t.strides[1],Ue=k;Ue<U;Ue+=u){for(var at=He+Ue*t.strides[2],Ze=se;Ze<te;Ze+=l){var st=w[at+Ze*t.strides[3]+I];if(i==="max"&&st>ye?ye=st:i==="avg"&&(Re+=st,Je++),isNaN(ye))break}if(isNaN(ye))break}if(isNaN(ye))break}b[ce+I]=i==="avg"?Re/Je:ye}}}return y.toTensor()},n.prototype.avgPool3d=function(t,r){return Q(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(t,r,i){Q([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,c=i.filterDepth,u=i.filterHeight,l=i.filterWidth,d=i.dilationDepth,p=i.dilationHeight,f=i.dilationWidth,m=i.effectiveFilterDepth,g=i.effectiveFilterHeight,v=i.effectiveFilterWidth,h=m-1-i.padInfo.front,w=v-1-i.padInfo.left,y=g-1-i.padInfo.top,b=Me(r.shape,"float32"),x=1/(c*u*l),_=this.bufferSync(t),C=0;C<i.batchSize;++C)for(var R=0;R<i.inChannels;++R)for(var S=0;S<i.inDepth;++S)for(var E=0;E<i.inHeight;++E)for(var T=0;T<i.inWidth;++T){for(var I=S-h,F=E-y,z=T-w,j=0,H=0;H<m;H+=d){var W=(I+H)/o;if(!(W<0||W>=i.outDepth||Math.floor(W)!==W))for(var L=0;L<g;L+=p){var $=(F+L)/a;if(!($<0||$>=i.outHeight||Math.floor($)!==$))for(var k=0;k<v;k+=f){var U=(z+k)/s;U<0||U>=i.outWidth||Math.floor(U)!==U||(j+=_.get(C,W,$,U,R))}}}b.set(j*x,C,S,E,T,R)}return b.toTensor()},n.prototype.maxPool3d=function(t,r){return Q(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(t,r){for(var i=Me(r.outShape,"int32"),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,d=r.effectiveFilterDepth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,v=r.padInfo.left,h=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var y=0;y<r.inChannels;++y)for(var b=0;b<r.outDepth;++b){for(var x=b*o-m,_=x;_<0;)_+=c;for(var C=Math.min(r.inDepth,d+x),R=0;R<r.outHeight;++R){for(var S=R*a-g,E=S;E<0;)E+=u;for(var T=Math.min(r.inHeight,p+S),I=0;I<r.outWidth;++I){for(var F=I*s-v,z=F;z<0;)z+=l;for(var j=Math.min(r.inWidth,f+F),H=Number.NEGATIVE_INFINITY,W=-1,L=_;L<C;L+=c)for(var $=L-x,k=E;k<T;k+=u)for(var U=k-S,X=z;X<j;X+=l){var P=X-F,ne=h.get(w,L,k,X,y);ne>=H&&(H=ne,W=$*p*f+U*p+P)}i.set(W,w,b,R,I,y)}}}return i.toTensor()},n.prototype.maxPool3dBackprop=function(t,r,i,o){Q([r,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,o),s=o.strideDepth,c=o.strideHeight,u=o.strideWidth,l=o.dilationDepth,d=o.dilationHeight,p=o.dilationWidth,f=o.effectiveFilterDepth,m=o.effectiveFilterHeight,g=o.effectiveFilterWidth,v=f-1-o.padInfo.front,h=g-1-o.padInfo.left,w=m-1-o.padInfo.top,y=Me(r.shape,"float32"),b=this.bufferSync(a),x=this.bufferSync(t),_=0;_<o.batchSize;++_)for(var C=0;C<o.inChannels;++C)for(var R=0;R<o.inDepth;++R)for(var S=0;S<o.inHeight;++S)for(var E=0;E<o.inWidth;++E){for(var T=R-v,I=S-w,F=E-h,z=0,j=0;j<f;j+=l){var H=(T+j)/s;if(!(H<0||H>=o.outDepth||Math.floor(H)!==H))for(var W=0;W<m;W+=d){var L=(I+W)/c;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var $=0;$<g;$+=p){var k=(F+$)/u;if(!(k<0||k>=o.outWidth||Math.floor(k)!==k)){var U=f*m*g-1-b.get(_,H,L,k,C)===j*m*g+W*g+$?1:0;U!==0&&(z+=x.get(_,H,L,k,C)*U)}}}}y.set(z,_,R,S,E,C)}return y.toTensor()},n.prototype.cast=function(t,r){return _C(t,r,this)},n.prototype.reshape=function(t,r){return Xg(t,r)},n.prototype.avgPool=function(t,r){return Q(t,"avgPool"),this.pool(t,r,"avg").toFloat()},n.prototype.resizeBilinear=function(t,r,i,o){Q(t,"resizeBilinear");for(var a=t.shape,s=a[0],c=a[1],u=a[2],l=a[3],d=this.readSync(t.dataId),p=new Float32Array(he([s,r,i,l])),f=[o&&r>1?c-1:c,o&&i>1?u-1:u],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=0,v=f[0]/m[0],h=f[1]/m[1],w=0;w<s;w++)for(var y=0;y<r;y++)for(var b=v*y,x=Math.floor(b),_=b-x,C=Math.min(c-1,Math.ceil(b)),R=w*t.strides[0]+x*t.strides[1],S=w*t.strides[0]+C*t.strides[1],E=0;E<i;E++)for(var T=h*E,I=Math.floor(T),F=T-I,z=Math.min(u-1,Math.ceil(T)),j=R+I*t.strides[2],H=S+I*t.strides[2],W=R+z*t.strides[2],L=S+z*t.strides[2],$=0;$<l;$++){var k=d[j+$],U=d[H+$],X=k+(d[W+$]-k)*F,P=X+(U+(d[L+$]-U)*F-X)*_;p[g++]=P}return mn(p,[s,r,i,l])},n.prototype.resizeBilinearBackprop=function(t,r,i){Q([t,r],"resizeBilinearBackprop");for(var o=r.shape,a=o[0],s=o[1],c=o[2],u=o[3],l=t.shape,d=l[1],p=l[2],f=new Float32Array(a*s*c*u),m=[i&&d>1?s-1:s,i&&p>1?c-1:c],g=[i&&d>1?d-1:d,i&&p>1?p-1:p],v=m[0]/g[0],h=m[1]/g[1],w=this.readSync(t.dataId),y=0,b=0;b<a;b++)for(var x=b*r.strides[0],_=0;_<d;_++)for(var C=_*v,R=Math.floor(C),S=Math.min(Math.ceil(C),s-1),E=x+R*r.strides[1],T=x+S*r.strides[1],I=C-R,F=1-I,z=0;z<p;z++)for(var j=z*h,H=Math.floor(j),W=Math.min(Math.ceil(j),c-1),L=j-H,$=1-L,k=E+H*r.strides[2],U=E+W*r.strides[2],X=T+H*r.strides[2],P=T+W*r.strides[2],ne=F*$,se=F*L,te=I*$,ce=I*L,ye=0;ye<u;ye++){var Re=w[y++];f[k+ye]+=Re*ne,f[U+ye]+=Re*se,f[X+ye]+=Re*te,f[P+ye]+=Re*ce}return Yn(f,[a,c,s,u],r.dtype)},n.prototype.resizeNearestNeighbor=function(t,r,i,o){Q(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],c=a[1],u=a[2],l=a[3],d=this.readSync(t.dataId),p=new Float32Array(s*r*i*l),f=[o&&r>1?c-1:c,o&&i>1?u-1:u],m=[o&&r>1?r-1:r,o&&i>1?i-1:i],g=f[0]/m[0],v=f[1]/m[1],h=0,w=0;w<s;w++)for(var y=w*t.strides[0],b=0;b<r;b++)for(var x=g*b,_=y+Math.min(c-1,o?Math.round(x):Math.floor(x))*t.strides[1],C=0;C<i;C++)for(var R=v*C,S=_+Math.min(u-1,o?Math.round(R):Math.floor(R))*t.strides[2],E=0;E<l;E++){var T=d[S+E];p[h++]=T}return mn(p,[s,r,i,l],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,r,i){Q([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,a=o[0],s=o[1],c=o[2],u=o[3],l=t.shape,d=l[1],p=l[2],f=new Float32Array(a*s*c*u),m=this.readSync(t.dataId),g=[i&&d>1?s-1:s,i&&p>1?c-1:c],v=[i&&d>1?d-1:d,i&&p>1?p-1:p],h=g[0]/v[0],w=g[1]/v[1],y=1/h,b=1/w,x=2*Math.ceil(y)+2,_=2*Math.ceil(b)+2,C=0;C<a;C++)for(var R=C*r.strides[0],S=0;S<s;S++)for(var E=R+S*r.strides[1],T=Math.floor(S*y),I=Math.floor(T-x/2),F=0;F<c;F++)for(var z=E+F*r.strides[2],j=Math.floor(F*b),H=Math.floor(j-_/2),W=0;W<u;W++){for(var L=0,$=0;$<x;$++){var k=$+I;if(!(k<0||k>=d)){var U=R+k*t.strides[1],X=k*h;if(S===Math.min(s-1,i?Math.round(X):Math.floor(X)))for(var P=0;P<_;P++){var ne=P+H;if(!(ne<0||ne>=p)){var se=U+ne*t.strides[2],te=ne*w;F===Math.min(c-1,i?Math.round(te):Math.floor(te))&&(L+=m[se+W])}}}}f[z+W]=L}return Yn(f,r.shape,r.dtype)},n.prototype.batchNormalization=function(t,r,i,o,a,s){Q([t,r,i,a,s],"batchNorm");for(var c=this.readSync(t.dataId),u=this.readSync(r.dataId),l=this.readSync(i.dataId),d=a?this.readSync(a.dataId):new Float32Array([1]),p=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(c.length),m=p.length,g=d.length,v=l.length,h=u.length,w=0,y=0,b=0,x=0,_=0;_<c.length;++_)f[_]=p[w++]+(c[_]-u[y++])*d[b++]/Math.sqrt(l[x++]+o),w>=m&&(w=0),y>=h&&(y=0),b>=g&&(b=0),x>=v&&(x=0);return Yn(f,t.shape)},n.prototype.localResponseNormalization4D=function(t,r,i,o,a){Q(t,"localResponseNormalization4D");var s=t.shape[3],c=s-1,u=this.readSync(t.dataId),l=t.size,d=new Float32Array(l);function p(v){for(var h=v%s,w=v-h+Math.max(0,h-r),y=v-h+Math.min(h+r,c),b=0;w<=y;w++){var x=u[w];b+=x*x}return b}for(var f=0;f<l;f++){var m=p(f),g=u[f]*Math.pow(i+o*m,-a);d[f]=g}return Yn(d,t.shape)},n.prototype.LRNGrad=function(t,r,i,o,a,s,c){Q(t,"LRNGrad");for(var u=t.shape[3],l=this.readSync(t.dataId),d=this.readSync(r.dataId),p=this.readSync(i.dataId),f=new Float32Array(t.size),m=t.size,g=0;g<m;g++){for(var v=g%u,h=g-v+Math.max(0,v-o),w=g-v+Math.min(u,v+o+1),y=0,b=h;b<w;b++)y+=Math.pow(d[b],2);for(y=s*y+a,b=h;b<w;b++){var x=-2*s*c*d[b]*p[g]/y;g===b&&(x+=Math.pow(y,-c)),x*=l[g],f[b]+=x}}return Yn(f,t.shape)},n.prototype.multinomial=function(t,r,i,o){Q(t,"multinomial");for(var a=r?t:go(t),s=a.shape[0],c=a.shape[1],u=xt([s,i],"int32"),l=this.readSync(u.dataId),d=this.readSync(a.dataId),p=0;p<s;++p){var f=p*c,m=new Float32Array(c-1);m[0]=d[f];for(var g=1;g<m.length;++g)m[g]=m[g-1]+d[f+g];for(var v=Yp(o.toString()),h=p*i,w=0;w<i;++w){var y=v();l[h+w]=m.length;for(var b=0;b<m.length;b++)if(y<m[b]){l[h+w]=b;break}}}return u},n.prototype.oneHot=function(t,r,i,o){Q(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(o);for(var s=this.readSync(t.dataId),c=0;c<t.size;++c)s[c]>=0&&s[c]<r&&(a[c*r+s[c]]=i);return Jo(a,[t.size,r],"int32")},n.prototype.nonMaxSuppression=function(t,r,i,o,a){return Q(t,"nonMaxSuppression"),Dy(this.readSync(t.dataId),this.readSync(r.dataId),i,o,a)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],a=Me(t.shape,"float32"),s=Me(t.shape,"float32"),c=Nr(t).as2D(i,o),u=Ri(t).as2D(i,o),l=0;l<i;l++)for(var d=c.slice([l,0],[1,o]),p=u.slice([l,0],[1,o]),f=fn(d,p),m=this.readSync(this.fftImpl(f,r).dataId),g=0;g<o;g++){var v=F1(m,g);a.values[l*o+g]=v.real,s.values[l*o+g]=v.imag}return fn(a.toTensor(),s.toTensor()).as2D(i,o)},n.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(a=fn(Nr(a).div(re(o)),Ri(a).div(re(o)))),a}var s=this.readSync(t.dataId),c=function(u){for(var l=new Float32Array(u.length/2),d=new Float32Array(u.length/2),p=0;p<u.length;p+=2)l[p/2]=u[p],d[p/2]=u[p+1];return{real:l,imag:d}}(this.fourierTransformByMatmul(s,o,r));return fn(c.real,c.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),a=r/2,s=function(h){for(var w=Math.ceil(h.length/4),y=new Float32Array(w),b=new Float32Array(w),x=0;x<h.length;x+=4)y[Math.floor(x/4)]=h[x],b[Math.floor(x/4)]=h[x+1];return{real:y,imag:b}}(o),c=fn(s.real,s.imag).as1D(),u=function(h){for(var w=Math.floor(h.length/4),y=new Float32Array(w),b=new Float32Array(w),x=2;x<h.length;x+=4)y[Math.floor(x/4)]=h[x],b[Math.floor(x/4)]=h[x+1];return{real:y,imag:b}}(o),l=fn(u.real,u.imag).as1D();c=this.fftRadix2(c,a,i),l=this.fftRadix2(l,a,i);var d=function(h,w){for(var y=new Float32Array(h/2),b=new Float32Array(h/2),x=0;x<Math.ceil(h/2);x++){var _=(w?2:-2)*Math.PI*(x/h);y[x]=Math.cos(_),b[x]=Math.sin(_)}return{real:y,imag:b}}(r,i),p=fn(d.real,d.imag).mul(l),f=c.add(p),m=c.sub(p),g=Nr(f).concat(Nr(m)),v=Ri(f).concat(Ri(m));return fn(g,v).as1D()},n.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,c=0,u=0;u<r;u++){var l=PA(a*u,r,i),d=F1(t,u);s+=d.real*l.real-d.imag*l.imag,c+=d.real*l.imag+d.imag*l.real}i&&(s/=r,c/=r),IA(o,s,c,a)}return o},n.prototype.depthToSpace=function(t,r,i){A(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),A(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],c=t.shape[3],u=a*r,l=s*r,d=c/(r*r),p=this.readSync(t.dataId),f=new Float32Array(o*u*l*d),m=0,g=0;g<o;++g)for(var v=0;v<u;++v)for(var h=Math.floor(v/r),w=v%r,y=0;y<l;++y)for(var b=Math.floor(y/r),x=(w*r+y%r)*d,_=0;_<d;++_){var C=_+x+c*(b+s*(h+a*g));f[m++]=p[C]}return Yn(f,[o,u,l,d])},n.prototype.broadcastedBinaryOp=function(t,r,i,o){var a=je(t.shape,r.shape),s=Me(a,i),c=this.readSync(t.dataId),u=this.readSync(r.dataId),l=$o(t.shape,a),d=$o(r.shape,a),p=s.values;if(l.length+d.length===0)for(var f=0;f<p.length;++f)p[f]=o(c[f%c.length],u[f%u.length]);else{var m=this.bufferSync(t),g=this.bufferSync(r),v=function(h){var w=s.indexToLoc(h),y=w.slice(-t.rank);l.forEach(function(C){return y[C]=0});var b=m.locToIndex(y),x=w.slice(-r.rank);d.forEach(function(C){return x[C]=0});var _=g.locToIndex(x);p[h]=o(c[b],u[_])};for(f=0;f<p.length;++f)v(f)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=je(t.shape,r.shape),a=Me(o,"float32"),s=Me(o,"float32"),c=this.readSync(t.dataId),u=this.readSync(r.dataId),l=$o(t.shape,o),d=$o(r.shape,o),p=a.values,f=s.values;if(l.length+d.length===0)for(var m=0;m<p.length;m++){var g=m%c.length,v=m%u.length,h=i(c[2*g],c[2*g+1],u[2*v],u[2*v+1]);p[m]=h.real,f[m]=h.imag}else{var w=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(x){var _=a.indexToLoc(x),C=_.slice(-t.rank);l.forEach(function(I){return C[I]=0});var R=w.locToIndex(C),S=_.slice(-r.rank);d.forEach(function(I){return S[I]=0});var E=y.locToIndex(S),T=i(c[2*R],c[2*R+1],u[2*E],u[2*E+1]);p[x]=T.real,f[x]=T.imag};for(m=0;m<p.length;m++)b(m)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(t,r,i){return RC(t,r,i)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(t,r,i,o,a,s){for(var c=t.shape,u=c[0],l=c[1],d=c[2],p=c[3],f=r.shape[0],m=o[0],g=o[1],v=Me([f,m,g,p],"float32"),h=this.readSync(r.dataId),w=this.readSync(i.dataId),y=this.readSync(t.dataId),b=t.strides,x=v.strides,_=0;_<f;_++){var C=4*_,R=h[C],S=h[C+1],E=h[C+2],T=h[C+3],I=w[_];if(!(I>=u))for(var F=m>1?(E-R)*(l-1)/(m-1):0,z=g>1?(T-S)*(d-1)/(g-1):0,j=0;j<m;j++){var H=m>1?R*(l-1)+j*F:.5*(R+E)*(l-1);if(H<0||H>l-1)for(var W=0;W<g;W++)for(var L=0;L<p;L++){var $=L+W*x[2]+j*x[1]+_*x[0];v.values[$]=s}else if(a==="bilinear"){var k=Math.floor(H),U=Math.ceil(H),X=H-k;for(W=0;W<g;W++)if((Pe=g>1?S*(d-1)+W*z:.5*(S+T)*(d-1))<0||Pe>d-1)for(L=0;L<p;L++)$=L+W*x[2]+j*x[1]+_*x[0],v.values[$]=s;else{var P=Math.floor(Pe),ne=Math.ceil(Pe),se=Pe-P;for(L=0;L<p;L++){var te=y[$=L+P*b[2]+k*b[1]+I*b[0]],ce=y[$=L+ne*b[2]+k*b[1]+I*b[0]],ye=y[$=L+P*b[2]+U*b[1]+I*b[0]],Re=te+(ce-te)*se,Je=ye+(y[$=L+ne*b[2]+U*b[1]+I*b[0]]-ye)*se;$=L+W*x[2]+j*x[1]+_*x[0],v.values[$]=Re+(Je-Re)*X}}}else for(W=0;W<g;++W){var Pe;if((Pe=g>1?S*(d-1)+W*z:.5*(S+T)*(d-1))<0||Pe>d-1)for(L=0;L<p;L++)$=L+W*x[2]+j*x[1]+_*x[0],v.values[$]=s;else{var He=Math.round(Pe),Ue=Math.round(H);for(L=0;L<p;L++){var at=L+He*b[2]+Ue*b[1]+I*b[0],Ze=L+W*x[2]+j*x[1]+_*x[0];v.values[Ze]=y[at]}}}}}return v.toTensor()},n.prototype.sparseToDense=function(t,r,i,o){var a=bp(0,t,i),s=a.sliceRank,c=a.numUpdates,u=a.sliceSize,l=a.strides,d=a.outputSize;return this.scatter(t,r,i,d,u,c,s,l,o,!1)},n.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=mC(t,r),s=a[0],c=a[1],u=a[2],l=a[3];if(c===0)return mn([],s,t.dtype);for(var d=new $u([c,u],t.dtype),p=this.readSync(r.dataId),f=this.readSync(t.dataId),m=0;m<c;m++){for(var g=[],v=0,h=0;h<o;h++){var w=p[m*o+h];v+=w*l[h],g.push(w)}if(v<0||v>=t.size/u)throw new Error("Invalid indices: "+g+" does not index into "+t.shape);for(var y=0;y<u;y++)d.values[m*u+y]=f[v*u+y]}return d.toTensor().reshape(s)},n.prototype.scatterND=function(t,r,i){var o=bp(0,t,i),a=o.sliceRank,s=o.numUpdates,c=o.sliceSize,u=o.strides,l=o.outputSize,d=re(0);return this.scatter(t,r,i,l,c,s,a,u,d,!0)},n.prototype.fill=function(t,r,i){var o=lp(i=i||Ju(r),he(t));return o.fill(r),O.makeTensor(o,t,i,this)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var r=lp(t.dtype,he(t.shape));return this.makeOutput(r,t.shape,t.dtype)},n.prototype.linspace=function(t,r,i){return SC(t,r,i)},n.prototype.scatter=function(t,r,i,o,a,s,c,u,l,d){var p=[o/a,a],f=this.readSync(t.dataId),m=this.readSync(r.dataId);if(o===0)return mn([],i,r.dtype);var g=new $u(p,r.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var v=0;v<s;v++){for(var h=[],w=0,y=0;y<c;y++){var b=f[v*c+y];h.push(b),w+=b*u[y]}if(w<0||w>=o/a)throw new Error("Invalid indices: "+h+" does not index into "+i);for(var x=0;x<a;x++)d?g.values[w*a+x]+=m[v*a+x]:g.values[w*a+x]=r.rank===0?m[0]:m[v*a+x]}return g.toTensor().reshape(i)},n}(bC);O.registerBackend("cpu",function(){return new Y4},1);for(var rm=0,ob=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,i=n,o=i.boxes,a=i.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,p=t;Q(o,"NonMaxSuppressionWithScore");var f=Iy(p.data.get(o.dataId).values,p.data.get(a.dataId).values,c,u,l,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,i=t;Q(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var c=o[s];a[s]=c*c}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Vu,backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,i=r.a,o=r.b,a=t;Q([i,o],Vu);var s=a.data.get(i.dataId).values,c=a.data.get(o.dataId).values,u=function(p,f,m,g,v,h){var w=je(p,f),y=w.length,b=Pi(w),x=ju(v,he(w)),_=p.length,C=f.length,R=Pi(p),S=Pi(f),E=$o(p,w),T=$o(f,w);if(E.length+T.length===0)for(var I=0;I<x.length;++I)x[I]=h(m[I%m.length],g[I%g.length]);else{var F=function(z){var j=sP(z,y,b),H=j.slice(-_);E.forEach(function(k){return H[k]=0});var W=T1(H,_,R),L=j.slice(-C);T.forEach(function(k){return L[k]=0});var $=T1(L,C,S);x[z]=h(m[W],g[$])};for(I=0;I<x.length;++I)F(I)}return[x,w]}(i.shape,o.shape,s,c,i.dtype,function(p,f){var m=p-f;return m*m}),l=u[0],d=u[1];return{dataId:a.write(l,d,i.dtype),shape:d,dtype:i.dtype}}}];rm<ob.length;rm++)K2(ob[rm]);var ss,J4=function(e){this.variableNames=["A"];var n=An(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},Z4=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=An(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(var im=0,ab=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,i=n.pixels,o=r.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,c=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],u=c[0],l=c[1],d=[l,u],p=[l,u,o];(s||a)&&(ss==null&&(ss=document.createElement("canvas").getContext("2d")),ss.canvas.width=u,ss.canvas.height=l,ss.drawImage(i,0,0,u,l),i=ss.canvas);var f=t.makeTensorInfo(d,"int32");t.texData.get(f.dataId).usage=gr.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(f.dataId),i);var m=K().getBool("WEBGL_PACK")?new Z4(p):new J4(p),g=t.runWebGLProgram(m,[f],"int32");return t.disposeData(f.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs;hp("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=n,o=i.boxes,a=i.scores,s=r,c=s.maxOutputSize,u=s.iouThreshold,l=s.scoreThreshold,d=s.softNmsSigma,p=t,f=Iy(p.readSync(o.dataId),p.readSync(a.dataId),c,u,l,d);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,i=t,o=new Oe(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Vu,backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,i=r.a,o=r.b,a=t,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new to("return (a - b) * (a - b);",i.shape,o.shape):new Nt("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}}];im<ab.length;im++)K2(ab[im]);for(var om=0,sb=[{kernelName:"Square",gradFunc:function(e,n){var t=n[0];return{x:function(){return e.mul(t.toFloat().mul(2))}}}},{kernelName:Vu,gradFunc:function(e,n){var t=n[0],r=n[1],i=re(2);return{a:function(){return Mn(e,Mn(i,Zt(t,r)))},b:function(){return Mn(e,Mn(i,Zt(r,t)))}}}}];om<sb.length;om++)QI(sb[om]);var eL=function(){function e(){}return e.prototype.fetch=function(n,t){return fetch(n,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},e}();K().get("IS_BROWSER")&&K().setPlatform("browser",new eL);var am,tL=function(){return require("node-fetch")},nL=function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(n,t){return K().global.fetch!=null?K().global.fetch(n,t):(am==null&&(am=tL()),am(n,t))},e.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return n.length===0?"":new this.util.TextDecoder(t).decode(n)},e}();K().get("IS_NODE")&&K().setPlatform("node",new nL);var Jg={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ep=4;function vR(e,n){for(var t={},r=0,i=function(s){var c=s.name,u=s.dtype,l=s.shape,d=he(l),p=void 0;if("quantization"in s){var f=s.quantization;if(f.dtype!=="uint8"&&f.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+f.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var m=Jg[f.dtype],g=e.slice(r,r+d*m),v=f.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(u==="float32")p=Float32Array.from(v,function(_){return _*f.scale+f.min});else{if(u!=="int32")throw new Error("Unsupported dtype in weight '"+c+"': "+u);p=Int32Array.from(v,function(_){return Math.round(_*f.scale+f.min)})}r+=d*m}else if(u==="string"){var h=he(s.shape);p=[];for(var w=0;w<h;w++){var y=new Uint32Array(e.slice(r,r+Ep))[0];r+=Ep;var b=new Uint8Array(e.slice(r,r+y));p.push(b),r+=y}}else{var x=Jg[u];if(g=e.slice(r,r+d*x),u==="float32")p=new Float32Array(g);else if(u==="int32")p=new Int32Array(g);else{if(u!=="bool")throw new Error("Unsupported dtype in weight '"+c+"': "+u);p=new Uint8Array(g)}r+=d*x}t[c]=mn(p,l,u)},o=0,a=n;o<a.length;o++)i(a[o]);return t}function rL(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var n=0,t=[];e.forEach(function(o){if(n+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(n),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var Zg=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function cb(e){return Zg?Buffer.byteLength(e):new Blob([e]).size}function Xy(e){var n=0;e.forEach(function(i){n+=i.byteLength});var t=new Uint8Array(n),r=0;return e.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function ub(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var n=e.split("/");return n[n.length-1]}function ol(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:cb(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:cb(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var vr=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(n){e.getInstance().saveRouters.push(n)},e.registerLoadRouter=function(n){e.getInstance().loadRouters.push(n)},e.getSaveHandlers=function(n){return e.getHandlers(n,"save")},e.getLoadHandlers=function(n,t){return e.getHandlers(n,"load",t)},e.getHandlers=function(n,t,r){var i=[];return(t==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach(function(o){var a=o(n,r);a!==null&&i.push(a)}),i},e}(),nc="://",Zo=function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(n,t){A(n!=null,function(){return"scheme must not be undefined or null."}),n.endsWith(nc)&&(n=n.slice(0,n.indexOf(nc))),A(n.length>0,function(){return"scheme must not be an empty string."});var r=e.getInstance();A(r.managers[n]==null,function(){return"A model store manager is already registered for scheme '"+n+"'."}),r.managers[n]=t},e.getManager=function(n){var t=this.getInstance().managers[n];if(t==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function Id(e){if(e.indexOf(nc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Zo.getSchemes().join(","));return{scheme:e.split(nc)[0],path:e.split(nc)[1]}}function lb(e,n,t){return t===void 0&&(t=!1),ue(this,void 0,void 0,function(){var r,i,o,a,s,c,u,l,d;return le(this,function(p){switch(p.label){case 0:return A(e!==n,function(){return"Old path and new path are the same: '"+e+"'"}),A((r=vr.getLoadHandlers(e)).length>0,function(){return"Copying failed because no load handler is found for source URL "+e+"."}),A(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."}),i=r[0],A((o=vr.getSaveHandlers(n)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+n+"."}),A(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."}),a=o[0],s=Id(e).scheme,c=Id(e).path,u=s===Id(e).scheme,[4,i.load()];case 1:return l=p.sent(),t&&u?[4,Zo.getManager(s).removeModel(c)]:[3,3];case 2:p.sent(),p.label=3;case 3:return[4,a.save(l)];case 4:return d=p.sent(),!t||u?[3,6]:[4,Zo.getManager(s).removeModel(c)];case 5:p.sent(),p.label=6;case 6:return[2,d.modelArtifactsInfo]}})})}var Da="models_store",Uo="model_info_store";function yR(){if(!K().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,n=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function ev(e){var n=e.result;n.createObjectStore(Da,{keyPath:"modelPath"}),n.createObjectStore(Uo,{keyPath:"modelPath"})}var rc=function(){function e(n){if(this.indexedDB=yR(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return e.prototype.save=function(n){return ue(this,void 0,void 0,function(){return le(this,function(t){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]})})},e.prototype.load=function(){return ue(this,void 0,void 0,function(){return le(this,function(n){return[2,this.databaseAction(this.modelPath)]})})},e.prototype.databaseAction=function(n,t){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return ev(a)},a.onsuccess=function(){var s=a.result;if(t==null){var c=s.transaction(Da,"readonly"),u=c.objectStore(Da).get(r.modelPath);u.onsuccess=function(){if(u.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(u.result.modelArtifacts)},u.onerror=function(g){return s.close(),o(u.error)},c.oncomplete=function(){return s.close()}}else{var l,d=ol(t),p=s.transaction(Uo,"readwrite"),f=p.objectStore(Uo),m=f.put({modelPath:r.modelPath,modelArtifactsInfo:d});m.onsuccess=function(){var g=(l=s.transaction(Da,"readwrite")).objectStore(Da).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:d});g.onsuccess=function(){return i({modelArtifactsInfo:d})},g.onerror=function(v){var h=(f=p.objectStore(Uo)).delete(r.modelPath);h.onsuccess=function(){return s.close(),o(g.error)},h.onerror=function(w){return s.close(),o(g.error)}}},m.onerror=function(g){return s.close(),o(m.error)},p.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},e.URL_SCHEME="indexeddb://",e}(),db=function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(rc.URL_SCHEME)?(n=e.slice(rc.URL_SCHEME.length),new rc(n)):null;var n};vr.registerSaveRouter(db),vr.registerLoadRouter(db);var iL=function(){function e(){this.indexedDB=yR()}return e.prototype.listModels=function(){return ue(this,void 0,void 0,function(){var n=this;return le(this,function(t){return[2,new Promise(function(r,i){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return ev(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Uo,"readonly"),c=s.objectStore(Uo).getAll();c.onsuccess=function(){for(var u={},l=0,d=c.result;l<d.length;l++){var p=d[l];u[p.modelPath]=p.modelArtifactsInfo}r(u)},c.onerror=function(u){return a.close(),i(c.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},e.prototype.removeModel=function(n){return ue(this,void 0,void 0,function(){var t=this;return le(this,function(r){var i;return n=(i=n).startsWith(rc.URL_SCHEME)?i.slice(rc.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return ev(s)},s.onsuccess=function(){var c,u=s.result,l=u.transaction(Uo,"readwrite"),d=l.objectStore(Uo),p=d.get(n);p.onsuccess=function(){if(p.result==null)return u.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var f=d.delete(n),m=function(){var g=(c=u.transaction(Da,"readwrite")).objectStore(Da).delete(n);g.onsuccess=function(){return o(p.result.modelArtifactsInfo)},g.onerror=function(v){return a(p.error)}};f.onsuccess=m,f.onerror=function(g){return m(),u.close(),a(p.error)}},p.onerror=function(f){return u.close(),a(p.error)},l.oncomplete=function(){c==null?u.close():c.oncomplete=function(){return u.close()}}},s.onerror=function(c){return a(s.error)}})]})})},e}();if(K().getBool("IS_BROWSER"))try{Zo.registerManager(rc.URL_SCHEME,new iL)}catch{}var io="/",Ms="tensorflowjs_models",wR="info",oL="model_topology",aL="weight_specs",sL="weight_data",cL="model_metadata";function bR(e){return{info:[Ms,e,wR].join(io),topology:[Ms,e,oL].join(io),weightSpecs:[Ms,e,aL].join(io),weightData:[Ms,e,sL].join(io),modelMetadata:[Ms,e,cL].join(io)}}function uL(e){var n=e.split(io);if(n.length<3)throw new Error("Invalid key format: "+e);return n.slice(1,n.length-1).join(io)}var ic=function(){function e(n){if(!K().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=bR(this.modelPath)}return e.prototype.save=function(n){return ue(this,void 0,void 0,function(){var t,r,i;return le(this,function(o){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),i=ol(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(a){if(Zg)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),c="",u=0,l=s.length;u<l;u++)c+=String.fromCharCode(s[u]);return btoa(c)}(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},e.prototype.load=function(){return ue(this,void 0,void 0,function(){var n,t,r,i,o,a,s;return le(this,function(c){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(u){if(Zg){var l=Buffer.from(u,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var d=atob(u),p=new Uint8Array(d.length),f=0;f<d.length;++f)p.set([d.charCodeAt(f)],f);return p.buffer}(s),[2,t]})})},e.URL_SCHEME="localstorage://",e}(),pb=function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ic.URL_SCHEME)?(n=e.slice(ic.URL_SCHEME.length),new ic(n)):null;var n};vr.registerSaveRouter(pb),vr.registerLoadRouter(pb);var lL=function(){function e(){A(K().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),A(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return e.prototype.listModels=function(){return ue(this,void 0,void 0,function(){var n,t,r,i,o,a;return le(this,function(s){for(n={},t=Ms+io,r=io+wR,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=uL(o),n[a]=JSON.parse(this.LS.getItem(o)));return[2,n]})})},e.prototype.removeModel=function(n){return ue(this,void 0,void 0,function(){var t,r;return le(this,function(i){var o;if(n=(o=n).startsWith(ic.URL_SCHEME)?o.slice(ic.URL_SCHEME.length):o,t=bR(n),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},e}();if(K().getBool("IS_BROWSER"))try{Zo.registerManager(ic.URL_SCHEME,new lL)}catch{}var dL="model",pL=".json",fL=".weights.bin";function fb(e){return new Promise(function(n){return setTimeout(n)}).then(e)}var sm=function(){function e(n){if(!K().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(e.URL_SCHEME)&&(n=n.slice(e.URL_SCHEME.length)),n!=null&&n.length!==0||(n=dL),this.modelTopologyFileName=n+pL,this.weightDataFileName=n+fL}return e.prototype.save=function(n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s;return le(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],i={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,fb(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,fb(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:ol(n)}]}})})},e.URL_SCHEME="downloads://",e}(),hL=function(){function e(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return e.prototype.load=function(){return ue(this,void 0,void 0,function(){var n,t,r=this;return le(this,function(i){return n=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,a){var s=new FileReader;s.onload=function(c){var u=JSON.parse(c.target.result),l=u.modelTopology;if(l!=null){t.length===0&&o({modelTopology:l});var d=u.weightsManifest;if(d!=null){var p;try{p=r.checkManifestAndWeightFiles(d,t)}catch(v){return void a(v)}var f=[],m=[],g=[];d.forEach(function(v){v.paths.forEach(function(h){m.push(h),g.push(null)}),f.push.apply(f,v.weights)}),d.forEach(function(v){v.paths.forEach(function(h){var w=new FileReader;w.onload=function(y){var b=y.target.result,x=m.indexOf(h);g[x]=b,g.indexOf(null)===-1&&o({modelTopology:l,weightSpecs:f,weightData:Xy(g),format:u.format,generatedBy:u.generatedBy,convertedBy:u.convertedBy,userDefinedMetadata:u.userDefinedMetadata})},w.onerror=function(y){return a("Failed to weights data from file of path '"+h+"'.")},w.readAsArrayBuffer(p[h])})})}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(c){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)})]})})},e.prototype.checkManifestAndWeightFiles=function(n,t){for(var r=[],i=t.map(function(c){return ub(c.name)}),o={},a=0,s=n;a<s.length;a++)s[a].paths.forEach(function(c){var u=ub(c);if(r.indexOf(u)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+u+"'");if(r.push(u),i.indexOf(u)===-1)throw new Error("Weight file with basename '"+u+"' is not provided.");o[c]=t[i.indexOf(u)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},e}();function hb(e,n,t,r){(function(o){A(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(e),function(o,a){A(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),A(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),A(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})}(t=t??0,r=r??1);var i=0;return Promise.all(e.map(function(o){return o.then(function(a){var s=t+ ++i/e.length*(r-t);return n(s),a}),o}))}function xR(e,n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s,c,u,l;return le(this,function(d){switch(d.label){case 0:return n==null&&(n={}),t=n.fetchFunc==null?K().platform.fetch:n.fetchFunc,r=e.map(function(p){return t(p,n.requestInit,{isBinary:!0})}),i=0,o=.5,n.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=d.sent(),[3,4];case 2:return[4,hb(r,n.onProgress,i,o)];case 3:a=d.sent(),d.label=4;case 4:return s=a.map(function(p){return p.arrayBuffer()}),c=.5,u=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=d.sent(),[3,8];case 6:return[4,hb(s,n.onProgress,c,u)];case 7:l=d.sent(),d.label=8;case 8:return[2,l]}})})}function mb(e){var n=this;return function(t,r,i){return r===void 0&&(r=""),ue(n,void 0,void 0,function(){var o,a,s,c,u,l,d,p,f,m;return le(this,function(g){switch(g.label){case 0:if(o=t.map(function(){return!1}),a={},s=i!=null?i.map(function(){return!1}):[],c=[],t.forEach(function(v,h){var w=0;v.weights.forEach(function(y){var b="quantization"in y?y.quantization.dtype:y.dtype,x=Jg[b]*he(y.shape),_=function(){o[h]=!0,a[h]==null&&(a[h]=[]),a[h].push({manifestEntry:y,groupOffset:w,sizeBytes:x})};i!=null?i.forEach(function(C,R){C===y.name&&(_(),s[R]=!0)}):_(),c.push(y.name),w+=x})}),!s.every(function(v){return v}))throw u=i.filter(function(v,h){return!s[h]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+`. 
Manifest JSON has weights with names: `+c.join(", ")+".");return l=o.reduce(function(v,h,w){return h&&v.push(w),v},[]),d=[],l.forEach(function(v){t[v].paths.forEach(function(h){var w=r+(r.endsWith("/")?"":"/")+h;d.push(w)})}),[4,e(d)];case 1:return p=g.sent(),f={},m=0,l.forEach(function(v){for(var h=t[v].paths.length,w=0,y=0;y<h;y++)w+=p[m+y].byteLength;for(var b=new ArrayBuffer(w),x=new Uint8Array(b),_=0,C=0;C<h;C++){var R=new Uint8Array(p[m+C]);x.set(R,_),_+=R.byteLength}a[v].forEach(function(S){var E=vR(b.slice(S.groupOffset,S.groupOffset+S.sizeBytes),[S.manifestEntry]);for(var T in E)f[T]=E[T]}),m+=h}),[2,f]}})})}}vr.registerSaveRouter(function(e){return K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sm.URL_SCHEME)?function(n){return n===void 0&&(n="model"),new sm(n)}(e.slice(sm.URL_SCHEME.length)):null});var _R=function(){function e(n,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(A(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=K().platform.fetch,A(n!=null&&n.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(n)&&A(n.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."}),this.path=n,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(n){return ue(this,void 0,void 0,function(){var t,r,i,o;return le(this,function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],i={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),n.weightData!=null&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:ol(n),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},e.prototype.load=function(){return ue(this,void 0,void 0,function(){var n,t,r,i,o,a,s,c,u,l,d,p;return le(this,function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,n.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,c=t.format,u=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:p=f.sent(),l=p[0],d=p[1],f.label=7;case 7:return[2,{modelTopology:i,weightSpecs:l,weightData:d,userDefinedMetadata:u,generatedBy:a,convertedBy:s,format:c}]}})})},e.prototype.loadWeights=function(n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s,c,u,l,d,p;return le(this,function(f){switch(f.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(m){var g=m.lastIndexOf("/"),v=m.lastIndexOf("?"),h=m.substring(0,g),w=v>g?m.substring(v):"";return[h+"/",w]}(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],c=0,u=n;c<u.length;c++)l=u[c],s.push.apply(s,l.weights);return d=[],n.forEach(function(m){m.paths.forEach(function(g){d.push(a+g+o)})}),[4,xR(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return p=f.sent(),[2,[s,Xy(p)]]}})})},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function tv(e){return e.match(_R.URL_SCHEME_REGEX)!=null}var gb=function(e,n){return typeof fetch>"u"?null:(Array.isArray(e)?e.every(function(t){return tv(t)}):tv(e))?nv(e,{onProgress:n}):null};function nv(e,n){return new _R(e,n)}vr.registerSaveRouter(gb),vr.registerLoadRouter(gb);var cm=function(){function e(n){this.modelArtifacts=n}return e.prototype.load=function(){return ue(this,void 0,void 0,function(){return le(this,function(n){return[2,this.modelArtifacts]})})},e}(),mL=function(){function e(n){this.saveHandler=n}return e.prototype.save=function(n){return ue(this,void 0,void 0,function(){return le(this,function(t){return[2,this.saveHandler(n)]})})},e}(),SR=Object.freeze({browserFiles:function(e){return new hL(e)},browserHTTPRequest:function(e,n){return nv(e,n)},concatenateArrayBuffers:Xy,decodeWeights:vR,encodeWeights:function(e,n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return le(this,function(c){switch(c.label){case 0:for(t=[],r=[],i=Array.isArray(e)?e.map(function(u){return u.name}):Object.keys(e),o=function(u){var l=i[u],d=Array.isArray(e)?e[u].tensor:e[l];if(d.dtype!=="float32"&&d.dtype!=="int32"&&d.dtype!=="bool"&&d.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+d.dtype);var p={name:l,shape:d.shape,dtype:d.dtype};if(d.dtype==="string"){var f=new Promise(function(m){return ue(s,void 0,void 0,function(){var g,v,h,w,y,b,x;return le(this,function(_){switch(_.label){case 0:return[4,d.bytes()];case 1:for(g=_.sent(),v=g.reduce(function(C,R){return C+R.length},0)+Ep*g.length,h=new Uint8Array(v),w=0,y=0;y<g.length;y++)b=g[y],x=new Uint8Array(new Uint32Array([b.length]).buffer),h.set(x,w),w+=Ep,h.set(b,w),w+=b.length;return m(h),[2]}})})});r.push(f)}else r.push(d.data());n!=null&&(p.group=n),t.push(p)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:rL(c.sent()),specs:t}]}})})},fromMemory:function(e,n,t,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new cm(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cm({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cm({modelTopology:e,weightSpecs:n,weightData:t,trainingConfig:r}))},getLoadHandlers:function(e,n){return vr.getLoadHandlers(e,n)},getModelArtifactsInfoForJSON:ol,getSaveHandlers:function(e){return vr.getSaveHandlers(e)},http:nv,isHTTPScheme:tv,loadWeights:function(e,n,t,r){return n===void 0&&(n=""),ue(this,void 0,void 0,function(){return le(this,function(i){return[2,mb(function(o){return xR(o,{requestInit:r})})(e,n,t)]})})},registerLoadRouter:function(e){return vr.registerLoadRouter(e)},registerSaveRouter:function(e){return vr.registerSaveRouter(e)},weightsLoaderFactory:mb,withSaveHandler:function(e){return new mL(e)},copyModel:function(e,n){return ue(this,void 0,void 0,function(){return le(this,function(t){return[2,lb(e,n,!1)]})})},listModels:function(){return ue(this,void 0,void 0,function(){var e,n,t,r,i,o,a;return le(this,function(s){switch(s.label){case 0:e=Zo.getSchemes(),n={},t=0,r=e,s.label=1;case 1:return t<r.length?(i=r[t],[4,Zo.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())n[i+nc+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,n]}})})},moveModel:function(e,n){return ue(this,void 0,void 0,function(){return le(this,function(t){return[2,lb(e,n,!0)]})})},removeModel:function(e){return ue(this,void 0,void 0,function(){var n;return le(this,function(t){return n=Id(e),[2,Zo.getManager(n.scheme).removeModel(n.path)]})})}}),cs;M({confusionMatrix_:function(e,n,t){var r=D(e,"labels","confusionMatrix"),i=D(n,"predictions","confusionMatrix");A(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),A(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),A(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),A(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),A(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=qg(r.asType("int32"),t),a=qg(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var gL=M({fromPixels_:function(e,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,a=!1;if(e.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)o=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(q2("FromPixels",O.backendName)!=null)return O.runKernel("FromPixels",{pixels:e},{numChannels:n});var s,c,u=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=u[0],d=u[1];if(a?s=e.getContext("2d").getImageData(0,0,l,d).data:r||t?s=e.data:(o||i)&&(cs==null&&(cs=document.createElement("canvas").getContext("2d")),cs.canvas.width=l,cs.canvas.height=d,cs.drawImage(e,0,0,l,d),s=cs.getImageData(0,0,l,d).data),n===4)c=new Int32Array(s);else{var p=l*d;c=new Int32Array(p*n);for(var f=0;f<p;f++)for(var m=0;m<n;++m)c[f*n+m]=s[4*f+m]}return Cy(c,[d,l,n],"int32")}}),Qy=Object.freeze({toPixels:function(e,n){return ue(this,void 0,void 0,function(){var t,r,i,o,a,s,c,u,l,d,p,f,m,g,v,h,w,y,b,x,_,C,R;return le(this,function(S){switch(S.label){case 0:if(t=D(e,"img","toPixels"),e instanceof kt||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=S.sent(),c=t.min(),u=t.max(),[4,Promise.all([c.data(),u.data()])];case 2:if(l=S.sent(),d=l[0],p=l[1],f=d[0],m=p[0],c.dispose(),u.dispose(),t.dtype==="float32"){if(f<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+m+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(f<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+m+"].")}for(g=t.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),h=0;h<i*o;++h)w=void 0,y=void 0,b=void 0,x=void 0,a===1?(w=s[h]*g,y=s[h]*g,b=s[h]*g,x=255):a===3?(w=s[3*h]*g,y=s[3*h+1]*g,b=s[3*h+2]*g,x=255):a===4&&(w=s[4*h]*g,y=s[4*h+1]*g,b=s[4*h+2]*g,x=s[4*h+3]*g),v[(_=4*h)+0]=Math.round(w),v[_+1]=Math.round(y),v[_+2]=Math.round(b),v[_+3]=Math.round(x);return n!=null&&(n.width=o,n.height=i,C=n.getContext("2d"),R=new ImageData(v,o,i),C.putImageData(R,0,0)),t!==e&&t.dispose(),[2,v]}})})},fromPixels:gL}),vL=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(n,t){return new n(t)},e}(),yL=function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(n){e.getMap().classNameMap[n.className]=[n,n.fromConfig]},e}();function Ka(e){A(e.className!=null,function(){return"Class being registered does not have the static className property defined."}),A(typeof e.className=="string",function(){return"className is required to be a string, but got type "+typeof e.className}),A(e.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),yL.register(e)}var Xa=function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return ri(n,e),n.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var c=i.map(function(u){return{name:u.name,tensor:s[u.name]}});this.applyGradients(c)}else this.applyGradients(s);return ir(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(t,r){return TA(t,r)},n.prototype.dispose=function(){this.iterations_!=null&&ir(this.iterations_)},n.prototype.saveIterations=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:re(this.iterations_,"int32")}]})})},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},n.prototype.extractIterations=function(t){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},n}(vL);Object.defineProperty(Xa,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var wL=function(e){function n(t,r,i){i===void 0&&(i=null);var o=e.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=O.backend.epsilon()),o}return ri(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:ie(function(){return Ke(a).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:ie(function(){return Ke(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var c=r.accumulatedGrads[o].variable,u=r.accumulatedUpdates[o].variable;ie(function(){var l=c.mul(r.rho).add(s.square().mul(1-r.rho)),d=u.add(r.epsilon).sqrt().div(c.add(r.epsilon).sqrt()).mul(s),p=u.mul(r.rho).add(d.square().mul(1-r.rho));c.assign(l),u.assign(p);var f=d.mul(-r.learningRate).add(a);a.assign(f)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ir(this.accumulatedGrads.map(function(t){return t.variable})),ir(this.accumulatedUpdates.map(function(t){return t.variable})))},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){var t;return le(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n}(Xa);Ka(wL);var bL=function(e){function n(t,r){r===void 0&&(r=.1);var i=e.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return ri(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:ie(function(){return Ai(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var c=r.accumulatedGrads[o].variable;ie(function(){var u=c.add(s.square());c.assign(u);var l=s.div(u.add(O.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&ir(this.accumulatedGrads.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n}(Xa);Ka(bL);var xL=function(e){function n(t,r,i,o){o===void 0&&(o=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ie(function(){a.accBeta1=re(r).variable(),a.accBeta2=re(i).variable()}),o==null&&(a.epsilon=O.backend.epsilon()),a}return ri(n,e),n.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);ie(function(){var o=Zt(1,r.accBeta1),a=Zt(1,r.accBeta2);i.forEach(function(s,c){var u=O.registeredVariables[s];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:s+"/m",variable:ie(function(){return Ke(u).variable(!1)})}),r.accumulatedSecondMoment[c]==null&&(r.accumulatedSecondMoment[c]={originalName:s+"/v",variable:ie(function(){return Ke(u).variable(!1)})});var l=Array.isArray(t)?t[c].tensor:t[s];if(l!=null){var d=r.accumulatedFirstMoment[c].variable,p=r.accumulatedSecondMoment[c].variable,f=d.mul(r.beta1).add(l.mul(1-r.beta1)),m=p.mul(r.beta2).add(l.square().mul(1-r.beta2)),g=f.div(o),v=m.div(a);d.assign(f),p.assign(m);var h=g.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(u);u.assign(h)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ir(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ir(this.accumulatedSecondMoment.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){var t;return le(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){var r,i=this;return le(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),ie(function(){i.accBeta1.assign(Rp(i.beta1,i.iterations_+1)),i.accBeta2.assign(Rp(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n}(Xa);Ka(xL);var _L=function(e){function n(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ie(function(){s.iteration=re(0).variable(),s.accBeta1=re(r).variable()}),o==null&&(s.epsilon=O.backend.epsilon()),s}return ri(n,e),n.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);ie(function(){var o=Zt(1,r.accBeta1),a=Xr(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(s,c){var u=O.registeredVariables[s];r.accumulatedFirstMoment[c]==null&&(r.accumulatedFirstMoment[c]={originalName:s+"/m",variable:Ke(u).variable(!1)}),r.accumulatedWeightedInfNorm[c]==null&&(r.accumulatedWeightedInfNorm[c]={originalName:s+"/v",variable:Ke(u).variable(!1)});var l=Array.isArray(t)?t[c].tensor:t[s];if(l!=null){var d=r.accumulatedFirstMoment[c].variable,p=r.accumulatedWeightedInfNorm[c].variable,f=d.mul(r.beta1).add(l.mul(1-r.beta1)),m=p.mul(r.beta2),g=l.abs(),v=m.maximum(g);d.assign(f),p.assign(v);var h=a.div(o).mul(f.div(v.add(r.epsilon))).add(u);u.assign(h)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ir(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ir(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n}(Xa);Ka(_L);var CR=function(e){function n(t){var r=e.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return ri(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=O.registeredVariables[i];ie(function(){var c=r.c.mul(a).add(s);s.assign(c)})}}),this.incrementIterations()},n.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=UP(re(-t))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(t,r){return new t(r.learningRate)},n.className="SGD",n}(Xa);Ka(CR);var SL=function(e){function n(t,r,i){i===void 0&&(i=!1);var o=e.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=re(o.momentum),o}return ri(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:ie(function(){return Ke(a).variable(!1)})});var s=r.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&ie(function(){var u,l=r.m.mul(s).add(c);u=r.useNesterov?r.c.mul(c.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(u)})}),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ir(this.accumulations.map(function(t){return t.variable}))},n.prototype.setMomentum=function(t){this.momentum=t},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){return le(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){return le(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n}(CR);Ka(SL);var CL=function(e){function n(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=O.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return ri(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=O.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:ie(function(){return Ke(a).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:ie(function(){return Ke(a).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:ie(function(){return Ke(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var c=r.accumulatedMeanSquares[o].variable,u=r.accumulatedMoments[o].variable;ie(function(){var l=c.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,p=d.mul(r.decay).add(s.mul(1-r.decay)),f=u.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(p.square().add(r.epsilon)).sqrt()));c.assign(l),d.assign(p),u.assign(f);var m=a.sub(f);a.assign(m)}else{var g=c.mul(r.decay).add(s.square().mul(1-r.decay));f=u.mul(r.momentum).add(s.mul(r.learningRate).div(g.add(r.epsilon).sqrt())),c.assign(g),u.assign(f),m=a.sub(f),a.assign(m)}})}}),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ir(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ir(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ir(this.accumulatedMoments.map(function(t){return t.variable}))},n.prototype.getWeights=function(){return ue(this,void 0,void 0,function(){var t;return le(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},n.prototype.setWeights=function(t){return ue(this,void 0,void 0,function(){var r;return le(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n}(Xa);Ka(CL);kt.prototype.squaredDifference=function(e){return zC(this,e)},G=Q4;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var rv=function(e,n){return rv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},rv(e,n)};function Ae(e,n){rv(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var Pn=function(){return Pn=Object.assign||function(n){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o])}return n},Pn.apply(this,arguments)};function ge(e,n,t,r){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(l){try{u(r.next(l))}catch(d){a(d)}}function c(l){try{u(r.throw(l))}catch(d){a(d)}}function u(l){l.done?o(l.value):i(l.value).then(s,c)}u((r=r.apply(e,[])).next())})}function ve(e,n){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){t.label=u[1];break}if(u[0]===6&&t.label<o[1]){t.label=o[1],o=u;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(u);break}o[2]&&t.ops.pop(),t.trys.pop();continue}u=n.call(e,t)}catch(l){u=[6,l],i=0}finally{r=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function wu(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;for(var r=Array(e),i=0,n=0;n<t;n++)for(var o=arguments[n],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var oc=function(){function e(n,t){if(!Na(n)||!Na(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:t}));this._width=n,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function af(e,n){return e instanceof kt&&e.shape.length===n}function RL(e){return af(e,2)}function sf(e){return af(e,3)}function ea(e){return af(e,4)}function kL(e){return e%1!==0}function vb(e){return e%2===0}function EL(e,n){n===void 0&&(n=2);var t=Math.pow(10,n);return Math.floor(e*t)/t}function yb(e){return e&&e.width&&e.height}function TL(e,n){var t=e.width,r=e.height,i=n/Math.max(r,t);return new oc(Math.round(t*i),Math.round(r*i))}function Yy(e){return e.reduce(function(n,t){return n.add(t)},new rt(0,0)).div(new rt(e.length,e.length))}function Hu(e,n,t){return Array(e).fill(0).map(function(r,i){return n+i*t})}function Na(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function wb(e){return Na(e)&&0<=e&&e<=1}var rt=function(){function e(n,t){this._x=n,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(n){return new e(this.x+n.x,this.y+n.y)},e.prototype.sub=function(n){return new e(this.x-n.x,this.y-n.y)},e.prototype.mul=function(n){return new e(this.x*n.x,this.y*n.y)},e.prototype.div=function(n){return new e(this.x/n.x,this.y/n.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),aa=function(){function e(n,t){t===void 0&&(t=!0);var r=n||{},i=[r.left,r.top,r.right,r.bottom].every(Na),o=[r.x,r.y,r.width,r.height].every(Na);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],c=a[1],u=a[2],l=a[3];e.assertIsValidBox({x:s,y:c,width:u,height:l},"Box.constructor",t),this._x=s,this._y=c,this._width=u,this._height=l}return e.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(Na)},e.assertIsValidBox=function(n,t,r){if(r===void 0&&(r=!1),!e.isRect(n))throw new Error(t+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(t+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new rt(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new rt(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new rt(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new rt(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=n[0],r=n[1],i=n[2],o=n[3];return new e({x:t,y:r,width:i,height:o})},e.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=n[0],r=n[1],i=n[2],o=n[3];return new e({x:t,y:r,width:i,height:o})},e.prototype.toSquare=function(){var n=this,t=n.x,r=n.y,i=n.width,o=n.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new e({x:t,y:r,width:i,height:o})},e.prototype.rescale=function(n){var t=yb(n)?n.width:n,r=yb(n)?n.height:n;return new e({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},e.prototype.pad=function(n,t){var r=[this.x-n/2,this.y-t/2,this.width+n,this.height+t],i=r[0],o=r[1],a=r[2],s=r[3];return new e({x:i,y:o,width:a,height:s})},e.prototype.clipAtImageBorders=function(n,t){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,c=Math.max(i,0),u=Math.max(o,0),l=a-c,d=s-u,p=Math.min(l,n-c),f=Math.min(d,t-u);return new e({x:c,y:u,width:p,height:f}).floor()},e.prototype.shift=function(n,t){var r=this,i=r.width,o=r.height,a=this.x+n,s=this.y+t;return new e({x:a,y:s,width:i,height:o})},e.prototype.padAtBorders=function(n,t){var r=this.width+1,i=this.height+1,o=1,a=1,s=r,c=i,u=this.left,l=this.top,d=this.right,p=this.bottom;return d>t&&(s=-d+t+r,d=t),p>n&&(c=-p+n+i,p=n),u<1&&(c=2-u,u=1),l<1&&(c=2-l,l=1),{dy:a,edy:c,dx:o,edx:s,y:l,ey:p,x:u,ex:d,w:r,h:i}},e.prototype.calibrate=function(n){return new e({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},e}(),cf=function(e){Ae(n,e);function n(t,r,i,o,a){return a===void 0&&(a=!1),e.call(this,{left:t,top:r,right:i,bottom:o},a)||this}return n}(aa),RR=function(){function e(n,t,r,i,o){this._imageDims=new oc(o.width,o.height),this._score=n,this._classScore=t,this._className=r,this._box=new aa(i).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new aa(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:t})},e}(),$i=function(e){Ae(n,e);function n(t,r,i){return e.call(this,t,t,"",r,i)||this}return n.prototype.forSize=function(t,r){var i=e.prototype.forSize.call(this,t,r),o=i.score,a=i.relativeBox,s=i.imageDims;return new n(o,a,s)},n}(RR);function DL(e,n,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(e.right,n.right)-Math.max(e.left,n.left)),i=Math.max(0,Math.min(e.bottom,n.bottom)-Math.max(e.top,n.top)),o=r*i;return t?o/(e.area+n.area-o):o/Math.min(e.area,n.area)}function IL(e){var n=e.map(function(s){return s.x}),t=e.map(function(s){return s.y}),r=n.reduce(function(s,c){return c<s?c:s},1/0),i=t.reduce(function(s,c){return c<s?c:s},1/0),o=n.reduce(function(s,c){return s<c?c:s},0),a=t.reduce(function(s,c){return s<c?c:s},0);return new cf(r,i,o,a)}function Gu(e,n,t,r){r===void 0&&(r=!0);for(var i=n.map(function(s,c){return{score:s,boxIndex:c}}).sort(function(s,c){return s.score-c.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var c=i,u=[],l=0;l<c.length;l++){var d=c[l],p=e[s],f=e[d];u.push(DL(p,f,r))}i=i.filter(function(m,g){return u[g]<=t})};i.length>0;)a();return o}function al(e,n){return ie(function(){var t=n[0],r=n[1],i=n[2],o=Ai(wu(e.shape.slice(0,3),[1]),t),a=Ai(wu(e.shape.slice(0,3),[1]),r),s=Ai(wu(e.shape.slice(0,3),[1]),i),c=Qt([o,a,s],3);return Zt(e,c)})}function PL(e,n){return n===void 0&&(n=!1),ie(function(){var t=e.shape.slice(1),r=t[0],i=t[1];if(r===i)return e;var o=Math.abs(r-i),a=Math.round(o*(n?.5:1)),s=r>i?2:1,c=function(f){var m=e.shape.slice();return m[s]=f,Ai(m,0)},u=c(a),l=o-u.shape[s],d=n&&l?c(l):null,p=[d,e,u].filter(function(f){return!!f}).map(function(f){return f.toFloat()});return Qt(p,s)})}function um(e){return 1/(1+Math.exp(-e))}var Jy=function(e){Ae(n,e);function n(t,r,i,o,a){return a===void 0&&(a=!1),e.call(this,{x:t,y:r,width:i,height:o},a)||this}return n}(aa),AL=.5,NL=.43,ML=.45,Tp=function(){function e(n,t,r){r===void 0&&(r=new rt(0,0));var i=t.width,o=t.height;this._imgDims=new oc(i,o),this._shift=r,this._positions=n.map(function(a){return a.mul(new rt(i,o)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new rt(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(t){return t.sub(n._shift).div(new rt(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new this.constructor(this.relativePositions,{width:n,height:t})},e.prototype.shiftBy=function(n,t){return new this.constructor(this.relativePositions,this._imgDims,new rt(n,t))},e.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},e.prototype.align=function(n,t){if(t===void 0&&(t={}),n){var r=n instanceof $i?n.box.floor():new aa(n);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[0],r=n[1],i=n[2],o=function(d){return i.sub(d).magnitude()},a=(o(t)+o(r))/2,s=Math.floor(a/ML),c=Yy(n),u=Math.floor(Math.max(0,c.x-AL*s)),l=Math.floor(Math.max(0,c.y-NL*s));return new Jy(u,l,Math.min(s,this.imageWidth+u),Math.min(s,this.imageHeight+l))},e.prototype.alignMinBbox=function(n){var t=IL(this.positions);return t.pad(t.width*n,t.height*n)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),LL=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],Yy([t[3],t[4]])]},n}(Tp),OL=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(Yy)},n}(Tp),bb=function(){function e(n,t){this._label=n,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+EL(this.distance)+")":"")},e}(),xb=function(e){Ae(n,e);function n(t,r){var i=e.call(this,t)||this;return i._label=r,i}return n.assertIsValidLabeledBox=function(t,r){if(aa.assertIsValidBox(t,r),!Na(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n}(aa),Kl=function(){function e(n,t){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},e.fromJSON=function(n){var t=n.descriptors.map(function(r){return new Float32Array(r)});return new e(n.label,t)},e}();(function(e){Ae(n,e);function n(t,r,i,o){var a=e.call(this,t,r)||this;return a._score=i,a._classScore=o,a}return n.assertIsValidPredictedBox=function(t,r){if(xb.assertIsValidLabeledBox(t,r),!wb(t.score)||!wb(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n})(xb);function FL(e){return e.detection instanceof $i}function Zy(e,n){var t={detection:n};return Object.assign({},e,t)}function kR(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:n}}function ER(e){var n="";if(!e)try{e=require("fs")}catch(r){n=r.toString()}var t=e?function(r){return new Promise(function(i,o){e.readFile(r,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:t}}function TR(){var e=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,t=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=ER();return Pn({Canvas:e||function(){function a(){}return a}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function a(){}return a}(),Image:n||function(){function a(){}return a}(),ImageData:global.ImageData||function(){function a(){}return a}(),Video:global.HTMLVideoElement||function(){function a(){}return a}(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function DR(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function IR(){return typeof global=="object"&&typeof require=="function"&&typeof iT<"u"&&typeof process<"u"&&!!process.version}var qt;function BL(){if(!qt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return qt}function iv(e){qt=e}function e0(){DR()&&iv(kR()),IR()&&iv(TR())}function zL(e){if(qt||e0(),!qt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=e.Canvas,t=n===void 0?qt.Canvas:n,r=e.Image,i=r===void 0?qt.Image:r;qt.Canvas=t,qt.Image=i,qt.createCanvasElement=e.createCanvasElement||function(){return new t},qt.createImageElement=e.createImageElement||function(){return new i},qt.ImageData=e.ImageData||qt.ImageData,qt.Video=e.Video||qt.Video,qt.fetch=e.fetch||qt.fetch,qt.readFile=e.readFile||qt.readFile}var Fn={getEnv:BL,setEnv:iv,initialize:e0,createBrowserEnv:kR,createFileSystem:ER,createNodejsEnv:TR,monkeyPatch:zL,isBrowser:DR,isNodejs:IR};e0();function PR(e){return!Fn.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function ja(e){var n=Fn.getEnv(),t=n.Canvas,r=n.CanvasRenderingContext2D;if(e instanceof r)return e;var i=PR(e);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var _b;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(_b||(_b={}));function AR(e){var n=Fn.getEnv(),t=n.Image,r=n.Video;return e instanceof t&&e.complete||e instanceof r&&e.readyState>=3}function jL(e){return new Promise(function(n,t){if(e instanceof Fn.getEnv().Canvas||AR(e))return n();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),n(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}e.addEventListener("load",r),e.addEventListener("error",i)})}function NR(e){var n=Fn.getEnv(),t=n.Image,r=n.Video;return e instanceof t?new oc(e.naturalWidth,e.naturalHeight):e instanceof r?new oc(e.videoWidth,e.videoHeight):new oc(e.width,e.height)}function uf(e){var n=e.width,t=e.height,r=Fn.getEnv().createCanvasElement,i=r();return i.width=n,i.height=t,i}function t0(e,n){var t=Fn.getEnv().ImageData;if(!(e instanceof t)&&!AR(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=NR(e),i=r.width,o=r.height,a=uf({width:i,height:o});return e instanceof t?ja(a).putImageData(e,0,0):ja(a).drawImage(e,0,0,i,o),a}function $L(e,n){return ge(this,void 0,void 0,function(){var t,r,i,o,a,s;return ve(this,function(c){switch(c.label){case 0:return t=Fn.getEnv().createCanvasElement(),r=e.shape.slice(ea(e)?1:0),i=r[0],o=r[1],a=r[2],s=ie(function(){return e.as3D(i,o,a).toInt()}),[4,Qy.toPixels(s,t)];case 1:return c.sent(),s.dispose(),[2,t]}})})}function Sb(e){var n=Fn.getEnv(),t=n.Image,r=n.Canvas,i=n.Video;return e instanceof t||e instanceof r||e instanceof i}function UL(e,n,t){t===void 0&&(t=!1);var r=Fn.getEnv(),i=r.Image,o=r.Canvas;if(!(e instanceof i||e instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=NR(e),s=n/Math.max(a.height,a.width),c=s*a.width,u=s*a.height,l=uf({width:n,height:n}),d=e instanceof o?e:t0(e),p=Math.abs(c-u)/2,f=t&&c<u?p:0,m=t&&u<c?p:0;return ja(l).drawImage(d,f,m,c,u),l}var Dp=function(){function e(n,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=t,this._batchSize=n.length,n.forEach(function(i,o){if(sf(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(ea(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof Fn.getEnv().Canvas?i:t0(i);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var n=this;return Hu(this.batchSize,0,1).map(function(t,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},e.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},e.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},e.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},e.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(n),r=this.getInputHeight(n);return TL({width:t,height:r},this.inputSize)},e.prototype.toBatchTensor=function(n,t){var r=this;return t===void 0&&(t=!0),this._inputSize=n,ie(function(){var i=Hu(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof kt){var c=ea(s)?s:s.expandDims();return c=PL(c,t),(c.shape[1]!==n||c.shape[2]!==n)&&(c=Vy.resizeBilinear(c,[n,n])),c.as3D(n,n,3)}if(s instanceof Fn.getEnv().Canvas)return Qy.fromPixels(UL(s,n,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=xr(i.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3);return o})},e}();function un(e){return ge(this,void 0,void 0,function(){var n,t,r;return ve(this,function(i){switch(i.label){case 0:if(e instanceof Dp)return[2,e];if(n=Array.isArray(e)?e:[e],!n.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(e)?" at input index "+o+":":""},r=n.map(PR),r.forEach(function(o,a){if(!Sb(o)&&!sf(o)&&!ea(o))throw typeof n[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(ea(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return Sb(o)&&jL(o)}))];case 1:return i.sent(),[2,new Dp(r,Array.isArray(e))]}})})}function n0(e,n){return ge(this,void 0,void 0,function(){var t,r,i,o,a,s,c;return ve(this,function(u){switch(u.label){case 0:return t=Fn.getEnv().Canvas,r=e,e instanceof t?[3,5]:[4,un(e)];case 1:if(i=u.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,$L(o)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=ja(r),c=n.map(function(l){return l instanceof $i?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}),[2,c.map(function(l){var d=l.x,p=l.y,f=l.width,m=l.height,g=uf({width:f,height:m});return ja(g).putImageData(s.getImageData(d,p,f,m),0,0),g})]}})})}function r0(e,n){return ge(this,void 0,void 0,function(){return ve(this,function(t){if(!sf(e)&&!ea(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(ea(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ie(function(){var r=e.shape.slice(ea(e)?1:0),i=r[0],o=r[1],a=r[2],s=n.map(function(u){return u instanceof $i?u.forSize(o,i).box:u}).map(function(u){return u.clipAtImageBorders(o,i)}),c=s.map(function(u){var l=u.x,d=u.y,p=u.width,f=u.height;return aR(e.as3D(i,o,a),[d,l,0],[f,p,a])});return c})]})})}function WL(e,n){return ge(this,void 0,void 0,function(){var t,r;return ve(this,function(i){switch(i.label){case 0:return t=Fn.getEnv().fetch,[4,t(e,n)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function VL(e){return ge(this,void 0,void 0,function(){return ve(this,function(n){switch(n.label){case 0:return[4,WL(e)];case 1:return[2,n.sent().json()]}})})}function MR(e,n){var t=n+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:t};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var i=e.split("/").filter(function(s){return s}),o=e.endsWith(".json")?i[i.length-1]:t,a=r+(e.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function HL(e,n){return ge(this,void 0,void 0,function(){var t,r,i,o;return ve(this,function(a){switch(a.label){case 0:return t=MR(e,n),r=t.manifestUri,i=t.modelBaseUri,[4,VL(r)];case 1:return o=a.sent(),[2,SR.loadWeights(o,i)]}})})}var yo=function(){function e(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(n){var t=this.traversePropertyPath(n),r=t.obj,i=t.objProp;return r[i]},e.prototype.reassignParamFromPath=function(n,t){var r=this.traversePropertyPath(n),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},e.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof wc})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof wc)})},e.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;n.reassignParamFromPath(r,i.variable())})},e.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=mn(i.dataSync());i.dispose(),n.reassignParamFromPath(r,o)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(t){if(n&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var t=n.tensor;return Array.from(t.dataSync())}).reduce(function(n,t){return n.concat(t)}))},e.prototype.load=function(n){return ge(this,void 0,void 0,function(){return ve(this,function(t){switch(t.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(n){return ge(this,void 0,void 0,function(){var t;return ve(this,function(r){switch(r.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,HL(n,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(n){return ge(this,void 0,void 0,function(){var t,r,i,o,a,s,c,u,l,d;return ve(this,function(p){switch(p.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Fn.getEnv().readFile,r=MR(n,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=function(f){return Promise.all(f.map(function(m){return t(m).then(function(g){return g.buffer})}))},s=SR.weightsLoaderFactory(a),l=(u=JSON).parse,[4,t(i)];case 1:return c=l.apply(u,[p.sent().toString()]),[4,s(c,o)];case 2:return d=p.sent(),this.loadFromWeightMap(d),[2]}})})},e.prototype.loadFromWeightMap=function(n){var t=this.extractParamsFromWeigthMap(n),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},e.prototype.extractWeights=function(n){var t=this.extractParams(n),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},e.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=n.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof kt))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:i}},e}();function yr(e,n,t){return ie(function(){var r=zy(e,n.depthwise_filter,n.pointwise_filter,t,"same");return r=ze(r,n.bias),r})}function lm(e,n,t){return t===void 0&&(t=!1),ie(function(){var r=Et(t?ze(zr(e,n.conv0.filters,[2,2],"same"),n.conv0.bias):yr(e,n.conv0,[2,2])),i=yr(r,n.conv1,[1,1]),o=Et(ze(r,i)),a=yr(o,n.conv2,[1,1]);return Et(ze(r,ze(i,a)))})}function Xl(e,n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),ie(function(){var i=Et(t?ze(zr(e,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):yr(e,n.conv0,r?[2,2]:[1,1])),o=yr(i,n.conv1,[1,1]),a=Et(ze(i,o)),s=yr(a,n.conv2,[1,1]),c=Et(ze(i,ze(o,s))),u=yr(c,n.conv3,[1,1]);return Et(ze(i,ze(o,ze(s,u))))})}function Zr(e,n,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),ie(function(){var i=ze(zr(e,n.filters,[1,1],t),n.bias);return r?Et(i):i})}function wo(e,n){Object.keys(e).forEach(function(t){n.some(function(r){return r.originalPath===t})||e[t].dispose()})}function lf(e,n){return function(t,r,i,o){var a=Yn(e(t*r*i*i),[i,i,t,r]),s=Vt(e(r));return n.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function i0(e,n){return function(t,r,i){var o=Jo(e(t*r),[t,r]),a=Vt(e(r));return n.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var LR=function(){function e(n,t,r){this.depthwise_filter=n,this.pointwise_filter=t,this.bias=r}return e}();function o0(e,n){return function(t,r,i){var o=Yn(e(9*t),[3,3,t,1]),a=Yn(e(t*r),[1,1,t,r]),s=Vt(e(r));return n.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new LR(o,a,s)}}function a0(e){return function(n){var t=e(n+"/depthwise_filter",4),r=e(n+"/pointwise_filter",4),i=e(n+"/bias",1);return new LR(t,r,i)}}function fa(e,n){return function(t,r,i){var o=e[t];if(!af(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return n.push({originalPath:t,paramPath:i||t}),o}}function bo(e){var n=e;function t(i){var o=n.slice(0,i);return n=n.slice(i),o}function r(){return n}return{extractWeights:t,getRemainingWeights:r}}function OR(e,n){var t=lf(e,n),r=o0(e,n);function i(a,s,c,u){u===void 0&&(u=!1);var l=u?t(a,s,3,c+"/conv0"):r(a,s,c+"/conv0"),d=r(s,s,c+"/conv1"),p=r(s,s,c+"/conv2");return{conv0:l,conv1:d,conv2:p}}function o(a,s,c,u){u===void 0&&(u=!1);var l=i(a,s,c,u),d=l.conv0,p=l.conv1,f=l.conv2,m=r(s,s,c+"/conv3");return{conv0:d,conv1:p,conv2:f,conv3:m}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function GL(e){var n=[],t=bo(e),r=t.extractWeights,i=t.getRemainingWeights,o=OR(r,n).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),c=o(64,128,"dense2"),u=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:c,dense3:u}}}function FR(e){return function(n){var t=e(n+"/filters",4),r=e(n+"/bias",1);return{filters:t,bias:r}}}function BR(e,n){var t=fa(e,n),r=FR(t),i=a0(t);function o(s,c){c===void 0&&(c=!1);var u=c?r(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),d=i(s+"/conv2");return{conv0:u,conv1:l,conv2:d}}function a(s,c){c===void 0&&(c=!1);var u=c?r(s+"/conv0"):i(s+"/conv0"),l=i(s+"/conv1"),d=i(s+"/conv2"),p=i(s+"/conv3");return{conv0:u,conv1:l,conv2:d,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function qL(e){var n=[],t=BR(e,n).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return wo(e,n),{params:r,paramMappings:n}}var zR=function(e){Ae(n,e);function n(){return e.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ie(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=al(i,o).div(re(255)),s=Xl(a,r.dense0,!0);return s=Xl(s,r.dense1),s=Xl(s,r.dense2),s=Xl(s,r.dense3),s=il(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(t){return qL(t)},n.prototype.extractParams=function(t){return GL(t)},n}(yo);function Ei(e,n){return ie(function(){return ze(nf(e,n.weights),n.bias)})}function KL(e,n,t){var r=[],i=bo(e),o=i.extractWeights,a=i.getRemainingWeights,s=i0(o,r),c=s(n,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:c}}}function XL(e){var n=[],t=fa(e,n);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:r("fc")};return wo(e,n),{params:i,paramMappings:n}}function jR(e){var n={},t={};return Object.keys(e).forEach(function(r){var i=r.startsWith("fc")?t:n;i[r]=e[r]}),{featureExtractorMap:n,classifierMap:t}}var $R=function(e){Ae(n,e);function n(t,r){var i=e.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ie(function(){var o=t instanceof Dp?r.faceFeatureExtractor.forwardInput(t):t;return Ei(o.as2D(o.shape[0],-1),i.fc)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},n.prototype.extractClassifierParams=function(t){return KL(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(t){var r=jR(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),XL(o)},n.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n}(yo),Cb=["neutral","happy","sad","angry","fearful","disgusted","surprised"],QL=function(){function e(n){var t=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);Cb.forEach(function(r,i){t[r]=n[i]})}return e.prototype.asSortedArray=function(){var n=this;return Cb.map(function(t){return{expression:t,probability:n[t]}}).sort(function(t,r){return r.probability-t.probability})},e}(),YL=function(e){Ae(n,e);function n(t){return t===void 0&&(t=new zR),e.call(this,"FaceExpressionNet",t)||this}return n.prototype.forwardInput=function(t){var r=this;return ie(function(){return go(r.runNet(t))})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.predictExpressions=function(t){return ge(this,void 0,void 0,function(){var r,i,o,a,s=this;return ve(this,function(c){switch(c.label){case 0:return[4,un(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),[4,Promise.all(Yt(i).map(function(u){return ge(s,void 0,void 0,function(){var l;return ve(this,function(d){switch(d.label){case 0:return[4,u.data()];case 1:return l=d.sent(),u.dispose(),[2,l]}})})}))];case 3:return o=c.sent(),i.dispose(),a=o.map(function(u){return new QL(u)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n}($R);function UR(e,n){var t={expressions:n};return Object.assign({},e,t)}function JL(e){return FL(e)&&e.landmarks instanceof Tp&&e.unshiftedLandmarks instanceof Tp&&e.alignedRect instanceof $i}function s0(e,n){var t=e.detection.box,r=n.shiftBy(t.x,t.y),i=r.align(),o=e.detection.imageDims,a=new $i(e.detection.score,i.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:n,alignedRect:a};return Object.assign({},e,s)}function ZL(e,n){var t=lf(e,n),r=o0(e,n);function i(a,s,c){var u=r(a,s,c+"/separable_conv0"),l=r(s,s,c+"/separable_conv1"),d=t(a,s,1,c+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:d}}function o(a,s){var c=r(a,a,s+"/separable_conv0"),u=r(a,a,s+"/separable_conv1"),l=r(a,a,s+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function eO(e,n){var t=[],r=bo(e),i=r.extractWeights,o=r.getRemainingWeights,a=ZL(i,t),s=a.extractConvParams,c=a.extractSeparableConvParams,u=a.extractReductionBlockParams,l=a.extractMainBlockParams,d=s(3,32,3,"entry_flow/conv_in"),p=u(32,64,"entry_flow/reduction_block_0"),f=u(64,128,"entry_flow/reduction_block_1"),m={conv_in:d,reduction_block_0:p,reduction_block_1:f},g={};Hu(n,0,1).forEach(function(y){g["main_block_"+y]=l(128,"middle_flow/main_block_"+y)});var v=u(128,256,"exit_flow/reduction_block"),h=c(256,512,"exit_flow/separable_conv"),w={reduction_block:v,separable_conv:h};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:m,middle_flow:g,exit_flow:w}}}function tO(e,n){var t=fa(e,n),r=FR(t),i=a0(t);function o(s){var c=i(s+"/separable_conv0"),u=i(s+"/separable_conv1"),l=r(s+"/expansion_conv");return{separable_conv0:c,separable_conv1:u,expansion_conv:l}}function a(s){var c=i(s+"/separable_conv0"),u=i(s+"/separable_conv1"),l=i(s+"/separable_conv2");return{separable_conv0:c,separable_conv1:u,separable_conv2:l}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function nO(e,n){var t=[],r=tO(e,t),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,c=i("entry_flow/conv_in"),u=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),d={conv_in:c,reduction_block_0:u,reduction_block_1:l},p={};Hu(n,0,1).forEach(function(v){p["main_block_"+v]=s("middle_flow/main_block_"+v)});var f=a("exit_flow/reduction_block"),m=o("exit_flow/separable_conv"),g={reduction_block:f,separable_conv:m};return wo(e,t),{params:{entry_flow:d,middle_flow:p,exit_flow:g},paramMappings:t}}function WR(e,n,t){return ze(zr(e,n.filters,t,"same"),n.bias)}function dm(e,n,t){t===void 0&&(t=!0);var r=t?Et(e):e;return r=yr(r,n.separable_conv0,[1,1]),r=yr(Et(r),n.separable_conv1,[1,1]),r=rn(r,[3,3],[2,2],"same"),r=ze(r,WR(e,n.expansion_conv,[2,2])),r}function rO(e,n){var t=yr(Et(e),n.separable_conv0,[1,1]);return t=yr(Et(t),n.separable_conv1,[1,1]),t=yr(Et(t),n.separable_conv2,[1,1]),t=ze(t,e),t}var iO=function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return n.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return ie(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=al(o,a).div(re(256)),c=Et(WR(s,i.entry_flow.conv_in,[2,2]));return c=dm(c,i.entry_flow.reduction_block_0,!1),c=dm(c,i.entry_flow.reduction_block_1),Hu(r._numMainBlocks,0,1).forEach(function(u){c=rO(c,i.middle_flow["main_block_"+u])}),c=dm(c,i.exit_flow.reduction_block),c=Et(yr(c,i.exit_flow.separable_conv,[1,1])),c})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(t){return nO(t,this._numMainBlocks)},n.prototype.extractParams=function(t){return eO(t,this._numMainBlocks)},n}(yo);function oO(e){var n=[],t=bo(e),r=t.extractWeights,i=t.getRemainingWeights,o=i0(r,n),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}function aO(e){var n=[],t=fa(e,n);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return wo(e,n),{params:i,paramMappings:n}}var Ip;(function(e){e.FEMALE="female",e.MALE="male"})(Ip||(Ip={}));var sO=function(e){Ae(n,e);function n(t){t===void 0&&(t=new iO(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return ie(function(){var o=t instanceof Dp?r.faceFeatureExtractor.forwardInput(t):t,a=il(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=Ei(a,i.fc.age).as1D(),c=Ei(a,i.fc.gender);return{age:s,gender:c}})},n.prototype.forwardInput=function(t){var r=this;return ie(function(){var i=r.runNet(t),o=i.age,a=i.gender;return{age:o,gender:go(a)}})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.predictAgeAndGender=function(t){return ge(this,void 0,void 0,function(){var r,i,o,a,s,c,u=this;return ve(this,function(l){switch(l.label){case 0:return[4,un(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return i=l.sent(),o=Yt(i.age),a=Yt(i.gender),s=o.map(function(d,p){return{ageTensor:d,genderTensor:a[p]}}),[4,Promise.all(s.map(function(d){var p=d.ageTensor,f=d.genderTensor;return ge(u,void 0,void 0,function(){var m,g,v,h,w;return ve(this,function(y){switch(y.label){case 0:return[4,p.data()];case 1:return m=y.sent()[0],[4,f.data()];case 2:return g=y.sent()[0],v=g>.5,h=v?Ip.MALE:Ip.FEMALE,w=v?g:1-g,p.dispose(),f.dispose(),[2,{age:m,gender:h,genderProbability:w}]}})})}))];case 3:return c=l.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?c:c[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},n.prototype.extractClassifierParams=function(t){return oO(t)},n.prototype.extractParamsFromWeigthMap=function(t){var r=jR(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),aO(o)},n.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},n}(yo),VR=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.postProcess=function(t,r,i){var o=i.map(function(s){var c=s.width,u=s.height,l=r/Math.max(u,c);return{width:c*l,height:u*l}}),a=o.length;return ie(function(){var s=function(p,f){return xr([Ai([68],p),Ai([68],f)],1).as2D(1,136).as1D()},c=function(p,f){var m=o[p],g=m.width,v=m.height;return f(g,v)?Math.abs(g-v)/2:0},u=function(p){return c(p,function(f,m){return f<m})},l=function(p){return c(p,function(f,m){return m<f})},d=t.mul(Ai([a,136],r)).sub(xr(Array.from(Array(a),function(p,f){return s(u(f),l(f))}))).div(xr(Array.from(Array(a),function(p,f){return s(o[f].width,o[f].height)})));return d})},n.prototype.forwardInput=function(t){var r=this;return ie(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.detectLandmarks=function(t){return ge(this,void 0,void 0,function(){var r,i,o,a=this;return ve(this,function(s){switch(s.label){case 0:return[4,un(t)];case 1:return r=s.sent(),i=ie(function(){return Yt(a.forwardInput(r))}),[4,Promise.all(i.map(function(c,u){return ge(a,void 0,void 0,function(){var l,d,p,f,m;return ve(this,function(g){switch(g.label){case 0:return p=(d=Array).from,[4,c.data()];case 1:return l=p.apply(d,[g.sent()]),f=l.filter(function(v,h){return vb(h)}),m=l.filter(function(v,h){return!vb(h)}),[2,new OL(Array(68).fill(0).map(function(v,h){return new rt(f[h],m[h])}),{height:r.getInputHeight(u),width:r.getInputWidth(u)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n}($R),HR=function(e){Ae(n,e);function n(t){return t===void 0&&(t=new zR),e.call(this,"FaceLandmark68Net",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n}(VR);function cO(e){var n=[],t=BR(e,n).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return wo(e,n),{params:r,paramMappings:n}}function uO(e){var n=[],t=bo(e),r=t.extractWeights,i=t.getRemainingWeights,o=OR(r,n).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),c=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:c}}}var lO=function(e){Ae(n,e);function n(){return e.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ie(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=al(i,o).div(re(255)),s=lm(a,r.dense0,!0);return s=lm(s,r.dense1),s=lm(s,r.dense2),s=il(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(t){return cO(t)},n.prototype.extractParams=function(t){return uO(t)},n}(yo),dO=function(e){Ae(n,e);function n(t){return t===void 0&&(t=new lO),e.call(this,"FaceLandmark68TinyNet",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n}(VR);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(HR);function pO(e,n){return ze(Mn(e,n.weights),n.biases)}function c0(e,n,t,r,i){i===void 0&&(i="same");var o=n.conv,a=o.filters,s=o.bias,c=zr(e,a,t,i);return c=ze(c,s),c=pO(c,n.scale),r?Et(c):c}function fO(e,n){return c0(e,n,[1,1],!0)}function GR(e,n){return c0(e,n,[1,1],!1)}function qR(e,n){return c0(e,n,[2,2],!0,"valid")}function hO(e,n){function t(s,c,u){var l=e(s),d=l.length/(c*u*u);if(kL(d))throw new Error("depth has to be an integer: "+d+", weights.length: "+l.length+", numFilters: "+c+", filterSize: "+u);return ie(function(){return oa(Yn(l,[c,d,u,u]),[2,3,1,0])})}function r(s,c,u,l){var d=t(s,c,u),p=Vt(e(c));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:d,bias:p}}function i(s,c){var u=Vt(e(s)),l=Vt(e(s));return n.push({paramPath:c+"/weights"},{paramPath:c+"/biases"}),{weights:u,biases:l}}function o(s,c,u,l){var d=r(s,c,u,l+"/conv"),p=i(c,l+"/scale");return{conv:d,scale:p}}function a(s,c,u,l,d){d===void 0&&(d=!1);var p=o((d?.5:1)*s,c,u,l+"/conv1"),f=o(s,c,u,l+"/conv2");return{conv1:p,conv2:f}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function mO(e){var n=bo(e),t=n.extractWeights,r=n.getRemainingWeights,i=[],o=hO(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,c=a(4704,32,7,"conv32_down"),u=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),p=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),m=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),h=s(147456,128,3,"conv128_1"),w=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),C=ie(function(){return oa(Jo(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var R={conv32_down:c,conv32_1:u,conv32_2:l,conv32_3:d,conv64_down:p,conv64_1:f,conv64_2:m,conv64_3:g,conv128_down:v,conv128_1:h,conv128_2:w,conv256_down:y,conv256_1:b,conv256_2:x,conv256_down_out:_,fc:C};return{params:R,paramMappings:i}}function gO(e,n){var t=fa(e,n);function r(a){var s=t(a+"/scale/weights",1),c=t(a+"/scale/biases",1);return{weights:s,biases:c}}function i(a){var s=t(a+"/conv/filters",4),c=t(a+"/conv/bias",1),u=r(a);return{conv:{filters:s,bias:c},scale:u}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function vO(e){var n=[],t=gO(e,n),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),c=i("conv32_3"),u=i("conv64_down"),l=i("conv64_1"),d=i("conv64_2"),p=i("conv64_3"),f=i("conv128_down"),m=i("conv128_1"),g=i("conv128_2"),v=i("conv256_down"),h=i("conv256_1"),w=i("conv256_2"),y=i("conv256_down_out"),b=e.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!RL(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var x={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:l,conv64_2:d,conv64_3:p,conv128_down:f,conv128_1:m,conv128_2:g,conv256_down:v,conv256_1:h,conv256_2:w,conv256_down_out:y,fc:b};return wo(e,n),{params:x,paramMappings:n}}function ui(e,n){var t=fO(e,n.conv1);return t=GR(t,n.conv2),t=ze(t,e),t=Et(t),t}function Ql(e,n){var t=qR(e,n.conv1);t=GR(t,n.conv2);var r=il(e,2,2,"valid"),i=xt(r.shape),o=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=wu(t.shape);s[1]=1;var c=xt(s);t=Qt([t,c],1);var u=wu(t.shape);u[2]=1;var l=xt(u);t=Qt([t,l],2)}return r=o?Qt([r,i],3):r,t=ze(r,t),t=Et(t),t}var yO=function(e){Ae(n,e);function n(){return e.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ie(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=al(i,o).div(re(256)),s=qR(a,r.conv32_down);s=rn(s,3,2,"valid"),s=ui(s,r.conv32_1),s=ui(s,r.conv32_2),s=ui(s,r.conv32_3),s=Ql(s,r.conv64_down),s=ui(s,r.conv64_1),s=ui(s,r.conv64_2),s=ui(s,r.conv64_3),s=Ql(s,r.conv128_down),s=ui(s,r.conv128_1),s=ui(s,r.conv128_2),s=Ql(s,r.conv256_down),s=ui(s,r.conv256_1),s=ui(s,r.conv256_2),s=Ql(s,r.conv256_down_out);var c=s.mean([1,2]),u=nf(c,r.fc);return u})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.computeFaceDescriptor=function(t){return ge(this,void 0,void 0,function(){var r,i,o,a=this;return ve(this,function(s){switch(s.label){case 0:return[4,un(t)];case 1:return r=s.sent(),i=ie(function(){return Yt(a.forwardInput(r))}),[4,Promise.all(i.map(function(c){return c.data()}))];case 2:return o=s.sent(),i.forEach(function(c){return c.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(t){return vO(t)},n.prototype.extractParams=function(t){return mO(t)},n}(yo);function KR(e,n){var t={descriptor:n};return Object.assign({},e,t)}function XR(e,n){var t={age:n};return Object.assign({},e,t)}function QR(e,n,t){var r={gender:n,genderProbability:t};return Object.assign({},e,r)}var YR=function(){function e(n){var t=n===void 0?{}:n,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(c){return typeof c!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(c){return typeof c!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function wO(e,n){function t(c,u){var l=Yn(e(9*c),[3,3,c,1]),d=Vt(e(c)),p=Vt(e(c)),f=Vt(e(c)),m=Vt(e(c));return n.push({paramPath:u+"/filters"},{paramPath:u+"/batch_norm_scale"},{paramPath:u+"/batch_norm_offset"},{paramPath:u+"/batch_norm_mean"},{paramPath:u+"/batch_norm_variance"}),{filters:l,batch_norm_scale:d,batch_norm_offset:p,batch_norm_mean:f,batch_norm_variance:m}}function r(c,u,l,d,p){var f=Yn(e(c*u*l*l),[l,l,c,u]),m=Vt(e(u));return n.push({paramPath:d+"/filters"},{paramPath:d+"/"+(p?"batch_norm_offset":"bias")}),{filters:f,bias:m}}function i(c,u,l,d){var p=r(c,u,l,d,!0),f=p.filters,m=p.bias;return{filters:f,batch_norm_offset:m}}function o(c,u,l){var d=t(c,l+"/depthwise_conv"),p=i(c,u,1,l+"/pointwise_conv");return{depthwise_conv:d,pointwise_conv:p}}function a(){var c=i(3,32,3,"mobilenetv1/conv_0"),u=o(32,64,"mobilenetv1/conv_1"),l=o(64,128,"mobilenetv1/conv_2"),d=o(128,128,"mobilenetv1/conv_3"),p=o(128,256,"mobilenetv1/conv_4"),f=o(256,256,"mobilenetv1/conv_5"),m=o(256,512,"mobilenetv1/conv_6"),g=o(512,512,"mobilenetv1/conv_7"),v=o(512,512,"mobilenetv1/conv_8"),h=o(512,512,"mobilenetv1/conv_9"),w=o(512,512,"mobilenetv1/conv_10"),y=o(512,512,"mobilenetv1/conv_11"),b=o(512,1024,"mobilenetv1/conv_12"),x=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:u,conv_2:l,conv_3:d,conv_4:p,conv_5:f,conv_6:m,conv_7:g,conv_8:v,conv_9:h,conv_10:w,conv_11:y,conv_12:b,conv_13:x}}function s(){var c=i(1024,256,1,"prediction_layer/conv_0"),u=i(256,512,3,"prediction_layer/conv_1"),l=i(512,128,1,"prediction_layer/conv_2"),d=i(128,256,3,"prediction_layer/conv_3"),p=i(256,128,1,"prediction_layer/conv_4"),f=i(128,256,3,"prediction_layer/conv_5"),m=i(256,64,1,"prediction_layer/conv_6"),g=i(64,128,3,"prediction_layer/conv_7"),v=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),h=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),w=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),y=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),x=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),R=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),E=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),T=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),I={box_encoding_predictor:v,class_predictor:h},F={box_encoding_predictor:w,class_predictor:y},z={box_encoding_predictor:b,class_predictor:x},j={box_encoding_predictor:_,class_predictor:C},H={box_encoding_predictor:R,class_predictor:S},W={box_encoding_predictor:E,class_predictor:T};return{conv_0:c,conv_1:u,conv_2:l,conv_3:d,conv_4:p,conv_5:f,conv_6:m,conv_7:g,box_predictor_0:I,box_predictor_1:F,box_predictor_2:z,box_predictor_3:j,box_predictor_4:H,box_predictor_5:W}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function bO(e){var n=[],t=bo(e),r=t.extractWeights,i=t.getRemainingWeights,o=wO(r,n),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,c=a(),u=s(),l=Cy(r(5118*4),[1,5118,4]),d={extra_dim:l};if(n.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:c,prediction_layer:u,output_layer:d},paramMappings:n}}function xO(e,n){var t=fa(e,n);function r(u,l,d){var p=t(u+"/Conv2d_"+l+"_pointwise/weights",4,d+"/filters"),f=t(u+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,d+"/batch_norm_offset");return{filters:p,batch_norm_offset:f}}function i(u){var l="mobilenetv1/conv_"+u,d="MobilenetV1/Conv2d_"+u+"_depthwise",p=l+"/depthwise_conv",f=l+"/pointwise_conv",m=t(d+"/depthwise_weights",4,p+"/filters"),g=t(d+"/BatchNorm/gamma",1,p+"/batch_norm_scale"),v=t(d+"/BatchNorm/beta",1,p+"/batch_norm_offset"),h=t(d+"/BatchNorm/moving_mean",1,p+"/batch_norm_mean"),w=t(d+"/BatchNorm/moving_variance",1,p+"/batch_norm_variance");return{depthwise_conv:{filters:m,batch_norm_scale:g,batch_norm_offset:v,batch_norm_mean:h,batch_norm_variance:w},pointwise_conv:r("MobilenetV1",u,f)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(u,l){var d=t(u+"/weights",4,l+"/filters"),p=t(u+"/biases",1,l+"/bias");return{filters:d,bias:p}}function s(u){var l=a("Prediction/BoxPredictor_"+u+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+u+"/box_encoding_predictor"),d=a("Prediction/BoxPredictor_"+u+"/ClassPredictor","prediction_layer/box_predictor_"+u+"/class_predictor");return{box_encoding_predictor:l,class_predictor:d}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:c}}function _O(e){var n=[],t=xO(e,n),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=e["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!sf(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return wo(e,n),{params:a,paramMappings:n}}function bi(e,n,t){return ie(function(){var r=zr(e,n.filters,t,"same");return r=ze(r,n.batch_norm_offset),Ly(r,0,6)})}var SO=.0010000000474974513;function CO(e,n,t){return ie(function(){var r=tf(e,n.filters,t,"same");return r=HC(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,SO),Ly(r,0,6)})}function RO(e){return[2,4,6,12].some(function(n){return n===e})?[2,2]:[1,1]}function kO(e,n){return ie(function(){var t=null,r=bi(e,n.conv_0,[2,2]),i=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(i.forEach(function(o,a){var s=a+1,c=RO(s);r=CO(r,o.depthwise_conv,c),r=bi(r,o.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function EO(e,n,t,r,i){var o=e.shape[0],a=Math.min(t,o),s=n.map(function(l,d){return{score:l,boxIndex:d}}).filter(function(l){return l.score>i}).sort(function(l,d){return d.score-l.score}),c=function(l){return l<=r?1:0},u=[];return s.forEach(function(l){if(!(u.length>=a)){for(var d=l.score,p=u.length-1;p>=0;--p){var f=TO(e,l.boxIndex,u[p]);if(f!==0&&(l.score*=c(f),l.score<=i))break}d===l.score&&u.push(l.boxIndex)}}),u}function TO(e,n,t){var r=e.arraySync(),i=Math.min(r[n][0],r[n][2]),o=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),c=Math.min(r[t][0],r[t][2]),u=Math.min(r[t][1],r[t][3]),l=Math.max(r[t][0],r[t][2]),d=Math.max(r[t][1],r[t][3]),p=(a-i)*(s-o),f=(l-c)*(d-u);if(p<=0||f<=0)return 0;var m=Math.max(i,c),g=Math.max(o,u),v=Math.min(a,l),h=Math.min(s,d),w=Math.max(v-m,0)*Math.max(h-g,0);return w/(p+f-w)}function DO(e){var n=Yt(oa(e,[1,0])),t=[Zt(n[2],n[0]),Zt(n[3],n[1])],r=[ze(n[0],Xr(t[0],re(2))),ze(n[1],Xr(t[1],re(2)))];return{sizes:t,centers:r}}function IO(e,n){var t=DO(e),r=t.sizes,i=t.centers,o=Yt(oa(n,[1,0])),a=Xr(Mn(Yg(Xr(o[2],re(5))),r[0]),re(2)),s=ze(Mn(Xr(o[0],re(10)),r[0]),i[0]),c=Xr(Mn(Yg(Xr(o[3],re(5))),r[1]),re(2)),u=ze(Mn(Xr(o[1],re(10)),r[1]),i[1]);return oa(xr([Zt(s,a),Zt(u,c),ze(s,a),ze(u,c)]),[1,0])}function PO(e,n,t){return ie(function(){var r=e.shape[0],i=IO(Qr(ec(t.extra_dim,[r,1,1]),[-1,4]),Qr(e,[-1,4]));i=Qr(i,[r,i.shape[0]/r,4]);var o=$C(Mi(n,[0,0,1],[-1,-1,-1])),a=Mi(o,[0,0,0],[-1,-1,1]);a=Qr(a,[r,a.shape[1]]);var s=Yt(i),c=Yt(a);return{boxes:s,scores:c}})}function us(e,n){return ie(function(){var t=e.shape[0],r=Qr(Zr(e,n.box_encoding_predictor),[t,-1,1,4]),i=Qr(Zr(e,n.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function AO(e,n,t){return ie(function(){var r=bi(e,t.conv_0,[1,1]),i=bi(r,t.conv_1,[2,2]),o=bi(i,t.conv_2,[1,1]),a=bi(o,t.conv_3,[2,2]),s=bi(a,t.conv_4,[1,1]),c=bi(s,t.conv_5,[2,2]),u=bi(c,t.conv_6,[1,1]),l=bi(u,t.conv_7,[2,2]),d=us(n,t.box_predictor_0),p=us(e,t.box_predictor_1),f=us(i,t.box_predictor_2),m=us(a,t.box_predictor_3),g=us(c,t.box_predictor_4),v=us(l,t.box_predictor_5),h=Qt([d.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,v.boxPredictionEncoding],1),w=Qt([d.classPrediction,p.classPrediction,f.classPrediction,m.classPrediction,g.classPrediction,v.classPrediction],1);return{boxPredictions:h,classPredictions:w}})}var df=function(){function e(n){var t=n===void 0?{}:n,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),JR=function(e){Ae(n,e);function n(){return e.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ie(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=Zt(Mn(i,re(.007843137718737125)),re(1)),a=kO(o,r.mobilenetv1),s=AO(a.out,a.conv11,r.prediction_layer),c=s.boxPredictions,u=s.classPredictions;return PO(c,u,r.output_layer)})},n.prototype.forward=function(t){return ge(this,void 0,void 0,function(){var r;return ve(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,un(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},n.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,o,a,s,c,u,l,d,p,f,m,g,v,h,w,y,b,x,_,C,R;return ve(this,function(S){switch(S.label){case 0:return i=new df(r),o=i.maxResults,a=i.minConfidence,[4,un(t)];case 1:for(s=S.sent(),c=this.forwardInput(s),u=c.boxes,l=c.scores,d=u[0],p=l[0],f=1;f<u.length;f++)u[f].dispose(),l[f].dispose();return v=(g=Array).from,[4,p.data()];case 2:return m=v.apply(g,[S.sent()]),h=.5,w=EO(d,m,o,h,a),y=s.getReshapedInputDimensions(0),b=s.inputSize,x=b/y.width,_=b/y.height,C=d.arraySync(),R=w.map(function(E){var T=[Math.max(0,C[E][0]),Math.min(1,C[E][2])].map(function(W){return W*_}),I=T[0],F=T[1],z=[Math.max(0,C[E][1]),Math.min(1,C[E][3])].map(function(W){return W*x}),j=z[0],H=z[1];return new $i(m[E],new Jy(j,I,H-j,F-I),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),d.dispose(),p.dispose(),[2,R]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(t){return _O(t)},n.prototype.extractParams=function(t){return bO(t)},n}(yo);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(JR);var NO=.4,MO=[new rt(.738768,.874946),new rt(2.42204,2.65704),new rt(4.30971,7.04493),new rt(10.246,4.59428),new rt(12.6868,11.8741)],LO=[new rt(1.603231,2.094468),new rt(6.041143,7.080126),new rt(2.882459,3.518061),new rt(4.266906,5.178857),new rt(9.041765,10.66308)],OO=[117.001,114.697,97.404],FO="tiny_yolov2_model",BO="tiny_yolov2_separable_conv_model",Yl=function(e){return typeof e=="number"};function zO(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Yl(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(n){return n||{}}).every(function(n){return Yl(n.x)&&Yl(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Yl)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function u0(e){return ie(function(){var n=Mn(e,re(.10000000149011612));return ze(Et(Zt(e,n)),n)})}function Eo(e,n){return ie(function(){var t=Ga(e,[[0,0],[1,1],[1,1],[0,0]]);return t=zr(t,n.conv.filters,[1,1],"valid"),t=Zt(t,n.bn.sub),t=Mn(t,n.bn.truediv),t=ze(t,n.conv.bias),u0(t)})}function To(e,n){return ie(function(){var t=Ga(e,[[0,0],[1,1],[1,1],[0,0]]);return t=zy(t,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),t=ze(t,n.bias),u0(t)})}function jO(e,n){var t=lf(e,n);function r(a,s){var c=Vt(e(a)),u=Vt(e(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:c,truediv:u}}function i(a,s,c){var u=t(a,s,3,c+"/conv"),l=r(s,c+"/bn");return{conv:u,bn:l}}var o=o0(e,n);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function $O(e,n,t,r){var i=bo(e),o=i.extractWeights,a=i.getRemainingWeights,s=[],c=jO(o,s),u=c.extractConvParams,l=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams,p;if(n.withSeparableConvs){var f=r[0],m=r[1],g=r[2],v=r[3],h=r[4],w=r[5],y=r[6],b=r[7],x=r[8],_=n.isFirstLayerConv2d?u(f,m,3,"conv0"):d(f,m,"conv0"),C=d(m,g,"conv1"),R=d(g,v,"conv2"),S=d(v,h,"conv3"),E=d(h,w,"conv4"),T=d(w,y,"conv5"),I=b?d(y,b,"conv6"):void 0,F=x?d(b,x,"conv7"):void 0,z=u(x||b||y,5*t,1,"conv8");p={conv0:_,conv1:C,conv2:R,conv3:S,conv4:E,conv5:T,conv6:I,conv7:F,conv8:z}}else{var f=r[0],m=r[1],g=r[2],v=r[3],h=r[4],w=r[5],y=r[6],b=r[7],x=r[8],_=l(f,m,"conv0"),C=l(m,g,"conv1"),R=l(g,v,"conv2"),S=l(v,h,"conv3"),E=l(h,w,"conv4"),T=l(w,y,"conv5"),I=l(y,b,"conv6"),F=l(b,x,"conv7"),z=u(x,5*t,1,"conv8");p={conv0:_,conv1:C,conv2:R,conv3:S,conv4:E,conv5:T,conv6:I,conv7:F,conv8:z}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:p,paramMappings:s}}function UO(e,n){var t=fa(e,n);function r(s){var c=t(s+"/sub",1),u=t(s+"/truediv",1);return{sub:c,truediv:u}}function i(s){var c=t(s+"/filters",4),u=t(s+"/bias",1);return{filters:c,bias:u}}function o(s){var c=i(s+"/conv"),u=r(s+"/bn");return{conv:c,bn:u}}var a=a0(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function WO(e,n){var t=[],r=UO(e,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(n.withSeparableConvs){var c=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:c>7?a("conv6"):void 0,conv7:c>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return wo(e,t),{params:s,paramMappings:t}}var Rb;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Rb||(Rb={}));var l0=function(){function e(n){var t=n===void 0?{}:n,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),ZR=function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyYolov2")||this;return zO(t),r._config=t,r}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(t,r){var i=Eo(t,r.conv0);return i=rn(i,[2,2],[2,2],"same"),i=Eo(i,r.conv1),i=rn(i,[2,2],[2,2],"same"),i=Eo(i,r.conv2),i=rn(i,[2,2],[2,2],"same"),i=Eo(i,r.conv3),i=rn(i,[2,2],[2,2],"same"),i=Eo(i,r.conv4),i=rn(i,[2,2],[2,2],"same"),i=Eo(i,r.conv5),i=rn(i,[2,2],[1,1],"same"),i=Eo(i,r.conv6),i=Eo(i,r.conv7),Zr(i,r.conv8,"valid",!1)},n.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?u0(Zr(t,r.conv0,"valid",!1)):To(t,r.conv0);return i=rn(i,[2,2],[2,2],"same"),i=To(i,r.conv1),i=rn(i,[2,2],[2,2],"same"),i=To(i,r.conv2),i=rn(i,[2,2],[2,2],"same"),i=To(i,r.conv3),i=rn(i,[2,2],[2,2],"same"),i=To(i,r.conv4),i=rn(i,[2,2],[2,2],"same"),i=To(i,r.conv5),i=rn(i,[2,2],[1,1],"same"),i=r.conv6?To(i,r.conv6):i,i=r.conv7?To(i,r.conv7):i,Zr(i,r.conv8,"valid",!1)},n.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return ie(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=i.config.meanRgb?al(a,i.config.meanRgb):a,a=a.div(re(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},n.prototype.forward=function(t,r){return ge(this,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,un(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},n.prototype.detect=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,o,a,s,c,u,l,d,p,f,m,g,v,h,w=this;return ve(this,function(y){switch(y.label){case 0:return i=new l0(r),o=i.inputSize,a=i.scoreThreshold,[4,un(t)];case 1:return s=y.sent(),[4,this.forwardInput(s,o)];case 2:return c=y.sent(),u=ie(function(){return Yt(c)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(u,s.getReshapedInputDimensions(0),a)];case 3:return d=y.sent(),c.dispose(),u.dispose(),p=d.map(function(b){return b.box}),f=d.map(function(b){return b.score}),m=d.map(function(b){return b.classScore}),g=d.map(function(b){return w.config.classes[b.label]}),v=Gu(p.map(function(b){return b.rescale(o)}),f,this.config.iouThreshold,!0),h=v.map(function(b){return new RR(f[b],m[b],g[b],p[b],l)}),[2,h]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(t){return WO(t,this.config)},n.prototype.extractParams=function(t){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return $O(t,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(t,r,i){return ge(this,void 0,void 0,function(){var o,a,s,c,u,l,d,p,f,m,g,v,h,w,y,b,x,_,C,R,S,E,T,I,F,z,j,H,W,L=this;return ve(this,function($){switch($.label){case 0:return o=r.width,a=r.height,s=Math.max(o,a),c=s/o,u=s/a,l=t.shape[1],d=this.config.anchors.length,p=ie(function(){var k=t.reshape([l,l,d,L.boxEncodingSize]),U=k.slice([0,0,0,0],[l,l,d,4]),X=k.slice([0,0,0,4],[l,l,d,1]),P=L.withClassScores?go(k.slice([0,0,0,5],[l,l,d,L.config.classes.length]),3):re(0);return[U,X,P]}),f=p[0],m=p[1],g=p[2],v=[],[4,m.array()];case 1:return h=$.sent(),[4,f.array()];case 2:w=$.sent(),y=0,$.label=3;case 3:if(!(y<l))return[3,12];b=0,$.label=4;case 4:if(!(b<l))return[3,11];x=0,$.label=5;case 5:return x<d?(_=um(h[y][b][x][0]),!i||_>i?(C=(b+um(w[y][b][x][0]))/l*c,R=(y+um(w[y][b][x][1]))/l*u,S=Math.exp(w[y][b][x][2])*this.config.anchors[x].x/l*c,E=Math.exp(w[y][b][x][3])*this.config.anchors[x].y/l*u,T=C-S/2,I=R-E/2,F={row:y,col:b,anchor:x},this.withClassScores?[4,this.extractPredictedClass(g,F)]:[3,7]):[3,9]):[3,10];case 6:return W=$.sent(),[3,8];case 7:W={classScore:1,label:0},$.label=8;case 8:z=W,j=z.classScore,H=z.label,v.push(Pn({box:new cf(T,I,T+S,I+E),score:_,classScore:_*j,label:H},F)),$.label=9;case 9:return x++,[3,5];case 10:return b++,[3,4];case 11:return y++,[3,3];case 12:return f.dispose(),m.dispose(),g.dispose(),[2,v]}})})},n.prototype.extractPredictedClass=function(t,r){return ge(this,void 0,void 0,function(){var i,o,a,s;return ve(this,function(c){switch(c.label){case 0:return i=r.row,o=r.col,a=r.anchor,[4,t.array()];case 1:return s=c.sent(),[2,Array(this.config.classes.length).fill(0).map(function(u,l){return s[i][o][a][l]}).map(function(u,l){return{classScore:u,label:l}}).reduce(function(u,l){return u.classScore>l.classScore?u:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n}(yo),VO=function(e){Ae(n,e);function n(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:NO,classes:["face"]},t?{anchors:LO,meanRgb:OO}:{anchors:MO,withClassScores:!0});return r=e.call(this,i)||this,r}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return ge(this,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new $i(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?BO:FO},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n}(ZR),ek=function(e){Ae(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return n}(l0),sl=function(){function e(){}return e.prototype.then=function(n){return ge(this,void 0,void 0,function(){var t;return ve(this,function(r){switch(r.label){case 0:return t=n,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return ge(this,void 0,void 0,function(){return ve(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},e}();function pf(e,n,t,r,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),ge(this,void 0,void 0,function(){var o,a,s,c,u;return ve(this,function(l){switch(l.label){case 0:return o=e.map(function(d){return JL(d)?i(d):d.detection}),s=r,s?[3,5]:n instanceof kt?[4,r0(n,o)]:[3,2];case 1:return c=l.sent(),[3,4];case 2:return[4,n0(n,o)];case 3:c=l.sent(),l.label=4;case 4:s=c,l.label=5;case 5:return a=s,[4,t(a)];case 6:return u=l.sent(),a.forEach(function(d){return d instanceof kt&&d.dispose()}),[2,u]}})})}function d0(e,n,t,r,i){return ge(this,void 0,void 0,function(){var o=this;return ve(this,function(a){return[2,pf([e],n,function(s){return ge(o,void 0,void 0,function(){return ve(this,function(c){return[2,t(s[0])]})})},r,i)]})})}function HO(e){return ie(function(){return xr(Yt(e,3).reverse(),3)})}var Jl=2,Pp=12;function GO(e,n){var t=lf(e,n),r=i0(e,n);function i(u,l){var d=Vt(e(u));return n.push({paramPath:l}),d}function o(u,l,d){d===void 0&&(d=!1);var p=t(u[0],u[1],3,l+"/conv1"),f=i(u[1],l+"/prelu1_alpha"),m=t(u[1],u[2],3,l+"/conv2"),g=i(u[2],l+"/prelu2_alpha"),v=t(u[2],u[3],d?2:3,l+"/conv3"),h=i(u[3],l+"/prelu3_alpha");return{conv1:p,prelu1_alpha:f,conv2:m,prelu2_alpha:g,conv3:v,prelu3_alpha:h}}function a(){var u=o([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),d=t(32,4,1,"pnet/conv4_2");return Pn(Pn({},u),{conv4_1:l,conv4_2:d})}function s(){var u=o([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),d=i(128,"rnet/prelu4_alpha"),p=r(128,2,"rnet/fc2_1"),f=r(128,4,"rnet/fc2_2");return Pn(Pn({},u),{fc1:l,prelu4_alpha:d,fc2_1:p,fc2_2:f})}function c(){var u=o([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),d=i(128,"onet/prelu4_alpha"),p=r(1152,256,"onet/fc1"),f=i(256,"onet/prelu5_alpha"),m=r(256,2,"onet/fc2_1"),g=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return Pn(Pn({},u),{conv4:l,prelu4_alpha:d,fc1:p,prelu5_alpha:f,fc2_1:m,fc2_2:g,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:c}}function qO(e){var n=bo(e),t=n.extractWeights,r=n.getRemainingWeights,i=[],o=GO(t,i),a=o.extractPNetParams,s=o.extractRNetParams,c=o.extractONetParams,u=a(),l=s(),d=c();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:u,rnet:l,onet:d},paramMappings:i}}function KO(e,n){var t=fa(e,n);function r(l){var d=t(l+"/weights",4,l+"/filters"),p=t(l+"/bias",1);return{filters:d,bias:p}}function i(l){var d=t(l+"/weights",2),p=t(l+"/bias",1);return{weights:d,bias:p}}function o(l){return t(l,1)}function a(l){var d=r(l+"/conv1"),p=o(l+"/prelu1_alpha"),f=r(l+"/conv2"),m=o(l+"/prelu2_alpha"),g=r(l+"/conv3"),v=o(l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:p,conv2:f,prelu2_alpha:m,conv3:g,prelu3_alpha:v}}function s(){var l=a("pnet"),d=r("pnet/conv4_1"),p=r("pnet/conv4_2");return Pn(Pn({},l),{conv4_1:d,conv4_2:p})}function c(){var l=a("rnet"),d=i("rnet/fc1"),p=o("rnet/prelu4_alpha"),f=i("rnet/fc2_1"),m=i("rnet/fc2_2");return Pn(Pn({},l),{fc1:d,prelu4_alpha:p,fc2_1:f,fc2_2:m})}function u(){var l=a("onet"),d=r("onet/conv4"),p=o("onet/prelu4_alpha"),f=i("onet/fc1"),m=o("onet/prelu5_alpha"),g=i("onet/fc2_1"),v=i("onet/fc2_2"),h=i("onet/fc2_3");return Pn(Pn({},l),{conv4:d,prelu4_alpha:p,fc1:f,prelu5_alpha:m,fc2_1:g,fc2_2:v,fc2_3:h})}return{extractPNetParams:s,extractRNetParams:c,extractONetParams:u}}function XO(e){var n=[],t=KO(e,n),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=r(),s=i(),c=o();return wo(e,n),{params:{pnet:a,rnet:s,onet:c},paramMappings:n}}function ov(e,n){var t=n[0],r=n[1];return{height:Math.floor(t*e),width:Math.floor(r*e)}}function QO(e,n,t){for(var r=t[0],i=t[1],o=Pp/e,a=[],s=Math.min(r,i)*o,c=0;s>=12;)a.push(o*Math.pow(n,c)),s=s*n,c+=1;return a}var p0=function(e){Ae(n,e);function n(t,r,i,o){return e.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return n}(aa);function tk(e){return ie(function(){return Mn(Zt(e,re(127.5)),re(.0078125))})}function ac(e,n){return ie(function(){return ze(Et(e),Mn(n,Cp(Et(Cp(e)))))})}function f0(e,n,t){return t===void 0&&(t=!1),ie(function(){var r=Zr(e,n.conv1,"valid");return r=ac(r,n.prelu1_alpha),r=rn(r,t?[2,2]:[3,3],[2,2],"same"),r=Zr(r,n.conv2,"valid"),r=ac(r,n.prelu2_alpha),r=t?r:rn(r,[3,3],[2,2],"valid"),r=Zr(r,n.conv3,"valid"),r=ac(r,n.prelu3_alpha),r})}function YO(e,n){return ie(function(){var t=f0(e,n,!0),r=Zr(t,n.conv4_1,"valid"),i=Ir(rf(r,3),3),o=go(Zt(r,i),3),a=Zr(t,n.conv4_2,"valid");return{prob:o,regions:a}})}function JO(e,n){return ie(function(){var t=ov(n,e.shape.slice(1)),r=t.height,i=t.width,o=Vy.resizeBilinear(e,[r,i]),a=tk(o);return oa(a,[0,2,1,3])})}function ZO(e,n,t,r){for(var i=[],o=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)o[a][s]>=r&&i.push(new rt(s,a));var c=i.map(function(u){var l=new cf(Math.round((u.y*Jl+1)/t),Math.round((u.x*Jl+1)/t),Math.round((u.y*Jl+Pp)/t),Math.round((u.x*Jl+Pp)/t)),d=o[u.y][u.x],p=n.arraySync(),f=new p0(p[u.y][u.x][0],p[u.y][u.x][1],p[u.y][u.x][2],p[u.y][u.x][3]);return{cell:l,score:d,region:f}});return c}function eF(e,n,t,r,i){i.stage1=[];var o=n.map(function(p){return ie(function(){var f={scale:p},m=JO(e,p),g=Date.now(),v=YO(m,r),h=v.prob,w=v.regions;f.pnet=Date.now()-g;var y=Yt(Yt(h,3)[1])[0],b=Yt(w)[0];return{scoresTensor:y,regionsTensor:b,scale:p,statsForScale:f}})}),a=o.map(function(p){var f=p.scoresTensor,m=p.regionsTensor,g=p.scale,v=p.statsForScale,h=ZO(f,m,g,t);if(f.dispose(),m.dispose(),!h.length)return i.stage1.push(v),[];var w=Date.now(),y=Gu(h.map(function(b){return b.cell}),h.map(function(b){return b.score}),.5);return v.nms=Date.now()-w,v.numBoxes=y.length,i.stage1.push(v),y.map(function(b){return h[b]})}),s=a.reduce(function(p,f){return p.concat(f)},[]),c=[],u=[];if(s.length>0){var l=Date.now(),d=Gu(s.map(function(p){return p.cell}),s.map(function(p){return p.score}),.7);i.stage1_nms=Date.now()-l,u=d.map(function(p){return s[p].score}),c=d.map(function(p){return s[p]}).map(function(p){var f=p.cell,m=p.region;return new cf(f.left+m.left*f.width,f.top+m.top*f.height,f.right+m.right*f.width,f.bottom+m.bottom*f.height).toSquare().round()})}return{boxes:c,scores:u}}function nk(e,n,t){var r=t.width,i=t.height;return ge(this,void 0,void 0,function(){var o,a,s,c=this;return ve(this,function(u){switch(u.label){case 0:return o=ja(e),[4,Promise.all(n.map(function(l){return ge(c,void 0,void 0,function(){var d,p,f,m,g,v,h,w;return ve(this,function(y){return d=l.padAtBorders(e.height,e.width),p=d.y,f=d.ey,m=d.x,g=d.ex,v=m-1,h=p-1,w=o.getImageData(v,h,g-v,f-h),[2,Fn.isNodejs()?t0(w):createImageBitmap(w)]})})}))];case 1:return a=u.sent(),s=[],a.forEach(function(l){var d=uf({width:r,height:i}),p=ja(d);p.drawImage(l,0,0,r,i);for(var f=p.getImageData(0,0,r,i).data,m=[],g=0;g<f.length;g+=4)m.push(f[g+2]),m.push(f[g+1]),m.push(f[g]);s.push(m)}),[2,s.map(function(l){var d=ie(function(){var p=oa(Yn(l,[1,r,i,3]),[0,2,1,3]).toFloat();return tk(p)});return d})]}})})}function tF(e,n){return ie(function(){var t=f0(e,n),r=Qr(t,[t.shape[0],n.fc1.weights.shape[0]]),i=Ei(r,n.fc1),o=ac(i,n.prelu4_alpha),a=Ei(o,n.fc2_1),s=Ir(rf(a,1),1),c=go(Zt(a,s),1),u=Ei(o,n.fc2_2),l=Yt(c,1)[1];return{scores:l,regions:u}})}function nF(e,n,t,r,i){return ge(this,void 0,void 0,function(){var o,a,s,c,u,l,d,p,f,m,g,v,h,w;return ve(this,function(y){switch(y.label){case 0:return o=Date.now(),[4,nk(e,n,{width:24,height:24})];case 1:return a=y.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(b){var x=tF(b,r);return b.dispose(),x}),i.stage2_rnet=Date.now()-o,c=s.length>1?Qt(s.map(function(b){return b.scores})):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[y.sent()]),c.dispose(),p=u.map(function(b,x){return{score:b,idx:x}}).filter(function(b){return b.score>t}).map(function(b){var x=b.idx;return x}),f=p.map(function(b){return n[b]}),m=p.map(function(b){return u[b]}),g=[],v=[],f.length>0&&(o=Date.now(),h=Gu(f,m,.7),i.stage2_nms=Date.now()-o,w=h.map(function(b){var x=s[p[b]].regions.arraySync();return new p0(x[0][0],x[0][1],x[0][2],x[0][3])}),v=h.map(function(b){return m[b]}),g=h.map(function(b,x){return f[b].calibrate(w[x])})),s.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:g,scores:v}]}})})}function rF(e,n){return ie(function(){var t=f0(e,n);t=rn(t,[2,2],[2,2],"same"),t=Zr(t,n.conv4,"valid"),t=ac(t,n.prelu4_alpha);var r=Qr(t,[t.shape[0],n.fc1.weights.shape[0]]),i=Ei(r,n.fc1),o=ac(i,n.prelu5_alpha),a=Ei(o,n.fc2_1),s=Ir(rf(a,1),1),c=go(Zt(a,s),1),u=Ei(o,n.fc2_2),l=Ei(o,n.fc2_3),d=Yt(c,1)[1];return{scores:d,regions:u,points:l}})}function iF(e,n,t,r,i){return ge(this,void 0,void 0,function(){var o,a,s,c,u,l,d,p,f,m,g,v,h,w,y;return ve(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,nk(e,n,{width:48,height:48})];case 1:return a=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(x){var _=rF(x,r);return x.dispose(),_}),i.stage3_onet=Date.now()-o,c=s.length>1?Qt(s.map(function(x){return x.scores})):s[0].scores,d=(l=Array).from,[4,c.data()];case 2:return u=d.apply(l,[b.sent()]),c.dispose(),p=u.map(function(x,_){return{score:x,idx:_}}).filter(function(x){return x.score>t}).map(function(x){var _=x.idx;return _}),f=p.map(function(x){var _=s[x].regions.arraySync();return new p0(_[0][0],_[0][1],_[0][2],_[0][3])}),m=p.map(function(x,_){return n[x].calibrate(f[_])}),g=p.map(function(x){return u[x]}),v=[],h=[],w=[],m.length>0&&(o=Date.now(),y=Gu(m,g,.7,!1),i.stage3_nms=Date.now()-o,v=y.map(function(x){return m[x]}),h=y.map(function(x){return g[x]}),w=y.map(function(x,_){return Array(5).fill(0).map(function(C,R){var S=s[x].points.arraySync();return new rt(S[0][R]*(v[_].width+1)+v[_].left,S[0][R+5]*(v[_].height+1)+v[_].top)})})),s.forEach(function(x){x.regions.dispose(),x.scores.dispose(),x.points.dispose()}),[2,{boxes:v,scores:h,points:w}]}})})}var oF=function(e){Ae(n,e);function n(){return e.call(this,"Mtcnn")||this}return n.prototype.load=function(t){return ge(this,void 0,void 0,function(){return ve(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},n.prototype.loadFromDisk=function(t){return ge(this,void 0,void 0,function(){return ve(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},n.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i,o,a,s,c,u,l,d,p,f,m,g,v,h,w,y,b,x,_,C,R;return ve(this,function(S){switch(S.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),c=ie(function(){return HO(Ir(Qy.fromPixels(o)).toFloat())}),u=function(E){return c.dispose(),a.total=Date.now()-s,E},l=c.shape.slice(1),d=l[0],p=l[1],f=new YR(r),m=f.minFaceSize,g=f.scaleFactor,v=f.maxNumScales,h=f.scoreThresholds,w=f.scaleSteps,y=(w||QO(m,g,[d,p])).filter(function(E){var T=ov(E,[d,p]);return Math.min(T.width,T.height)>Pp}).slice(0,v),a.scales=y,a.pyramid=y.map(function(E){return ov(E,[d,p])}),b=Date.now(),[4,eF(c,y,h[0],i.pnet,a)];case 1:return x=S.sent(),a.total_stage1=Date.now()-b,x.boxes.length?(a.stage2_numInputBoxes=x.boxes.length,b=Date.now(),[4,nF(o,x.boxes,h[1],i.rnet,a)]):[2,u({results:[],stats:a})];case 2:return _=S.sent(),a.total_stage2=Date.now()-b,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,b=Date.now(),[4,iF(o,_.boxes,h[2],i.onet,a)]):[2,u({results:[],stats:a})];case 3:return C=S.sent(),a.total_stage3=Date.now()-b,R=C.boxes.map(function(E,T){return s0(Zy({},new $i(C.scores[T],new Jy(E.left/p,E.top/d,E.width/p,E.height/d),{height:d,width:p})),new LL(C.points[T].map(function(I){return I.sub(new rt(E.left,E.top)).div(new rt(E.width,E.height))}),{width:E.width,height:E.height}))}),[2,u({results:R,stats:a})]}})})},n.prototype.forward=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,un(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},n.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),ge(this,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,un(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(t){return XO(t)},n.prototype.extractParams=function(t){return qO(t)},n}(yo),aF=.4,sF=[new rt(1.603231,2.094468),new rt(6.041143,7.080126),new rt(2.882459,3.518061),new rt(4.266906,5.178857),new rt(9.041765,10.66308)],cF=[117.001,114.697,97.404],uF=function(e){Ae(n,e);function n(){var t=this,r={withSeparableConvs:!0,iouThreshold:aF,classes:["face"],anchors:sF,meanRgb:cF,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=e.call(this,r)||this,t}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return ge(this,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new $i(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n}(ZR),er={ssdMobilenetv1:new JR,tinyFaceDetector:new uF,tinyYolov2:new VO,mtcnn:new oF,faceLandmark68Net:new HR,faceLandmark68TinyNet:new dO,faceRecognitionNet:new yO,faceExpressionNet:new YL,ageGenderNet:new sO},rk=function(e){Ae(n,e);function n(t,r,i){var o=e.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return n}(sl),h0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i=this;return ve(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,pf(t,this.input,function(a){return ge(i,void 0,void 0,function(){return ve(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(c){return er.faceExpressionNet.predictExpressions(c)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){return UR(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new y0(this,this.input)},n}(rk),m0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return ve(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,d0(t,this.input,function(o){return er.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,UR(t,r)]}})})},n.prototype.withAgeAndGender=function(){return new w0(this,this.input)},n}(rk),g0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new b0(this,this.input)},n.prototype.withFaceDescriptors=function(){return new _0(this,this.input)},n}(h0),v0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new x0(this,this.input)},n.prototype.withFaceDescriptor=function(){return new S0(this,this.input)},n}(m0),ik=function(e){Ae(n,e);function n(t,r,i){var o=e.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return n}(sl),y0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i=this;return ve(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,pf(t,this.input,function(a){return ge(i,void 0,void 0,function(){return ve(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(c){return er.ageGenderNet.predictAgeAndGender(c)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){var c=r[s],u=c.age,l=c.gender,d=c.genderProbability;return XR(QR(a,l,d),u)})]}})})},n.prototype.withFaceExpressions=function(){return new h0(this,this.input)},n}(ik),w0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,o,a;return ve(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,d0(t,this.input,function(c){return er.ageGenderNet.predictAgeAndGender(c)},this.extractedFaces)]:[2];case 2:return r=s.sent(),i=r.age,o=r.gender,a=r.genderProbability,[2,XR(QR(t,o,a),i)]}})})},n.prototype.withFaceExpressions=function(){return new m0(this,this.input)},n}(ik),b0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new g0(this,this.input)},n.prototype.withFaceDescriptors=function(){return new _0(this,this.input)},n}(y0),x0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new v0(this,this.input)},n.prototype.withFaceDescriptor=function(){return new S0(this,this.input)},n}(w0),ok=function(e){Ae(n,e);function n(t,r){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i}return n}(sl),_0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return ve(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,pf(t,this.input,function(o){return Promise.all(o.map(function(a){return er.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,a){return KR(t[a],o)})]}})})},n.prototype.withFaceExpressions=function(){return new g0(this,this.input)},n.prototype.withAgeAndGender=function(){return new b0(this,this.input)},n}(ok),S0=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return ve(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,d0(t,this.input,function(o){return er.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,KR(t,r)]}})})},n.prototype.withFaceExpressions=function(){return new v0(this,this.input)},n.prototype.withAgeAndGender=function(){return new x0(this,this.input)},n}(ok),ak=function(e){Ae(n,e);function n(t,r,i){var o=e.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?er.faceLandmark68TinyNet:er.faceLandmark68Net},enumerable:!0,configurable:!0}),n}(sl),lF=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return ve(this,function(c){switch(c.label){case 0:return[4,this.parentTask];case 1:return t=c.sent(),r=t.map(function(u){return u.detection}),this.input instanceof kt?[4,r0(this.input,r)]:[3,3];case 2:return o=c.sent(),[3,5];case 3:return[4,n0(this.input,r)];case 4:o=c.sent(),c.label=5;case 5:return i=o,[4,Promise.all(i.map(function(u){return s.landmarkNet.detectLandmarks(u)}))];case 6:return a=c.sent(),i.forEach(function(u){return u instanceof kt&&u.dispose()}),[2,t.map(function(u,l){return s0(u,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new g0(this,this.input)},n.prototype.withAgeAndGender=function(){return new b0(this,this.input)},n.prototype.withFaceDescriptors=function(){return new _0(this,this.input)},n}(ak),dF=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,o,a;return ve(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof kt?[4,r0(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,n0(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(c){return c instanceof kt&&c.dispose()}),[2,s0(t,a)]}})})},n.prototype.withFaceExpressions=function(){return new v0(this,this.input)},n.prototype.withAgeAndGender=function(){return new x0(this,this.input)},n.prototype.withFaceDescriptor=function(){return new S0(this,this.input)},n}(ak),sk=function(e){Ae(n,e);function n(t,r){r===void 0&&(r=new df);var i=e.call(this)||this;return i.input=t,i.options=r,i}return n}(sl),pF=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r,i,o;return ve(this,function(a){switch(a.label){case 0:return t=this,r=t.input,i=t.options,i instanceof YR?[4,er.mtcnn.forward(r,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof ek?function(s){return er.tinyFaceDetector.locateFaces(s,i)}:i instanceof df?function(s){return er.ssdMobilenetv1.locateFaces(s,i)}:i instanceof l0?function(s){return er.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return ge(t,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(a){return Zy({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new lF(this.runAndExtendWithFaceDetections(),this.input,t)},n.prototype.withFaceExpressions=function(){return new h0(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new y0(this.runAndExtendWithFaceDetections(),this.input)},n}(sk),fF=function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return ge(this,void 0,void 0,function(){var t,r;return ve(this,function(i){switch(i.label){case 0:return[4,new pF(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return ge(t,void 0,void 0,function(){var i;return ve(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?Zy({},i):void 0)]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new dF(this.runAndExtendWithFaceDetection(),this.input,t)},n.prototype.withFaceExpressions=function(){return new m0(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new w0(this.runAndExtendWithFaceDetection(),this.input)},n}(sk);function hF(e,n){return n===void 0&&(n=new df),new fF(e,n)}function mF(e,n){if(e.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(e),r=Array.from(n);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function e(n,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(a){if(a instanceof Kl)return a;if(a instanceof Float32Array)return new Kl(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Kl(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(n,t){return t.map(function(r){return mF(r,n)}).reduce(function(r,i){return r+i},0)/(t.length||1)},e.prototype.matchDescriptor=function(n){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new bb(o,t.computeMeanDistance(n,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},e.prototype.findBestMatch=function(n){var t=this.matchDescriptor(n);return t.distance<this.distanceThreshold?t:new bb("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},e.fromJSON=function(n){var t=n.labeledDescriptors.map(function(r){return Kl.fromJSON(r)});return new e(t,n.distanceThreshold)},e})();const kb="/models",gF=async()=>{try{return await Promise.all([er.tinyFaceDetector.loadFromUri(kb),er.faceExpressionNet.loadFromUri(kb)]),console.log("Face API models loaded successfully"),!0}catch(e){return console.error("Error loading face-api models:",e),!1}},vF=async e=>{if(!e||e.paused||e.ended)return null;try{const n=new ek({inputSize:224,scoreThreshold:.5});return await hF(e,n).withFaceExpressions()}catch(n){return console.error("Error detecting expressions:",n),null}},yF=e=>e?Object.entries(e).reduce((n,t)=>t[1]>n[1]?t:n,["neutral",0])[0]:null,wF=e=>{const n={happy:"bg-yellow-500",sad:"bg-blue-500",angry:"bg-red-500",fearful:"bg-purple-500",disgusted:"bg-green-500",surprised:"bg-pink-500",neutral:"bg-gray-500"};return n[e]||n.neutral},bF=e=>{const n={happy:"",sad:"",angry:"",fearful:"",disgusted:"",surprised:"",neutral:""};return n[e]||n.neutral},ck=({videoRef:e,isActive:n=!1})=>{const[t,r]=oe.useState(null),[i,o]=oe.useState(0),a=oe.useRef(null);if(oe.useEffect(()=>{let u=!0;const l=async()=>{if(!e.current||!n)return;const d=await vF(e.current);if(d&&u){const p=yF(d.expressions),f=d.expressions[p]*100;r(p),o(Math.round(f))}u&&(a.current=requestAnimationFrame(l))};return n&&l(),()=>{u=!1,a.current&&cancelAnimationFrame(a.current)}},[e,n]),!t)return null;const s=wF(t),c=bF(t);return B.jsxs("div",{className:"absolute top-3 right-3 flex items-center gap-1.5 bg-black/60 backdrop-blur-sm text-white px-3 py-1.5 rounded-lg",children:[B.jsx("span",{className:"text-lg",children:c}),B.jsxs("div",{className:"flex flex-col",children:[B.jsx("span",{className:"text-xs font-medium capitalize",children:t}),B.jsx("div",{className:"w-full h-1.5 bg-gray-700 rounded-full overflow-hidden",children:B.jsx("div",{className:`h-full ${s} transition-all duration-300`,style:{width:`${i}%`}})})]})]})},Eb=({stream:e,username:n,userRole:t,isMainSpeaker:r=!1})=>{const i=oe.useRef(null);oe.useEffect(()=>{i.current&&e&&(i.current.srcObject=e)},[e]);const o=t?t.charAt(0).toUpperCase()+t.slice(1):"";return B.jsxs("div",{className:`relative ${r?"w-full h-[450px] mx-auto":"w-full h-24 md:h-32"}`,children:[e?B.jsxs(B.Fragment,{children:[B.jsx("video",{ref:i,className:"w-full h-full object-cover rounded-xl bg-slate-700",autoPlay:!0,playsInline:!0,controls:!0}),B.jsx(ck,{videoRef:i,isActive:!!e})]}):B.jsx("div",{className:"w-full h-full rounded-xl bg-slate-700/50 flex items-center justify-center",children:B.jsx(W2,{size:r?64:32,className:"text-slate-500"})}),n&&B.jsxs("div",{className:"absolute bottom-3 left-3 bg-black/60 backdrop-blur-sm text-white px-3 py-1.5 text-sm rounded-lg flex items-center space-x-1",children:[B.jsx("span",{children:n}),o&&B.jsxs(B.Fragment,{children:[B.jsx("span",{className:"text-slate-400 mx-1",children:"|"}),B.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${t==="interviewer"?"bg-blue-500/80":t==="recruiter"?"bg-purple-500/80":"bg-green-500/80"}`,children:o})]})]}),r&&e&&B.jsx("div",{className:"absolute top-3 left-3 bg-emerald-500/80 backdrop-blur-sm text-white px-2 py-1 text-xs rounded-lg",children:"Active Speaker"})]})},xF=({consumers:e,activeSpeakers:n})=>{var o,a,s;const t=n||[],r=t[0],i=t.slice(1,5);return B.jsxs("div",{className:"space-y-4",children:[r&&e[r]?B.jsx("div",{className:"overflow-hidden rounded-xl shadow-xl border border-slate-700",children:B.jsx(Eb,{stream:(o=e[r])==null?void 0:o.combinedStream,username:(a=e[r])==null?void 0:a.userName,userRole:(s=e[r])==null?void 0:s.userRole,isMainSpeaker:!0})}):B.jsx("div",{className:"w-full h-[450px] rounded-xl bg-slate-800/50 border border-slate-700 flex items-center justify-center",children:B.jsxs("div",{className:"text-center",children:[B.jsx(W2,{size:80,className:"mx-auto text-slate-600 mb-4"}),B.jsx("p",{className:"text-slate-400",children:"No active speaker"})]})}),i.length>0&&B.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:i.map((c,u)=>{var l,d,p;return B.jsx("div",{className:"overflow-hidden rounded-xl shadow-lg border border-slate-700",children:B.jsx(Eb,{stream:(l=e[c])==null?void 0:l.combinedStream,username:(d=e[c])==null?void 0:d.userName,userRole:(p=e[c])==null?void 0:p.userRole})},c||`empty-${u}`)})})]})},_F=({localStream:e,isCameraEnabled:n=!0,userRole:t="candidate"})=>{const r=oe.useRef(null);oe.useEffect(()=>{r.current&&e&&(r.current.srcObject=e)},[e]);const i=t?t.charAt(0).toUpperCase()+t.slice(1):"Candidate",o=t==="interviewer"?"bg-blue-500/80":t==="recruiter"?"bg-purple-500/80":"bg-green-500/80";return e?B.jsx("div",{className:"relative w-[240px] h-[180px] rounded-xl overflow-hidden",children:B.jsxs("div",{className:`relative h-full ${n?"":"bg-slate-800"}`,children:[B.jsx("video",{ref:r,className:`w-full h-full object-cover ${n?"":"invisible"}`,muted:!0,autoPlay:!0,playsInline:!0}),!n&&B.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:B.jsx(Og,{size:32,className:"text-slate-500"})}),n&&B.jsx(ck,{videoRef:r,isActive:!!e}),B.jsxs("div",{className:"absolute bottom-2 left-2 bg-black/60 backdrop-blur-sm text-white px-2 py-1 text-xs rounded-lg flex items-center space-x-1",children:[B.jsx("span",{children:"You"}),B.jsx("span",{className:"text-slate-400 mx-1",children:"|"}),B.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${o}`,children:i})]})]})}):null},Tb=["http","https","mailto","tel"];function SF(e){const n=(e||"").trim(),t=n.charAt(0);if(t==="#"||t==="/")return n;const r=n.indexOf(":");if(r===-1)return n;let i=-1;for(;++i<Tb.length;){const o=Tb[i];if(r===o.length&&n.slice(0,o.length).toLowerCase()===o)return n}return i=n.indexOf("?"),i!==-1&&r>i||(i=n.indexOf("#"),i!==-1&&r>i)?n:"javascript:void(0)"}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var CF=function(n){return n!=null&&n.constructor!=null&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)};const uk=_c(CF);function bu(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?Db(e.position):"start"in e||"end"in e?Db(e):"line"in e||"column"in e?av(e):""}function av(e){return Ib(e&&e.line)+":"+Ib(e&&e.column)}function Db(e){return av(e&&e.start)+"-"+av(e&&e.end)}function Ib(e){return e&&typeof e=="number"?e:1}class jr extends Error{constructor(n,t,r){const i=[null,null];let o={start:{line:null,column:null},end:{line:null,column:null}};if(super(),typeof t=="string"&&(r=t,t=void 0),typeof r=="string"){const a=r.indexOf(":");a===-1?i[1]=r:(i[0]=r.slice(0,a),i[1]=r.slice(a+1))}t&&("type"in t||"position"in t?t.position&&(o=t.position):"start"in t||"end"in t?o=t:("line"in t||"column"in t)&&(o.start=t)),this.name=bu(t)||"1:1",this.message=typeof n=="object"?n.message:n,this.stack="",typeof n=="object"&&n.stack&&(this.stack=n.stack),this.reason=this.message,this.fatal,this.line=o.start.line,this.column=o.start.column,this.position=o,this.source=i[0],this.ruleId=i[1],this.file,this.actual,this.expected,this.url,this.note}}jr.prototype.file="";jr.prototype.name="";jr.prototype.reason="";jr.prototype.message="";jr.prototype.stack="";jr.prototype.fatal=null;jr.prototype.column=null;jr.prototype.line=null;jr.prototype.source=null;jr.prototype.ruleId=null;jr.prototype.position=null;const xi={basename:RF,dirname:kF,extname:EF,join:TF,sep:"/"};function RF(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');cl(e);let t=0,r=-1,i=e.length,o;if(n===void 0||n.length===0||n.length>e.length){for(;i--;)if(e.charCodeAt(i)===47){if(o){t=i+1;break}}else r<0&&(o=!0,r=i+1);return r<0?"":e.slice(t,r)}if(n===e)return"";let a=-1,s=n.length-1;for(;i--;)if(e.charCodeAt(i)===47){if(o){t=i+1;break}}else a<0&&(o=!0,a=i+1),s>-1&&(e.charCodeAt(i)===n.charCodeAt(s--)?s<0&&(r=i):(s=-1,r=a));return t===r?r=a:r<0&&(r=e.length),e.slice(t,r)}function kF(e){if(cl(e),e.length===0)return".";let n=-1,t=e.length,r;for(;--t;)if(e.charCodeAt(t)===47){if(r){n=t;break}}else r||(r=!0);return n<0?e.charCodeAt(0)===47?"/":".":n===1&&e.charCodeAt(0)===47?"//":e.slice(0,n)}function EF(e){cl(e);let n=e.length,t=-1,r=0,i=-1,o=0,a;for(;n--;){const s=e.charCodeAt(n);if(s===47){if(a){r=n+1;break}continue}t<0&&(a=!0,t=n+1),s===46?i<0?i=n:o!==1&&(o=1):i>-1&&(o=-1)}return i<0||t<0||o===0||o===1&&i===t-1&&i===r+1?"":e.slice(i,t)}function TF(...e){let n=-1,t;for(;++n<e.length;)cl(e[n]),e[n]&&(t=t===void 0?e[n]:t+"/"+e[n]);return t===void 0?".":DF(t)}function DF(e){cl(e);const n=e.charCodeAt(0)===47;let t=IF(e,!n);return t.length===0&&!n&&(t="."),t.length>0&&e.charCodeAt(e.length-1)===47&&(t+="/"),n?"/"+t:t}function IF(e,n){let t="",r=0,i=-1,o=0,a=-1,s,c;for(;++a<=e.length;){if(a<e.length)s=e.charCodeAt(a);else{if(s===47)break;s=47}if(s===47){if(!(i===a-1||o===1))if(i!==a-1&&o===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){if(c=t.lastIndexOf("/"),c!==t.length-1){c<0?(t="",r=0):(t=t.slice(0,c),r=t.length-1-t.lastIndexOf("/")),i=a,o=0;continue}}else if(t.length>0){t="",r=0,i=a,o=0;continue}}n&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+e.slice(i+1,a):t=e.slice(i+1,a),r=a-i-1;i=a,o=0}else s===46&&o>-1?o++:o=-1}return t}function cl(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const PF={cwd:AF};function AF(){return"/"}function sv(e){return e!==null&&typeof e=="object"&&e.href&&e.origin}function NF(e){if(typeof e=="string")e=new URL(e);else if(!sv(e)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(e.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return MF(e)}function MF(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const n=e.pathname;let t=-1;for(;++t<n.length;)if(n.charCodeAt(t)===37&&n.charCodeAt(t+1)===50){const r=n.charCodeAt(t+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(n)}const pm=["history","path","basename","stem","extname","dirname"];class lk{constructor(n){let t;n?typeof n=="string"||LF(n)?t={value:n}:sv(n)?t={path:n}:t=n:t={},this.data={},this.messages=[],this.history=[],this.cwd=PF.cwd(),this.value,this.stored,this.result,this.map;let r=-1;for(;++r<pm.length;){const o=pm[r];o in t&&t[o]!==void 0&&t[o]!==null&&(this[o]=o==="history"?[...t[o]]:t[o])}let i;for(i in t)pm.includes(i)||(this[i]=t[i])}get path(){return this.history[this.history.length-1]}set path(n){sv(n)&&(n=NF(n)),hm(n,"path"),this.path!==n&&this.history.push(n)}get dirname(){return typeof this.path=="string"?xi.dirname(this.path):void 0}set dirname(n){Pb(this.basename,"dirname"),this.path=xi.join(n||"",this.basename)}get basename(){return typeof this.path=="string"?xi.basename(this.path):void 0}set basename(n){hm(n,"basename"),fm(n,"basename"),this.path=xi.join(this.dirname||"",n)}get extname(){return typeof this.path=="string"?xi.extname(this.path):void 0}set extname(n){if(fm(n,"extname"),Pb(this.dirname,"extname"),n){if(n.charCodeAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=xi.join(this.dirname,this.stem+(n||""))}get stem(){return typeof this.path=="string"?xi.basename(this.path,this.extname):void 0}set stem(n){hm(n,"stem"),fm(n,"stem"),this.path=xi.join(this.dirname||"",n+(this.extname||""))}toString(n){return(this.value||"").toString(n||void 0)}message(n,t,r){const i=new jr(n,t,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}info(n,t,r){const i=this.message(n,t,r);return i.fatal=null,i}fail(n,t,r){const i=this.message(n,t,r);throw i.fatal=!0,i}}function fm(e,n){if(e&&e.includes(xi.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+xi.sep+"`")}function hm(e,n){if(!e)throw new Error("`"+n+"` cannot be empty")}function Pb(e,n){if(!e)throw new Error("Setting `"+n+"` requires `path` to be set too")}function LF(e){return uk(e)}function Ab(e){if(e)throw e}var Pd=Object.prototype.hasOwnProperty,dk=Object.prototype.toString,Nb=Object.defineProperty,Mb=Object.getOwnPropertyDescriptor,Lb=function(n){return typeof Array.isArray=="function"?Array.isArray(n):dk.call(n)==="[object Array]"},Ob=function(n){if(!n||dk.call(n)!=="[object Object]")return!1;var t=Pd.call(n,"constructor"),r=n.constructor&&n.constructor.prototype&&Pd.call(n.constructor.prototype,"isPrototypeOf");if(n.constructor&&!t&&!r)return!1;var i;for(i in n);return typeof i>"u"||Pd.call(n,i)},Fb=function(n,t){Nb&&t.name==="__proto__"?Nb(n,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):n[t.name]=t.newValue},Bb=function(n,t){if(t==="__proto__")if(Pd.call(n,t)){if(Mb)return Mb(n,t).value}else return;return n[t]},OF=function e(){var n,t,r,i,o,a,s=arguments[0],c=1,u=arguments.length,l=!1;for(typeof s=="boolean"&&(l=s,s=arguments[1]||{},c=2),(s==null||typeof s!="object"&&typeof s!="function")&&(s={});c<u;++c)if(n=arguments[c],n!=null)for(t in n)r=Bb(s,t),i=Bb(n,t),s!==i&&(l&&i&&(Ob(i)||(o=Lb(i)))?(o?(o=!1,a=r&&Lb(r)?r:[]):a=r&&Ob(r)?r:{},Fb(s,{name:t,newValue:e(l,a,i)})):typeof i<"u"&&Fb(s,{name:t,newValue:i}));return s};const zb=_c(OF);function cv(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function FF(){const e=[],n={run:t,use:r};return n;function t(...i){let o=-1;const a=i.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);s(null,...i);function s(c,...u){const l=e[++o];let d=-1;if(c){a(c);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,l?BF(l,s)(...u):a(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return e.push(i),n}}function BF(e,n){let t;return r;function r(...a){const s=e.length>a.length;let c;s&&a.push(i);try{c=e.apply(this,a)}catch(u){const l=u;if(s&&t)throw l;return i(l)}s||(c&&c.then&&typeof c.then=="function"?c.then(o,i):c instanceof Error?i(c):o(c))}function i(a,...s){t||(t=!0,n(a,...s))}function o(a){i(null,a)}}const zF=fk().freeze(),pk={}.hasOwnProperty;function fk(){const e=FF(),n=[];let t={},r,i=-1;return o.data=a,o.Parser=void 0,o.Compiler=void 0,o.freeze=s,o.attachers=n,o.use=c,o.parse=u,o.stringify=l,o.run=d,o.runSync=p,o.process=f,o.processSync=m,o;function o(){const g=fk();let v=-1;for(;++v<n.length;)g.use(...n[v]);return g.data(zb(!0,{},t)),g}function a(g,v){return typeof g=="string"?arguments.length===2?(vm("data",r),t[g]=v,o):pk.call(t,g)&&t[g]||null:g?(vm("data",r),t=g,o):t}function s(){if(r)return o;for(;++i<n.length;){const[g,...v]=n[i];if(v[0]===!1)continue;v[0]===!0&&(v[0]=void 0);const h=g.call(o,...v);typeof h=="function"&&e.use(h)}return r=!0,i=Number.POSITIVE_INFINITY,o}function c(g,...v){let h;if(vm("use",r),g!=null)if(typeof g=="function")x(g,...v);else if(typeof g=="object")Array.isArray(g)?b(g):y(g);else throw new TypeError("Expected usable value, not `"+g+"`");return h&&(t.settings=Object.assign(t.settings||{},h)),o;function w(_){if(typeof _=="function")x(_);else if(typeof _=="object")if(Array.isArray(_)){const[C,...R]=_;x(C,...R)}else y(_);else throw new TypeError("Expected usable value, not `"+_+"`")}function y(_){b(_.plugins),_.settings&&(h=Object.assign(h||{},_.settings))}function b(_){let C=-1;if(_!=null)if(Array.isArray(_))for(;++C<_.length;){const R=_[C];w(R)}else throw new TypeError("Expected a list of plugins, not `"+_+"`")}function x(_,C){let R=-1,S;for(;++R<n.length;)if(n[R][0]===_){S=n[R];break}S?(cv(S[1])&&cv(C)&&(C=zb(!0,S[1],C)),S[1]=C):n.push([...arguments])}}function u(g){o.freeze();const v=Yc(g),h=o.Parser;return mm("parse",h),jb(h,"parse")?new h(String(v),v).parse():h(String(v),v)}function l(g,v){o.freeze();const h=Yc(v),w=o.Compiler;return gm("stringify",w),$b(g),jb(w,"compile")?new w(g,h).compile():w(g,h)}function d(g,v,h){if($b(g),o.freeze(),!h&&typeof v=="function"&&(h=v,v=void 0),!h)return new Promise(w);w(null,h);function w(y,b){e.run(g,Yc(v),x);function x(_,C,R){C=C||g,_?b(_):y?y(C):h(null,C,R)}}}function p(g,v){let h,w;return o.run(g,v,y),Ub("runSync","run",w),h;function y(b,x){Ab(b),h=x,w=!0}}function f(g,v){if(o.freeze(),mm("process",o.Parser),gm("process",o.Compiler),!v)return new Promise(h);h(null,v);function h(w,y){const b=Yc(g);o.run(o.parse(b),b,(_,C,R)=>{if(_||!C||!R)x(_);else{const S=o.stringify(C,R);S==null||(UF(S)?R.value=S:R.result=S),x(_,R)}});function x(_,C){_||!C?y(_):w?w(C):v(null,C)}}}function m(g){let v;o.freeze(),mm("processSync",o.Parser),gm("processSync",o.Compiler);const h=Yc(g);return o.process(h,w),Ub("processSync","process",v),h;function w(y){v=!0,Ab(y)}}}function jb(e,n){return typeof e=="function"&&e.prototype&&(jF(e.prototype)||n in e.prototype)}function jF(e){let n;for(n in e)if(pk.call(e,n))return!0;return!1}function mm(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `Parser`")}function gm(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `Compiler`")}function vm(e,n){if(n)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function $b(e){if(!cv(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Ub(e,n,t){if(!t)throw new Error("`"+e+"` finished async. Use `"+n+"` instead")}function Yc(e){return $F(e)?e:new lk(e)}function $F(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function UF(e){return typeof e=="string"||uk(e)}const WF={};function VF(e,n){const t=WF,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return hk(e,r,i)}function hk(e,n,t){if(HF(e)){if("value"in e)return e.type==="html"&&!t?"":e.value;if(n&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Wb(e.children,n,t)}return Array.isArray(e)?Wb(e,n,t):""}function Wb(e,n,t){const r=[];let i=-1;for(;++i<e.length;)r[i]=hk(e[i],n,t);return r.join("")}function HF(e){return!!(e&&typeof e=="object")}function Li(e,n,t,r){const i=e.length;let o=0,a;if(n<0?n=-n>i?0:i+n:n=n>i?i:n,t=t>0?t:0,r.length<1e4)a=Array.from(r),a.unshift(n,t),e.splice(...a);else for(t&&e.splice(n,t);o<r.length;)a=r.slice(o,o+1e4),a.unshift(n,0),e.splice(...a),o+=1e4,n+=1e4}function Pr(e,n){return e.length>0?(Li(e,e.length,0,n),e):n}const Vb={}.hasOwnProperty;function GF(e){const n={};let t=-1;for(;++t<e.length;)qF(n,e[t]);return n}function qF(e,n){let t;for(t in n){const i=(Vb.call(e,t)?e[t]:void 0)||(e[t]={}),o=n[t];let a;if(o)for(a in o){Vb.call(i,a)||(i[a]=[]);const s=o[a];KF(i[a],Array.isArray(s)?s:s?[s]:[])}}}function KF(e,n){let t=-1;const r=[];for(;++t<n.length;)(n[t].add==="after"?e:r).push(n[t]);Li(e,0,0,r)}const XF=/[!-\/:-@\[-`\{-~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/,ki=ha(/[A-Za-z]/),wr=ha(/[\dA-Za-z]/),QF=ha(/[#-'*+\--9=?A-Z^-~]/);function uv(e){return e!==null&&(e<32||e===127)}const lv=ha(/\d/),YF=ha(/[\dA-Fa-f]/),JF=ha(/[!-/:-@[-`{-~]/);function Ie(e){return e!==null&&e<-2}function or(e){return e!==null&&(e<0||e===32)}function nt(e){return e===-2||e===-1||e===32}const ZF=ha(XF),eB=ha(/\s/);function ha(e){return n;function n(t){return t!==null&&e.test(String.fromCharCode(t))}}function yt(e,n,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return a;function a(c){return nt(c)?(e.enter(t),s(c)):n(c)}function s(c){return nt(c)&&o++<i?(e.consume(c),s):(e.exit(t),n(c))}}const tB={tokenize:nB};function nB(e){const n=e.attempt(this.parser.constructs.contentInitial,r,i);let t;return n;function r(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),yt(e,n,"linePrefix")}function i(s){return e.enter("paragraph"),o(s)}function o(s){const c=e.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=c),t=c,a(s)}function a(s){if(s===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(s);return}return Ie(s)?(e.consume(s),e.exit("chunkText"),o):(e.consume(s),a)}}const rB={tokenize:iB},Hb={tokenize:oB};function iB(e){const n=this,t=[];let r=0,i,o,a;return s;function s(y){if(r<t.length){const b=t[r];return n.containerState=b[1],e.attempt(b[0].continuation,c,u)(y)}return u(y)}function c(y){if(r++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,i&&w();const b=n.events.length;let x=b,_;for(;x--;)if(n.events[x][0]==="exit"&&n.events[x][1].type==="chunkFlow"){_=n.events[x][1].end;break}h(r);let C=b;for(;C<n.events.length;)n.events[C][1].end=Object.assign({},_),C++;return Li(n.events,x+1,0,n.events.slice(b)),n.events.length=C,u(y)}return s(y)}function u(y){if(r===t.length){if(!i)return p(y);if(i.currentConstruct&&i.currentConstruct.concrete)return m(y);n.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return n.containerState={},e.check(Hb,l,d)(y)}function l(y){return i&&w(),h(r),p(y)}function d(y){return n.parser.lazy[n.now().line]=r!==t.length,a=n.now().offset,m(y)}function p(y){return n.containerState={},e.attempt(Hb,f,m)(y)}function f(y){return r++,t.push([n.currentConstruct,n.containerState]),p(y)}function m(y){if(y===null){i&&w(),h(0),e.consume(y);return}return i=i||n.parser.flow(n.now()),e.enter("chunkFlow",{contentType:"flow",previous:o,_tokenizer:i}),g(y)}function g(y){if(y===null){v(e.exit("chunkFlow"),!0),h(0),e.consume(y);return}return Ie(y)?(e.consume(y),v(e.exit("chunkFlow")),r=0,n.interrupt=void 0,s):(e.consume(y),g)}function v(y,b){const x=n.sliceStream(y);if(b&&x.push(null),y.previous=o,o&&(o.next=y),o=y,i.defineSkip(y.start),i.write(x),n.parser.lazy[y.start.line]){let _=i.events.length;for(;_--;)if(i.events[_][1].start.offset<a&&(!i.events[_][1].end||i.events[_][1].end.offset>a))return;const C=n.events.length;let R=C,S,E;for(;R--;)if(n.events[R][0]==="exit"&&n.events[R][1].type==="chunkFlow"){if(S){E=n.events[R][1].end;break}S=!0}for(h(r),_=C;_<n.events.length;)n.events[_][1].end=Object.assign({},E),_++;Li(n.events,R+1,0,n.events.slice(C)),n.events.length=_}}function h(y){let b=t.length;for(;b-- >y;){const x=t[b];n.containerState=x[1],x[0].exit.call(n,e)}t.length=y}function w(){i.write([null]),o=void 0,i=void 0,n.containerState._closeFlow=void 0}}function oB(e,n,t){return yt(e,e.attempt(this.parser.constructs.document,n,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Gb(e){if(e===null||or(e)||eB(e))return 1;if(ZF(e))return 2}function C0(e,n,t){const r=[];let i=-1;for(;++i<e.length;){const o=e[i].resolveAll;o&&!r.includes(o)&&(n=o(n,t),r.push(o))}return n}const dv={name:"attention",tokenize:sB,resolveAll:aB};function aB(e,n){let t=-1,r,i,o,a,s,c,u,l;for(;++t<e.length;)if(e[t][0]==="enter"&&e[t][1].type==="attentionSequence"&&e[t][1]._close){for(r=t;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&n.sliceSerialize(e[r][1]).charCodeAt(0)===n.sliceSerialize(e[t][1]).charCodeAt(0)){if((e[r][1]._close||e[t][1]._open)&&(e[t][1].end.offset-e[t][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[t][1].end.offset-e[t][1].start.offset)%3))continue;c=e[r][1].end.offset-e[r][1].start.offset>1&&e[t][1].end.offset-e[t][1].start.offset>1?2:1;const d=Object.assign({},e[r][1].end),p=Object.assign({},e[t][1].start);qb(d,-c),qb(p,c),a={type:c>1?"strongSequence":"emphasisSequence",start:d,end:Object.assign({},e[r][1].end)},s={type:c>1?"strongSequence":"emphasisSequence",start:Object.assign({},e[t][1].start),end:p},o={type:c>1?"strongText":"emphasisText",start:Object.assign({},e[r][1].end),end:Object.assign({},e[t][1].start)},i={type:c>1?"strong":"emphasis",start:Object.assign({},a.start),end:Object.assign({},s.end)},e[r][1].end=Object.assign({},a.start),e[t][1].start=Object.assign({},s.end),u=[],e[r][1].end.offset-e[r][1].start.offset&&(u=Pr(u,[["enter",e[r][1],n],["exit",e[r][1],n]])),u=Pr(u,[["enter",i,n],["enter",a,n],["exit",a,n],["enter",o,n]]),u=Pr(u,C0(n.parser.constructs.insideSpan.null,e.slice(r+1,t),n)),u=Pr(u,[["exit",o,n],["enter",s,n],["exit",s,n],["exit",i,n]]),e[t][1].end.offset-e[t][1].start.offset?(l=2,u=Pr(u,[["enter",e[t][1],n],["exit",e[t][1],n]])):l=0,Li(e,r-1,t-r+3,u),t=r+u.length-l-2;break}}for(t=-1;++t<e.length;)e[t][1].type==="attentionSequence"&&(e[t][1].type="data");return e}function sB(e,n){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,i=Gb(r);let o;return a;function a(c){return o=c,e.enter("attentionSequence"),s(c)}function s(c){if(c===o)return e.consume(c),s;const u=e.exit("attentionSequence"),l=Gb(c),d=!l||l===2&&i||t.includes(c),p=!i||i===2&&l||t.includes(r);return u._open=!!(o===42?d:d&&(i||!p)),u._close=!!(o===42?p:p&&(l||!d)),n(c)}}function qb(e,n){e.column+=n,e.offset+=n,e._bufferIndex+=n}const cB={name:"autolink",tokenize:uB};function uB(e,n,t){let r=0;return i;function i(f){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),o}function o(f){return ki(f)?(e.consume(f),a):u(f)}function a(f){return f===43||f===45||f===46||wr(f)?(r=1,s(f)):u(f)}function s(f){return f===58?(e.consume(f),r=0,c):(f===43||f===45||f===46||wr(f))&&r++<32?(e.consume(f),s):(r=0,u(f))}function c(f){return f===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),n):f===null||f===32||f===60||uv(f)?t(f):(e.consume(f),c)}function u(f){return f===64?(e.consume(f),l):QF(f)?(e.consume(f),u):t(f)}function l(f){return wr(f)?d(f):t(f)}function d(f){return f===46?(e.consume(f),r=0,l):f===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),n):p(f)}function p(f){if((f===45||wr(f))&&r++<63){const m=f===45?p:d;return e.consume(f),m}return t(f)}}const ff={tokenize:lB,partial:!0};function lB(e,n,t){return r;function r(o){return nt(o)?yt(e,i,"linePrefix")(o):i(o)}function i(o){return o===null||Ie(o)?n(o):t(o)}}const mk={name:"blockQuote",tokenize:dB,continuation:{tokenize:pB},exit:fB};function dB(e,n,t){const r=this;return i;function i(a){if(a===62){const s=r.containerState;return s.open||(e.enter("blockQuote",{_container:!0}),s.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),o}return t(a)}function o(a){return nt(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),n):(e.exit("blockQuotePrefix"),n(a))}}function pB(e,n,t){const r=this;return i;function i(a){return nt(a)?yt(e,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):o(a)}function o(a){return e.attempt(mk,n,t)(a)}}function fB(e){e.exit("blockQuote")}const gk={name:"characterEscape",tokenize:hB};function hB(e,n,t){return r;function r(o){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(o),e.exit("escapeMarker"),i}function i(o){return JF(o)?(e.enter("characterEscapeValue"),e.consume(o),e.exit("characterEscapeValue"),e.exit("characterEscape"),n):t(o)}}const Kb=document.createElement("i");function R0(e){const n="&"+e+";";Kb.innerHTML=n;const t=Kb.textContent;return t.charCodeAt(t.length-1)===59&&e!=="semi"||t===n?!1:t}const vk={name:"characterReference",tokenize:mB};function mB(e,n,t){const r=this;let i=0,o,a;return s;function s(d){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),c}function c(d){return d===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(d),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),o=31,a=wr,l(d))}function u(d){return d===88||d===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(d),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),o=6,a=YF,l):(e.enter("characterReferenceValue"),o=7,a=lv,l(d))}function l(d){if(d===59&&i){const p=e.exit("characterReferenceValue");return a===wr&&!R0(r.sliceSerialize(p))?t(d):(e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),e.exit("characterReference"),n)}return a(d)&&i++<o?(e.consume(d),l):t(d)}}const Xb={tokenize:vB,partial:!0},Qb={name:"codeFenced",tokenize:gB,concrete:!0};function gB(e,n,t){const r=this,i={tokenize:x,partial:!0};let o=0,a=0,s;return c;function c(_){return u(_)}function u(_){const C=r.events[r.events.length-1];return o=C&&C[1].type==="linePrefix"?C[2].sliceSerialize(C[1],!0).length:0,s=_,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),l(_)}function l(_){return _===s?(a++,e.consume(_),l):a<3?t(_):(e.exit("codeFencedFenceSequence"),nt(_)?yt(e,d,"whitespace")(_):d(_))}function d(_){return _===null||Ie(_)?(e.exit("codeFencedFence"),r.interrupt?n(_):e.check(Xb,g,b)(_)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),p(_))}function p(_){return _===null||Ie(_)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),d(_)):nt(_)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),yt(e,f,"whitespace")(_)):_===96&&_===s?t(_):(e.consume(_),p)}function f(_){return _===null||Ie(_)?d(_):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),m(_))}function m(_){return _===null||Ie(_)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),d(_)):_===96&&_===s?t(_):(e.consume(_),m)}function g(_){return e.attempt(i,b,v)(_)}function v(_){return e.enter("lineEnding"),e.consume(_),e.exit("lineEnding"),h}function h(_){return o>0&&nt(_)?yt(e,w,"linePrefix",o+1)(_):w(_)}function w(_){return _===null||Ie(_)?e.check(Xb,g,b)(_):(e.enter("codeFlowValue"),y(_))}function y(_){return _===null||Ie(_)?(e.exit("codeFlowValue"),w(_)):(e.consume(_),y)}function b(_){return e.exit("codeFenced"),n(_)}function x(_,C,R){let S=0;return E;function E(j){return _.enter("lineEnding"),_.consume(j),_.exit("lineEnding"),T}function T(j){return _.enter("codeFencedFence"),nt(j)?yt(_,I,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(j):I(j)}function I(j){return j===s?(_.enter("codeFencedFenceSequence"),F(j)):R(j)}function F(j){return j===s?(S++,_.consume(j),F):S>=a?(_.exit("codeFencedFenceSequence"),nt(j)?yt(_,z,"whitespace")(j):z(j)):R(j)}function z(j){return j===null||Ie(j)?(_.exit("codeFencedFence"),C(j)):R(j)}}}function vB(e,n,t){const r=this;return i;function i(a){return a===null?t(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),o)}function o(a){return r.parser.lazy[r.now().line]?t(a):n(a)}}const ym={name:"codeIndented",tokenize:wB},yB={tokenize:bB,partial:!0};function wB(e,n,t){const r=this;return i;function i(u){return e.enter("codeIndented"),yt(e,o,"linePrefix",5)(u)}function o(u){const l=r.events[r.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?a(u):t(u)}function a(u){return u===null?c(u):Ie(u)?e.attempt(yB,a,c)(u):(e.enter("codeFlowValue"),s(u))}function s(u){return u===null||Ie(u)?(e.exit("codeFlowValue"),a(u)):(e.consume(u),s)}function c(u){return e.exit("codeIndented"),n(u)}}function bB(e,n,t){const r=this;return i;function i(a){return r.parser.lazy[r.now().line]?t(a):Ie(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i):yt(e,o,"linePrefix",5)(a)}function o(a){const s=r.events[r.events.length-1];return s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?n(a):Ie(a)?i(a):t(a)}}const xB={name:"codeText",tokenize:CB,resolve:_B,previous:SB};function _B(e){let n=e.length-4,t=3,r,i;if((e[t][1].type==="lineEnding"||e[t][1].type==="space")&&(e[n][1].type==="lineEnding"||e[n][1].type==="space")){for(r=t;++r<n;)if(e[r][1].type==="codeTextData"){e[t][1].type="codeTextPadding",e[n][1].type="codeTextPadding",t+=2,n-=2;break}}for(r=t-1,n++;++r<=n;)i===void 0?r!==n&&e[r][1].type!=="lineEnding"&&(i=r):(r===n||e[r][1].type==="lineEnding")&&(e[i][1].type="codeTextData",r!==i+2&&(e[i][1].end=e[r-1][1].end,e.splice(i+2,r-i-2),n-=r-i-2,r=i+2),i=void 0);return e}function SB(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function CB(e,n,t){let r=0,i,o;return a;function a(d){return e.enter("codeText"),e.enter("codeTextSequence"),s(d)}function s(d){return d===96?(e.consume(d),r++,s):(e.exit("codeTextSequence"),c(d))}function c(d){return d===null?t(d):d===32?(e.enter("space"),e.consume(d),e.exit("space"),c):d===96?(o=e.enter("codeTextSequence"),i=0,l(d)):Ie(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),c):(e.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||Ie(d)?(e.exit("codeTextData"),c(d)):(e.consume(d),u)}function l(d){return d===96?(e.consume(d),i++,l):i===r?(e.exit("codeTextSequence"),e.exit("codeText"),n(d)):(o.type="codeTextData",u(d))}}function yk(e){const n={};let t=-1,r,i,o,a,s,c,u;for(;++t<e.length;){for(;t in n;)t=n[t];if(r=e[t],t&&r[1].type==="chunkFlow"&&e[t-1][1].type==="listItemPrefix"&&(c=r[1]._tokenizer.events,o=0,o<c.length&&c[o][1].type==="lineEndingBlank"&&(o+=2),o<c.length&&c[o][1].type==="content"))for(;++o<c.length&&c[o][1].type!=="content";)c[o][1].type==="chunkText"&&(c[o][1]._isInFirstContentOfListItem=!0,o++);if(r[0]==="enter")r[1].contentType&&(Object.assign(n,RB(e,t)),t=n[t],u=!0);else if(r[1]._container){for(o=t,i=void 0;o--&&(a=e[o],a[1].type==="lineEnding"||a[1].type==="lineEndingBlank");)a[0]==="enter"&&(i&&(e[i][1].type="lineEndingBlank"),a[1].type="lineEnding",i=o);i&&(r[1].end=Object.assign({},e[i][1].start),s=e.slice(i,t),s.unshift(r),Li(e,i,t-i+1,s))}}return!u}function RB(e,n){const t=e[n][1],r=e[n][2];let i=n-1;const o=[],a=t._tokenizer||r.parser[t.contentType](t.start),s=a.events,c=[],u={};let l,d,p=-1,f=t,m=0,g=0;const v=[g];for(;f;){for(;e[++i][1]!==f;);o.push(i),f._tokenizer||(l=r.sliceStream(f),f.next||l.push(null),d&&a.defineSkip(f.start),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(l),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=f,f=f.next}for(f=t;++p<s.length;)s[p][0]==="exit"&&s[p-1][0]==="enter"&&s[p][1].type===s[p-1][1].type&&s[p][1].start.line!==s[p][1].end.line&&(g=p+1,v.push(g),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(a.events=[],f?(f._tokenizer=void 0,f.previous=void 0):v.pop(),p=v.length;p--;){const h=s.slice(v[p],v[p+1]),w=o.pop();c.unshift([w,w+h.length-1]),Li(e,w,2,h)}for(p=-1;++p<c.length;)u[m+c[p][0]]=m+c[p][1],m+=c[p][1]-c[p][0]-1;return u}const kB={tokenize:DB,resolve:TB},EB={tokenize:IB,partial:!0};function TB(e){return yk(e),e}function DB(e,n){let t;return r;function r(s){return e.enter("content"),t=e.enter("chunkContent",{contentType:"content"}),i(s)}function i(s){return s===null?o(s):Ie(s)?e.check(EB,a,o)(s):(e.consume(s),i)}function o(s){return e.exit("chunkContent"),e.exit("content"),n(s)}function a(s){return e.consume(s),e.exit("chunkContent"),t.next=e.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,i}}function IB(e,n,t){const r=this;return i;function i(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),yt(e,o,"linePrefix")}function o(a){if(a===null||Ie(a))return t(a);const s=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&s&&s[1].type==="linePrefix"&&s[2].sliceSerialize(s[1],!0).length>=4?n(a):e.interrupt(r.parser.constructs.flow,t,n)(a)}}function wk(e,n,t,r,i,o,a,s,c){const u=c||Number.POSITIVE_INFINITY;let l=0;return d;function d(h){return h===60?(e.enter(r),e.enter(i),e.enter(o),e.consume(h),e.exit(o),p):h===null||h===32||h===41||uv(h)?t(h):(e.enter(r),e.enter(a),e.enter(s),e.enter("chunkString",{contentType:"string"}),g(h))}function p(h){return h===62?(e.enter(o),e.consume(h),e.exit(o),e.exit(i),e.exit(r),n):(e.enter(s),e.enter("chunkString",{contentType:"string"}),f(h))}function f(h){return h===62?(e.exit("chunkString"),e.exit(s),p(h)):h===null||h===60||Ie(h)?t(h):(e.consume(h),h===92?m:f)}function m(h){return h===60||h===62||h===92?(e.consume(h),f):f(h)}function g(h){return!l&&(h===null||h===41||or(h))?(e.exit("chunkString"),e.exit(s),e.exit(a),e.exit(r),n(h)):l<u&&h===40?(e.consume(h),l++,g):h===41?(e.consume(h),l--,g):h===null||h===32||h===40||uv(h)?t(h):(e.consume(h),h===92?v:g)}function v(h){return h===40||h===41||h===92?(e.consume(h),g):g(h)}}function bk(e,n,t,r,i,o){const a=this;let s=0,c;return u;function u(f){return e.enter(r),e.enter(i),e.consume(f),e.exit(i),e.enter(o),l}function l(f){return s>999||f===null||f===91||f===93&&!c||f===94&&!s&&"_hiddenFootnoteSupport"in a.parser.constructs?t(f):f===93?(e.exit(o),e.enter(i),e.consume(f),e.exit(i),e.exit(r),n):Ie(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),l):(e.enter("chunkString",{contentType:"string"}),d(f))}function d(f){return f===null||f===91||f===93||Ie(f)||s++>999?(e.exit("chunkString"),l(f)):(e.consume(f),c||(c=!nt(f)),f===92?p:d)}function p(f){return f===91||f===92||f===93?(e.consume(f),s++,d):d(f)}}function xk(e,n,t,r,i,o){let a;return s;function s(p){return p===34||p===39||p===40?(e.enter(r),e.enter(i),e.consume(p),e.exit(i),a=p===40?41:p,c):t(p)}function c(p){return p===a?(e.enter(i),e.consume(p),e.exit(i),e.exit(r),n):(e.enter(o),u(p))}function u(p){return p===a?(e.exit(o),c(a)):p===null?t(p):Ie(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),yt(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),l(p))}function l(p){return p===a||p===null||Ie(p)?(e.exit("chunkString"),u(p)):(e.consume(p),p===92?d:l)}function d(p){return p===a||p===92?(e.consume(p),l):l(p)}}function xu(e,n){let t;return r;function r(i){return Ie(i)?(e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t=!0,r):nt(i)?yt(e,r,t?"linePrefix":"lineSuffix")(i):n(i)}}function sc(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const PB={name:"definition",tokenize:NB},AB={tokenize:MB,partial:!0};function NB(e,n,t){const r=this;let i;return o;function o(f){return e.enter("definition"),a(f)}function a(f){return bk.call(r,e,s,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function s(f){return i=sc(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(e.enter("definitionMarker"),e.consume(f),e.exit("definitionMarker"),c):t(f)}function c(f){return or(f)?xu(e,u)(f):u(f)}function u(f){return wk(e,l,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function l(f){return e.attempt(AB,d,d)(f)}function d(f){return nt(f)?yt(e,p,"whitespace")(f):p(f)}function p(f){return f===null||Ie(f)?(e.exit("definition"),r.parser.defined.push(i),n(f)):t(f)}}function MB(e,n,t){return r;function r(s){return or(s)?xu(e,i)(s):t(s)}function i(s){return xk(e,o,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(s)}function o(s){return nt(s)?yt(e,a,"whitespace")(s):a(s)}function a(s){return s===null||Ie(s)?n(s):t(s)}}const LB={name:"hardBreakEscape",tokenize:OB};function OB(e,n,t){return r;function r(o){return e.enter("hardBreakEscape"),e.consume(o),i}function i(o){return Ie(o)?(e.exit("hardBreakEscape"),n(o)):t(o)}}const FB={name:"headingAtx",tokenize:zB,resolve:BB};function BB(e,n){let t=e.length-2,r=3,i,o;return e[r][1].type==="whitespace"&&(r+=2),t-2>r&&e[t][1].type==="whitespace"&&(t-=2),e[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&e[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:e[r][1].start,end:e[t][1].end},o={type:"chunkText",start:e[r][1].start,end:e[t][1].end,contentType:"text"},Li(e,r,t-r+1,[["enter",i,n],["enter",o,n],["exit",o,n],["exit",i,n]])),e}function zB(e,n,t){let r=0;return i;function i(l){return e.enter("atxHeading"),o(l)}function o(l){return e.enter("atxHeadingSequence"),a(l)}function a(l){return l===35&&r++<6?(e.consume(l),a):l===null||or(l)?(e.exit("atxHeadingSequence"),s(l)):t(l)}function s(l){return l===35?(e.enter("atxHeadingSequence"),c(l)):l===null||Ie(l)?(e.exit("atxHeading"),n(l)):nt(l)?yt(e,s,"whitespace")(l):(e.enter("atxHeadingText"),u(l))}function c(l){return l===35?(e.consume(l),c):(e.exit("atxHeadingSequence"),s(l))}function u(l){return l===null||l===35||or(l)?(e.exit("atxHeadingText"),s(l)):(e.consume(l),u)}}const jB=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Yb=["pre","script","style","textarea"],$B={name:"htmlFlow",tokenize:HB,resolveTo:VB,concrete:!0},UB={tokenize:qB,partial:!0},WB={tokenize:GB,partial:!0};function VB(e){let n=e.length;for(;n--&&!(e[n][0]==="enter"&&e[n][1].type==="htmlFlow"););return n>1&&e[n-2][1].type==="linePrefix"&&(e[n][1].start=e[n-2][1].start,e[n+1][1].start=e[n-2][1].start,e.splice(n-2,2)),e}function HB(e,n,t){const r=this;let i,o,a,s,c;return u;function u(P){return l(P)}function l(P){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(P),d}function d(P){return P===33?(e.consume(P),p):P===47?(e.consume(P),o=!0,g):P===63?(e.consume(P),i=3,r.interrupt?n:k):ki(P)?(e.consume(P),a=String.fromCharCode(P),v):t(P)}function p(P){return P===45?(e.consume(P),i=2,f):P===91?(e.consume(P),i=5,s=0,m):ki(P)?(e.consume(P),i=4,r.interrupt?n:k):t(P)}function f(P){return P===45?(e.consume(P),r.interrupt?n:k):t(P)}function m(P){const ne="CDATA[";return P===ne.charCodeAt(s++)?(e.consume(P),s===ne.length?r.interrupt?n:I:m):t(P)}function g(P){return ki(P)?(e.consume(P),a=String.fromCharCode(P),v):t(P)}function v(P){if(P===null||P===47||P===62||or(P)){const ne=P===47,se=a.toLowerCase();return!ne&&!o&&Yb.includes(se)?(i=1,r.interrupt?n(P):I(P)):jB.includes(a.toLowerCase())?(i=6,ne?(e.consume(P),h):r.interrupt?n(P):I(P)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(P):o?w(P):y(P))}return P===45||wr(P)?(e.consume(P),a+=String.fromCharCode(P),v):t(P)}function h(P){return P===62?(e.consume(P),r.interrupt?n:I):t(P)}function w(P){return nt(P)?(e.consume(P),w):E(P)}function y(P){return P===47?(e.consume(P),E):P===58||P===95||ki(P)?(e.consume(P),b):nt(P)?(e.consume(P),y):E(P)}function b(P){return P===45||P===46||P===58||P===95||wr(P)?(e.consume(P),b):x(P)}function x(P){return P===61?(e.consume(P),_):nt(P)?(e.consume(P),x):y(P)}function _(P){return P===null||P===60||P===61||P===62||P===96?t(P):P===34||P===39?(e.consume(P),c=P,C):nt(P)?(e.consume(P),_):R(P)}function C(P){return P===c?(e.consume(P),c=null,S):P===null||Ie(P)?t(P):(e.consume(P),C)}function R(P){return P===null||P===34||P===39||P===47||P===60||P===61||P===62||P===96||or(P)?x(P):(e.consume(P),R)}function S(P){return P===47||P===62||nt(P)?y(P):t(P)}function E(P){return P===62?(e.consume(P),T):t(P)}function T(P){return P===null||Ie(P)?I(P):nt(P)?(e.consume(P),T):t(P)}function I(P){return P===45&&i===2?(e.consume(P),H):P===60&&i===1?(e.consume(P),W):P===62&&i===4?(e.consume(P),U):P===63&&i===3?(e.consume(P),k):P===93&&i===5?(e.consume(P),$):Ie(P)&&(i===6||i===7)?(e.exit("htmlFlowData"),e.check(UB,X,F)(P)):P===null||Ie(P)?(e.exit("htmlFlowData"),F(P)):(e.consume(P),I)}function F(P){return e.check(WB,z,X)(P)}function z(P){return e.enter("lineEnding"),e.consume(P),e.exit("lineEnding"),j}function j(P){return P===null||Ie(P)?F(P):(e.enter("htmlFlowData"),I(P))}function H(P){return P===45?(e.consume(P),k):I(P)}function W(P){return P===47?(e.consume(P),a="",L):I(P)}function L(P){if(P===62){const ne=a.toLowerCase();return Yb.includes(ne)?(e.consume(P),U):I(P)}return ki(P)&&a.length<8?(e.consume(P),a+=String.fromCharCode(P),L):I(P)}function $(P){return P===93?(e.consume(P),k):I(P)}function k(P){return P===62?(e.consume(P),U):P===45&&i===2?(e.consume(P),k):I(P)}function U(P){return P===null||Ie(P)?(e.exit("htmlFlowData"),X(P)):(e.consume(P),U)}function X(P){return e.exit("htmlFlow"),n(P)}}function GB(e,n,t){const r=this;return i;function i(a){return Ie(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),o):t(a)}function o(a){return r.parser.lazy[r.now().line]?t(a):n(a)}}function qB(e,n,t){return r;function r(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),e.attempt(ff,n,t)}}const KB={name:"htmlText",tokenize:XB};function XB(e,n,t){const r=this;let i,o,a;return s;function s(k){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(k),c}function c(k){return k===33?(e.consume(k),u):k===47?(e.consume(k),x):k===63?(e.consume(k),y):ki(k)?(e.consume(k),R):t(k)}function u(k){return k===45?(e.consume(k),l):k===91?(e.consume(k),o=0,m):ki(k)?(e.consume(k),w):t(k)}function l(k){return k===45?(e.consume(k),f):t(k)}function d(k){return k===null?t(k):k===45?(e.consume(k),p):Ie(k)?(a=d,W(k)):(e.consume(k),d)}function p(k){return k===45?(e.consume(k),f):d(k)}function f(k){return k===62?H(k):k===45?p(k):d(k)}function m(k){const U="CDATA[";return k===U.charCodeAt(o++)?(e.consume(k),o===U.length?g:m):t(k)}function g(k){return k===null?t(k):k===93?(e.consume(k),v):Ie(k)?(a=g,W(k)):(e.consume(k),g)}function v(k){return k===93?(e.consume(k),h):g(k)}function h(k){return k===62?H(k):k===93?(e.consume(k),h):g(k)}function w(k){return k===null||k===62?H(k):Ie(k)?(a=w,W(k)):(e.consume(k),w)}function y(k){return k===null?t(k):k===63?(e.consume(k),b):Ie(k)?(a=y,W(k)):(e.consume(k),y)}function b(k){return k===62?H(k):y(k)}function x(k){return ki(k)?(e.consume(k),_):t(k)}function _(k){return k===45||wr(k)?(e.consume(k),_):C(k)}function C(k){return Ie(k)?(a=C,W(k)):nt(k)?(e.consume(k),C):H(k)}function R(k){return k===45||wr(k)?(e.consume(k),R):k===47||k===62||or(k)?S(k):t(k)}function S(k){return k===47?(e.consume(k),H):k===58||k===95||ki(k)?(e.consume(k),E):Ie(k)?(a=S,W(k)):nt(k)?(e.consume(k),S):H(k)}function E(k){return k===45||k===46||k===58||k===95||wr(k)?(e.consume(k),E):T(k)}function T(k){return k===61?(e.consume(k),I):Ie(k)?(a=T,W(k)):nt(k)?(e.consume(k),T):S(k)}function I(k){return k===null||k===60||k===61||k===62||k===96?t(k):k===34||k===39?(e.consume(k),i=k,F):Ie(k)?(a=I,W(k)):nt(k)?(e.consume(k),I):(e.consume(k),z)}function F(k){return k===i?(e.consume(k),i=void 0,j):k===null?t(k):Ie(k)?(a=F,W(k)):(e.consume(k),F)}function z(k){return k===null||k===34||k===39||k===60||k===61||k===96?t(k):k===47||k===62||or(k)?S(k):(e.consume(k),z)}function j(k){return k===47||k===62||or(k)?S(k):t(k)}function H(k){return k===62?(e.consume(k),e.exit("htmlTextData"),e.exit("htmlText"),n):t(k)}function W(k){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(k),e.exit("lineEnding"),L}function L(k){return nt(k)?yt(e,$,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(k):$(k)}function $(k){return e.enter("htmlTextData"),a(k)}}const k0={name:"labelEnd",tokenize:t6,resolveTo:e6,resolveAll:ZB},QB={tokenize:n6},YB={tokenize:r6},JB={tokenize:i6};function ZB(e){let n=-1;for(;++n<e.length;){const t=e[n][1];(t.type==="labelImage"||t.type==="labelLink"||t.type==="labelEnd")&&(e.splice(n+1,t.type==="labelImage"?4:2),t.type="data",n++)}return e}function e6(e,n){let t=e.length,r=0,i,o,a,s;for(;t--;)if(i=e[t][1],o){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;e[t][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(a){if(e[t][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(o=t,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(a=t);const c={type:e[o][1].type==="labelLink"?"link":"image",start:Object.assign({},e[o][1].start),end:Object.assign({},e[e.length-1][1].end)},u={type:"label",start:Object.assign({},e[o][1].start),end:Object.assign({},e[a][1].end)},l={type:"labelText",start:Object.assign({},e[o+r+2][1].end),end:Object.assign({},e[a-2][1].start)};return s=[["enter",c,n],["enter",u,n]],s=Pr(s,e.slice(o+1,o+r+3)),s=Pr(s,[["enter",l,n]]),s=Pr(s,C0(n.parser.constructs.insideSpan.null,e.slice(o+r+4,a-3),n)),s=Pr(s,[["exit",l,n],e[a-2],e[a-1],["exit",u,n]]),s=Pr(s,e.slice(a+1)),s=Pr(s,[["exit",c,n]]),Li(e,o,e.length,s),e}function t6(e,n,t){const r=this;let i=r.events.length,o,a;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){o=r.events[i][1];break}return s;function s(p){return o?o._inactive?d(p):(a=r.parser.defined.includes(sc(r.sliceSerialize({start:o.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(p),e.exit("labelMarker"),e.exit("labelEnd"),c):t(p)}function c(p){return p===40?e.attempt(QB,l,a?l:d)(p):p===91?e.attempt(YB,l,a?u:d)(p):a?l(p):d(p)}function u(p){return e.attempt(JB,l,d)(p)}function l(p){return n(p)}function d(p){return o._balanced=!0,t(p)}}function n6(e,n,t){return r;function r(d){return e.enter("resource"),e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),i}function i(d){return or(d)?xu(e,o)(d):o(d)}function o(d){return d===41?l(d):wk(e,a,s,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function a(d){return or(d)?xu(e,c)(d):l(d)}function s(d){return t(d)}function c(d){return d===34||d===39||d===40?xk(e,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):l(d)}function u(d){return or(d)?xu(e,l)(d):l(d)}function l(d){return d===41?(e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),e.exit("resource"),n):t(d)}}function r6(e,n,t){const r=this;return i;function i(s){return bk.call(r,e,o,a,"reference","referenceMarker","referenceString")(s)}function o(s){return r.parser.defined.includes(sc(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?n(s):t(s)}function a(s){return t(s)}}function i6(e,n,t){return r;function r(o){return e.enter("reference"),e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),i}function i(o){return o===93?(e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),e.exit("reference"),n):t(o)}}const o6={name:"labelStartImage",tokenize:a6,resolveAll:k0.resolveAll};function a6(e,n,t){const r=this;return i;function i(s){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(s),e.exit("labelImageMarker"),o}function o(s){return s===91?(e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelImage"),a):t(s)}function a(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(s):n(s)}}const s6={name:"labelStartLink",tokenize:c6,resolveAll:k0.resolveAll};function c6(e,n,t){const r=this;return i;function i(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),o}function o(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(a):n(a)}}const wm={name:"lineEnding",tokenize:u6};function u6(e,n){return t;function t(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),yt(e,n,"linePrefix")}}const Ad={name:"thematicBreak",tokenize:l6};function l6(e,n,t){let r=0,i;return o;function o(u){return e.enter("thematicBreak"),a(u)}function a(u){return i=u,s(u)}function s(u){return u===i?(e.enter("thematicBreakSequence"),c(u)):r>=3&&(u===null||Ie(u))?(e.exit("thematicBreak"),n(u)):t(u)}function c(u){return u===i?(e.consume(u),r++,c):(e.exit("thematicBreakSequence"),nt(u)?yt(e,s,"whitespace")(u):s(u))}}const Xn={name:"list",tokenize:f6,continuation:{tokenize:h6},exit:g6},d6={tokenize:v6,partial:!0},p6={tokenize:m6,partial:!0};function f6(e,n,t){const r=this,i=r.events[r.events.length-1];let o=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,a=0;return s;function s(f){const m=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:lv(f)){if(r.containerState.type||(r.containerState.type=m,e.enter(m,{_container:!0})),m==="listUnordered")return e.enter("listItemPrefix"),f===42||f===45?e.check(Ad,t,u)(f):u(f);if(!r.interrupt||f===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),c(f)}return t(f)}function c(f){return lv(f)&&++a<10?(e.consume(f),c):(!r.interrupt||a<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(e.exit("listItemValue"),u(f)):t(f)}function u(f){return e.enter("listItemMarker"),e.consume(f),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,e.check(ff,r.interrupt?t:l,e.attempt(d6,p,d))}function l(f){return r.containerState.initialBlankLine=!0,o++,p(f)}function d(f){return nt(f)?(e.enter("listItemPrefixWhitespace"),e.consume(f),e.exit("listItemPrefixWhitespace"),p):t(f)}function p(f){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,n(f)}}function h6(e,n,t){const r=this;return r.containerState._closeFlow=void 0,e.check(ff,i,o);function i(s){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,yt(e,n,"listItemIndent",r.containerState.size+1)(s)}function o(s){return r.containerState.furtherBlankLines||!nt(s)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,a(s)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(p6,n,a)(s))}function a(s){return r.containerState._closeFlow=!0,r.interrupt=void 0,yt(e,e.attempt(Xn,n,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s)}}function m6(e,n,t){const r=this;return yt(e,i,"listItemIndent",r.containerState.size+1);function i(o){const a=r.events[r.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===r.containerState.size?n(o):t(o)}}function g6(e){e.exit(this.containerState.type)}function v6(e,n,t){const r=this;return yt(e,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(o){const a=r.events[r.events.length-1];return!nt(o)&&a&&a[1].type==="listItemPrefixWhitespace"?n(o):t(o)}}const Jb={name:"setextUnderline",tokenize:w6,resolveTo:y6};function y6(e,n){let t=e.length,r,i,o;for(;t--;)if(e[t][0]==="enter"){if(e[t][1].type==="content"){r=t;break}e[t][1].type==="paragraph"&&(i=t)}else e[t][1].type==="content"&&e.splice(t,1),!o&&e[t][1].type==="definition"&&(o=t);const a={type:"setextHeading",start:Object.assign({},e[i][1].start),end:Object.assign({},e[e.length-1][1].end)};return e[i][1].type="setextHeadingText",o?(e.splice(i,0,["enter",a,n]),e.splice(o+1,0,["exit",e[r][1],n]),e[r][1].end=Object.assign({},e[o][1].end)):e[r][1]=a,e.push(["exit",a,n]),e}function w6(e,n,t){const r=this;let i;return o;function o(u){let l=r.events.length,d;for(;l--;)if(r.events[l][1].type!=="lineEnding"&&r.events[l][1].type!=="linePrefix"&&r.events[l][1].type!=="content"){d=r.events[l][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(e.enter("setextHeadingLine"),i=u,a(u)):t(u)}function a(u){return e.enter("setextHeadingLineSequence"),s(u)}function s(u){return u===i?(e.consume(u),s):(e.exit("setextHeadingLineSequence"),nt(u)?yt(e,c,"lineSuffix")(u):c(u))}function c(u){return u===null||Ie(u)?(e.exit("setextHeadingLine"),n(u)):t(u)}}const b6={tokenize:x6};function x6(e){const n=this,t=e.attempt(ff,r,e.attempt(this.parser.constructs.flowInitial,i,yt(e,e.attempt(this.parser.constructs.flow,i,e.attempt(kB,i)),"linePrefix")));return t;function r(o){if(o===null){e.consume(o);return}return e.enter("lineEndingBlank"),e.consume(o),e.exit("lineEndingBlank"),n.currentConstruct=void 0,t}function i(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),n.currentConstruct=void 0,t}}const _6={resolveAll:Sk()},S6=_k("string"),C6=_k("text");function _k(e){return{tokenize:n,resolveAll:Sk(e==="text"?R6:void 0)};function n(t){const r=this,i=this.parser.constructs[e],o=t.attempt(i,a,s);return a;function a(l){return u(l)?o(l):s(l)}function s(l){if(l===null){t.consume(l);return}return t.enter("data"),t.consume(l),c}function c(l){return u(l)?(t.exit("data"),o(l)):(t.consume(l),c)}function u(l){if(l===null)return!0;const d=i[l];let p=-1;if(d)for(;++p<d.length;){const f=d[p];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function Sk(e){return n;function n(t,r){let i=-1,o;for(;++i<=t.length;)o===void 0?t[i]&&t[i][1].type==="data"&&(o=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==o+2&&(t[o][1].end=t[i-1][1].end,t.splice(o+2,i-o-2),i=o+2),o=void 0);return e?e(t,r):t}}function R6(e,n){let t=0;for(;++t<=e.length;)if((t===e.length||e[t][1].type==="lineEnding")&&e[t-1][1].type==="data"){const r=e[t-1][1],i=n.sliceStream(r);let o=i.length,a=-1,s=0,c;for(;o--;){const u=i[o];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)s++,a--;if(a)break;a=-1}else if(u===-2)c=!0,s++;else if(u!==-1){o++;break}}if(s){const u={type:t===e.length||c||s<2?"lineSuffix":"hardBreakTrailing",start:{line:r.end.line,column:r.end.column-s,offset:r.end.offset-s,_index:r.start._index+o,_bufferIndex:o?a:r.start._bufferIndex+a},end:Object.assign({},r.end)};r.end=Object.assign({},u.start),r.start.offset===r.end.offset?Object.assign(r,u):(e.splice(t,0,["enter",u,n],["exit",u,n]),t+=2)}t++}return e}function k6(e,n,t){let r=Object.assign(t?Object.assign({},t):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const i={},o=[];let a=[],s=[];const c={consume:w,enter:y,exit:b,attempt:C(x),check:C(_),interrupt:C(_,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:e,sliceStream:f,sliceSerialize:p,now:m,defineSkip:g,write:d};let l=n.tokenize.call(u,c);return n.resolveAll&&o.push(n),u;function d(T){return a=Pr(a,T),v(),a[a.length-1]!==null?[]:(R(n,0),u.events=C0(o,u.events,u),u.events)}function p(T,I){return T6(f(T),I)}function f(T){return E6(a,T)}function m(){const{line:T,column:I,offset:F,_index:z,_bufferIndex:j}=r;return{line:T,column:I,offset:F,_index:z,_bufferIndex:j}}function g(T){i[T.line]=T.column,E()}function v(){let T;for(;r._index<a.length;){const I=a[r._index];if(typeof I=="string")for(T=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===T&&r._bufferIndex<I.length;)h(I.charCodeAt(r._bufferIndex));else h(I)}}function h(T){l=l(T)}function w(T){Ie(T)?(r.line++,r.column=1,r.offset+=T===-3?2:1,E()):T!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=T}function y(T,I){const F=I||{};return F.type=T,F.start=m(),u.events.push(["enter",F,u]),s.push(F),F}function b(T){const I=s.pop();return I.end=m(),u.events.push(["exit",I,u]),I}function x(T,I){R(T,I.from)}function _(T,I){I.restore()}function C(T,I){return F;function F(z,j,H){let W,L,$,k;return Array.isArray(z)?X(z):"tokenize"in z?X([z]):U(z);function U(te){return ce;function ce(ye){const Re=ye!==null&&te[ye],Je=ye!==null&&te.null,Pe=[...Array.isArray(Re)?Re:Re?[Re]:[],...Array.isArray(Je)?Je:Je?[Je]:[]];return X(Pe)(ye)}}function X(te){return W=te,L=0,te.length===0?H:P(te[L])}function P(te){return ce;function ce(ye){return k=S(),$=te,te.partial||(u.currentConstruct=te),te.name&&u.parser.constructs.disable.null.includes(te.name)?se():te.tokenize.call(I?Object.assign(Object.create(u),I):u,c,ne,se)(ye)}}function ne(te){return T($,k),j}function se(te){return k.restore(),++L<W.length?P(W[L]):H}}}function R(T,I){T.resolveAll&&!o.includes(T)&&o.push(T),T.resolve&&Li(u.events,I,u.events.length-I,T.resolve(u.events.slice(I),u)),T.resolveTo&&(u.events=T.resolveTo(u.events,u))}function S(){const T=m(),I=u.previous,F=u.currentConstruct,z=u.events.length,j=Array.from(s);return{restore:H,from:z};function H(){r=T,u.previous=I,u.currentConstruct=F,u.events.length=z,s=j,E()}}function E(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function E6(e,n){const t=n.start._index,r=n.start._bufferIndex,i=n.end._index,o=n.end._bufferIndex;let a;if(t===i)a=[e[t].slice(r,o)];else{if(a=e.slice(t,i),r>-1){const s=a[0];typeof s=="string"?a[0]=s.slice(r):a.shift()}o>0&&a.push(e[i].slice(0,o))}return a}function T6(e,n){let t=-1;const r=[];let i;for(;++t<e.length;){const o=e[t];let a;if(typeof o=="string")a=o;else switch(o){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=n?" ":"	";break}case-1:{if(!n&&i)continue;a=" ";break}default:a=String.fromCharCode(o)}i=o===-2,r.push(a)}return r.join("")}const D6={42:Xn,43:Xn,45:Xn,48:Xn,49:Xn,50:Xn,51:Xn,52:Xn,53:Xn,54:Xn,55:Xn,56:Xn,57:Xn,62:mk},I6={91:PB},P6={[-2]:ym,[-1]:ym,32:ym},A6={35:FB,42:Ad,45:[Jb,Ad],60:$B,61:Jb,95:Ad,96:Qb,126:Qb},N6={38:vk,92:gk},M6={[-5]:wm,[-4]:wm,[-3]:wm,33:o6,38:vk,42:dv,60:[cB,KB],91:s6,92:[LB,gk],93:k0,95:dv,96:xB},L6={null:[dv,_6]},O6={null:[42,95]},F6={null:[]},B6=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:O6,contentInitial:I6,disable:F6,document:D6,flow:A6,flowInitial:P6,insideSpan:L6,string:N6,text:M6},Symbol.toStringTag,{value:"Module"}));function z6(e){const t=GF([B6,...(e||{}).extensions||[]]),r={defined:[],lazy:{},constructs:t,content:i(tB),document:i(rB),flow:i(b6),string:i(S6),text:i(C6)};return r;function i(o){return a;function a(s){return k6(r,o,s)}}}const Zb=/[\0\t\n\r]/g;function j6(){let e=1,n="",t=!0,r;return i;function i(o,a,s){const c=[];let u,l,d,p,f;for(o=n+o.toString(a),d=0,n="",t&&(o.charCodeAt(0)===65279&&d++,t=void 0);d<o.length;){if(Zb.lastIndex=d,u=Zb.exec(o),p=u&&u.index!==void 0?u.index:o.length,f=o.charCodeAt(p),!u){n=o.slice(d);break}if(f===10&&d===p&&r)c.push(-3),r=void 0;else switch(r&&(c.push(-5),r=void 0),d<p&&(c.push(o.slice(d,p)),e+=p-d),f){case 0:{c.push(65533),e++;break}case 9:{for(l=Math.ceil(e/4)*4,c.push(-2);e++<l;)c.push(-1);break}case 10:{c.push(-4),e=1;break}default:r=!0,e=1}d=p+1}return s&&(r&&c.push(-5),n&&c.push(n),c.push(null)),c}}function $6(e){for(;!yk(e););return e}function Ck(e,n){const t=Number.parseInt(e,n);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCharCode(t)}const U6=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function W6(e){return e.replace(U6,V6)}function V6(e,n,t){if(n)return n;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),o=i===120||i===88;return Ck(t.slice(o?2:1),o?16:10)}return R0(t)||e}const Rk={}.hasOwnProperty,H6=function(e,n,t){return typeof n!="string"&&(t=n,n=void 0),G6(t)($6(z6(t).document().write(j6()(e,n,!0))))};function G6(e){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(Rr),autolinkProtocol:T,autolinkEmail:T,atxHeading:s(st),blockQuote:s(Pe),characterEscape:T,characterReference:T,codeFenced:s(He),codeFencedFenceInfo:c,codeFencedFenceMeta:c,codeIndented:s(He,c),codeText:s(Ue,c),codeTextData:T,data:T,codeFlowValue:T,definition:s(at),definitionDestinationString:c,definitionLabelString:c,definitionTitleString:c,emphasis:s(Ze),hardBreakEscape:s(bn),hardBreakTrailing:s(bn),htmlFlow:s(Lt,c),htmlFlowData:T,htmlText:s(Lt,c),htmlTextData:T,image:s(tn),label:c,link:s(Rr),listItem:s(jn),listItemValue:m,listOrdered:s(zn,f),listUnordered:s(zn),paragraph:s($n),reference:se,referenceString:c,resourceDestinationString:c,resourceTitleString:c,setextHeading:s(st),strong:s(kr),thematicBreak:s(_o)},exit:{atxHeading:l(),atxHeadingSequence:C,autolink:l(),autolinkEmail:Je,autolinkProtocol:Re,blockQuote:l(),characterEscapeValue:I,characterReferenceMarkerHexadecimal:ce,characterReferenceMarkerNumeric:ce,characterReferenceValue:ye,codeFenced:l(w),codeFencedFence:h,codeFencedFenceInfo:g,codeFencedFenceMeta:v,codeFlowValue:I,codeIndented:l(y),codeText:l(W),codeTextData:I,data:I,definition:l(),definitionDestinationString:_,definitionLabelString:b,definitionTitleString:x,emphasis:l(),hardBreakEscape:l(z),hardBreakTrailing:l(z),htmlFlow:l(j),htmlFlowData:I,htmlText:l(H),htmlTextData:I,image:l($),label:U,labelText:k,lineEnding:F,link:l(L),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:te,resourceDestinationString:X,resourceTitleString:P,resource:ne,setextHeading:l(E),setextHeadingLineSequence:S,setextHeadingText:R,strong:l(),thematicBreak:l()}};kk(n,(e||{}).mdastExtensions||[]);const t={};return r;function r(q){let Y={type:"root",children:[]};const we={stack:[Y],tokenStack:[],config:n,enter:u,exit:d,buffer:c,resume:p,setData:o,getData:a},We=[];let Xe=-1;for(;++Xe<q.length;)if(q[Xe][1].type==="listOrdered"||q[Xe][1].type==="listUnordered")if(q[Xe][0]==="enter")We.push(Xe);else{const ln=We.pop();Xe=i(q,ln,Xe)}for(Xe=-1;++Xe<q.length;){const ln=n[q[Xe][0]];Rk.call(ln,q[Xe][1].type)&&ln[q[Xe][1].type].call(Object.assign({sliceSerialize:q[Xe][2].sliceSerialize},we),q[Xe][1])}if(we.tokenStack.length>0){const ln=we.tokenStack[we.tokenStack.length-1];(ln[1]||ex).call(we,void 0,ln[0])}for(Y.position={start:Do(q.length>0?q[0][1].start:{line:1,column:1,offset:0}),end:Do(q.length>0?q[q.length-2][1].end:{line:1,column:1,offset:0})},Xe=-1;++Xe<n.transforms.length;)Y=n.transforms[Xe](Y)||Y;return Y}function i(q,Y,we){let We=Y-1,Xe=-1,ln=!1,Wn,xn,nn,ga;for(;++We<=we;){const ft=q[We];if(ft[1].type==="listUnordered"||ft[1].type==="listOrdered"||ft[1].type==="blockQuote"?(ft[0]==="enter"?Xe++:Xe--,ga=void 0):ft[1].type==="lineEndingBlank"?ft[0]==="enter"&&(Wn&&!ga&&!Xe&&!nn&&(nn=We),ga=void 0):ft[1].type==="linePrefix"||ft[1].type==="listItemValue"||ft[1].type==="listItemMarker"||ft[1].type==="listItemPrefix"||ft[1].type==="listItemPrefixWhitespace"||(ga=void 0),!Xe&&ft[0]==="enter"&&ft[1].type==="listItemPrefix"||Xe===-1&&ft[0]==="exit"&&(ft[1].type==="listUnordered"||ft[1].type==="listOrdered")){if(Wn){let Gi=We;for(xn=void 0;Gi--;){const ur=q[Gi];if(ur[1].type==="lineEnding"||ur[1].type==="lineEndingBlank"){if(ur[0]==="exit")continue;xn&&(q[xn][1].type="lineEndingBlank",ln=!0),ur[1].type="lineEnding",xn=Gi}else if(!(ur[1].type==="linePrefix"||ur[1].type==="blockQuotePrefix"||ur[1].type==="blockQuotePrefixWhitespace"||ur[1].type==="blockQuoteMarker"||ur[1].type==="listItemIndent"))break}nn&&(!xn||nn<xn)&&(Wn._spread=!0),Wn.end=Object.assign({},xn?q[xn][1].start:ft[1].end),q.splice(xn||We,0,["exit",Wn,ft[2]]),We++,we++}ft[1].type==="listItemPrefix"&&(Wn={type:"listItem",_spread:!1,start:Object.assign({},ft[1].start),end:void 0},q.splice(We,0,["enter",Wn,ft[2]]),We++,we++,nn=void 0,ga=!0)}}return q[Y][1]._spread=ln,we}function o(q,Y){t[q]=Y}function a(q){return t[q]}function s(q,Y){return we;function we(We){u.call(this,q(We),We),Y&&Y.call(this,We)}}function c(){this.stack.push({type:"fragment",children:[]})}function u(q,Y,we){return this.stack[this.stack.length-1].children.push(q),this.stack.push(q),this.tokenStack.push([Y,we]),q.position={start:Do(Y.start)},q}function l(q){return Y;function Y(we){q&&q.call(this,we),d.call(this,we)}}function d(q,Y){const we=this.stack.pop(),We=this.tokenStack.pop();if(We)We[0].type!==q.type&&(Y?Y.call(this,q,We[0]):(We[1]||ex).call(this,q,We[0]));else throw new Error("Cannot close `"+q.type+"` ("+bu({start:q.start,end:q.end})+"): its not open");return we.position.end=Do(q.end),we}function p(){return VF(this.stack.pop())}function f(){o("expectingFirstListItemValue",!0)}function m(q){if(a("expectingFirstListItemValue")){const Y=this.stack[this.stack.length-2];Y.start=Number.parseInt(this.sliceSerialize(q),10),o("expectingFirstListItemValue")}}function g(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.lang=q}function v(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.meta=q}function h(){a("flowCodeInside")||(this.buffer(),o("flowCodeInside",!0))}function w(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.value=q.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),o("flowCodeInside")}function y(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.value=q.replace(/(\r?\n|\r)$/g,"")}function b(q){const Y=this.resume(),we=this.stack[this.stack.length-1];we.label=Y,we.identifier=sc(this.sliceSerialize(q)).toLowerCase()}function x(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.title=q}function _(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.url=q}function C(q){const Y=this.stack[this.stack.length-1];if(!Y.depth){const we=this.sliceSerialize(q).length;Y.depth=we}}function R(){o("setextHeadingSlurpLineEnding",!0)}function S(q){const Y=this.stack[this.stack.length-1];Y.depth=this.sliceSerialize(q).charCodeAt(0)===61?1:2}function E(){o("setextHeadingSlurpLineEnding")}function T(q){const Y=this.stack[this.stack.length-1];let we=Y.children[Y.children.length-1];(!we||we.type!=="text")&&(we=Un(),we.position={start:Do(q.start)},Y.children.push(we)),this.stack.push(we)}function I(q){const Y=this.stack.pop();Y.value+=this.sliceSerialize(q),Y.position.end=Do(q.end)}function F(q){const Y=this.stack[this.stack.length-1];if(a("atHardBreak")){const we=Y.children[Y.children.length-1];we.position.end=Do(q.end),o("atHardBreak");return}!a("setextHeadingSlurpLineEnding")&&n.canContainEols.includes(Y.type)&&(T.call(this,q),I.call(this,q))}function z(){o("atHardBreak",!0)}function j(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.value=q}function H(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.value=q}function W(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.value=q}function L(){const q=this.stack[this.stack.length-1];if(a("inReference")){const Y=a("referenceType")||"shortcut";q.type+="Reference",q.referenceType=Y,delete q.url,delete q.title}else delete q.identifier,delete q.label;o("referenceType")}function $(){const q=this.stack[this.stack.length-1];if(a("inReference")){const Y=a("referenceType")||"shortcut";q.type+="Reference",q.referenceType=Y,delete q.url,delete q.title}else delete q.identifier,delete q.label;o("referenceType")}function k(q){const Y=this.sliceSerialize(q),we=this.stack[this.stack.length-2];we.label=W6(Y),we.identifier=sc(Y).toLowerCase()}function U(){const q=this.stack[this.stack.length-1],Y=this.resume(),we=this.stack[this.stack.length-1];if(o("inReference",!0),we.type==="link"){const We=q.children;we.children=We}else we.alt=Y}function X(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.url=q}function P(){const q=this.resume(),Y=this.stack[this.stack.length-1];Y.title=q}function ne(){o("inReference")}function se(){o("referenceType","collapsed")}function te(q){const Y=this.resume(),we=this.stack[this.stack.length-1];we.label=Y,we.identifier=sc(this.sliceSerialize(q)).toLowerCase(),o("referenceType","full")}function ce(q){o("characterReferenceType",q.type)}function ye(q){const Y=this.sliceSerialize(q),we=a("characterReferenceType");let We;we?(We=Ck(Y,we==="characterReferenceMarkerNumeric"?10:16),o("characterReferenceType")):We=R0(Y);const Xe=this.stack.pop();Xe.value+=We,Xe.position.end=Do(q.end)}function Re(q){I.call(this,q);const Y=this.stack[this.stack.length-1];Y.url=this.sliceSerialize(q)}function Je(q){I.call(this,q);const Y=this.stack[this.stack.length-1];Y.url="mailto:"+this.sliceSerialize(q)}function Pe(){return{type:"blockquote",children:[]}}function He(){return{type:"code",lang:null,meta:null,value:""}}function Ue(){return{type:"inlineCode",value:""}}function at(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Ze(){return{type:"emphasis",children:[]}}function st(){return{type:"heading",depth:void 0,children:[]}}function bn(){return{type:"break"}}function Lt(){return{type:"html",value:""}}function tn(){return{type:"image",title:null,url:"",alt:null}}function Rr(){return{type:"link",title:null,url:"",children:[]}}function zn(q){return{type:"list",ordered:q.type==="listOrdered",start:null,spread:q._spread,children:[]}}function jn(q){return{type:"listItem",spread:q._spread,checked:null,children:[]}}function $n(){return{type:"paragraph",children:[]}}function kr(){return{type:"strong",children:[]}}function Un(){return{type:"text",value:""}}function _o(){return{type:"thematicBreak"}}}function Do(e){return{line:e.line,column:e.column,offset:e.offset}}function kk(e,n){let t=-1;for(;++t<n.length;){const r=n[t];Array.isArray(r)?kk(e,r):q6(e,r)}}function q6(e,n){let t;for(t in n)if(Rk.call(n,t)){if(t==="canContainEols"){const r=n[t];r&&e[t].push(...r)}else if(t==="transforms"){const r=n[t];r&&e[t].push(...r)}else if(t==="enter"||t==="exit"){const r=n[t];r&&Object.assign(e[t],r)}}}function ex(e,n){throw e?new Error("Cannot close `"+e.type+"` ("+bu({start:e.start,end:e.end})+"): a different token (`"+n.type+"`, "+bu({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+bu({start:n.start,end:n.end})+") is still open")}function K6(e){Object.assign(this,{Parser:t=>{const r=this.data("settings");return H6(t,Object.assign({},r,e,{extensions:this.data("micromarkExtensions")||[],mdastExtensions:this.data("fromMarkdownExtensions")||[]}))}})}function X6(e,n){const t={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(n),!0)};return e.patch(n,t),e.applyData(n,t)}function Q6(e,n){const t={type:"element",tagName:"br",properties:{},children:[]};return e.patch(n,t),[e.applyData(n,t),{type:"text",value:`
`}]}function Y6(e,n){const t=n.value?n.value+`
`:"",r=n.lang?n.lang.match(/^[^ \t]+(?=[ \t]|$)/):null,i={};r&&(i.className=["language-"+r]);let o={type:"element",tagName:"code",properties:i,children:[{type:"text",value:t}]};return n.meta&&(o.data={meta:n.meta}),e.patch(n,o),o=e.applyData(n,o),o={type:"element",tagName:"pre",properties:{},children:[o]},e.patch(n,o),o}function J6(e,n){const t={type:"element",tagName:"del",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function Z6(e,n){const t={type:"element",tagName:"em",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function Tc(e){const n=[];let t=-1,r=0,i=0;for(;++t<e.length;){const o=e.charCodeAt(t);let a="";if(o===37&&wr(e.charCodeAt(t+1))&&wr(e.charCodeAt(t+2)))i=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(a=String.fromCharCode(o));else if(o>55295&&o<57344){const s=e.charCodeAt(t+1);o<56320&&s>56319&&s<57344?(a=String.fromCharCode(o,s),i=1):a=""}else a=String.fromCharCode(o);a&&(n.push(e.slice(r,t),encodeURIComponent(a)),r=t+i+1,a=""),i&&(t+=i,i=0)}return n.join("")+e.slice(r)}function Ek(e,n){const t=String(n.identifier).toUpperCase(),r=Tc(t.toLowerCase()),i=e.footnoteOrder.indexOf(t);let o;i===-1?(e.footnoteOrder.push(t),e.footnoteCounts[t]=1,o=e.footnoteOrder.length):(e.footnoteCounts[t]++,o=i+1);const a=e.footnoteCounts[t],s={type:"element",tagName:"a",properties:{href:"#"+e.clobberPrefix+"fn-"+r,id:e.clobberPrefix+"fnref-"+r+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};e.patch(n,s);const c={type:"element",tagName:"sup",properties:{},children:[s]};return e.patch(n,c),e.applyData(n,c)}function e5(e,n){const t=e.footnoteById;let r=1;for(;r in t;)r++;const i=String(r);return t[i]={type:"footnoteDefinition",identifier:i,children:[{type:"paragraph",children:n.children}],position:n.position},Ek(e,{type:"footnoteReference",identifier:i,position:n.position})}function t5(e,n){const t={type:"element",tagName:"h"+n.depth,properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function n5(e,n){if(e.dangerous){const t={type:"raw",value:n.value};return e.patch(n,t),e.applyData(n,t)}return null}function Tk(e,n){const t=n.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return{type:"text",value:"!["+n.alt+r};const i=e.all(n),o=i[0];o&&o.type==="text"?o.value="["+o.value:i.unshift({type:"text",value:"["});const a=i[i.length-1];return a&&a.type==="text"?a.value+=r:i.push({type:"text",value:r}),i}function r5(e,n){const t=e.definition(n.identifier);if(!t)return Tk(e,n);const r={src:Tc(t.url||""),alt:n.alt};t.title!==null&&t.title!==void 0&&(r.title=t.title);const i={type:"element",tagName:"img",properties:r,children:[]};return e.patch(n,i),e.applyData(n,i)}function i5(e,n){const t={src:Tc(n.url)};n.alt!==null&&n.alt!==void 0&&(t.alt=n.alt),n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"img",properties:t,children:[]};return e.patch(n,r),e.applyData(n,r)}function o5(e,n){const t={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};e.patch(n,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return e.patch(n,r),e.applyData(n,r)}function a5(e,n){const t=e.definition(n.identifier);if(!t)return Tk(e,n);const r={href:Tc(t.url||"")};t.title!==null&&t.title!==void 0&&(r.title=t.title);const i={type:"element",tagName:"a",properties:r,children:e.all(n)};return e.patch(n,i),e.applyData(n,i)}function s5(e,n){const t={href:Tc(n.url)};n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"a",properties:t,children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function c5(e,n,t){const r=e.all(n),i=t?u5(t):Dk(n),o={},a=[];if(typeof n.checked=="boolean"){const l=r[0];let d;l&&l.type==="element"&&l.tagName==="p"?d=l:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let s=-1;for(;++s<r.length;){const l=r[s];(i||s!==0||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`}),l.type==="element"&&l.tagName==="p"&&!i?a.push(...l.children):a.push(l)}const c=r[r.length-1];c&&(i||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:o,children:a};return e.patch(n,u),e.applyData(n,u)}function u5(e){let n=!1;if(e.type==="list"){n=e.spread||!1;const t=e.children;let r=-1;for(;!n&&++r<t.length;)n=Dk(t[r])}return n}function Dk(e){const n=e.spread;return n??e.children.length>1}function l5(e,n){const t={},r=e.all(n);let i=-1;for(typeof n.start=="number"&&n.start!==1&&(t.start=n.start);++i<r.length;){const a=r[i];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const o={type:"element",tagName:n.ordered?"ol":"ul",properties:t,children:e.wrap(r,!0)};return e.patch(n,o),e.applyData(n,o)}function d5(e,n){const t={type:"element",tagName:"p",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function p5(e,n){const t={type:"root",children:e.wrap(e.all(n))};return e.patch(n,t),e.applyData(n,t)}function f5(e,n){const t={type:"element",tagName:"strong",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}const E0=Ik("start"),T0=Ik("end");function h5(e){return{start:E0(e),end:T0(e)}}function Ik(e){return n;function n(t){const r=t&&t.position&&t.position[e]||{};return{line:r.line||null,column:r.column||null,offset:r.offset>-1?r.offset:null}}}function m5(e,n){const t=e.all(n),r=t.shift(),i=[];if(r){const a={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(n.children[0],a),i.push(a)}if(t.length>0){const a={type:"element",tagName:"tbody",properties:{},children:e.wrap(t,!0)},s=E0(n.children[1]),c=T0(n.children[n.children.length-1]);s.line&&c.line&&(a.position={start:s,end:c}),i.push(a)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)};return e.patch(n,o),e.applyData(n,o)}function g5(e,n,t){const r=t?t.children:void 0,o=(r?r.indexOf(n):1)===0?"th":"td",a=t&&t.type==="table"?t.align:void 0,s=a?a.length:n.children.length;let c=-1;const u=[];for(;++c<s;){const d=n.children[c],p={},f=a?a[c]:void 0;f&&(p.align=f);let m={type:"element",tagName:o,properties:p,children:[]};d&&(m.children=e.all(d),e.patch(d,m),m=e.applyData(n,m)),u.push(m)}const l={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(n,l),e.applyData(n,l)}function v5(e,n){const t={type:"element",tagName:"td",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}const tx=9,nx=32;function y5(e){const n=String(e),t=/\r?\n|\r/g;let r=t.exec(n),i=0;const o=[];for(;r;)o.push(rx(n.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=t.exec(n);return o.push(rx(n.slice(i),i>0,!1)),o.join("")}function rx(e,n,t){let r=0,i=e.length;if(n){let o=e.codePointAt(r);for(;o===tx||o===nx;)r++,o=e.codePointAt(r)}if(t){let o=e.codePointAt(i-1);for(;o===tx||o===nx;)i--,o=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}function w5(e,n){const t={type:"text",value:y5(String(n.value))};return e.patch(n,t),e.applyData(n,t)}function b5(e,n){const t={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(n,t),e.applyData(n,t)}const x5={blockquote:X6,break:Q6,code:Y6,delete:J6,emphasis:Z6,footnoteReference:Ek,footnote:e5,heading:t5,html:n5,imageReference:r5,image:i5,inlineCode:o5,linkReference:a5,link:s5,listItem:c5,list:l5,paragraph:d5,root:p5,strong:f5,table:m5,tableCell:v5,tableRow:g5,text:w5,thematicBreak:b5,toml:Zl,yaml:Zl,definition:Zl,footnoteDefinition:Zl};function Zl(){return null}const Pk=function(e){if(e==null)return R5;if(typeof e=="string")return C5(e);if(typeof e=="object")return Array.isArray(e)?_5(e):S5(e);if(typeof e=="function")return hf(e);throw new Error("Expected function, string, or object as test")};function _5(e){const n=[];let t=-1;for(;++t<e.length;)n[t]=Pk(e[t]);return hf(r);function r(...i){let o=-1;for(;++o<n.length;)if(n[o].call(this,...i))return!0;return!1}}function S5(e){return hf(n);function n(t){let r;for(r in e)if(t[r]!==e[r])return!1;return!0}}function C5(e){return hf(n);function n(t){return t&&t.type===e}}function hf(e){return n;function n(t,...r){return!!(t&&typeof t=="object"&&"type"in t&&e.call(this,t,...r))}}function R5(){return!0}const k5=!0,ix=!1,E5="skip",T5=function(e,n,t,r){typeof n=="function"&&typeof t!="function"&&(r=t,t=n,n=null);const i=Pk(n),o=r?-1:1;a(e,void 0,[])();function a(s,c,u){const l=s&&typeof s=="object"?s:{};if(typeof l.type=="string"){const p=typeof l.tagName=="string"?l.tagName:typeof l.name=="string"?l.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(s.type+(p?"<"+p+">":""))+")"})}return d;function d(){let p=[],f,m,g;if((!n||i(s,c,u[u.length-1]||null))&&(p=D5(t(s,u)),p[0]===ix))return p;if(s.children&&p[0]!==E5)for(m=(r?s.children.length:-1)+o,g=u.concat(s);m>-1&&m<s.children.length;){if(f=a(s.children[m],m,g)(),f[0]===ix)return f;m=typeof f[1]=="number"?f[1]:m+o}return p}}};function D5(e){return Array.isArray(e)?e:typeof e=="number"?[k5,e]:[e]}const D0=function(e,n,t,r){typeof n=="function"&&typeof t!="function"&&(r=t,t=n,n=null),T5(e,n,i,r);function i(o,a){const s=a[a.length-1];return t(o,s?s.children.indexOf(o):null,s)}};function I5(e){return!e||!e.position||!e.position.start||!e.position.start.line||!e.position.start.column||!e.position.end||!e.position.end.line||!e.position.end.column}const ox={}.hasOwnProperty;function P5(e){const n=Object.create(null);if(!e||!e.type)throw new Error("mdast-util-definitions expected node");return D0(e,"definition",r=>{const i=ax(r.identifier);i&&!ox.call(n,i)&&(n[i]=r)}),t;function t(r){const i=ax(r);return i&&ox.call(n,i)?n[i]:null}}function ax(e){return String(e||"").toUpperCase()}const Ap={}.hasOwnProperty;function A5(e,n){const t=n||{},r=t.allowDangerousHtml||!1,i={};return a.dangerous=r,a.clobberPrefix=t.clobberPrefix===void 0||t.clobberPrefix===null?"user-content-":t.clobberPrefix,a.footnoteLabel=t.footnoteLabel||"Footnotes",a.footnoteLabelTagName=t.footnoteLabelTagName||"h2",a.footnoteLabelProperties=t.footnoteLabelProperties||{className:["sr-only"]},a.footnoteBackLabel=t.footnoteBackLabel||"Back to content",a.unknownHandler=t.unknownHandler,a.passThrough=t.passThrough,a.handlers={...x5,...t.handlers},a.definition=P5(e),a.footnoteById=i,a.footnoteOrder=[],a.footnoteCounts={},a.patch=N5,a.applyData=M5,a.one=s,a.all=c,a.wrap=O5,a.augment=o,D0(e,"footnoteDefinition",u=>{const l=String(u.identifier).toUpperCase();Ap.call(i,l)||(i[l]=u)}),a;function o(u,l){if(u&&"data"in u&&u.data){const d=u.data;d.hName&&(l.type!=="element"&&(l={type:"element",tagName:"",properties:{},children:[]}),l.tagName=d.hName),l.type==="element"&&d.hProperties&&(l.properties={...l.properties,...d.hProperties}),"children"in l&&l.children&&d.hChildren&&(l.children=d.hChildren)}if(u){const d="type"in u?u:{position:u};I5(d)||(l.position={start:E0(d),end:T0(d)})}return l}function a(u,l,d,p){return Array.isArray(d)&&(p=d,d={}),o(u,{type:"element",tagName:l,properties:d||{},children:p||[]})}function s(u,l){return Ak(a,u,l)}function c(u){return I0(a,u)}}function N5(e,n){e.position&&(n.position=h5(e))}function M5(e,n){let t=n;if(e&&e.data){const r=e.data.hName,i=e.data.hChildren,o=e.data.hProperties;typeof r=="string"&&(t.type==="element"?t.tagName=r:t={type:"element",tagName:r,properties:{},children:[]}),t.type==="element"&&o&&(t.properties={...t.properties,...o}),"children"in t&&t.children&&i!==null&&i!==void 0&&(t.children=i)}return t}function Ak(e,n,t){const r=n&&n.type;if(!r)throw new Error("Expected node, got `"+n+"`");return Ap.call(e.handlers,r)?e.handlers[r](e,n,t):e.passThrough&&e.passThrough.includes(r)?"children"in n?{...n,children:I0(e,n)}:n:e.unknownHandler?e.unknownHandler(e,n,t):L5(e,n)}function I0(e,n){const t=[];if("children"in n){const r=n.children;let i=-1;for(;++i<r.length;){const o=Ak(e,r[i],n);if(o){if(i&&r[i-1].type==="break"&&(!Array.isArray(o)&&o.type==="text"&&(o.value=o.value.replace(/^\s+/,"")),!Array.isArray(o)&&o.type==="element")){const a=o.children[0];a&&a.type==="text"&&(a.value=a.value.replace(/^\s+/,""))}Array.isArray(o)?t.push(...o):t.push(o)}}}return t}function L5(e,n){const t=n.data||{},r="value"in n&&!(Ap.call(t,"hProperties")||Ap.call(t,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:I0(e,n)};return e.patch(n,r),e.applyData(n,r)}function O5(e,n){const t=[];let r=-1;for(n&&t.push({type:"text",value:`
`});++r<e.length;)r&&t.push({type:"text",value:`
`}),t.push(e[r]);return n&&e.length>0&&t.push({type:"text",value:`
`}),t}function F5(e){const n=[];let t=-1;for(;++t<e.footnoteOrder.length;){const r=e.footnoteById[e.footnoteOrder[t]];if(!r)continue;const i=e.all(r),o=String(r.identifier).toUpperCase(),a=Tc(o.toLowerCase());let s=0;const c=[];for(;++s<=e.footnoteCounts[o];){const d={type:"element",tagName:"a",properties:{href:"#"+e.clobberPrefix+"fnref-"+a+(s>1?"-"+s:""),dataFootnoteBackref:!0,className:["data-footnote-backref"],ariaLabel:e.footnoteBackLabel},children:[{type:"text",value:""}]};s>1&&d.children.push({type:"element",tagName:"sup",children:[{type:"text",value:String(s)}]}),c.length>0&&c.push({type:"text",value:" "}),c.push(d)}const u=i[i.length-1];if(u&&u.type==="element"&&u.tagName==="p"){const d=u.children[u.children.length-1];d&&d.type==="text"?d.value+=" ":u.children.push({type:"text",value:" "}),u.children.push(...c)}else i.push(...c);const l={type:"element",tagName:"li",properties:{id:e.clobberPrefix+"fn-"+a},children:e.wrap(i,!0)};e.patch(r,l),n.push(l)}if(n.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:e.footnoteLabelTagName,properties:{...JSON.parse(JSON.stringify(e.footnoteLabelProperties)),id:"footnote-label"},children:[{type:"text",value:e.footnoteLabel}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(n,!0)},{type:"text",value:`
`}]}}function Nk(e,n){const t=A5(e,n),r=t.one(e,null),i=F5(t);return i&&r.children.push({type:"text",value:`
`},i),Array.isArray(r)?{type:"root",children:r}:r}const B5=function(e,n){return e&&"run"in e?z5(e,n):j5(e||n)};function z5(e,n){return(t,r,i)=>{e.run(Nk(t,n),r,o=>{i(o)})}}function j5(e){return n=>Nk(n,e)}var Mk={exports:{}},$5="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",U5=$5,W5=U5;function Lk(){}function Ok(){}Ok.resetWarningCache=Lk;var V5=function(){function e(r,i,o,a,s,c){if(c!==W5){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function n(){return e}var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:n,element:e,elementType:e,instanceOf:n,node:e,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:Ok,resetWarningCache:Lk};return t.PropTypes=t,t};Mk.exports=V5();var H5=Mk.exports;const Ne=_c(H5);class ul{constructor(n,t,r){this.property=n,this.normal=t,r&&(this.space=r)}}ul.prototype.property={};ul.prototype.normal={};ul.prototype.space=null;function Fk(e,n){const t={},r={};let i=-1;for(;++i<e.length;)Object.assign(t,e[i].property),Object.assign(r,e[i].normal);return new ul(t,r,n)}function pv(e){return e.toLowerCase()}class $r{constructor(n,t){this.property=n,this.attribute=t}}$r.prototype.space=null;$r.prototype.boolean=!1;$r.prototype.booleanish=!1;$r.prototype.overloadedBoolean=!1;$r.prototype.number=!1;$r.prototype.commaSeparated=!1;$r.prototype.spaceSeparated=!1;$r.prototype.commaOrSpaceSeparated=!1;$r.prototype.mustUseProperty=!1;$r.prototype.defined=!1;let G5=0;const Le=Qa(),Ut=Qa(),Bk=Qa(),Z=Qa(),gt=Qa(),cc=Qa(),lr=Qa();function Qa(){return 2**++G5}const fv=Object.freeze(Object.defineProperty({__proto__:null,boolean:Le,booleanish:Ut,commaOrSpaceSeparated:lr,commaSeparated:cc,number:Z,overloadedBoolean:Bk,spaceSeparated:gt},Symbol.toStringTag,{value:"Module"})),bm=Object.keys(fv);class P0 extends $r{constructor(n,t,r,i){let o=-1;if(super(n,t),sx(this,"space",i),typeof r=="number")for(;++o<bm.length;){const a=bm[o];sx(this,bm[o],(r&fv[a])===fv[a])}}}P0.prototype.defined=!0;function sx(e,n,t){t&&(e[n]=t)}const q5={}.hasOwnProperty;function Dc(e){const n={},t={};let r;for(r in e.properties)if(q5.call(e.properties,r)){const i=e.properties[r],o=new P0(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),n[r]=o,t[pv(r)]=r,t[pv(o.attribute)]=r}return new ul(n,t,e.space)}const zk=Dc({space:"xlink",transform(e,n){return"xlink:"+n.slice(5).toLowerCase()},properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),jk=Dc({space:"xml",transform(e,n){return"xml:"+n.slice(3).toLowerCase()},properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function $k(e,n){return n in e?e[n]:n}function Uk(e,n){return $k(e,n.toLowerCase())}const Wk=Dc({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:Uk,properties:{xmlns:null,xmlnsXLink:null}}),Vk=Dc({transform(e,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()},properties:{ariaActiveDescendant:null,ariaAtomic:Ut,ariaAutoComplete:null,ariaBusy:Ut,ariaChecked:Ut,ariaColCount:Z,ariaColIndex:Z,ariaColSpan:Z,ariaControls:gt,ariaCurrent:null,ariaDescribedBy:gt,ariaDetails:null,ariaDisabled:Ut,ariaDropEffect:gt,ariaErrorMessage:null,ariaExpanded:Ut,ariaFlowTo:gt,ariaGrabbed:Ut,ariaHasPopup:null,ariaHidden:Ut,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:gt,ariaLevel:Z,ariaLive:null,ariaModal:Ut,ariaMultiLine:Ut,ariaMultiSelectable:Ut,ariaOrientation:null,ariaOwns:gt,ariaPlaceholder:null,ariaPosInSet:Z,ariaPressed:Ut,ariaReadOnly:Ut,ariaRelevant:null,ariaRequired:Ut,ariaRoleDescription:gt,ariaRowCount:Z,ariaRowIndex:Z,ariaRowSpan:Z,ariaSelected:Ut,ariaSetSize:Z,ariaSort:null,ariaValueMax:Z,ariaValueMin:Z,ariaValueNow:Z,ariaValueText:null,role:null}}),K5=Dc({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:Uk,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:cc,acceptCharset:gt,accessKey:gt,action:null,allow:null,allowFullScreen:Le,allowPaymentRequest:Le,allowUserMedia:Le,alt:null,as:null,async:Le,autoCapitalize:null,autoComplete:gt,autoFocus:Le,autoPlay:Le,blocking:gt,capture:null,charSet:null,checked:Le,cite:null,className:gt,cols:Z,colSpan:null,content:null,contentEditable:Ut,controls:Le,controlsList:gt,coords:Z|cc,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Le,defer:Le,dir:null,dirName:null,disabled:Le,download:Bk,draggable:Ut,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Le,formTarget:null,headers:gt,height:Z,hidden:Le,high:Z,href:null,hrefLang:null,htmlFor:gt,httpEquiv:gt,id:null,imageSizes:null,imageSrcSet:null,inert:Le,inputMode:null,integrity:null,is:null,isMap:Le,itemId:null,itemProp:gt,itemRef:gt,itemScope:Le,itemType:gt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Le,low:Z,manifest:null,max:null,maxLength:Z,media:null,method:null,min:null,minLength:Z,multiple:Le,muted:Le,name:null,nonce:null,noModule:Le,noValidate:Le,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Le,optimum:Z,pattern:null,ping:gt,placeholder:null,playsInline:Le,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Le,referrerPolicy:null,rel:gt,required:Le,reversed:Le,rows:Z,rowSpan:Z,sandbox:gt,scope:null,scoped:Le,seamless:Le,selected:Le,shadowRootClonable:Le,shadowRootDelegatesFocus:Le,shadowRootMode:null,shape:null,size:Z,sizes:null,slot:null,span:Z,spellCheck:Ut,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Z,step:null,style:null,tabIndex:Z,target:null,title:null,translate:null,type:null,typeMustMatch:Le,useMap:null,value:Ut,width:Z,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:gt,axis:null,background:null,bgColor:null,border:Z,borderColor:null,bottomMargin:Z,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Le,declare:Le,event:null,face:null,frame:null,frameBorder:null,hSpace:Z,leftMargin:Z,link:null,longDesc:null,lowSrc:null,marginHeight:Z,marginWidth:Z,noResize:Le,noHref:Le,noShade:Le,noWrap:Le,object:null,profile:null,prompt:null,rev:null,rightMargin:Z,rules:null,scheme:null,scrolling:Ut,standby:null,summary:null,text:null,topMargin:Z,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Z,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Le,disableRemotePlayback:Le,prefix:null,property:null,results:Z,security:null,unselectable:null}}),X5=Dc({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:$k,properties:{about:lr,accentHeight:Z,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Z,amplitude:Z,arabicForm:null,ascent:Z,attributeName:null,attributeType:null,azimuth:Z,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Z,by:null,calcMode:null,capHeight:Z,className:gt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Z,diffuseConstant:Z,direction:null,display:null,dur:null,divisor:Z,dominantBaseline:null,download:Le,dx:null,dy:null,edgeMode:null,editable:null,elevation:Z,enableBackground:null,end:null,event:null,exponent:Z,externalResourcesRequired:null,fill:null,fillOpacity:Z,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:cc,g2:cc,glyphName:cc,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Z,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Z,horizOriginX:Z,horizOriginY:Z,id:null,ideographic:Z,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Z,k:Z,k1:Z,k2:Z,k3:Z,k4:Z,kernelMatrix:lr,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Z,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Z,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Z,overlineThickness:Z,paintOrder:null,panose1:null,path:null,pathLength:Z,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:gt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Z,pointsAtY:Z,pointsAtZ:Z,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:lr,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:lr,rev:lr,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:lr,requiredFeatures:lr,requiredFonts:lr,requiredFormats:lr,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Z,specularExponent:Z,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Z,strikethroughThickness:Z,string:null,stroke:null,strokeDashArray:lr,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Z,strokeOpacity:Z,strokeWidth:null,style:null,surfaceScale:Z,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:lr,tabIndex:Z,tableValues:null,target:null,targetX:Z,targetY:Z,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:lr,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Z,underlineThickness:Z,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Z,values:null,vAlphabetic:Z,vMathematical:Z,vectorEffect:null,vHanging:Z,vIdeographic:Z,version:null,vertAdvY:Z,vertOriginX:Z,vertOriginY:Z,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Z,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),Q5=/^data[-\w.:]+$/i,cx=/-[a-z]/g,Y5=/[A-Z]/g;function J5(e,n){const t=pv(n);let r=n,i=$r;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&Q5.test(n)){if(n.charAt(4)==="-"){const o=n.slice(5).replace(cx,ez);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=n.slice(4);if(!cx.test(o)){let a=o.replace(Y5,Z5);a.charAt(0)!=="-"&&(a="-"+a),n="data"+a}}i=P0}return new i(r,n)}function Z5(e){return"-"+e.toLowerCase()}function ez(e){return e.charAt(1).toUpperCase()}const ux={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},tz=Fk([jk,zk,Wk,Vk,K5],"html"),nz=Fk([jk,zk,Wk,Vk,X5],"svg");function rz(e){if(e.allowedElements&&e.disallowedElements)throw new TypeError("Only one of `allowedElements` and `disallowedElements` should be defined");if(e.allowedElements||e.disallowedElements||e.allowElement)return n=>{D0(n,"element",(t,r,i)=>{const o=i;let a;if(e.allowedElements?a=!e.allowedElements.includes(t.tagName):e.disallowedElements&&(a=e.disallowedElements.includes(t.tagName)),!a&&e.allowElement&&typeof r=="number"&&(a=!e.allowElement(t,r,o)),a&&typeof r=="number")return e.unwrapDisallowed&&t.children?o.children.splice(r,1,...t.children):o.children.splice(r,1),r})}}var Hk={exports:{}},lt={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A0=Symbol.for("react.element"),N0=Symbol.for("react.portal"),mf=Symbol.for("react.fragment"),gf=Symbol.for("react.strict_mode"),vf=Symbol.for("react.profiler"),yf=Symbol.for("react.provider"),wf=Symbol.for("react.context"),iz=Symbol.for("react.server_context"),bf=Symbol.for("react.forward_ref"),xf=Symbol.for("react.suspense"),_f=Symbol.for("react.suspense_list"),Sf=Symbol.for("react.memo"),Cf=Symbol.for("react.lazy"),oz=Symbol.for("react.offscreen"),Gk;Gk=Symbol.for("react.module.reference");function Ur(e){if(typeof e=="object"&&e!==null){var n=e.$$typeof;switch(n){case A0:switch(e=e.type,e){case mf:case vf:case gf:case xf:case _f:return e;default:switch(e=e&&e.$$typeof,e){case iz:case wf:case bf:case Cf:case Sf:case yf:return e;default:return n}}case N0:return n}}}lt.ContextConsumer=wf;lt.ContextProvider=yf;lt.Element=A0;lt.ForwardRef=bf;lt.Fragment=mf;lt.Lazy=Cf;lt.Memo=Sf;lt.Portal=N0;lt.Profiler=vf;lt.StrictMode=gf;lt.Suspense=xf;lt.SuspenseList=_f;lt.isAsyncMode=function(){return!1};lt.isConcurrentMode=function(){return!1};lt.isContextConsumer=function(e){return Ur(e)===wf};lt.isContextProvider=function(e){return Ur(e)===yf};lt.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===A0};lt.isForwardRef=function(e){return Ur(e)===bf};lt.isFragment=function(e){return Ur(e)===mf};lt.isLazy=function(e){return Ur(e)===Cf};lt.isMemo=function(e){return Ur(e)===Sf};lt.isPortal=function(e){return Ur(e)===N0};lt.isProfiler=function(e){return Ur(e)===vf};lt.isStrictMode=function(e){return Ur(e)===gf};lt.isSuspense=function(e){return Ur(e)===xf};lt.isSuspenseList=function(e){return Ur(e)===_f};lt.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===mf||e===vf||e===gf||e===xf||e===_f||e===oz||typeof e=="object"&&e!==null&&(e.$$typeof===Cf||e.$$typeof===Sf||e.$$typeof===yf||e.$$typeof===wf||e.$$typeof===bf||e.$$typeof===Gk||e.getModuleId!==void 0)};lt.typeOf=Ur;Hk.exports=lt;var az=Hk.exports;const sz=_c(az);function cz(e){const n=e&&typeof e=="object"&&e.type==="text"?e.value||"":e;return typeof n=="string"&&n.replace(/[ \t\n\f\r]/g,"")===""}function uz(e){return e.join(" ").trim()}function lz(e,n){const t={};return(e[e.length-1]===""?[...e,""]:e).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}var M0={exports:{}},lx=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,dz=/\n/g,pz=/^\s*/,fz=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,hz=/^:\s*/,mz=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,gz=/^[;\s]*/,vz=/^\s+|\s+$/g,yz=`
`,dx="/",px="*",Ca="",wz="comment",bz="declaration",xz=function(e,n){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];n=n||{};var t=1,r=1;function i(m){var g=m.match(dz);g&&(t+=g.length);var v=m.lastIndexOf(yz);r=~v?m.length-v:r+m.length}function o(){var m={line:t,column:r};return function(g){return g.position=new a(m),u(),g}}function a(m){this.start=m,this.end={line:t,column:r},this.source=n.source}a.prototype.content=e;function s(m){var g=new Error(n.source+":"+t+":"+r+": "+m);if(g.reason=m,g.filename=n.source,g.line=t,g.column=r,g.source=e,!n.silent)throw g}function c(m){var g=m.exec(e);if(g){var v=g[0];return i(v),e=e.slice(v.length),g}}function u(){c(pz)}function l(m){var g;for(m=m||[];g=d();)g!==!1&&m.push(g);return m}function d(){var m=o();if(!(dx!=e.charAt(0)||px!=e.charAt(1))){for(var g=2;Ca!=e.charAt(g)&&(px!=e.charAt(g)||dx!=e.charAt(g+1));)++g;if(g+=2,Ca===e.charAt(g-1))return s("End of comment missing");var v=e.slice(2,g-2);return r+=2,i(v),e=e.slice(g),r+=2,m({type:wz,comment:v})}}function p(){var m=o(),g=c(fz);if(g){if(d(),!c(hz))return s("property missing ':'");var v=c(mz),h=m({type:bz,property:fx(g[0].replace(lx,Ca)),value:v?fx(v[0].replace(lx,Ca)):Ca});return c(gz),h}}function f(){var m=[];l(m);for(var g;g=p();)g!==!1&&(m.push(g),l(m));return m}return u(),f()};function fx(e){return e?e.replace(vz,Ca):Ca}var _z=xz;function qk(e,n){var t=null;if(!e||typeof e!="string")return t;for(var r,i=_z(e),o=typeof n=="function",a,s,c=0,u=i.length;c<u;c++)r=i[c],a=r.property,s=r.value,o?n(a,s,r):s&&(t||(t={}),t[a]=s);return t}M0.exports=qk;M0.exports.default=qk;var Sz=M0.exports;const Cz=_c(Sz),hv={}.hasOwnProperty,Rz=new Set(["table","thead","tbody","tfoot","tr"]);function Kk(e,n){const t=[];let r=-1,i;for(;++r<n.children.length;)i=n.children[r],i.type==="element"?t.push(kz(e,i,r,n)):i.type==="text"?(n.type!=="element"||!Rz.has(n.tagName)||!cz(i))&&t.push(i.value):i.type==="raw"&&!e.options.skipHtml&&t.push(i.value);return t}function kz(e,n,t,r){const i=e.options,o=i.transformLinkUri===void 0?SF:i.transformLinkUri,a=e.schema,s=n.tagName,c={};let u=a,l;if(a.space==="html"&&s==="svg"&&(u=nz,e.schema=u),n.properties)for(l in n.properties)hv.call(n.properties,l)&&Tz(c,l,n.properties[l],e);(s==="ol"||s==="ul")&&e.listDepth++;const d=Kk(e,n);(s==="ol"||s==="ul")&&e.listDepth--,e.schema=a;const p=n.position||{start:{line:null,column:null,offset:null},end:{line:null,column:null,offset:null}},f=i.components&&hv.call(i.components,s)?i.components[s]:s,m=typeof f=="string"||f===Ia.Fragment;if(!sz.isValidElementType(f))throw new TypeError(`Component for name \`${s}\` not defined or is not renderable`);if(c.key=t,s==="a"&&i.linkTarget&&(c.target=typeof i.linkTarget=="function"?i.linkTarget(String(c.href||""),n.children,typeof c.title=="string"?c.title:null):i.linkTarget),s==="a"&&o&&(c.href=o(String(c.href||""),n.children,typeof c.title=="string"?c.title:null)),!m&&s==="code"&&r.type==="element"&&r.tagName!=="pre"&&(c.inline=!0),!m&&(s==="h1"||s==="h2"||s==="h3"||s==="h4"||s==="h5"||s==="h6")&&(c.level=Number.parseInt(s.charAt(1),10)),s==="img"&&i.transformImageUri&&(c.src=i.transformImageUri(String(c.src||""),String(c.alt||""),typeof c.title=="string"?c.title:null)),!m&&s==="li"&&r.type==="element"){const g=Ez(n);c.checked=g&&g.properties?!!g.properties.checked:null,c.index=xm(r,n),c.ordered=r.tagName==="ol"}return!m&&(s==="ol"||s==="ul")&&(c.ordered=s==="ol",c.depth=e.listDepth),(s==="td"||s==="th")&&(c.align&&(c.style||(c.style={}),c.style.textAlign=c.align,delete c.align),m||(c.isHeader=s==="th")),!m&&s==="tr"&&r.type==="element"&&(c.isHeader=r.tagName==="thead"),i.sourcePos&&(c["data-sourcepos"]=Pz(p)),!m&&i.rawSourcePos&&(c.sourcePosition=n.position),!m&&i.includeElementIndex&&(c.index=xm(r,n),c.siblingCount=xm(r)),m||(c.node=n),d.length>0?Ia.createElement(f,c,d):Ia.createElement(f,c)}function Ez(e){let n=-1;for(;++n<e.children.length;){const t=e.children[n];if(t.type==="element"&&t.tagName==="input")return t}return null}function xm(e,n){let t=-1,r=0;for(;++t<e.children.length&&e.children[t]!==n;)e.children[t].type==="element"&&r++;return r}function Tz(e,n,t,r){const i=J5(r.schema,n);let o=t;o==null||o!==o||(Array.isArray(o)&&(o=i.commaSeparated?lz(o):uz(o)),i.property==="style"&&typeof o=="string"&&(o=Dz(o)),i.space&&i.property?e[hv.call(ux,i.property)?ux[i.property]:i.property]=o:i.attribute&&(e[i.attribute]=o))}function Dz(e){const n={};try{Cz(e,t)}catch{}return n;function t(r,i){const o=r.slice(0,4)==="-ms-"?`ms-${r.slice(4)}`:r;n[o.replace(/-([a-z])/g,Iz)]=i}}function Iz(e,n){return n.toUpperCase()}function Pz(e){return[e.start.line,":",e.start.column,"-",e.end.line,":",e.end.column].map(String).join("")}const hx={}.hasOwnProperty,Az="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",ed={plugins:{to:"remarkPlugins",id:"change-plugins-to-remarkplugins"},renderers:{to:"components",id:"change-renderers-to-components"},astPlugins:{id:"remove-buggy-html-in-markdown-parser"},allowDangerousHtml:{id:"remove-buggy-html-in-markdown-parser"},escapeHtml:{id:"remove-buggy-html-in-markdown-parser"},source:{to:"children",id:"change-source-to-children"},allowNode:{to:"allowElement",id:"replace-allownode-allowedtypes-and-disallowedtypes"},allowedTypes:{to:"allowedElements",id:"replace-allownode-allowedtypes-and-disallowedtypes"},disallowedTypes:{to:"disallowedElements",id:"replace-allownode-allowedtypes-and-disallowedtypes"},includeNodeIndex:{to:"includeElementIndex",id:"change-includenodeindex-to-includeelementindex"}};function Nd(e){for(const o in ed)if(hx.call(ed,o)&&hx.call(e,o)){const a=ed[o];console.warn(`[react-markdown] Warning: please ${a.to?`use \`${a.to}\` instead of`:"remove"} \`${o}\` (see <${Az}#${a.id}> for more info)`),delete ed[o]}const n=zF().use(K6).use(e.remarkPlugins||[]).use(B5,{...e.remarkRehypeOptions,allowDangerousHtml:!0}).use(e.rehypePlugins||[]).use(rz,e),t=new lk;typeof e.children=="string"?t.value=e.children:e.children!==void 0&&e.children!==null&&console.warn(`[react-markdown] Warning: please pass a string as \`children\` (not: \`${e.children}\`)`);const r=n.runSync(n.parse(t),t);if(r.type!=="root")throw new TypeError("Expected a `root` node");let i=Ia.createElement(Ia.Fragment,{},Kk({options:e,schema:tz,listDepth:0},r));return e.className&&(i=Ia.createElement("div",{className:e.className},i)),i}Nd.propTypes={children:Ne.string,className:Ne.string,allowElement:Ne.func,allowedElements:Ne.arrayOf(Ne.string),disallowedElements:Ne.arrayOf(Ne.string),unwrapDisallowed:Ne.bool,remarkPlugins:Ne.arrayOf(Ne.oneOfType([Ne.object,Ne.func,Ne.arrayOf(Ne.oneOfType([Ne.bool,Ne.string,Ne.object,Ne.func,Ne.arrayOf(Ne.any)]))])),rehypePlugins:Ne.arrayOf(Ne.oneOfType([Ne.object,Ne.func,Ne.arrayOf(Ne.oneOfType([Ne.bool,Ne.string,Ne.object,Ne.func,Ne.arrayOf(Ne.any)]))])),sourcePos:Ne.bool,rawSourcePos:Ne.bool,skipHtml:Ne.bool,includeElementIndex:Ne.bool,transformLinkUri:Ne.oneOfType([Ne.func,Ne.bool]),linkTarget:Ne.oneOfType([Ne.func,Ne.string]),transformImageUri:Ne.func,components:Ne.object};const Nz=({localStream:e})=>{const[n,t]=oe.useState(""),[r,i]=oe.useState(!1),[o,a]=oe.useState(!1),[s,c]=oe.useState(""),[u,l]=oe.useState(""),[d,p]=oe.useState(""),[f,m]=oe.useState(""),[g,v]=oe.useState(""),h=oe.useRef(null),w=oe.useRef(null),y=async R=>{try{const E=await(await fetch("https://meetings.aiiventure.com/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:R,timestamp:new Date().toISOString(),sender:"interviewer"})})).json();return console.log("[Interviewer] Transcription sent to backend:",E),!0}catch(S){return console.error("[Interviewer] Error sending transcription:",S),!1}},b=async()=>{try{const S=await(await fetch("https://meetings.aiiventure.com/api/transcriptions")).json();if(S.candidate&&S.candidate.length>0){const E=S.candidate.map(T=>T.transcript).join(" ");v(E)}}catch(R){console.error("[Interviewer] Error fetching transcriptions:",R)}},x=async()=>{try{t(""),v(""),l(""),p(""),m(""),c(""),await fetch("https://meetings.aiiventure.com/api/transcriptions/clear",{method:"POST"});try{const S=await(await fetch("https://meetings.aiiventure.com/reset",{method:"POST",headers:{"Content-Type":"application/json"}})).json();console.log("Reset response from Python backend:",S)}catch(R){console.error("Error resetting interview on Python backend:",R)}}catch(R){console.error("Error resetting interview:",R)}},_=async()=>{const R=n+" "+g;if(R.trim()){a(!0);try{console.log("Sending for analysis:",R);const E=await(await fetch("https://meetings.aiiventure.com/api/python/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:R})})).json();if(console.log("Analysis response:",E),E.error){console.error("Analysis error:",E.error);return}const T=E.analysis||"";console.log("Analysis text:",T);const I=T.match(/## Analysis\s+([\s\S]*?)(?=## |$)/i),F=T.match(/## Evaluation\s+([\s\S]*?)(?=## |$)/i),z=T.match(/## Follow-up Questions\s+([\s\S]*?)(?=## |$)/i);console.log("Direct section matches:",{analysisMatch:I?"found":"not found",evaluationMatch:F?"found":"not found",followUpMatch:z?"found":"not found"});const j=I?I[1].trim():"",H=F?F[1].trim():"",W=z?z[1].trim():"";if(console.log("Extracted content lengths:",{analysis:j.length,evaluation:H.length,followUp:W.length}),l(j),m(H),p(W),console.log("STATE SET with extracted content:",{analysis:j.substring(0,50)+"...",evaluation:H.substring(0,50)+"...",followUp:W.substring(0,50)+"..."}),W){const L=W.split(`
`).filter($=>$.trim().startsWith("-")||$.trim().startsWith("*"));if(console.log("Extracted questions:",L),L.length>0){const $=L[0].replace(/^[-*]\s*/,"").trim();console.log("Setting current question:",$),c($)}}t(""),v("");try{await fetch("http://localhost:3031/api/transcriptions/clear",{method:"POST"})}catch(L){console.error("Error clearing backend transcripts:",L)}}catch(S){console.error("Error analyzing response:",S),alert("Error connecting to the Python analysis backend. Make sure it's running on port 8000.")}finally{a(!1)}}};oe.useEffect(()=>(w.current=setInterval(b,2e3),b(),()=>{w.current&&clearInterval(w.current)}),[]),oe.useEffect(()=>{if(!e)return;const R=e.getAudioTracks()[0];if(!R){console.error("No audio track found in stream");return}const S=new MediaStream([R]),E=MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":null;if(!E){console.error("No supported audio MIME type found");return}const T=new MediaRecorder(S,{mimeType:E,audioBitsPerSecond:128e3}),I=new WebSocket("wss://api.deepgram.com/v1/listen",["token","1f3fc83e4559e5e5db749b92a75fbd0d66813d3e"]);return I.onopen=()=>{i(!0),console.log("[Interviewer] Connected to Deepgram"),T.addEventListener("dataavailable",async F=>{F.data.size>0&&I.readyState===1&&I.send(F.data)});try{T.start(1e3),console.log("[Interviewer] MediaRecorder started successfully")}catch(F){console.error("[Interviewer] Error starting MediaRecorder:",F)}},I.onmessage=F=>{try{const z=JSON.parse(F.data);if(z&&z.channel&&z.channel.alternatives&&z.channel.alternatives.length>0){const j=z.channel.alternatives[0].transcript;j&&z.is_final&&t(H=>{const W=H+" "+j;return y(j),W})}}catch(z){console.error("[Interviewer] Error processing transcript:",z)}},I.onclose=()=>{i(!1),console.log("[Interviewer] Disconnected from Deepgram")},I.onerror=F=>{console.error("[Interviewer] Deepgram WebSocket error:",F)},()=>{if(T.state!=="inactive")try{T.stop()}catch(F){console.error("[Interviewer] Error stopping MediaRecorder:",F)}I.readyState===1&&I.close()}},[e]),oe.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[n,g]);const C=()=>{if(!n&&!g)return"No transcription yet...";let R="";return n&&(R+=`Interviewer: ${n}

`),g&&(R+=`Candidate: ${g}`),R};return B.jsxs("div",{className:"h-full w-full bg-slate-800 border-l border-slate-700 flex flex-col overflow-hidden",children:[B.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-700",children:[B.jsx("h3",{className:"text-xl font-medium text-white",children:"Interview Assistant"}),B.jsxs("div",{className:"flex items-center space-x-2",children:[B.jsx("span",{className:`w-2 h-2 rounded-full ${r?"bg-emerald-500":"bg-red-500"}`}),B.jsx("span",{className:"text-xs text-slate-300",children:r?"Connected":"Disconnected"})]})]}),B.jsxs("div",{className:"flex flex-col space-y-4 h-full overflow-auto p-4",children:[B.jsxs("div",{className:"bg-red-900/30 rounded-lg p-2 text-xs",children:[B.jsx("h5",{className:"font-bold text-white mb-1",children:"Debug Info:"}),B.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[B.jsxs("div",{children:[B.jsx("span",{className:"text-white",children:"Analysis length: "}),B.jsxs("span",{className:"text-slate-300",children:[u.length," chars"]})]}),B.jsxs("div",{children:[B.jsx("span",{className:"text-white",children:"Evaluation length: "}),B.jsxs("span",{className:"text-slate-300",children:[f.length," chars"]})]}),B.jsxs("div",{children:[B.jsx("span",{className:"text-white",children:"Follow-up length: "}),B.jsxs("span",{className:"text-slate-300",children:[d.length," chars"]})]}),B.jsxs("div",{children:[B.jsx("span",{className:"text-white",children:"Current Q length: "}),B.jsxs("span",{className:"text-slate-300",children:[s.length," chars"]})]})]})]}),B.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 flex-shrink-0 shadow-md",children:[B.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Current Question"]}),B.jsx("p",{className:"text-base text-white",children:s||"No question yet. Start the interview by analyzing."})]}),B.jsxs("div",{className:"flex flex-col flex-grow bg-slate-700/50 rounded-lg p-4 overflow-hidden shadow-md",children:[B.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),"Conversation Transcript"]}),B.jsx("div",{ref:h,className:"flex-grow overflow-y-auto text-base text-white whitespace-pre-wrap bg-slate-800/50 p-3 rounded",children:C()})]}),B.jsxs("div",{className:"flex justify-between space-x-2",children:[B.jsxs("button",{onClick:x,className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors w-1/3 shadow-md flex items-center justify-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Reset"]}),B.jsx("button",{onClick:_,disabled:o||!(n.trim()||g.trim()),className:`px-4 py-2 ${o||!(n.trim()||g.trim())?"bg-emerald-700/50 cursor-not-allowed":"bg-emerald-600 hover:bg-emerald-700"} text-white rounded-lg font-medium transition-colors w-2/3 shadow-md flex items-center justify-center`,children:o?B.jsxs(B.Fragment,{children:[B.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[B.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),B.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Analyzing..."]}):B.jsxs(B.Fragment,{children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"Analyze Response"]})})]}),(u||d||f)&&B.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2",children:[u&&B.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 shadow-md",children:[B.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),"Analysis"]}),B.jsx("div",{className:"prose prose-invert prose-sm max-w-none bg-slate-800/50 p-3 rounded",children:B.jsx(Nd,{children:u})})]}),f&&B.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 shadow-md",children:[B.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Evaluation"]}),B.jsx("div",{className:"prose prose-invert prose-sm max-w-none bg-slate-800/50 p-3 rounded",children:B.jsx(Nd,{children:f})})]}),d&&B.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-4 shadow-md md:col-span-2",children:[B.jsxs("h4",{className:"text-sm font-medium text-slate-300 mb-2 flex items-center",children:[B.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:B.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Follow-up Questions"]}),B.jsx("div",{className:"prose prose-invert prose-sm max-w-none bg-slate-800/50 p-3 rounded",children:B.jsx(Nd,{children:d})})]})]})]})]})},Mz=({notifications:e,clearNotification:n})=>B.jsx("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-md",children:e.map(t=>B.jsx(Lz,{notification:t,onClose:()=>n(t.id)},t.id))}),Lz=({notification:e,onClose:n})=>{oe.useEffect(()=>{const i=setTimeout(()=>{n()},5e3);return()=>clearTimeout(i)},[n]);let t="bg-slate-700",r=null;switch(e.type){case"userLeft":t="bg-red-500/10 border-red-500/20",r=B.jsx("div",{className:"w-8 h-8 bg-red-500/20 rounded-full flex items-center justify-center mr-3",children:B.jsx("span",{className:"text-red-500 text-lg font-bold",children:"!"})});break;case"userJoined":t="bg-emerald-500/10 border-emerald-500/20",r=B.jsx("div",{className:"w-8 h-8 bg-emerald-500/20 rounded-full flex items-center justify-center mr-3",children:B.jsx("span",{className:"text-emerald-500 text-lg font-bold",children:""})});break;default:t="bg-blue-500/10 border-blue-500/20",r=B.jsx("div",{className:"w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center mr-3",children:B.jsx("span",{className:"text-blue-500 text-lg font-bold",children:"i"})})}return B.jsxs("div",{className:`flex items-center rounded-lg p-3 border ${t} text-white animate-fadeIn`,children:[r,B.jsx("div",{className:"flex-1",children:e.message}),B.jsx("button",{onClick:n,className:"ml-3 text-slate-400 hover:text-white transition-colors",children:B.jsx(VI,{size:16})})]})},Oi=Object.create(null);Oi.open="0";Oi.close="1";Oi.ping="2";Oi.pong="3";Oi.message="4";Oi.upgrade="5";Oi.noop="6";const Md=Object.create(null);Object.keys(Oi).forEach(e=>{Md[Oi[e]]=e});const mv={type:"error",data:"parser error"},Xk=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Qk=typeof ArrayBuffer=="function",Yk=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,L0=({type:e,data:n},t,r)=>Xk&&n instanceof Blob?t?r(n):mx(n,r):Qk&&(n instanceof ArrayBuffer||Yk(n))?t?r(n):mx(new Blob([n]),r):r(Oi[e]+(n||"")),mx=(e,n)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];n("b"+(r||""))},t.readAsDataURL(e)};function gx(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let _m;function Oz(e,n){if(Xk&&e.data instanceof Blob)return e.data.arrayBuffer().then(gx).then(n);if(Qk&&(e.data instanceof ArrayBuffer||Yk(e.data)))return n(gx(e.data));L0(e,!1,t=>{_m||(_m=new TextEncoder),n(_m.encode(t))})}const vx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",su=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<vx.length;e++)su[vx.charCodeAt(e)]=e;const Fz=e=>{let n=e.length*.75,t=e.length,r,i=0,o,a,s,c;e[e.length-1]==="="&&(n--,e[e.length-2]==="="&&n--);const u=new ArrayBuffer(n),l=new Uint8Array(u);for(r=0;r<t;r+=4)o=su[e.charCodeAt(r)],a=su[e.charCodeAt(r+1)],s=su[e.charCodeAt(r+2)],c=su[e.charCodeAt(r+3)],l[i++]=o<<2|a>>4,l[i++]=(a&15)<<4|s>>2,l[i++]=(s&3)<<6|c&63;return u},Bz=typeof ArrayBuffer=="function",O0=(e,n)=>{if(typeof e!="string")return{type:"message",data:Jk(e,n)};const t=e.charAt(0);return t==="b"?{type:"message",data:zz(e.substring(1),n)}:Md[t]?e.length>1?{type:Md[t],data:e.substring(1)}:{type:Md[t]}:mv},zz=(e,n)=>{if(Bz){const t=Fz(e);return Jk(t,n)}else return{base64:!0,data:e}},Jk=(e,n)=>{switch(n){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},Zk="",jz=(e,n)=>{const t=e.length,r=new Array(t);let i=0;e.forEach((o,a)=>{L0(o,!1,s=>{r[a]=s,++i===t&&n(r.join(Zk))})})},$z=(e,n)=>{const t=e.split(Zk),r=[];for(let i=0;i<t.length;i++){const o=O0(t[i],n);if(r.push(o),o.type==="error")break}return r};function Uz(){return new TransformStream({transform(e,n){Oz(e,t=>{const r=t.length;let i;if(r<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,r);else if(r<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,r)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(r))}e.data&&typeof e.data!="string"&&(i[0]|=128),n.enqueue(i),n.enqueue(t)})}})}let Sm;function td(e){return e.reduce((n,t)=>n+t.length,0)}function nd(e,n){if(e[0].length===n)return e.shift();const t=new Uint8Array(n);let r=0;for(let i=0;i<n;i++)t[i]=e[0][r++],r===e[0].length&&(e.shift(),r=0);return e.length&&r<e[0].length&&(e[0]=e[0].slice(r)),t}function Wz(e,n){Sm||(Sm=new TextDecoder);const t=[];let r=0,i=-1,o=!1;return new TransformStream({transform(a,s){for(t.push(a);;){if(r===0){if(td(t)<1)break;const c=nd(t,1);o=(c[0]&128)===128,i=c[0]&127,i<126?r=3:i===126?r=1:r=2}else if(r===1){if(td(t)<2)break;const c=nd(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(td(t)<8)break;const c=nd(t,8),u=new DataView(c.buffer,c.byteOffset,c.length),l=u.getUint32(0);if(l>Math.pow(2,21)-1){s.enqueue(mv);break}i=l*Math.pow(2,32)+u.getUint32(4),r=3}else{if(td(t)<i)break;const c=nd(t,i);s.enqueue(O0(o?c:Sm.decode(c),n)),r=0}if(i===0||i>e){s.enqueue(mv);break}}}})}const eE=4;function Ht(e){if(e)return Vz(e)}function Vz(e){for(var n in Ht.prototype)e[n]=Ht.prototype[n];return e}Ht.prototype.on=Ht.prototype.addEventListener=function(e,n){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(n),this};Ht.prototype.once=function(e,n){function t(){this.off(e,t),n.apply(this,arguments)}return t.fn=n,this.on(e,t),this};Ht.prototype.off=Ht.prototype.removeListener=Ht.prototype.removeAllListeners=Ht.prototype.removeEventListener=function(e,n){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var r,i=0;i<t.length;i++)if(r=t[i],r===n||r.fn===n){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+e],this};Ht.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var n=new Array(arguments.length-1),t=this._callbacks["$"+e],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,i=t.length;r<i;++r)t[r].apply(this,n)}return this};Ht.prototype.emitReserved=Ht.prototype.emit;Ht.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Ht.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Rf=typeof Promise=="function"&&typeof Promise.resolve=="function"?n=>Promise.resolve().then(n):(n,t)=>t(n,0),Ar=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Hz="arraybuffer";function tE(e,...n){return n.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const Gz=Ar.setTimeout,qz=Ar.clearTimeout;function kf(e,n){n.useNativeTimers?(e.setTimeoutFn=Gz.bind(Ar),e.clearTimeoutFn=qz.bind(Ar)):(e.setTimeoutFn=Ar.setTimeout.bind(Ar),e.clearTimeoutFn=Ar.clearTimeout.bind(Ar))}const Kz=1.33;function Xz(e){return typeof e=="string"?Qz(e):Math.ceil((e.byteLength||e.size)*Kz)}function Qz(e){let n=0,t=0;for(let r=0,i=e.length;r<i;r++)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:n<55296||n>=57344?t+=3:(r++,t+=4);return t}function nE(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Yz(e){let n="";for(let t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n}function Jz(e){let n={},t=e.split("&");for(let r=0,i=t.length;r<i;r++){let o=t[r].split("=");n[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return n}class Zz extends Error{constructor(n,t,r){super(n),this.description=t,this.context=r,this.type="TransportError"}}let F0=class extends Ht{constructor(n){super(),this.writable=!1,kf(this,n),this.opts=n,this.query=n.query,this.socket=n.socket,this.supportsBinary=!n.forceBase64}onError(n,t,r){return super.emitReserved("error",new Zz(n,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(n){this.readyState==="open"&&this.write(n)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(n){const t=O0(n,this.socket.binaryType);this.onPacket(t)}onPacket(n){super.emitReserved("packet",n)}onClose(n){this.readyState="closed",super.emitReserved("close",n)}pause(n){}createUri(n,t={}){return n+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const n=this.opts.hostname;return n.indexOf(":")===-1?n:"["+n+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(n){const t=Yz(n);return t.length?"?"+t:""}};class ej extends F0{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(n){this.readyState="pausing";const t=()=>{this.readyState="paused",n()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(n){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};$z(n,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const n=()=>{this.write([{type:"close"}])};this.readyState==="open"?n():this.once("open",n)}write(n){this.writable=!1,jz(n,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const n=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=nE()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(n,t)}}let rE=!1;try{rE=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const tj=rE;function nj(){}class rj extends ej{constructor(n){if(super(n),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&n.hostname!==location.hostname||r!==n.port}}doWrite(n,t){const r=this.request({method:"POST",data:n});r.on("success",t),r.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const n=this.request();n.on("data",this.onData.bind(this)),n.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=n}}class Ni extends Ht{constructor(n,t,r){super(),this.createRequest=n,kf(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var n;const t=tE(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&r.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(n=this._opts.cookieJar)===null||n===void 0||n.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var i;r.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Ni.requestsCount++,Ni.requests[this._index]=this)}_onError(n){this.emitReserved("error",n,this._xhr),this._cleanup(!0)}_cleanup(n){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=nj,n)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ni.requests[this._index],this._xhr=null}}_onLoad(){const n=this._xhr.responseText;n!==null&&(this.emitReserved("data",n),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ni.requestsCount=0;Ni.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",yx);else if(typeof addEventListener=="function"){const e="onpagehide"in Ar?"pagehide":"unload";addEventListener(e,yx,!1)}}function yx(){for(let e in Ni.requests)Ni.requests.hasOwnProperty(e)&&Ni.requests[e].abort()}const ij=function(){const e=iE({xdomain:!1});return e&&e.responseType!==null}();class oj extends rj{constructor(n){super(n);const t=n&&n.forceBase64;this.supportsBinary=ij&&!t}request(n={}){return Object.assign(n,{xd:this.xd},this.opts),new Ni(iE,this.uri(),n)}}function iE(e){const n=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!n||tj))return new XMLHttpRequest}catch{}if(!n)try{return new Ar[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const oE=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class aj extends F0{get name(){return"websocket"}doOpen(){const n=this.uri(),t=this.opts.protocols,r=oE?{}:tE(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(n,t,r)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=n=>this.onClose({description:"websocket connection closed",context:n}),this.ws.onmessage=n=>this.onData(n.data),this.ws.onerror=n=>this.onError("websocket error",n)}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const r=n[t],i=t===n.length-1;L0(r,this.supportsBinary,o=>{try{this.doWrite(r,o)}catch{}i&&Rf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const n=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=nE()),this.supportsBinary||(t.b64=1),this.createUri(n,t)}}const Cm=Ar.WebSocket||Ar.MozWebSocket;class sj extends aj{createSocket(n,t,r){return oE?new Cm(n,t,r):t?new Cm(n,t):new Cm(n)}doWrite(n,t){this.ws.send(t)}}class cj extends F0{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(n){return this.emitReserved("error",n)}this._transport.closed.then(()=>{this.onClose()}).catch(n=>{this.onError("webtransport error",n)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(n=>{const t=Wz(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=n.readable.pipeThrough(t).getReader(),i=Uz();i.readable.pipeTo(n.writable),this._writer=i.writable.getWriter();const o=()=>{r.read().then(({done:s,value:c})=>{s||(this.onPacket(c),o())}).catch(s=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(n){this.writable=!1;for(let t=0;t<n.length;t++){const r=n[t],i=t===n.length-1;this._writer.write(r).then(()=>{i&&Rf(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var n;(n=this._transport)===null||n===void 0||n.close()}}const uj={websocket:sj,webtransport:cj,polling:oj},lj=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,dj=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function gv(e){if(e.length>8e3)throw"URI too long";const n=e,t=e.indexOf("["),r=e.indexOf("]");t!=-1&&r!=-1&&(e=e.substring(0,t)+e.substring(t,r).replace(/:/g,";")+e.substring(r,e.length));let i=lj.exec(e||""),o={},a=14;for(;a--;)o[dj[a]]=i[a]||"";return t!=-1&&r!=-1&&(o.source=n,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=pj(o,o.path),o.queryKey=fj(o,o.query),o}function pj(e,n){const t=/\/{2,9}/g,r=n.replace(t,"/").split("/");return(n.slice(0,1)=="/"||n.length===0)&&r.splice(0,1),n.slice(-1)=="/"&&r.splice(r.length-1,1),r}function fj(e,n){const t={};return n.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,i,o){i&&(t[i]=o)}),t}const vv=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ld=[];vv&&addEventListener("offline",()=>{Ld.forEach(e=>e())},!1);class ta extends Ht{constructor(n,t){if(super(),this.binaryType=Hz,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,n&&typeof n=="object"&&(t=n,n=null),n){const r=gv(n);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=gv(t.host).host);kf(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const i=r.prototype.name;this.transports.push(i),this._transportsByName[i]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Jz(this.opts.query)),vv&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ld.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(n){const t=Object.assign({},this.opts.query);t.EIO=eE,t.transport=n,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[n]);return new this._transportsByName[n](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const n=this.opts.rememberUpgrade&&ta.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(n);t.open(),this.setTransport(t)}setTransport(n){this.transport&&this.transport.removeAllListeners(),this.transport=n,n.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",ta.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",n),this.emitReserved("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=n.data,this._onError(t);break;case"message":this.emitReserved("data",n.data),this.emitReserved("message",n.data);break}}onHandshake(n){this.emitReserved("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this._pingInterval=n.pingInterval,this._pingTimeout=n.pingTimeout,this._maxPayload=n.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const n=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+n,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},n),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const n=this._getWritablePackets();this.transport.send(n),this._prevBufferLen=n.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const i=this.writeBuffer[r].data;if(i&&(t+=Xz(i)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const n=Date.now()>this._pingTimeoutTime;return n&&(this._pingTimeoutTime=0,Rf(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),n}write(n,t,r){return this._sendPacket("message",n,t,r),this}send(n,t,r){return this._sendPacket("message",n,t,r),this}_sendPacket(n,t,r,i){if(typeof t=="function"&&(i=t,t=void 0),typeof r=="function"&&(i=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const o={type:n,data:t,options:r};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const n=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),n()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():n()}):this.upgrading?r():n()),this}_onError(n){if(ta.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",n),this._onClose("transport error",n)}_onClose(n,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),vv&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=Ld.indexOf(this._offlineEventListener);r!==-1&&Ld.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",n,t),this.writeBuffer=[],this._prevBufferLen=0}}}ta.protocol=eE;class hj extends ta{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let n=0;n<this._upgrades.length;n++)this._probe(this._upgrades[n])}_probe(n){let t=this.createTransport(n),r=!1;ta.priorWebsocketSuccess=!1;const i=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",d=>{if(!r)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ta.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function o(){r||(r=!0,l(),t.close(),t=null)}const a=d=>{const p=new Error("probe error: "+d);p.transport=t.name,o(),this.emitReserved("upgradeError",p)};function s(){a("transport closed")}function c(){a("socket closed")}function u(d){t&&d.name!==t.name&&o()}const l=()=>{t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",s),this.off("close",c),this.off("upgrading",u)};t.once("open",i),t.once("error",a),t.once("close",s),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&n!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(n){this._upgrades=this._filterUpgrades(n.upgrades),super.onHandshake(n)}_filterUpgrades(n){const t=[];for(let r=0;r<n.length;r++)~this.transports.indexOf(n[r])&&t.push(n[r]);return t}}let mj=class extends hj{constructor(n,t={}){const r=typeof n=="object"?n:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(i=>uj[i]).filter(i=>!!i)),super(n,r)}};function gj(e,n="",t){let r=e;t=t||typeof location<"u"&&location,e==null&&(e=t.protocol+"//"+t.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=t.protocol+e:e=t.host+e),/^(https?|wss?):\/\//.test(e)||(typeof t<"u"?e=t.protocol+"//"+e:e="https://"+e),r=gv(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const o=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+o+":"+r.port+n,r.href=r.protocol+"://"+o+(t&&t.port===r.port?"":":"+r.port),r}const vj=typeof ArrayBuffer=="function",yj=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,aE=Object.prototype.toString,wj=typeof Blob=="function"||typeof Blob<"u"&&aE.call(Blob)==="[object BlobConstructor]",bj=typeof File=="function"||typeof File<"u"&&aE.call(File)==="[object FileConstructor]";function B0(e){return vj&&(e instanceof ArrayBuffer||yj(e))||wj&&e instanceof Blob||bj&&e instanceof File}function Od(e,n){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(Od(e[t]))return!0;return!1}if(B0(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Od(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&Od(e[t]))return!0;return!1}function xj(e){const n=[],t=e.data,r=e;return r.data=yv(t,n),r.attachments=n.length,{packet:r,buffers:n}}function yv(e,n){if(!e)return e;if(B0(e)){const t={_placeholder:!0,num:n.length};return n.push(e),t}else if(Array.isArray(e)){const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=yv(e[r],n);return t}else if(typeof e=="object"&&!(e instanceof Date)){const t={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=yv(e[r],n));return t}return e}function _j(e,n){return e.data=wv(e.data,n),delete e.attachments,e}function wv(e,n){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<n.length)return n[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=wv(e[t],n);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=wv(e[t],n));return e}const Sj=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Cj=5;var qe;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(qe||(qe={}));class Rj{constructor(n){this.replacer=n}encode(n){return(n.type===qe.EVENT||n.type===qe.ACK)&&Od(n)?this.encodeAsBinary({type:n.type===qe.EVENT?qe.BINARY_EVENT:qe.BINARY_ACK,nsp:n.nsp,data:n.data,id:n.id}):[this.encodeAsString(n)]}encodeAsString(n){let t=""+n.type;return(n.type===qe.BINARY_EVENT||n.type===qe.BINARY_ACK)&&(t+=n.attachments+"-"),n.nsp&&n.nsp!=="/"&&(t+=n.nsp+","),n.id!=null&&(t+=n.id),n.data!=null&&(t+=JSON.stringify(n.data,this.replacer)),t}encodeAsBinary(n){const t=xj(n),r=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(r),i}}function wx(e){return Object.prototype.toString.call(e)==="[object Object]"}class z0 extends Ht{constructor(n){super(),this.reviver=n}add(n){let t;if(typeof n=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(n);const r=t.type===qe.BINARY_EVENT;r||t.type===qe.BINARY_ACK?(t.type=r?qe.EVENT:qe.ACK,this.reconstructor=new kj(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(B0(n)||n.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(n),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+n)}decodeString(n){let t=0;const r={type:Number(n.charAt(0))};if(qe[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===qe.BINARY_EVENT||r.type===qe.BINARY_ACK){const o=t+1;for(;n.charAt(++t)!=="-"&&t!=n.length;);const a=n.substring(o,t);if(a!=Number(a)||n.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(a)}if(n.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(n.charAt(t)===","||t===n.length););r.nsp=n.substring(o,t)}else r.nsp="/";const i=n.charAt(t+1);if(i!==""&&Number(i)==i){const o=t+1;for(;++t;){const a=n.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===n.length)break}r.id=Number(n.substring(o,t+1))}if(n.charAt(++t)){const o=this.tryParse(n.substr(t));if(z0.isPayloadValid(r.type,o))r.data=o;else throw new Error("invalid payload")}return r}tryParse(n){try{return JSON.parse(n,this.reviver)}catch{return!1}}static isPayloadValid(n,t){switch(n){case qe.CONNECT:return wx(t);case qe.DISCONNECT:return t===void 0;case qe.CONNECT_ERROR:return typeof t=="string"||wx(t);case qe.EVENT:case qe.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Sj.indexOf(t[0])===-1);case qe.ACK:case qe.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class kj{constructor(n){this.packet=n,this.buffers=[],this.reconPack=n}takeBinaryData(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){const t=_j(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ej=Object.freeze(Object.defineProperty({__proto__:null,Decoder:z0,Encoder:Rj,get PacketType(){return qe},protocol:Cj},Symbol.toStringTag,{value:"Module"}));function qr(e,n,t){return e.on(n,t),function(){e.off(n,t)}}const Tj=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class sE extends Ht{constructor(n,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=n,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const n=this.io;this.subs=[qr(n,"open",this.onopen.bind(this)),qr(n,"packet",this.onpacket.bind(this)),qr(n,"error",this.onerror.bind(this)),qr(n,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...n){return n.unshift("message"),this.emit.apply(this,n),this}emit(n,...t){var r,i,o;if(Tj.hasOwnProperty(n))throw new Error('"'+n.toString()+'" is a reserved event name');if(t.unshift(n),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const a={type:qe.EVENT,data:t};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const l=this.ids++,d=t.pop();this._registerAckCallback(l,d),a.id=l}const s=(i=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!s||(c?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(n,t){var r;const i=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(i===void 0){this.acks[n]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[n];for(let s=0;s<this.sendBuffer.length;s++)this.sendBuffer[s].id===n&&this.sendBuffer.splice(s,1);t.call(this,new Error("operation has timed out"))},i),a=(...s)=>{this.io.clearTimeoutFn(o),t.apply(this,s)};a.withError=!0,this.acks[n]=a}emitWithAck(n,...t){return new Promise((r,i)=>{const o=(a,s)=>a?i(a):r(s);o.withError=!0,t.push(o),this.emit(n,...t)})}_addToQueue(n){let t;typeof n[n.length-1]=="function"&&(t=n.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:n,flags:Object.assign({fromQueue:!0},this.flags)};n.push((i,...o)=>r!==this._queue[0]?void 0:(i!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(n=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!n||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(n){n.nsp=this.nsp,this.io._packet(n)}onopen(){typeof this.auth=="function"?this.auth(n=>{this._sendConnectPacket(n)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(n){this.packet({type:qe.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},n):n})}onerror(n){this.connected||this.emitReserved("connect_error",n)}onclose(n,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",n,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(n=>{if(!this.sendBuffer.some(r=>String(r.id)===n)){const r=this.acks[n];delete this.acks[n],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(n){if(n.nsp===this.nsp)switch(n.type){case qe.CONNECT:n.data&&n.data.sid?this.onconnect(n.data.sid,n.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case qe.EVENT:case qe.BINARY_EVENT:this.onevent(n);break;case qe.ACK:case qe.BINARY_ACK:this.onack(n);break;case qe.DISCONNECT:this.ondisconnect();break;case qe.CONNECT_ERROR:this.destroy();const r=new Error(n.data.message);r.data=n.data.data,this.emitReserved("connect_error",r);break}}onevent(n){const t=n.data||[];n.id!=null&&t.push(this.ack(n.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(n){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,n)}super.emit.apply(this,n),this._pid&&n.length&&typeof n[n.length-1]=="string"&&(this._lastOffset=n[n.length-1])}ack(n){const t=this;let r=!1;return function(...i){r||(r=!0,t.packet({type:qe.ACK,id:n,data:i}))}}onack(n){const t=this.acks[n.id];typeof t=="function"&&(delete this.acks[n.id],t.withError&&n.data.unshift(null),t.apply(this,n.data))}onconnect(n,t){this.id=n,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(n=>this.emitEvent(n)),this.receiveBuffer=[],this.sendBuffer.forEach(n=>{this.notifyOutgoingListeners(n),this.packet(n)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(n=>n()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:qe.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(n){return this.flags.compress=n,this}get volatile(){return this.flags.volatile=!0,this}timeout(n){return this.flags.timeout=n,this}onAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(n),this}prependAny(n){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(n),this}offAny(n){if(!this._anyListeners)return this;if(n){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(n),this}prependAnyOutgoing(n){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(n),this}offAnyOutgoing(n){if(!this._anyOutgoingListeners)return this;if(n){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(n===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(n){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,n.data)}}}function Ic(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ic.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var n=Math.random(),t=Math.floor(n*this.jitter*e);e=Math.floor(n*10)&1?e+t:e-t}return Math.min(e,this.max)|0};Ic.prototype.reset=function(){this.attempts=0};Ic.prototype.setMin=function(e){this.ms=e};Ic.prototype.setMax=function(e){this.max=e};Ic.prototype.setJitter=function(e){this.jitter=e};class bv extends Ht{constructor(n,t){var r;super(),this.nsps={},this.subs=[],n&&typeof n=="object"&&(t=n,n=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,kf(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ic({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=n;const i=t.parser||Ej;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(n){return arguments.length?(this._reconnection=!!n,n||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(n){return n===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=n,this)}reconnectionDelay(n){var t;return n===void 0?this._reconnectionDelay:(this._reconnectionDelay=n,(t=this.backoff)===null||t===void 0||t.setMin(n),this)}randomizationFactor(n){var t;return n===void 0?this._randomizationFactor:(this._randomizationFactor=n,(t=this.backoff)===null||t===void 0||t.setJitter(n),this)}reconnectionDelayMax(n){var t;return n===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=n,(t=this.backoff)===null||t===void 0||t.setMax(n),this)}timeout(n){return arguments.length?(this._timeout=n,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(n){if(~this._readyState.indexOf("open"))return this;this.engine=new mj(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const i=qr(t,"open",function(){r.onopen(),n&&n()}),o=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),n?n(s):this.maybeReconnectOnOpen()},a=qr(t,"error",o);if(this._timeout!==!1){const s=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),t.close()},s);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(a),this}connect(n){return this.open(n)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const n=this.engine;this.subs.push(qr(n,"ping",this.onping.bind(this)),qr(n,"data",this.ondata.bind(this)),qr(n,"error",this.onerror.bind(this)),qr(n,"close",this.onclose.bind(this)),qr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(n){try{this.decoder.add(n)}catch(t){this.onclose("parse error",t)}}ondecoded(n){Rf(()=>{this.emitReserved("packet",n)},this.setTimeoutFn)}onerror(n){this.emitReserved("error",n)}socket(n,t){let r=this.nsps[n];return r?this._autoConnect&&!r.active&&r.connect():(r=new sE(this,n,t),this.nsps[n]=r),r}_destroy(n){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(n){const t=this.encoder.encode(n);for(let r=0;r<t.length;r++)this.engine.write(t[r],n.options)}cleanup(){this.subs.forEach(n=>n()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(n,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",n,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const n=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{n.skipReconnect||(this.emitReserved("reconnect_attempt",n.backoff.attempts),!n.skipReconnect&&n.open(i=>{i?(n._reconnecting=!1,n.reconnect(),this.emitReserved("reconnect_error",i)):n.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const n=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",n)}}const Jc={};function Fd(e,n){typeof e=="object"&&(n=e,e=void 0),n=n||{};const t=gj(e,n.path||"/socket.io"),r=t.source,i=t.id,o=t.path,a=Jc[i]&&o in Jc[i].nsps,s=n.forceNew||n["force new connection"]||n.multiplex===!1||a;let c;return s?c=new bv(r,n):(Jc[i]||(Jc[i]=new bv(r,n)),c=Jc[i]),t.query&&!n.query&&(n.query=t.queryKey),c.socket(t.path,n)}Object.assign(Fd,{Manager:bv,Socket:sE,io:Fd,connect:Fd});var cE={},xv={exports:{}},Rm,bx;function Dj(){if(bx)return Rm;bx=1;var e=1e3,n=e*60,t=n*60,r=t*24,i=r*7,o=r*365.25;Rm=function(l,d){d=d||{};var p=typeof l;if(p==="string"&&l.length>0)return a(l);if(p==="number"&&isFinite(l))return d.long?c(l):s(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function a(l){if(l=String(l),!(l.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(d){var p=parseFloat(d[1]),f=(d[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return p*o;case"weeks":case"week":case"w":return p*i;case"days":case"day":case"d":return p*r;case"hours":case"hour":case"hrs":case"hr":case"h":return p*t;case"minutes":case"minute":case"mins":case"min":case"m":return p*n;case"seconds":case"second":case"secs":case"sec":case"s":return p*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function s(l){var d=Math.abs(l);return d>=r?Math.round(l/r)+"d":d>=t?Math.round(l/t)+"h":d>=n?Math.round(l/n)+"m":d>=e?Math.round(l/e)+"s":l+"ms"}function c(l){var d=Math.abs(l);return d>=r?u(l,d,r,"day"):d>=t?u(l,d,t,"hour"):d>=n?u(l,d,n,"minute"):d>=e?u(l,d,e,"second"):l+" ms"}function u(l,d,p,f){var m=d>=p*1.5;return Math.round(l/p)+" "+f+(m?"s":"")}return Rm}function Ij(e){t.debug=t,t.default=t,t.coerce=c,t.disable=a,t.enable=i,t.enabled=s,t.humanize=Dj(),t.destroy=u,Object.keys(e).forEach(l=>{t[l]=e[l]}),t.names=[],t.skips=[],t.formatters={};function n(l){let d=0;for(let p=0;p<l.length;p++)d=(d<<5)-d+l.charCodeAt(p),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=n;function t(l){let d,p=null,f,m;function g(...v){if(!g.enabled)return;const h=g,w=Number(new Date),y=w-(d||w);h.diff=y,h.prev=d,h.curr=w,d=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let b=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(_,C)=>{if(_==="%%")return"%";b++;const R=t.formatters[C];if(typeof R=="function"){const S=v[b];_=R.call(h,S),v.splice(b,1),b--}return _}),t.formatArgs.call(h,v),(h.log||t.log).apply(h,v)}return g.namespace=l,g.useColors=t.useColors(),g.color=t.selectColor(l),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(f!==t.namespaces&&(f=t.namespaces,m=t.enabled(l)),m),set:v=>{p=v}}),typeof t.init=="function"&&t.init(g),g}function r(l,d){const p=t(this.namespace+(typeof d>"u"?":":d)+l);return p.log=this.log,p}function i(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];const d=(typeof l=="string"?l:"").trim().replace(" ",",").split(",").filter(Boolean);for(const p of d)p[0]==="-"?t.skips.push(p.slice(1)):t.names.push(p)}function o(l,d){let p=0,f=0,m=-1,g=0;for(;p<l.length;)if(f<d.length&&(d[f]===l[p]||d[f]==="*"))d[f]==="*"?(m=f,g=p,f++):(p++,f++);else if(m!==-1)f=m+1,g++,p=g;else return!1;for(;f<d.length&&d[f]==="*";)f++;return f===d.length}function a(){const l=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),l}function s(l){for(const d of t.skips)if(o(l,d))return!1;for(const d of t.names)if(o(l,d))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Pj=Ij;(function(e,n){var t={};n.formatArgs=i,n.save=o,n.load=a,n.useColors=r,n.storage=s(),n.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),n.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let d=0,p=0;u[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(p=d))}),u.splice(p,0,l)}n.log=console.debug||console.log||(()=>{});function o(u){try{u?n.storage.setItem("debug",u):n.storage.removeItem("debug")}catch{}}function a(){let u;try{u=n.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=t.DEBUG),u}function s(){try{return localStorage}catch{}}e.exports=Pj(n);const{formatters:c}=e.exports;c.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(xv,xv.exports);var Ef=xv.exports,uE={},Pc={},_v={exports:{}};(function(e,n){(function(t,r){var i="2.0.3",o=500,a="user-agent",s="",c="?",u="function",l="undefined",d="object",p="string",f="browser",m="cpu",g="device",v="engine",h="os",w="result",y="name",b="type",x="vendor",_="version",C="architecture",R="major",S="model",E="console",T="mobile",I="tablet",F="smarttv",z="wearable",j="xr",H="embedded",W="inapp",L="brands",$="formFactors",k="fullVersionList",U="platform",X="platformVersion",P="bitness",ne="sec-ch-ua",se=ne+"-full-version-list",te=ne+"-arch",ce=ne+"-"+P,ye=ne+"-form-factors",Re=ne+"-"+T,Je=ne+"-"+S,Pe=ne+"-"+U,He=Pe+"-version",Ue=[L,k,T,S,U,X,C,$,P],at="Amazon",Ze="Apple",st="ASUS",bn="BlackBerry",Lt="Google",tn="Huawei",Rr="Lenovo",zn="Honor",jn="LG",$n="Microsoft",kr="Motorola",Un="Nvidia",_o="OnePlus",q="OPPO",Y="Samsung",we="Sharp",We="Sony",Xe="Xiaomi",ln="Zebra",Wn="Chrome",xn="Chromium",nn="Chromecast",ga="Edge",ft="Firefox",Gi="Opera",ur="Facebook",cw="Sogou",ts="Mobile ",Mc=" Browser",ah="Windows",uw=typeof t!==l,Kn=uw&&t.navigator?t.navigator:r,So=Kn&&Kn.userAgentData?Kn.userAgentData:r,oT=function(ee,de){var pe={},tt=de;if(!yl(de)){tt={};for(var ke in de)for(var ht in de[ke])tt[ht]=de[ke][ht].concat(tt[ht]?tt[ht]:[])}for(var be in ee)pe[be]=tt[be]&&tt[be].length%2===0?tt[be].concat(ee[be]):ee[be];return pe},vl=function(ee){for(var de={},pe=0;pe<ee.length;pe++)de[ee[pe].toUpperCase()]=ee[pe];return de},sh=function(ee,de){if(typeof ee===d&&ee.length>0){for(var pe in ee)if(qi(ee[pe])==qi(de))return!0;return!1}return ns(ee)?qi(de).indexOf(qi(ee))!==-1:!1},yl=function(ee,de){for(var pe in ee)return/^(browser|cpu|device|engine|os)$/.test(pe)||(de?yl(ee[pe]):!1)},ns=function(ee){return typeof ee===p},ch=function(ee){if(!ee)return r;for(var de=[],pe=rs(/\\?\"/g,ee).split(","),tt=0;tt<pe.length;tt++)if(pe[tt].indexOf(";")>-1){var ke=Oc(pe[tt]).split(";v=");de[tt]={brand:ke[0],version:ke[1]}}else de[tt]=Oc(pe[tt]);return de},qi=function(ee){return ns(ee)?ee.toLowerCase():ee},uh=function(ee){return ns(ee)?rs(/[^\d\.]/g,ee).split(".")[0]:r},Ki=function(ee){for(var de in ee){var pe=ee[de];typeof pe==d&&pe.length==2?this[pe[0]]=pe[1]:this[pe]=r}return this},rs=function(ee,de){return ns(de)?de.replace(ee,s):de},Lc=function(ee){return rs(/\\?\"/g,ee)},Oc=function(ee,de){if(ns(ee))return ee=rs(/^\s\s*/,ee),typeof de===l?ee:ee.substring(0,o)},lh=function(ee,de){if(!(!ee||!de))for(var pe=0,tt,ke,ht,be,ct,Be;pe<de.length&&!ct;){var Ot=de[pe],Xi=de[pe+1];for(tt=ke=0;tt<Ot.length&&!ct&&Ot[tt];)if(ct=Ot[tt++].exec(ee),ct)for(ht=0;ht<Xi.length;ht++)Be=ct[++ke],be=Xi[ht],typeof be===d&&be.length>0?be.length===2?typeof be[1]==u?this[be[0]]=be[1].call(this,Be):this[be[0]]=be[1]:be.length===3?typeof be[1]===u&&!(be[1].exec&&be[1].test)?this[be[0]]=Be?be[1].call(this,Be,be[2]):r:this[be[0]]=Be?Be.replace(be[1],be[2]):r:be.length===4&&(this[be[0]]=Be?be[3].call(this,Be.replace(be[1],be[2])):r):this[be]=Be||r;pe+=2}},Co=function(ee,de){for(var pe in de)if(typeof de[pe]===d&&de[pe].length>0){for(var tt=0;tt<de[pe].length;tt++)if(sh(de[pe][tt],ee))return pe===c?r:pe}else if(sh(de[pe],ee))return pe===c?r:pe;return de.hasOwnProperty("*")?de["*"]:ee},lw={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},dw={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":r},pw={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_,[y,ts+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,_],[/opios[\/ ]+([\w\.]+)/i],[_,[y,Gi+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[_,[y,Gi+" GX"]],[/\bopr\/([\w\.]+)/i],[_,[y,Gi]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[_,[y,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[_,[y,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[y,_],[/quark(?:pc)?\/([-\w\.]+)/i],[_,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[_,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_,[y,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[_,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[_,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[_,[y,"Smart "+Rr+Mc]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure"+Mc],_],[/\bfocus\/([\w\.]+)/i],[_,[y,ft+" Focus"]],[/\bopt\/([\w\.]+)/i],[_,[y,Gi+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[_,[y,Gi+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_,[y,"MIUI"+Mc]],[/fxios\/([\w\.-]+)/i],[_,[y,ts+ft]],[/\bqihoobrowser\/?([\w\.]*)/i],[_,[y,"360"]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],_],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+Mc],_],[/samsungbrowser\/([\w\.]+)/i],[_,[y,Y+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[_,[y,cw+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,cw+" Mobile"],_],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[y,_],[/(lbbrowser|rekonq)/i],[y],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[_,y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,ur],_,[b,W]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[y,_,[b,W]],[/\bgsa\/([\w\.]+) .*safari\//i],[_,[y,"GSA"],[b,W]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[_,[y,"TikTok"],[b,W]],[/\[(linkedin)app\]/i],[y,[b,W]],[/(chromium)[\/ ]([-\w\.]+)/i],[y,_],[/headlesschrome(?:\/([\w\.]+)| )/i],[_,[y,Wn+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,Wn+" WebView"],_],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_,[y,"Android"+Mc]],[/chrome\/([\w\.]+) mobile/i],[_,[y,ts+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,_],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[_,[y,ts+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[y,ts+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[_,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[_,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[y,_],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[y,ts+ft],_],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],_],[/(wolvic|librewolf)\/([\w\.]+)/i],[y,_],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_,[y,ft+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[y,[_,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[_,/[^\d\.]+./,s]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[C,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[C,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[C,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[C,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[C,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[C,/ower/,s,qi]],[/ sun4\w[;\)]/i],[[C,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[C,qi]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[S,[x,Y],[b,I]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[S,[x,Y],[b,T]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[S,[x,Ze],[b,T]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[S,[x,Ze],[b,I]],[/(macintosh);/i],[S,[x,Ze]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[S,[x,we],[b,T]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[S,[x,zn],[b,I]],[/honor([-\w ]+)[;\)]/i],[S,[x,zn],[b,T]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[S,[x,tn],[b,I]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[S,[x,tn],[b,T]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[S,/_/g," "],[x,Xe],[b,I]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[S,/_/g," "],[x,Xe],[b,T]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[S,[x,q],[b,T]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[S,[x,Co,{OnePlus:["304","403","203"],"*":q}],[b,I]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[S,[x,"BLU"],[b,T]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[S,[x,"Vivo"],[b,T]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[S,[x,"Realme"],[b,T]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[S,[x,kr],[b,T]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[S,[x,kr],[b,I]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[S,[x,jn],[b,I]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[S,[x,jn],[b,T]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[S,[x,Rr],[b,I]],[/(nokia) (t[12][01])/i],[x,S,[b,I]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[S,/_/g," "],[b,T],[x,"Nokia"]],[/(pixel (c|tablet))\b/i],[S,[x,Lt],[b,I]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[S,[x,Lt],[b,T]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[S,[x,We],[b,T]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[S,"Xperia Tablet"],[x,We],[b,I]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[S,[x,_o],[b,T]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[S,[x,at],[b,I]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[S,/(.+)/g,"Fire Phone $1"],[x,at],[b,T]],[/(playbook);[-\w\),; ]+(rim)/i],[S,x,[b,I]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[S,[x,bn],[b,T]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[S,[x,st],[b,I]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[S,[x,st],[b,T]],[/(nexus 9)/i],[S,[x,"HTC"],[b,I]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[x,[S,/_/g," "],[b,T]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[S,[x,"TCL"],[b,I]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[S,[x,"TCL"],[b,T]],[/(itel) ((\w+))/i],[[x,qi],S,[b,Co,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[S,[x,"Acer"],[b,I]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[S,[x,"Meizu"],[b,T]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[S,[x,"Ulefone"],[b,T]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[S,[x,"Energizer"],[b,T]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[S,[x,"Cat"],[b,T]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[S,[x,"Smartfren"],[b,T]],[/droid.+; (a(?:015|06[35]|142p?))/i],[S,[x,"Nothing"],[b,T]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[S,[x,"Archos"],[b,I]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[S,[x,"Archos"],[b,T]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[x,S,[b,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[x,S,[b,T]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[x,S,[b,I]],[/(surface duo)/i],[S,[x,$n],[b,I]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[S,[x,"Fairphone"],[b,T]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[S,[x,Un],[b,I]],[/(sprint) (\w+)/i],[x,S,[b,T]],[/(kin\.[onetw]{3})/i],[[S,/\./g," "],[x,$n],[b,T]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[S,[x,ln],[b,I]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[S,[x,ln],[b,T]],[/smart-tv.+(samsung)/i],[x,[b,F]],[/hbbtv.+maple;(\d+)/i],[[S,/^/,"SmartTV"],[x,Y],[b,F]],[/tcast.+(lg)e?. ([-\w]+)/i],[x,S,[b,F]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[x,jn],[b,F]],[/(apple) ?tv/i],[x,[S,Ze+" TV"],[b,F]],[/crkey.*devicetype\/chromecast/i],[[S,nn+" Third Generation"],[x,Lt],[b,F]],[/crkey.*devicetype\/([^/]*)/i],[[S,/^/,"Chromecast "],[x,Lt],[b,F]],[/fuchsia.*crkey/i],[[S,nn+" Nest Hub"],[x,Lt],[b,F]],[/crkey/i],[[S,nn],[x,Lt],[b,F]],[/(portaltv)/i],[S,[x,ur],[b,F]],[/droid.+aft(\w+)( bui|\))/i],[S,[x,at],[b,F]],[/(shield \w+ tv)/i],[S,[x,Un],[b,F]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[S,[x,we],[b,F]],[/(bravia[\w ]+)( bui|\))/i],[S,[x,We],[b,F]],[/(mi(tv|box)-?\w+) bui/i],[S,[x,Xe],[b,F]],[/Hbbtv.*(technisat) (.*);/i],[x,S,[b,F]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[x,Oc],[S,Oc],[b,F]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[S,[b,F]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[b,F]],[/(ouya)/i,/(nintendo) (\w+)/i],[x,S,[b,E]],[/droid.+; (shield)( bui|\))/i],[S,[x,Un],[b,E]],[/(playstation \w+)/i],[S,[x,We],[b,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[S,[x,$n],[b,E]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[S,[x,Y],[b,z]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[x,S,[b,z]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[S,[x,q],[b,z]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[S,[x,Ze],[b,z]],[/(opwwe\d{3})/i],[S,[x,_o],[b,z]],[/(moto 360)/i],[S,[x,kr],[b,z]],[/(smartwatch 3)/i],[S,[x,We],[b,z]],[/(g watch r)/i],[S,[x,jn],[b,z]],[/droid.+; (wt63?0{2,3})\)/i],[S,[x,ln],[b,z]],[/droid.+; (glass) \d/i],[S,[x,Lt],[b,j]],[/(pico) (4|neo3(?: link|pro)?)/i],[x,S,[b,j]],[/(quest( \d| pro)?s?).+vr/i],[S,[x,ur],[b,j]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[x,[b,H]],[/(aeobc)\b/i],[S,[x,at],[b,H]],[/(homepod).+mac os/i],[S,[x,Ze],[b,H]],[/windows iot/i],[[b,H]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[S,[b,Co,{mobile:"Mobile",xr:"VR","*":I}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,I]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,T]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[S,[x,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_,[y,ga+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[y,_],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,_],[/ladybird\//i],[[y,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_,y]],os:[[/microsoft (windows) (vista|xp)/i],[y,_],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[y,[_,Co,lw]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,Co,lw],[y,ah]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[_,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[y,"macOS"],[_,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[_,[y,nn+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[_,[y,nn+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[_,[y,nn+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[_,[y,nn+" Linux"]],[/crkey\/([\d\.]+)/i],[_,[y,nn]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_,y],[/(ubuntu) ([\w\.]+) like android/i],[[y,/(.+)/,"$1 Touch"],_],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[y,_],[/\(bb(10);/i],[_,[y,bn]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[_,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_,[y,ft+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_,[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_,[y,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,"Chrome OS"],_],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[y,_],[/(sunos) ?([\w\.\d]*)/i],[[y,"Solaris"],_],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,_]]},wl=function(){var ee={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Ki.call(ee.init,[[f,[y,_,R,b]],[m,[C]],[g,[b,S,x]],[v,[y,_]],[h,[y,_]]]),Ki.call(ee.isIgnore,[[f,[_,R]],[v,[_]],[h,[_]]]),Ki.call(ee.isIgnoreRgx,[[f,/ ?browser$/i],[h,/ ?os$/i]]),Ki.call(ee.toString,[[f,[y,_]],[m,[C]],[g,[x,S]],[v,[y,_]],[h,[y,_]]]),ee}(),aT=function(ee,de){var pe=wl.init[de],tt=wl.isIgnore[de]||0,ke=wl.isIgnoreRgx[de]||0,ht=wl.toString[de]||0;function be(){Ki.call(this,pe)}return be.prototype.getItem=function(){return ee},be.prototype.withClientHints=function(){return So?So.getHighEntropyValues(Ue).then(function(ct){return ee.setCH(new fw(ct,!1)).parseCH().get()}):ee.parseCH().get()},be.prototype.withFeatureCheck=function(){return ee.detectFeature().get()},de!=w&&(be.prototype.is=function(ct){var Be=!1;for(var Ot in this)if(this.hasOwnProperty(Ot)&&!sh(tt,Ot)&&qi(ke?rs(ke,this[Ot]):this[Ot])==qi(ke?rs(ke,ct):ct)){if(Be=!0,ct!=l)break}else if(ct==l&&Be){Be=!Be;break}return Be},be.prototype.toString=function(){var ct=s;for(var Be in ht)typeof this[ht[Be]]!==l&&(ct+=(ct?" ":s)+this[ht[Be]]);return ct||l}),So||(be.prototype.then=function(ct){var Be=this,Ot=function(){for(var Ro in Be)Be.hasOwnProperty(Ro)&&(this[Ro]=Be[Ro])};Ot.prototype={is:be.prototype.is,toString:be.prototype.toString};var Xi=new Ot;return ct(Xi),Xi}),new be};function fw(ee,de){if(ee=ee||{},Ki.call(this,Ue),de)Ki.call(this,[[L,ch(ee[ne])],[k,ch(ee[se])],[T,/\?1/.test(ee[Re])],[S,Lc(ee[Je])],[U,Lc(ee[Pe])],[X,Lc(ee[He])],[C,Lc(ee[te])],[$,ch(ee[ye])],[P,Lc(ee[ce])]]);else for(var pe in ee)this.hasOwnProperty(pe)&&typeof ee[pe]!==l&&(this[pe]=ee[pe])}function hw(ee,de,pe,tt){return this.get=function(ke){return ke?this.data.hasOwnProperty(ke)?this.data[ke]:r:this.data},this.set=function(ke,ht){return this.data[ke]=ht,this},this.setCH=function(ke){return this.uaCH=ke,this},this.detectFeature=function(){if(Kn&&Kn.userAgent==this.ua)switch(this.itemType){case f:Kn.brave&&typeof Kn.brave.isBrave==u&&this.set(y,"Brave");break;case g:!this.get(b)&&So&&So[T]&&this.set(b,T),this.get(S)=="Macintosh"&&Kn&&typeof Kn.standalone!==l&&Kn.maxTouchPoints&&Kn.maxTouchPoints>2&&this.set(S,"iPad").set(b,I);break;case h:!this.get(y)&&So&&So[U]&&this.set(y,So[U]);break;case w:var ke=this.data,ht=function(be){return ke[be].getItem().detectFeature().get()};this.set(f,ht(f)).set(m,ht(m)).set(g,ht(g)).set(v,ht(v)).set(h,ht(h))}return this},this.parseUA=function(){return this.itemType!=w&&lh.call(this.data,this.ua,this.rgxMap),this.itemType==f&&this.set(R,uh(this.get(_))),this},this.parseCH=function(){var ke=this.uaCH,ht=this.rgxMap;switch(this.itemType){case f:case v:var be=ke[k]||ke[L],ct;if(be)for(var Be in be){var Ot=be[Be].brand||be[Be],Xi=be[Be].version;this.itemType==f&&!/not.a.brand/i.test(Ot)&&(!ct||/chrom/i.test(ct)&&Ot!=xn)&&(Ot=Co(Ot,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(y,Ot).set(_,Xi).set(R,uh(Xi)),ct=Ot),this.itemType==v&&Ot==xn&&this.set(_,Xi)}break;case m:var Ro=ke[C];Ro&&(Ro&&ke[P]=="64"&&(Ro+="64"),lh.call(this.data,Ro+";",ht));break;case g:if(ke[T]&&this.set(b,T),ke[S]&&(this.set(S,ke[S]),!this.get(b)||!this.get(x))){var Fc={};lh.call(Fc,"droid 9; "+ke[S]+")",ht),!this.get(b)&&Fc.type&&this.set(b,Fc.type),!this.get(x)&&Fc.vendor&&this.set(x,Fc.vendor)}if(ke[$]){var xl;if(typeof ke[$]!="string")for(var mw=0;!xl&&mw<ke[$].length;)xl=Co(ke[$][mw++],dw);else xl=Co(ke[$],dw);this.set(b,xl)}break;case h:var dh=ke[U];if(dh){var ph=ke[X];dh==ah&&(ph=parseInt(uh(ph),10)>=13?"11":"10"),this.set(y,dh).set(_,ph)}this.get(y)==ah&&ke[S]=="Xbox"&&this.set(y,"Xbox").set(_,r);break;case w:var sT=this.data,Bc=function(cT){return sT[cT].getItem().setCH(ke).parseCH().get()};this.set(f,Bc(f)).set(m,Bc(m)).set(g,Bc(g)).set(v,Bc(v)).set(h,Bc(h))}return this},Ki.call(this,[["itemType",ee],["ua",de],["uaCH",tt],["rgxMap",pe],["data",aT(this,ee)]]),this}function Wr(ee,de,pe){if(typeof ee===d?(yl(ee,!0)?(typeof de===d&&(pe=de),de=ee):(pe=ee,de=r),ee=r):typeof ee===p&&!yl(de,!0)&&(pe=de,de=r),pe&&typeof pe.append===u){var tt={};pe.forEach(function(Be,Ot){tt[Ot]=Be}),pe=tt}if(!(this instanceof Wr))return new Wr(ee,de,pe).getResult();var ke=typeof ee===p?ee:pe&&pe[a]?pe[a]:Kn&&Kn.userAgent?Kn.userAgent:s,ht=new fw(pe,!0),be=de?oT(pw,de):pw,ct=function(Be){return Be==w?function(){return new hw(Be,ke,be,ht).set("ua",ke).set(f,this.getBrowser()).set(m,this.getCPU()).set(g,this.getDevice()).set(v,this.getEngine()).set(h,this.getOS()).get()}:function(){return new hw(Be,ke,be[Be],ht).parseUA().get()}};return Ki.call(this,[["getBrowser",ct(f)],["getCPU",ct(m)],["getDevice",ct(g)],["getEngine",ct(v)],["getOS",ct(h)],["getResult",ct(w)],["getUA",function(){return ke}],["setUA",function(Be){return ns(Be)&&(ke=Be.length>o?Oc(Be,o):Be),this}]]).setUA(ke),this}Wr.VERSION=i,Wr.BROWSER=vl([y,_,R,b]),Wr.CPU=vl([C]),Wr.DEVICE=vl([S,x,b,E,T,F,I,z,H]),Wr.ENGINE=Wr.OS=vl([y,_]),e.exports&&(n=e.exports=Wr),n.UAParser=Wr;var is=uw&&(t.jQuery||t.Zepto);if(is&&!is.ua){var bl=new Wr;is.ua=bl.getResult(),is.ua.get=function(){return bl.getUA()},is.ua.set=function(ee){bl.setUA(ee);var de=bl.getResult();for(var pe in de)is.ua[pe]=de[pe]}}})(typeof window=="object"?window:oo)})(_v,_v.exports);var Aj=_v.exports,Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});Ct.Logger=void 0;const ls=Ef,ds="mediasoup-client";let Nj=class{constructor(n){N(this,"_debug");N(this,"_warn");N(this,"_error");n?(this._debug=(0,ls.default)(`${ds}:${n}`),this._warn=(0,ls.default)(`${ds}:WARN:${n}`),this._error=(0,ls.default)(`${ds}:ERROR:${n}`)):(this._debug=(0,ls.default)(ds),this._warn=(0,ls.default)(`${ds}:WARN`),this._error=(0,ls.default)(`${ds}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};Ct.Logger=Nj;var oi={},j0={exports:{}},uc=typeof Reflect=="object"?Reflect:null,xx=uc&&typeof uc.apply=="function"?uc.apply:function(n,t,r){return Function.prototype.apply.call(n,t,r)},Bd;uc&&typeof uc.ownKeys=="function"?Bd=uc.ownKeys:Object.getOwnPropertySymbols?Bd=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Bd=function(n){return Object.getOwnPropertyNames(n)};function Mj(e){console&&console.warn&&console.warn(e)}var lE=Number.isNaN||function(n){return n!==n};function pt(){pt.init.call(this)}j0.exports=pt;j0.exports.once=Bj;pt.EventEmitter=pt;pt.prototype._events=void 0;pt.prototype._eventsCount=0;pt.prototype._maxListeners=void 0;var _x=10;function Tf(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(pt,"defaultMaxListeners",{enumerable:!0,get:function(){return _x},set:function(e){if(typeof e!="number"||e<0||lE(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");_x=e}});pt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};pt.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||lE(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function dE(e){return e._maxListeners===void 0?pt.defaultMaxListeners:e._maxListeners}pt.prototype.getMaxListeners=function(){return dE(this)};pt.prototype.emit=function(n){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i=n==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[n];if(c===void 0)return!1;if(typeof c=="function")xx(c,this,t);else for(var u=c.length,l=gE(c,u),r=0;r<u;++r)xx(l[r],this,t);return!0};function pE(e,n,t,r){var i,o,a;if(Tf(t),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",n,t.listener?t.listener:t),o=e._events),a=o[n]),a===void 0)a=o[n]=t,++e._eventsCount;else if(typeof a=="function"?a=o[n]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),i=dE(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=n,s.count=a.length,Mj(s)}return e}pt.prototype.addListener=function(n,t){return pE(this,n,t,!1)};pt.prototype.on=pt.prototype.addListener;pt.prototype.prependListener=function(n,t){return pE(this,n,t,!0)};function Lj(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function fE(e,n,t){var r={fired:!1,wrapFn:void 0,target:e,type:n,listener:t},i=Lj.bind(r);return i.listener=t,r.wrapFn=i,i}pt.prototype.once=function(n,t){return Tf(t),this.on(n,fE(this,n,t)),this};pt.prototype.prependOnceListener=function(n,t){return Tf(t),this.prependListener(n,fE(this,n,t)),this};pt.prototype.removeListener=function(n,t){var r,i,o,a,s;if(Tf(t),i=this._events,i===void 0)return this;if(r=i[n],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[n],i.removeListener&&this.emit("removeListener",n,r.listener||t));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():Oj(r,o),r.length===1&&(i[n]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",n,s||t)}return this};pt.prototype.off=pt.prototype.removeListener;pt.prototype.removeAllListeners=function(n){var t,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[n]),this;if(arguments.length===0){var o=Object.keys(r),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[n],typeof t=="function")this.removeListener(n,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(n,t[i]);return this};function hE(e,n,t){var r=e._events;if(r===void 0)return[];var i=r[n];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Fj(i):gE(i,i.length)}pt.prototype.listeners=function(n){return hE(this,n,!0)};pt.prototype.rawListeners=function(n){return hE(this,n,!1)};pt.listenerCount=function(e,n){return typeof e.listenerCount=="function"?e.listenerCount(n):mE.call(e,n)};pt.prototype.listenerCount=mE;function mE(e){var n=this._events;if(n!==void 0){var t=n[e];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}pt.prototype.eventNames=function(){return this._eventsCount>0?Bd(this._events):[]};function gE(e,n){for(var t=new Array(n),r=0;r<n;++r)t[r]=e[r];return t}function Oj(e,n){for(;n+1<e.length;n++)e[n]=e[n+1];e.pop()}function Fj(e){for(var n=new Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function Bj(e,n){return new Promise(function(t,r){function i(a){e.removeListener(n,o),r(a)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",i),t([].slice.call(arguments))}vE(e,n,o,{once:!0}),n!=="error"&&zj(e,i,{once:!0})})}function zj(e,n,t){typeof e.on=="function"&&vE(e,"error",n,t)}function vE(e,n,t,r){if(typeof e.on=="function")r.once?e.once(n,t):e.on(n,t);else if(typeof e.addEventListener=="function")e.addEventListener(n,function i(o){r.once&&e.removeEventListener(n,i),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var jj=j0.exports;Object.defineProperty(oi,"__esModule",{value:!0});oi.EnhancedEventEmitter=void 0;const $j=jj,Uj=Ct,Wj=new Uj.Logger("EnhancedEventEmitter");class Vj extends $j.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(n,...t){return super.emit(n,...t)}safeEmit(n,...t){try{return super.emit(n,...t)}catch(r){Wj.error("safeEmit() | event listener threw an error [eventName:%s]:%o",n,r);try{super.emit("listenererror",n,r)}catch{}return!!super.listenerCount(n)}}on(n,t){return super.on(n,t),this}off(n,t){return super.off(n,t),this}addListener(n,t){return super.on(n,t),this}prependListener(n,t){return super.prependListener(n,t),this}once(n,t){return super.once(n,t),this}prependOnceListener(n,t){return super.prependOnceListener(n,t),this}removeListener(n,t){return super.off(n,t),this}removeAllListeners(n){return super.removeAllListeners(n),this}listenerCount(n){return super.listenerCount(n)}listeners(n){return super.listeners(n)}rawListeners(n){return super.rawListeners(n)}}oi.EnhancedEventEmitter=Vj;var jt={};Object.defineProperty(jt,"__esModule",{value:!0});jt.InvalidStateError=jt.UnsupportedError=void 0;class $0 extends Error{constructor(n){super(n),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,$0):this.stack=new Error(n).stack}}jt.UnsupportedError=$0;class U0 extends Error{constructor(n){super(n),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,U0):this.stack=new Error(n).stack}}jt.InvalidStateError=U0;var Pt={};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.clone=Hj;Pt.generateRandomNumber=Gj;Pt.deepFreeze=yE;function Hj(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}function Gj(){return Math.round(Math.random()*1e7)}function yE(e){const n=Reflect.ownKeys(e);for(const t of n){const r=e[t];(r&&typeof r=="object"||typeof r=="function")&&yE(r)}return Object.freeze(e)}var dt={},vn={},Df={},qj=oo&&oo.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Df,"__esModule",{value:!0});Df.Logger=void 0;const ps=qj(Ef),fs="h264-profile-level-id";let Kj=class{constructor(n){n?(this._debug=(0,ps.default)(`${fs}:${n}`),this._warn=(0,ps.default)(`${fs}:WARN:${n}`),this._error=(0,ps.default)(`${fs}:ERROR:${n}`)):(this._debug=(0,ps.default)(fs),this._warn=(0,ps.default)(`${fs}:WARN`),this._error=(0,ps.default)(`${fs}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};Df.Logger=Kj;Object.defineProperty(vn,"__esModule",{value:!0});vn.ProfileLevelId=vn.Level=vn.Profile=void 0;vn.parseProfileLevelId=wE;vn.profileLevelIdToString=bE;vn.profileToString=Jj;vn.levelToString=Zj;vn.parseSdpProfileLevelId=$a;vn.isSameProfile=e$;vn.isSameProfileAndLevel=t$;vn.generateProfileLevelIdStringForAnswer=n$;vn.supportedLevel=r$;const Xj=Df,ei=new Xj.Logger;var mt;(function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"})(mt||(vn.Profile=mt={}));var fe;(function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"})(fe||(vn.Level=fe={}));class If{constructor(n,t){this.profile=n,this.level=t}}vn.ProfileLevelId=If;const Qj=new If(mt.ConstrainedBaseline,fe.L3_1);class Yi{constructor(n){this.mask=~Cx("x",n),this.masked_value=Cx("1",n)}isMatch(n){return this.masked_value===(n&this.mask)}}class Ji{constructor(n,t,r){this.profile_idc=n,this.profile_iop=t,this.profile=r}}const Yj=[new Ji(66,new Yi("x1xx0000"),mt.ConstrainedBaseline),new Ji(77,new Yi("1xxx0000"),mt.ConstrainedBaseline),new Ji(88,new Yi("11xx0000"),mt.ConstrainedBaseline),new Ji(66,new Yi("x0xx0000"),mt.Baseline),new Ji(88,new Yi("10xx0000"),mt.Baseline),new Ji(77,new Yi("0x0x0000"),mt.Main),new Ji(100,new Yi("00000000"),mt.High),new Ji(100,new Yi("00001100"),mt.ConstrainedHigh),new Ji(244,new Yi("00000000"),mt.PredictiveHigh444)],Sx=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:fe.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:fe.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:fe.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:fe.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:fe.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:fe.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:fe.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:fe.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:fe.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:fe.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:fe.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:fe.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:fe.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:fe.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:fe.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:fe.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:fe.L5_2}];function wE(e){if(typeof e!="string"||e.length!==6)return;const t=parseInt(e,16);if(t===0)return;const r=t&255,i=t>>8&255,o=t>>16&255;let a;switch(r){case fe.L1_1:{a=i&16?fe.L1_b:fe.L1_1;break}case fe.L1:case fe.L1_2:case fe.L1_3:case fe.L2:case fe.L2_1:case fe.L2_2:case fe.L3:case fe.L3_1:case fe.L3_2:case fe.L4:case fe.L4_1:case fe.L4_2:case fe.L5:case fe.L5_1:case fe.L5_2:{a=r;break}default:{ei.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`);return}}for(const s of Yj)if(o===s.profile_idc&&s.profile_iop.isMatch(i))return ei.debug(`parseProfileLevelId() | result [str:${e}, profile:${s.profile}, level:${a}]`),new If(s.profile,a);ei.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${o}, profile_iop:${i}]`)}function bE(e){if(e.level==fe.L1_b)switch(e.profile){case mt.ConstrainedBaseline:return"42f00b";case mt.Baseline:return"42100b";case mt.Main:return"4d100b";default:{ei.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`);return}}let n;switch(e.profile){case mt.ConstrainedBaseline:{n="42e0";break}case mt.Baseline:{n="4200";break}case mt.Main:{n="4d00";break}case mt.ConstrainedHigh:{n="640c";break}case mt.High:{n="6400";break}case mt.PredictiveHigh444:{n="f400";break}default:{ei.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`);return}}let t=e.level.toString(16);return t.length===1&&(t=`0${t}`),`${n}${t}`}function Jj(e){switch(e){case mt.ConstrainedBaseline:return"ConstrainedBaseline";case mt.Baseline:return"Baseline";case mt.Main:return"Main";case mt.ConstrainedHigh:return"ConstrainedHigh";case mt.High:return"High";case mt.PredictiveHigh444:return"PredictiveHigh444";default:{ei.warn(`profileToString() | unrecognized profile ${e}`);return}}}function Zj(e){switch(e){case fe.L1_b:return"1b";case fe.L1:return"1";case fe.L1_1:return"1.1";case fe.L1_2:return"1.2";case fe.L1_3:return"1.3";case fe.L2:return"2";case fe.L2_1:return"2.1";case fe.L2_2:return"2.2";case fe.L3:return"3";case fe.L3_1:return"3.1";case fe.L3_2:return"3.2";case fe.L4:return"4";case fe.L4_1:return"4.1";case fe.L4_2:return"4.2";case fe.L5:return"5";case fe.L5_1:return"5.1";case fe.L5_2:return"5.2";default:{ei.warn(`levelToString() | unrecognized level ${e}`);return}}}function $a(e={}){const n=e["profile-level-id"];return n?wE(n):Qj}function e$(e={},n={}){const t=$a(e),r=$a(n);return!!(t&&r&&t.profile===r.profile)}function t$(e={},n={}){const t=$a(e),r=$a(n);return!!(t&&r&&t.profile===r.profile&&t.level==r.level)}function n$(e={},n={}){if(!e["profile-level-id"]&&!n["profile-level-id"]){ei.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const t=$a(e),r=$a(n);if(!t)throw new TypeError("invalid local_profile_level_id");if(!r)throw new TypeError("invalid remote_profile_level_id");if(t.profile!==r.profile)throw new TypeError("H264 Profile mismatch");const i=Rx(e)&&Rx(n),o=t.level,a=r.level,s=o$(o,a),c=i?o:s;return ei.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${t.profile}, level:${c}]`),bE(new If(t.profile,c))}function r$(e,n){for(let r=Sx.length-1;r>=0;--r){const i=Sx[r];if(i.max_macroblock_frame_size*256<=e&&i.max_macroblocks_per_second<=n*i.max_macroblock_frame_size)return ei.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${n}, level:${i.level}]`),i.level}ei.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${n}]`)}function Cx(e,n){return+(n[0]===e)<<7|+(n[1]===e)<<6|+(n[2]===e)<<5|+(n[3]===e)<<4|+(n[4]===e)<<3|+(n[5]===e)<<2|+(n[6]===e)<<1|+(n[7]===e)<<0}function i$(e,n){return e===fe.L1_b?n!==fe.L1&&n!==fe.L1_b:n===fe.L1_b?e!==fe.L1:e<n}function o$(e,n){return i$(e,n)?e:n}function Rx(e={}){const n=e["level-asymmetry-allowed"];return n===!0||n===1||n==="1"}Object.defineProperty(dt,"__esModule",{value:!0});dt.validateRtpCapabilities=l$;dt.validateRtpParameters=W0;dt.validateSctpStreamParameters=d$;dt.validateSctpCapabilities=p$;dt.getExtendedRtpCapabilities=f$;dt.getRecvRtpCapabilities=h$;dt.getSendingRtpParameters=m$;dt.getSendingRemoteRtpParameters=g$;dt.reduceCodecs=v$;dt.generateProbatorRtpParameters=y$;dt.canSend=w$;dt.canReceive=b$;const kx=vn,a$=Pt,s$="probator",c$=1234,u$=127;function l$(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const n of e.codecs)x$(n);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const n of e.headerExtensions)_$(n)}function W0(e){if(typeof e!="object")throw new TypeError("params is not an object");if(e.mid&&typeof e.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const n of e.codecs)S$(n);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const n of e.headerExtensions)C$(n);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const n of e.encodings)R$(n);if(e.rtcp&&typeof e.rtcp!="object")throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),k$(e.rtcp)}function d$(e){if(typeof e!="object")throw new TypeError("params is not an object");if(typeof e.streamId!="number")throw new TypeError("missing params.streamId");let n=!1;if(typeof e.ordered=="boolean"?n=!0:e.ordered=!0,e.maxPacketLifeTime&&typeof e.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&typeof e.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(n&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!n&&(e.maxPacketLifeTime||e.maxRetransmits)&&(e.ordered=!1),e.label&&typeof e.label!="string")throw new TypeError("invalid params.label");if(e.protocol&&typeof e.protocol!="string")throw new TypeError("invalid params.protocol")}function p$(e){if(typeof e!="object")throw new TypeError("caps is not an object");if(!e.numStreams||typeof e.numStreams!="object")throw new TypeError("missing caps.numStreams");E$(e.numStreams)}function f$(e,n){const t={codecs:[],headerExtensions:[]};for(const r of n.codecs??[]){if(_u(r))continue;const i=(e.codecs??[]).find(a=>_E(a,r,{strict:!0,modify:!0}));if(!i)continue;const o={mimeType:i.mimeType,kind:i.kind,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:r.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:i.parameters,remoteParameters:r.parameters,rtcpFeedback:D$(i,r)};t.codecs.push(o)}for(const r of t.codecs){const i=e.codecs.find(a=>_u(a)&&a.parameters.apt===r.localPayloadType),o=n.codecs.find(a=>_u(a)&&a.parameters.apt===r.remotePayloadType);i&&o&&(r.localRtxPayloadType=i.preferredPayloadType,r.remoteRtxPayloadType=o.preferredPayloadType)}for(const r of n.headerExtensions){const i=e.headerExtensions.find(a=>T$(a,r));if(!i)continue;const o={kind:r.kind,uri:r.uri,sendId:i.preferredId,recvId:r.preferredId,encrypt:i.preferredEncrypt,direction:"sendrecv"};switch(r.direction){case"sendrecv":{o.direction="sendrecv";break}case"recvonly":{o.direction="sendonly";break}case"sendonly":{o.direction="recvonly";break}case"inactive":{o.direction="inactive";break}}t.headerExtensions.push(o)}return t}function h$(e){const n={codecs:[],headerExtensions:[]};for(const t of e.codecs){const r={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(n.codecs.push(r),!t.remoteRtxPayloadType)continue;const i={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};n.codecs.push(i)}for(const t of e.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;const r={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};n.headerExtensions.push(r)}return n}function m$(e,n){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of n.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(i),r.localRtxPayloadType){const o={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(o)}}for(const r of n.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(i)}return t}function g$(e,n){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const r of n.codecs){if(r.kind!==e)continue;const i={mimeType:r.mimeType,payloadType:r.localPayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.remoteParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(i),r.localRtxPayloadType){const o={mimeType:`${r.kind}/rtx`,payloadType:r.localRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.localPayloadType},rtcpFeedback:[]};t.codecs.push(o)}}for(const r of n.headerExtensions){if(r.kind&&r.kind!==e||r.direction!=="sendrecv"&&r.direction!=="sendonly")continue;const i={uri:r.uri,id:r.sendId,encrypt:r.encrypt,parameters:{}};t.headerExtensions.push(i)}if(t.headerExtensions.some(r=>r.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="goog-remb");else if(t.headerExtensions.some(r=>r.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc");else for(const r of t.codecs)r.rtcpFeedback=(r.rtcpFeedback??[]).filter(i=>i.type!=="transport-cc"&&i.type!=="goog-remb");return t}function v$(e,n){const t=[];if(!n)t.push(e[0]),_u(e[1])&&t.push(e[1]);else{for(let r=0;r<e.length;++r)if(_E(e[r],n,{strict:!0})){t.push(e[r]),_u(e[r+1])&&t.push(e[r+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}return t}function y$(e){e=a$.clone(e),W0(e);const n={mid:s$,codecs:[],headerExtensions:[],encodings:[{ssrc:c$}],rtcp:{cname:"probator"}};return n.codecs.push(e.codecs[0]),n.codecs[0].payloadType=u$,n.headerExtensions=e.headerExtensions,n}function w$(e,n){return n.codecs.some(t=>t.kind===e)}function b$(e,n){if(W0(e),e.codecs.length===0)return!1;const t=e.codecs[0];return n.codecs.some(r=>r.remotePayloadType===t.payloadType)}function x$(e){const n=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=n.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(e.kind=t[1].toLowerCase(),e.preferredPayloadType&&typeof e.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");e.kind==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const r of Object.keys(e.parameters)){let i=e.parameters[r];if(i===void 0&&(e.parameters[r]="",i=""),typeof i!="string"&&typeof i!="number")throw new TypeError(`invalid codec parameter [key:${r}s, value:${i}]`);if(r==="apt"&&typeof i!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const r of e.rtcpFeedback)xE(r)}function xE(e){if(typeof e!="object")throw new TypeError("fb is not an object");if(!e.type||typeof e.type!="string")throw new TypeError("missing fb.type");(!e.parameter||typeof e.parameter!="string")&&(e.parameter="")}function _$(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(e.kind!=="audio"&&e.kind!=="video")throw new TypeError("invalid ext.kind");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.preferredId!="number")throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&typeof e.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&typeof e.direction!="string")throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function S$(e){const n=new RegExp("^(audio|video)/(.+)","i");if(typeof e!="object")throw new TypeError("codec is not an object");if(!e.mimeType||typeof e.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=n.exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof e.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof e.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof e.channels!="number"&&(e.channels=1):delete e.channels,(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const i of Object.keys(e.parameters)){let o=e.parameters[i];if(o===void 0&&(e.parameters[i]="",o=""),typeof o!="string"&&typeof o!="number")throw new TypeError(`invalid codec parameter [key:${i}s, value:${o}]`);if(i==="apt"&&typeof o!="number")throw new TypeError("invalid codec apt parameter")}(!e.rtcpFeedback||!Array.isArray(e.rtcpFeedback))&&(e.rtcpFeedback=[]);for(const i of e.rtcpFeedback)xE(i)}function C$(e){if(typeof e!="object")throw new TypeError("ext is not an object");if(!e.uri||typeof e.uri!="string")throw new TypeError("missing ext.uri");if(typeof e.id!="number")throw new TypeError("missing ext.id");if(e.encrypt&&typeof e.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),(!e.parameters||typeof e.parameters!="object")&&(e.parameters={});for(const n of Object.keys(e.parameters)){let t=e.parameters[n];if(t===void 0&&(e.parameters[n]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}function R$(e){if(typeof e!="object")throw new TypeError("encoding is not an object");if(e.ssrc&&typeof e.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(e.rid&&typeof e.rid!="string")throw new TypeError("invalid encoding.rid");if(e.rtx&&typeof e.rtx!="object")throw new TypeError("invalid encoding.rtx");if(e.rtx&&typeof e.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!e.dtx||typeof e.dtx!="boolean")&&(e.dtx=!1),e.scalabilityMode&&typeof e.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function k$(e){if(typeof e!="object")throw new TypeError("rtcp is not an object");if(e.cname&&typeof e.cname!="string")throw new TypeError("invalid rtcp.cname");(!e.reducedSize||typeof e.reducedSize!="boolean")&&(e.reducedSize=!0)}function E$(e){if(typeof e!="object")throw new TypeError("numStreams is not an object");if(typeof e.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof e.MIS!="number")throw new TypeError("missing numStreams.MIS")}function _u(e){return e?/.+\/rtx$/i.test(e.mimeType):!1}function _E(e,n,{strict:t=!1,modify:r=!1}={}){const i=e.mimeType.toLowerCase(),o=n.mimeType.toLowerCase();if(i!==o||e.clockRate!==n.clockRate||e.channels!==n.channels)return!1;switch(i){case"video/h264":{if(t){const a=e.parameters["packetization-mode"]??0,s=n.parameters["packetization-mode"]??0;if(a!==s||!kx.isSameProfile(e.parameters,n.parameters))return!1;let c;try{c=kx.generateProfileLevelIdStringForAnswer(e.parameters,n.parameters)}catch{return!1}r&&(c?(e.parameters["profile-level-id"]=c,n.parameters["profile-level-id"]=c):(delete e.parameters["profile-level-id"],delete n.parameters["profile-level-id"]))}break}case"video/vp9":{if(t){const a=e.parameters["profile-id"]??0,s=n.parameters["profile-id"]??0;if(a!==s)return!1}break}}return!0}function T$(e,n){return!(e.kind&&n.kind&&e.kind!==n.kind||e.uri!==n.uri)}function D$(e,n){const t=[];for(const r of e.rtcpFeedback??[]){const i=(n.rtcpFeedback??[]).find(o=>o.type===r.type&&(o.parameter===r.parameter||!o.parameter&&!r.parameter));i&&t.push(i)}return t}var ll={},SE={},Pf={},Af={};Object.defineProperty(Af,"__esModule",{value:!0});Af.Logger=void 0;const hs=Ef,ms="awaitqueue";class I${constructor(n){N(this,"_debug");N(this,"_warn");N(this,"_error");n?(this._debug=hs(`${ms}:${n}`),this._warn=hs(`${ms}:WARN:${n}`),this._error=hs(`${ms}:ERROR:${n}`)):(this._debug=hs(ms),this._warn=hs(`${ms}:WARN`),this._error=hs(`${ms}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Af.Logger=I$;var Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});Ua.AwaitQueueRemovedTaskError=Ua.AwaitQueueStoppedError=void 0;class V0 extends Error{constructor(n){super(n??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,V0)}}Ua.AwaitQueueStoppedError=V0;class H0 extends Error{constructor(n){super(n??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,H0)}}Ua.AwaitQueueRemovedTaskError=H0;Object.defineProperty(Pf,"__esModule",{value:!0});Pf.AwaitQueue=void 0;const P$=Af,Ex=Ua,Zi=new P$.Logger("AwaitQueue");class A${constructor(){N(this,"pendingTasks",new Map);N(this,"nextTaskId",0);N(this,"stopping",!1);Zi.debug("constructor()")}get size(){return this.pendingTasks.size}async push(n,t){if(t=t??n.name,Zi.debug(`push() [name:${t}]`),typeof n!="function")throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(n,"name",{value:t})}catch{}return new Promise((r,i)=>{const o={id:this.nextTaskId++,task:n,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:a=>{if(o.completed)return;o.completed=!0,this.pendingTasks.delete(o.id),Zi.debug(`resolving task [name:${o.name}]`),r(a);const[s]=this.pendingTasks.values();s&&!s.executedAt&&this.execute(s)},reject:a=>{if(!o.completed&&(o.completed=!0,this.pendingTasks.delete(o.id),Zi.debug(`rejecting task [name:${o.name}]: %s`,String(a)),i(a),!this.stopping)){const[s]=this.pendingTasks.values();s&&!s.executedAt&&this.execute(s)}}};this.pendingTasks.set(o.id,o),this.pendingTasks.size===1&&this.execute(o)})}stop(){Zi.debug("stop()"),this.stopping=!0;for(const n of this.pendingTasks.values())Zi.debug(`stop() | stopping task [name:${n.name}]`),n.reject(new Ex.AwaitQueueStoppedError);this.stopping=!1}remove(n){Zi.debug(`remove() [taskIdx:${n}]`);const t=Array.from(this.pendingTasks.values())[n];if(!t){Zi.debug(`stop() | no task with given idx [taskIdx:${n}]`);return}t.reject(new Ex.AwaitQueueRemovedTaskError)}dump(){const n=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:n-r.enqueuedAt,executionTime:r.executedAt?n-r.executedAt:0}))}async execute(n){if(Zi.debug(`execute() [name:${n.name}]`),n.executedAt)throw new Error("task already being executed");n.executedAt=Date.now();try{const t=await n.task();n.resolve(t)}catch(t){n.reject(t)}}}Pf.AwaitQueue=A$;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var n=Pf;Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return n.AwaitQueue}});var t=Ua;Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return t.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return t.AwaitQueueRemovedTaskError}})})(SE);var dl={};Object.defineProperty(dl,"__esModule",{value:!0});dl.Producer=void 0;const N$=Ct,Tx=oi,gs=jt,li=new N$.Logger("Producer");class M$ extends Tx.EnhancedEventEmitter{constructor({id:t,localId:r,rtpSender:i,track:o,rtpParameters:a,stopTracks:s,disableTrackOnPause:c,zeroRtpOnPause:u,appData:l}){super();N(this,"_id");N(this,"_localId");N(this,"_closed",!1);N(this,"_rtpSender");N(this,"_track");N(this,"_kind");N(this,"_rtpParameters");N(this,"_paused");N(this,"_maxSpatialLayer");N(this,"_stopTracks");N(this,"_disableTrackOnPause");N(this,"_zeroRtpOnPause");N(this,"_appData");N(this,"_observer",new Tx.EnhancedEventEmitter);li.debug("constructor()"),this._id=t,this._localId=r,this._rtpSender=i,this._track=o,this._kind=o.kind,this._rtpParameters=a,this._paused=c?!o.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=s,this._disableTrackOnPause=c,this._zeroRtpOnPause=u,this._appData=l??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(t){this._appData=t}get observer(){return this._observer}close(){this._closed||(li.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(li.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new gs.InvalidStateError("closed");return new Promise((t,r)=>{this.safeEmit("@getstats",t,r)})}pause(){if(li.debug("pause()"),this._closed){li.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((t,r)=>{this.safeEmit("@pause",t,r)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(li.debug("resume()"),this._closed){li.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((t,r)=>{this.safeEmit("@resume",t,r)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:t}){if(li.debug("replaceTrack() [track:%o]",t),this._closed){if(t&&this._stopTracks)try{t.stop()}catch{}throw new gs.InvalidStateError("closed")}else if(t&&t.readyState==="ended")throw new gs.InvalidStateError("track ended");if(t===this._track){li.debug("replaceTrack() | same track, ignored");return}await new Promise((r,i)=>{this.safeEmit("@replacetrack",t,r,i)}),this.destroyTrack(),this._track=t,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(t){if(this._closed)throw new gs.InvalidStateError("closed");if(this._kind!=="video")throw new gs.UnsupportedError("not a video Producer");if(typeof t!="number")throw new TypeError("invalid spatialLayer");t!==this._maxSpatialLayer&&(await new Promise((r,i)=>{this.safeEmit("@setmaxspatiallayer",t,r,i)}).catch(()=>{}),this._maxSpatialLayer=t)}async setRtpEncodingParameters(t){if(this._closed)throw new gs.InvalidStateError("closed");if(typeof t!="object")throw new TypeError("invalid params");await new Promise((r,i)=>{this.safeEmit("@setrtpencodingparameters",t,r,i)})}onTrackEnded(){li.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}dl.Producer=M$;var pl={};Object.defineProperty(pl,"__esModule",{value:!0});pl.Consumer=void 0;const L$=Ct,Dx=oi,O$=jt,di=new L$.Logger("Consumer");class F$ extends Dx.EnhancedEventEmitter{constructor({id:t,localId:r,producerId:i,rtpReceiver:o,track:a,rtpParameters:s,appData:c}){super();N(this,"_id");N(this,"_localId");N(this,"_producerId");N(this,"_closed",!1);N(this,"_rtpReceiver");N(this,"_track");N(this,"_rtpParameters");N(this,"_paused");N(this,"_appData");N(this,"_observer",new Dx.EnhancedEventEmitter);di.debug("constructor()"),this._id=t,this._localId=r,this._producerId=i,this._rtpReceiver=o,this._track=a,this._rtpParameters=s,this._paused=!a.enabled,this._appData=c??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(t){this._appData=t}get observer(){return this._observer}close(){this._closed||(di.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(di.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new O$.InvalidStateError("closed");return new Promise((t,r)=>{this.safeEmit("@getstats",t,r)})}pause(){if(di.debug("pause()"),this._closed){di.error("pause() | Consumer closed");return}if(this._paused){di.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(di.debug("resume()"),this._closed){di.error("resume() | Consumer closed");return}if(!this._paused){di.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){di.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}pl.Consumer=F$;var fl={};Object.defineProperty(fl,"__esModule",{value:!0});fl.DataProducer=void 0;const B$=Ct,Ix=oi,z$=jt,eo=new B$.Logger("DataProducer");class j$ extends Ix.EnhancedEventEmitter{constructor({id:t,dataChannel:r,sctpStreamParameters:i,appData:o}){super();N(this,"_id");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new Ix.EnhancedEventEmitter);eo.debug("constructor()"),this._id=t,this._dataChannel=r,this._sctpStreamParameters=i,this._appData=o??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(t){this._dataChannel.bufferedAmountLowThreshold=t}get appData(){return this._appData}set appData(t){this._appData=t}get observer(){return this._observer}close(){this._closed||(eo.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(eo.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(t){if(eo.debug("send()"),this._closed)throw new z$.InvalidStateError("closed");this._dataChannel.send(t)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(eo.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(this._closed)return;let{error:r}=t;r||(r=new Error("unknown DataChannel error")),r.errorDetail==="sctp-failure"?eo.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):eo.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(eo.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||eo.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}fl.DataProducer=j$;var hl={};Object.defineProperty(hl,"__esModule",{value:!0});hl.DataConsumer=void 0;const $$=Ct,Px=oi,ya=new $$.Logger("DataConsumer");class U$ extends Px.EnhancedEventEmitter{constructor({id:t,dataProducerId:r,dataChannel:i,sctpStreamParameters:o,appData:a}){super();N(this,"_id");N(this,"_dataProducerId");N(this,"_dataChannel");N(this,"_closed",!1);N(this,"_sctpStreamParameters");N(this,"_appData");N(this,"_observer",new Px.EnhancedEventEmitter);ya.debug("constructor()"),this._id=t,this._dataProducerId=r,this._dataChannel=i,this._sctpStreamParameters=o,this._appData=a??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(t){this._dataChannel.binaryType=t}get appData(){return this._appData}set appData(t){this._appData=t}get observer(){return this._observer}close(){this._closed||(ya.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(ya.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(ya.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(this._closed)return;let{error:r}=t;r||(r=new Error("unknown DataChannel error")),r.errorDetail==="sctp-failure"?ya.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",r.sctpCauseCode,r.message):ya.error('DataChannel "error" event: %o',r),this.safeEmit("error",r)}),this._dataChannel.addEventListener("close",()=>{this._closed||(ya.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",t=>{this._closed||this.safeEmit("message",t.data)})}}hl.DataConsumer=U$;Object.defineProperty(ll,"__esModule",{value:!0});ll.Transport=void 0;const W$=SE,V$=Ct,Ax=oi,Gt=jt,km=Pt,Zc=dt,H$=dl,G$=pl,q$=fl,K$=hl,Ft=new V$.Logger("Transport");class X${constructor(n){N(this,"consumerOptions");N(this,"promise");N(this,"resolve");N(this,"reject");this.consumerOptions=n,this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}}class Q$ extends Ax.EnhancedEventEmitter{constructor({direction:t,id:r,iceParameters:i,iceCandidates:o,dtlsParameters:a,sctpParameters:s,iceServers:c,iceTransportPolicy:u,additionalSettings:l,proprietaryConstraints:d,appData:p,handlerFactory:f,extendedRtpCapabilities:m,canProduceByKind:g}){super();N(this,"_id");N(this,"_closed",!1);N(this,"_direction");N(this,"_extendedRtpCapabilities");N(this,"_canProduceByKind");N(this,"_maxSctpMessageSize");N(this,"_handler");N(this,"_iceGatheringState","new");N(this,"_connectionState","new");N(this,"_appData");N(this,"_producers",new Map);N(this,"_consumers",new Map);N(this,"_dataProducers",new Map);N(this,"_dataConsumers",new Map);N(this,"_probatorConsumerCreated",!1);N(this,"_awaitQueue",new W$.AwaitQueue);N(this,"_pendingConsumerTasks",[]);N(this,"_consumerCreationInProgress",!1);N(this,"_pendingPauseConsumers",new Map);N(this,"_consumerPauseInProgress",!1);N(this,"_pendingResumeConsumers",new Map);N(this,"_consumerResumeInProgress",!1);N(this,"_pendingCloseConsumers",new Map);N(this,"_consumerCloseInProgress",!1);N(this,"_observer",new Ax.EnhancedEventEmitter);Ft.debug("constructor() [id:%s, direction:%s]",r,t),this._id=r,this._direction=t,this._extendedRtpCapabilities=m,this._canProduceByKind=g,this._maxSctpMessageSize=s?s.maxMessageSize:null;const v=km.clone(l)??{};delete v.iceServers,delete v.iceTransportPolicy,delete v.bundlePolicy,delete v.rtcpMuxPolicy,delete v.sdpSemantics,this._handler=f(),this._handler.run({direction:t,iceParameters:i,iceCandidates:o,dtlsParameters:a,sctpParameters:s,iceServers:c,iceTransportPolicy:u,additionalSettings:v,proprietaryConstraints:d,extendedRtpCapabilities:m}),this._appData=p??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(t){this._appData=t}get observer(){return this._observer}close(){if(!this._closed){Ft.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const t of this._producers.values())t.transportClosed();this._producers.clear();for(const t of this._consumers.values())t.transportClosed();this._consumers.clear();for(const t of this._dataProducers.values())t.transportClosed();this._dataProducers.clear();for(const t of this._dataConsumers.values())t.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new Gt.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:t}){if(Ft.debug("restartIce()"),this._closed)throw new Gt.InvalidStateError("closed");if(!t)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(t),"transport.restartIce()")}async updateIceServers({iceServers:t}={}){if(Ft.debug("updateIceServers()"),this._closed)throw new Gt.InvalidStateError("closed");if(!Array.isArray(t))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(t),"transport.updateIceServers()")}async produce({track:t,encodings:r,codecOptions:i,codec:o,stopTracks:a=!0,disableTrackOnPause:s=!0,zeroRtpOnPause:c=!1,onRtpSender:u,appData:l={}}={}){if(Ft.debug("produce() [track:%o]",t),this._closed)throw new Gt.InvalidStateError("closed");if(t){if(this._direction!=="send")throw new Gt.UnsupportedError("not a sending Transport");if(this._canProduceByKind[t.kind]){if(t.readyState==="ended")throw new Gt.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(l&&typeof l!="object")throw new TypeError("if given, appData must be an object")}else throw new Gt.UnsupportedError(`cannot produce ${t.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let d;if(r&&!Array.isArray(r))throw TypeError("encodings must be an array");r&&r.length===0?d=void 0:r&&(d=r.map(g=>{const v={active:!0};return g.active===!1&&(v.active=!1),typeof g.dtx=="boolean"&&(v.dtx=g.dtx),typeof g.scalabilityMode=="string"&&(v.scalabilityMode=g.scalabilityMode),typeof g.scaleResolutionDownBy=="number"&&(v.scaleResolutionDownBy=g.scaleResolutionDownBy),typeof g.maxBitrate=="number"&&(v.maxBitrate=g.maxBitrate),typeof g.maxFramerate=="number"&&(v.maxFramerate=g.maxFramerate),typeof g.adaptivePtime=="boolean"&&(v.adaptivePtime=g.adaptivePtime),typeof g.priority=="string"&&(v.priority=g.priority),typeof g.networkPriority=="string"&&(v.networkPriority=g.networkPriority),v}));const{localId:p,rtpParameters:f,rtpSender:m}=await this._handler.send({track:t,encodings:d,codecOptions:i,codec:o,onRtpSender:u});try{Zc.validateRtpParameters(f);const{id:g}=await new Promise((h,w)=>{this.safeEmit("produce",{kind:t.kind,rtpParameters:f,appData:l},h,w)}),v=new H$.Producer({id:g,localId:p,rtpSender:m,track:t,rtpParameters:f,stopTracks:a,disableTrackOnPause:s,zeroRtpOnPause:c,appData:l});return this._producers.set(v.id,v),this.handleProducer(v),this._observer.safeEmit("newproducer",v),v}catch(g){throw this._handler.stopSending(p).catch(()=>{}),g}},"transport.produce()").catch(d=>{if(a)try{t.stop()}catch{}throw d})}async consume({id:t,producerId:r,kind:i,rtpParameters:o,streamId:a,onRtpReceiver:s,appData:c={}}){if(Ft.debug("consume()"),this._closed)throw new Gt.InvalidStateError("closed");if(this._direction!=="recv")throw new Gt.UnsupportedError("not a receiving Transport");if(typeof t!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(i!=="audio"&&i!=="video")throw new TypeError(`invalid kind '${i}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(c&&typeof c!="object")throw new TypeError("if given, appData must be an object");const u=km.clone(o);if(!Zc.canReceive(u,this._extendedRtpCapabilities))throw new Gt.UnsupportedError("cannot consume this Producer");const d=new X$({id:t,producerId:r,kind:i,rtpParameters:u,streamId:a,onRtpReceiver:s,appData:c});return this._pendingConsumerTasks.push(d),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),d.promise}async produceData({ordered:t=!0,maxPacketLifeTime:r,maxRetransmits:i,label:o="",protocol:a="",appData:s={}}={}){if(Ft.debug("produceData()"),this._closed)throw new Gt.InvalidStateError("closed");if(this._direction!=="send")throw new Gt.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(s&&typeof s!="object")throw new TypeError("if given, appData must be an object")}else throw new Gt.UnsupportedError("SCTP not enabled by remote Transport");return(r||i)&&(t=!1),this._awaitQueue.push(async()=>{const{dataChannel:c,sctpStreamParameters:u}=await this._handler.sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a});Zc.validateSctpStreamParameters(u);const{id:l}=await new Promise((p,f)=>{this.safeEmit("producedata",{sctpStreamParameters:u,label:o,protocol:a,appData:s},p,f)}),d=new q$.DataProducer({id:l,dataChannel:c,sctpStreamParameters:u,appData:s});return this._dataProducers.set(d.id,d),this.handleDataProducer(d),this._observer.safeEmit("newdataproducer",d),d},"transport.produceData()")}async consumeData({id:t,dataProducerId:r,sctpStreamParameters:i,label:o="",protocol:a="",appData:s={}}){if(Ft.debug("consumeData()"),this._closed)throw new Gt.InvalidStateError("closed");if(this._direction!=="recv")throw new Gt.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof t!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(s&&typeof s!="object")throw new TypeError("if given, appData must be an object")}else throw new Gt.UnsupportedError("SCTP not enabled by remote Transport");const c=km.clone(i);return Zc.validateSctpStreamParameters(c),this._awaitQueue.push(async()=>{const{dataChannel:u}=await this._handler.receiveDataChannel({sctpStreamParameters:c,label:o,protocol:a}),l=new K$.DataConsumer({id:t,dataProducerId:r,dataChannel:u,sctpStreamParameters:c,appData:s});return this._dataConsumers.set(l.id,l),this.handleDataConsumer(l),this._observer.safeEmit("newdataconsumer",l),l},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){Ft.debug("createPendingConsumers() | there is no Consumer to be created");return}const t=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let r;const i=[];for(const o of t){const{id:a,kind:s,rtpParameters:c,streamId:u,onRtpReceiver:l}=o.consumerOptions;i.push({trackId:a,kind:s,rtpParameters:c,streamId:u,onRtpReceiver:l})}try{const o=await this._handler.receive(i);for(let a=0;a<o.length;++a){const s=t[a],c=o[a],{id:u,producerId:l,kind:d,rtpParameters:p,appData:f}=s.consumerOptions,{localId:m,rtpReceiver:g,track:v}=c,h=new G$.Consumer({id:u,localId:m,producerId:l,rtpReceiver:g,track:v,rtpParameters:p,appData:f});this._consumers.set(h.id,h),this.handleConsumer(h),!this._probatorConsumerCreated&&!r&&d==="video"&&(r=h),this._observer.safeEmit("newconsumer",h),s.resolve(h)}}catch(o){for(const a of t)a.reject(o)}if(r)try{const o=Zc.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:o}]),Ft.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(o){Ft.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",o)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){Ft.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const t=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=t.map(i=>i.localId);await this._handler.pauseReceiving(r)}catch(r){Ft.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){Ft.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const t=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=t.map(i=>i.localId);await this._handler.resumeReceiving(r)}catch(r){Ft.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){Ft.debug("closePendingConsumers() | there is no Consumer to be closed");return}const t=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(t.map(r=>r.localId))}catch(r){Ft.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const t=this._handler;t.on("@connect",({dtlsParameters:r},i,o)=>{if(this._closed){o(new Gt.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:r},i,o)}),t.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(Ft.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),t.on("@icecandidateerror",r=>{Ft.warn(`ICE candidate error [url:${r.url}, localAddress:${r.address}, localPort:${r.port}]: ${r.errorCode} "${r.errorText}"`),this.safeEmit("icecandidateerror",r)}),t.on("@connectionstatechange",r=>{r!==this._connectionState&&(Ft.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(t){t.on("@close",()=>{this._producers.delete(t.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(t.localId),"producer @close event").catch(r=>Ft.warn("producer.close() failed:%o",r))}),t.on("@pause",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(t.localId),"producer @pause event").then(r).catch(i)}),t.on("@resume",(r,i)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(t.localId),"producer @resume event").then(r).catch(i)}),t.on("@replacetrack",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(t.localId,r),"producer @replacetrack event").then(i).catch(o)}),t.on("@setmaxspatiallayer",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(t.localId,r),"producer @setmaxspatiallayer event").then(i).catch(o)}),t.on("@setrtpencodingparameters",(r,i,o)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(t.localId,r),"producer @setrtpencodingparameters event").then(i).catch(o)}),t.on("@getstats",(r,i)=>{if(this._closed)return i(new Gt.InvalidStateError("closed"));this._handler.getSenderStats(t.localId).then(r).catch(i)})}handleConsumer(t){t.on("@close",()=>{this._consumers.delete(t.id),this._pendingPauseConsumers.delete(t.id),this._pendingResumeConsumers.delete(t.id),!this._closed&&(this._pendingCloseConsumers.set(t.id,t),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),t.on("@pause",()=>{this._pendingResumeConsumers.has(t.id)&&this._pendingResumeConsumers.delete(t.id),this._pendingPauseConsumers.set(t.id,t),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),t.on("@resume",()=>{this._pendingPauseConsumers.has(t.id)&&this._pendingPauseConsumers.delete(t.id),this._pendingResumeConsumers.set(t.id,t),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),t.on("@getstats",(r,i)=>{if(this._closed)return i(new Gt.InvalidStateError("closed"));this._handler.getReceiverStats(t.localId).then(r).catch(i)})}handleDataProducer(t){t.on("@close",()=>{this._dataProducers.delete(t.id)})}handleDataConsumer(t){t.on("@close",()=>{this._dataConsumers.delete(t.id)})}}ll.Transport=Q$;var Nf={},At={},CE={},RE={exports:{}},Nx=RE.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(Nx).forEach(function(e){var n=Nx[e];n.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})});var G0=RE.exports;(function(e){var n=function(s){return String(Number(s))===s?Number(s):s},t=function(s,c,u,l){if(l&&!u)c[l]=n(s[1]);else for(var d=0;d<u.length;d+=1)s[d+1]!=null&&(c[u[d]]=n(s[d+1]))},r=function(s,c,u){var l=s.name&&s.names;s.push&&!c[s.push]?c[s.push]=[]:l&&!c[s.name]&&(c[s.name]={});var d=s.push?{}:l?c[s.name]:c;t(u.match(s.reg),d,s.names,s.name),s.push&&c[s.push].push(d)},i=G0,o=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(s){var c={},u=[],l=c;return s.split(/(\r\n|\r|\n)/).filter(o).forEach(function(d){var p=d[0],f=d.slice(2);p==="m"&&(u.push({rtp:[],fmtp:[]}),l=u[u.length-1]);for(var m=0;m<(i[p]||[]).length;m+=1){var g=i[p][m];if(g.reg.test(f))return r(g,l,f)}}),c.media=u,c};var a=function(s,c){var u=c.split(/=(.+)/,2);return u.length===2?s[u[0]]=n(u[1]):u.length===1&&c.length>1&&(s[u[0]]=void 0),s};e.parseParams=function(s){return s.split(/;\s?/).reduce(a,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(s){return s.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(s){for(var c=[],u=s.split(" ").map(n),l=0;l<u.length;l+=3)c.push({component:u[l],ip:u[l+1],port:u[l+2]});return c},e.parseImageAttributes=function(s){return s.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(a,{})})},e.parseSimulcastStreamList=function(s){return s.split(";").map(function(c){return c.split(",").map(function(u){var l,d=!1;return u[0]!=="~"?l=n(u):(l=n(u.substring(1,u.length)),d=!0),{scid:l,paused:d}})})}})(CE);var Em=G0,Y$=/%[sdv%]/g,J$=function(e){var n=1,t=arguments,r=t.length;return e.replace(Y$,function(i){if(n>=r)return i;var o=t[n];switch(n+=1,i){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},eu=function(e,n,t){var r=n.format instanceof Function?n.format(n.push?t:t[n.name]):n.format,i=[e+"="+r];if(n.names)for(var o=0;o<n.names.length;o+=1){var a=n.names[o];n.name?i.push(t[n.name][a]):i.push(t[n.names[o]])}else i.push(t[n.name]);return J$.apply(null,i)},Z$=["v","o","s","i","u","e","p","c","b","t","r","z","a"],eU=["i","c","b","a"],tU=function(e,n){n=n||{},e.version==null&&(e.version=0),e.name==null&&(e.name=" "),e.media.forEach(function(o){o.payloads==null&&(o.payloads="")});var t=n.outerOrder||Z$,r=n.innerOrder||eU,i=[];return t.forEach(function(o){Em[o].forEach(function(a){a.name in e&&e[a.name]!=null?i.push(eu(o,a,e)):a.push in e&&e[a.push]!=null&&e[a.push].forEach(function(s){i.push(eu(o,a,s))})})}),e.media.forEach(function(o){i.push(eu("m",Em.m[0],o)),r.forEach(function(a){Em[a].forEach(function(s){s.name in o&&o[s.name]!=null?i.push(eu(a,s,o)):s.push in o&&o[s.push]!=null&&o[s.push].forEach(function(c){i.push(eu(a,s,c))})})})}),i.join(`\r
`)+`\r
`},Ya=CE,nU=tU,rU=G0;At.grammar=rU;At.write=nU;At.parse=Ya.parse;At.parseParams=Ya.parseParams;At.parseFmtpConfig=Ya.parseFmtpConfig;At.parsePayloads=Ya.parsePayloads;At.parseRemoteCandidates=Ya.parseRemoteCandidates;At.parseImageAttributes=Ya.parseImageAttributes;At.parseSimulcastStreamList=Ya.parseSimulcastStreamList;var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.extractRtpCapabilities=iU;Bn.extractDtlsParameters=oU;Bn.getCname=aU;Bn.applyCodecParameters=sU;const kE=At;function iU({sdpObject:e}){const n=new Map,t=[];let r=!1,i=!1;for(const a of e.media){const s=a.type;switch(s){case"audio":{if(r)continue;r=!0;break}case"video":{if(i)continue;i=!0;break}default:continue}for(const c of a.rtp){const u={kind:s,mimeType:`${s}/${c.codec}`,preferredPayloadType:c.payload,clockRate:c.rate,channels:c.encoding,parameters:{},rtcpFeedback:[]};n.set(u.preferredPayloadType,u)}for(const c of a.fmtp??[]){const u=kE.parseParams(c.config),l=n.get(c.payload);l&&(u!=null&&u.hasOwnProperty("profile-level-id")&&(u["profile-level-id"]=String(u["profile-level-id"])),l.parameters=u)}for(const c of a.rtcpFb??[]){const u={type:c.type,parameter:c.subtype};if(u.parameter||delete u.parameter,c.payload!=="*"){const l=n.get(c.payload);if(!l)continue;l.rtcpFeedback.push(u)}else for(const l of n.values())l.kind===s&&!/.+\/rtx$/i.test(l.mimeType)&&l.rtcpFeedback.push(u)}for(const c of a.ext??[]){if(c["encrypt-uri"])continue;const u={kind:s,uri:c.uri,preferredId:c.value};t.push(u)}}return{codecs:Array.from(n.values()),headerExtensions:t}}function oU({sdpObject:e}){let n=e.setup,t=e.fingerprint;if(!n||!t){const o=(e.media??[]).find(a=>a.port!==0);o&&(n??(n=o.setup),t??(t=o.fingerprint))}if(n){if(!t)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let r;switch(n){case"active":{r="client";break}case"passive":{r="server";break}case"actpass":{r="auto";break}}return{role:r,fingerprints:[{algorithm:t.type,value:t.hash}]}}function aU({offerMediaObject:e}){const n=(e.ssrcs??[]).find(t=>t.attribute==="cname");return n?n.value:""}function sU({offerRtpParameters:e,answerMediaObject:n}){for(const t of e.codecs){const r=t.mimeType.toLowerCase();if(r!=="audio/opus"||!(n.rtp??[]).find(s=>s.payload===t.payloadType))continue;n.fmtp=n.fmtp??[];let o=n.fmtp.find(s=>s.payload===t.payloadType);o||(o={payload:t.payloadType,config:""},n.fmtp.push(o));const a=kE.parseParams(o.config);switch(r){case"audio/opus":{const s=t.parameters["sprop-stereo"];s!==void 0&&(a.stereo=Number(s)?1:0);break}}o.config="";for(const s of Object.keys(a))o.config&&(o.config+=";"),o.config+=`${s}=${a[s]}`}}var Ui={};Object.defineProperty(Ui,"__esModule",{value:!0});Ui.getRtpEncodings=cU;Ui.addLegacySimulcast=uU;function cU({offerMediaObject:e}){const n=new Set;for(const i of e.ssrcs??[]){const o=i.id;n.add(o)}if(n.size===0)throw new Error("no a=ssrc lines found");const t=new Map;for(const i of e.ssrcGroups??[]){if(i.semantics!=="FID")continue;let[o,a]=i.ssrcs.split(/\s+/);o=Number(o),a=Number(a),n.has(o)&&(n.delete(o),n.delete(a),t.set(o,a))}for(const i of n)t.set(i,null);const r=[];for(const[i,o]of t){const a={ssrc:i};o&&(a.rtx={ssrc:o}),r.push(a)}return r}function uU({offerMediaObject:e,numStreams:n}){if(n<=1)throw new TypeError("numStreams must be greater than 1");const t=(e.ssrcs??[]).find(d=>d.attribute==="msid");if(!t)throw new Error("a=ssrc line with msid information not found");const[r,i]=t.value.split(" "),o=Number(t.id);let a;(e.ssrcGroups??[]).some(d=>{if(d.semantics!=="FID")return!1;const p=d.ssrcs.split(/\s+/);return Number(p[0])===o?(a=Number(p[1]),!0):!1});const s=e.ssrcs.find(d=>d.attribute==="cname");if(!s)throw new Error("a=ssrc line with cname information not found");const c=s.value,u=[],l=[];for(let d=0;d<n;++d)u.push(o+d),a&&l.push(a+d);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(const d of u)e.ssrcs.push({id:d,attribute:"cname",value:c}),e.ssrcs.push({id:d,attribute:"msid",value:`${r} ${i}`});for(let d=0;d<l.length;++d){const p=u[d],f=l[d];e.ssrcs.push({id:f,attribute:"cname",value:c}),e.ssrcs.push({id:f,attribute:"msid",value:`${r} ${i}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${f}`})}}var Ac={};Object.defineProperty(Ac,"__esModule",{value:!0});Ac.addNackSupportForOpus=lU;function lU(e){var n;for(const t of e.codecs??[])(t.mimeType.toLowerCase()==="audio/opus"||t.mimeType.toLowerCase()==="audio/multiopus")&&!((n=t.rtcpFeedback)!=null&&n.some(r=>r.type==="nack"&&!r.parameter))&&(t.rtcpFeedback||(t.rtcpFeedback=[]),t.rtcpFeedback.push({type:"nack"}))}var wn={};Object.defineProperty(wn,"__esModule",{value:!0});wn.HandlerInterface=void 0;const dU=oi;class pU extends dU.EnhancedEventEmitter{constructor(){super()}}wn.HandlerInterface=pU;var cr={},na={};Object.defineProperty(na,"__esModule",{value:!0});na.OfferMediaSection=na.AnswerMediaSection=na.MediaSection=void 0;const fU=At,Mx=Pt;class q0{constructor({iceParameters:n,iceCandidates:t,dtlsParameters:r,planB:i=!1}){N(this,"_mediaObject");N(this,"_planB");if(this._mediaObject={},this._planB=i,n&&this.setIceParameters(n),t){this._mediaObject.candidates=[];for(const o of t){const a={};a.component=1,a.foundation=o.foundation,a.ip=o.address??o.ip,a.port=o.port,a.priority=o.priority,a.transport=o.protocol,a.type=o.type,o.tcpType&&(a.tcptype=o.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(n){this._mediaObject.iceUfrag=n.usernameFragment,this._mediaObject.icePwd=n.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}na.MediaSection=q0;class hU extends q0{constructor({iceParameters:n,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:o,planB:a=!1,offerMediaObject:s,offerRtpParameters:c,answerRtpParameters:u,codecOptions:l}){switch(super({iceParameters:n,iceCandidates:t,dtlsParameters:r,planB:a}),this._mediaObject.mid=String(s.mid),this._mediaObject.type=s.type,this._mediaObject.protocol=s.protocol,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),s.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const d of u.codecs){const p={payload:d.payloadType,codec:Sv(d),rate:d.clockRate};d.channels>1&&(p.encoding=d.channels),this._mediaObject.rtp.push(p);const f=Mx.clone(d.parameters)??{};let m=Mx.clone(d.rtcpFeedback)??[];if(l){const{opusStereo:v,opusFec:h,opusDtx:w,opusMaxPlaybackRate:y,opusMaxAverageBitrate:b,opusPtime:x,opusNack:_,videoGoogleStartBitrate:C,videoGoogleMaxBitrate:R,videoGoogleMinBitrate:S}=l,E=c.codecs.find(T=>T.payloadType===d.payloadType);switch(d.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{v!==void 0&&(E.parameters["sprop-stereo"]=v?1:0,f.stereo=v?1:0),h!==void 0&&(E.parameters.useinbandfec=h?1:0,f.useinbandfec=h?1:0),w!==void 0&&(E.parameters.usedtx=w?1:0,f.usedtx=w?1:0),y!==void 0&&(f.maxplaybackrate=y),b!==void 0&&(f.maxaveragebitrate=b),x!==void 0&&(E.parameters.ptime=x,f.ptime=x),_||(E.rtcpFeedback=E.rtcpFeedback.filter(T=>T.type!=="nack"||T.parameter),m=m.filter(T=>T.type!=="nack"||T.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{C!==void 0&&(f["x-google-start-bitrate"]=C),R!==void 0&&(f["x-google-max-bitrate"]=R),S!==void 0&&(f["x-google-min-bitrate"]=S);break}}}const g={payload:d.payloadType,config:""};for(const v of Object.keys(f))g.config&&(g.config+=";"),g.config+=`${v}=${f[v]}`;g.config&&this._mediaObject.fmtp.push(g);for(const v of m)this._mediaObject.rtcpFb.push({payload:d.payloadType,type:v.type,subtype:v.parameter})}this._mediaObject.payloads=u.codecs.map(d=>d.payloadType).join(" "),this._mediaObject.ext=[];for(const d of u.headerExtensions)(s.ext??[]).some(f=>f.uri===d.uri)&&this._mediaObject.ext.push({uri:d.uri,value:d.id});if(s.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),s.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:s.simulcast.list1},this._mediaObject.rids=[];for(const d of s.rids??[])d.direction==="send"&&this._mediaObject.rids.push({id:d.id,direction:"recv"})}else if(s.simulcast_03){this._mediaObject.simulcast_03={value:s.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const d of s.rids??[])d.direction==="send"&&this._mediaObject.rids.push({id:d.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof s.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize):s.sctpmap&&(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize});break}}}setDtlsRole(n){switch(n){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(n){var o,a;if(!((o=this._mediaObject.simulcast)!=null&&o.list1))return;const t={};for(const s of n)s.rid&&(t[s.rid]=s);const r=this._mediaObject.simulcast.list1,i=fU.parseSimulcastStreamList(r);for(const s of i)for(const c of s)c.paused=!((a=t[c.scid])!=null&&a.active);this._mediaObject.simulcast.list1=i.map(s=>s.map(c=>`${c.paused?"~":""}${c.scid}`).join(",")).join(";")}}na.AnswerMediaSection=hU;class mU extends q0{constructor({iceParameters:n,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:o,planB:a=!1,mid:s,kind:c,offerRtpParameters:u,streamId:l,trackId:d,oldDataChannelSpec:p=!1}){var f;switch(super({iceParameters:n,iceCandidates:t,dtlsParameters:r,planB:a}),this._mediaObject.mid=String(s),this._mediaObject.type=c,o?(this._mediaObject.connection={ip:o.ip,version:o.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=o.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},i?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),c){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${l??"-"} ${d}`);for(const h of u.codecs){const w={payload:h.payloadType,codec:Sv(h),rate:h.clockRate};h.channels>1&&(w.encoding=h.channels),this._mediaObject.rtp.push(w);const y={payload:h.payloadType,config:""};for(const b of Object.keys(h.parameters))y.config&&(y.config+=";"),y.config+=`${b}=${h.parameters[b]}`;y.config&&this._mediaObject.fmtp.push(y);for(const b of h.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:h.payloadType,type:b.type,subtype:b.parameter})}this._mediaObject.payloads=u.codecs.map(h=>h.payloadType).join(" "),this._mediaObject.ext=[];for(const h of u.headerExtensions)this._mediaObject.ext.push({uri:h.uri,value:h.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const m=u.encodings[0],g=m.ssrc,v=(f=m.rtx)==null?void 0:f.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],u.rtcp.cname&&this._mediaObject.ssrcs.push({id:g,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:g,attribute:"msid",value:`${l??"-"} ${d}`}),v&&(u.rtcp.cname&&this._mediaObject.ssrcs.push({id:v,attribute:"cname",value:u.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:v,attribute:"msid",value:`${l??"-"} ${d}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${g} ${v}`}));break}case"application":{p?(this._mediaObject.payloads=i.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:i.port,maxMessageSize:i.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=i.port,this._mediaObject.maxMessageSize=i.maxMessageSize);break}}}setDtlsRole(n){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:n,streamId:t,trackId:r}){var c;const i=n.encodings[0],o=i.ssrc,a=(c=i.rtx)==null?void 0:c.ssrc,s=this._mediaObject.payloads.split(" ");for(const u of n.codecs){if(s.includes(String(u.payloadType)))continue;const l={payload:u.payloadType,codec:Sv(u),rate:u.clockRate};u.channels>1&&(l.encoding=u.channels),this._mediaObject.rtp.push(l);const d={payload:u.payloadType,config:""};for(const p of Object.keys(u.parameters))d.config&&(d.config+=";"),d.config+=`${p}=${u.parameters[p]}`;d.config&&this._mediaObject.fmtp.push(d);for(const p of u.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:u.payloadType,type:p.type,subtype:p.parameter})}this._mediaObject.payloads+=` ${n.codecs.filter(u=>!this._mediaObject.payloads.includes(u.payloadType)).map(u=>u.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),n.rtcp.cname&&this._mediaObject.ssrcs.push({id:o,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:o,attribute:"msid",value:`${t??"-"} ${r}`}),a&&(n.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:n.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t??"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${o} ${a}`}))}planBStopReceiving({offerRtpParameters:n}){var o;const t=n.encodings[0],r=t.ssrc,i=(o=t.rtx)==null?void 0:o.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(a=>a.id!==r&&a.id!==i),i&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(a=>a.ssrcs!==`${r} ${i}`))}}na.OfferMediaSection=mU;function Sv(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}Object.defineProperty(cr,"__esModule",{value:!0});cr.RemoteSdp=void 0;const gU=At,vU=Ct,rd=na,id=new vU.Logger("RemoteSdp");class yU{constructor({iceParameters:n,iceCandidates:t,dtlsParameters:r,sctpParameters:i,plainRtpParameters:o,planB:a=!1}){N(this,"_iceParameters");N(this,"_iceCandidates");N(this,"_dtlsParameters");N(this,"_sctpParameters");N(this,"_plainRtpParameters");N(this,"_planB");N(this,"_mediaSections",[]);N(this,"_midToIndex",new Map);N(this,"_firstMid");N(this,"_sdpObject");if(this._iceParameters=n,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=i,this._plainRtpParameters=o,this._planB=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},n!=null&&n.iceLite&&(this._sdpObject.icelite="ice-lite"),r){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const s=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:r.fingerprints[s-1].algorithm,hash:r.fingerprints[s-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}o&&(this._sdpObject.origin.address=o.ip,this._sdpObject.origin.ipVer=o.ipVersion)}updateIceParameters(n){id.debug("updateIceParameters() [iceParameters:%o]",n),this._iceParameters=n,this._sdpObject.icelite=n.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(n)}updateDtlsRole(n){id.debug("updateDtlsRole() [role:%s]",n),this._dtlsParameters.role=n;for(const t of this._mediaSections)t.setDtlsRole(n)}setSessionExtmapAllowMixed(){id.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let n=0;n<this._mediaSections.length;++n){const t=this._mediaSections[n];if(t.closed)return{idx:n,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:n,reuseMid:t,offerRtpParameters:r,answerRtpParameters:i,codecOptions:o}){const a=new rd.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:n,offerRtpParameters:r,answerRtpParameters:i,codecOptions:o});t?this._replaceMediaSection(a,t):this._midToIndex.has(a.mid)?this._replaceMediaSection(a):this._addMediaSection(a)}receive({mid:n,kind:t,offerRtpParameters:r,streamId:i,trackId:o}){const a=this._midToIndex.get(n);let s;if(a!==void 0&&(s=this._mediaSections[a]),s)s.planBReceive({offerRtpParameters:r,streamId:i,trackId:o}),this._replaceMediaSection(s);else{s=new rd.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:n,kind:t,offerRtpParameters:r,streamId:i,trackId:o});const c=this._mediaSections.find(u=>u.closed);c?this._replaceMediaSection(s,c.mid):this._addMediaSection(s)}}pauseMediaSection(n){this._findMediaSection(n).pause()}resumeSendingMediaSection(n){this._findMediaSection(n).resume()}resumeReceivingMediaSection(n){this._findMediaSection(n).resume()}disableMediaSection(n){this._findMediaSection(n).disable()}closeMediaSection(n){const t=this._findMediaSection(n);return n===this._firstMid?(id.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",n),this.disableMediaSection(n),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(n,t){const r=this._findMediaSection(n);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}planBStopReceiving({mid:n,offerRtpParameters:t}){const r=this._findMediaSection(n);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:n}){const t=new rd.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:n});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:n=!1}={}){const t=new rd.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:n});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,gU.write(this._sdpObject)}_addMediaSection(n){this._firstMid||(this._firstMid=n.mid),this._mediaSections.push(n),this._midToIndex.set(n.mid,this._mediaSections.length-1),this._sdpObject.media.push(n.getObject()),this._regenerateBundleMids()}_replaceMediaSection(n,t){if(typeof t=="string"){const r=this._midToIndex.get(t);if(r===void 0)throw new Error(`no media section found for reuseMid '${t}'`);const i=this._mediaSections[r];this._mediaSections[r]=n,this._midToIndex.delete(i.mid),this._midToIndex.set(n.mid,r),this._sdpObject.media[r]=n.getObject(),this._regenerateBundleMids()}else{const r=this._midToIndex.get(n.mid);if(r===void 0)throw new Error(`no media section found with mid '${n.mid}'`);this._mediaSections[r]=n,this._sdpObject.media[r]=n.getObject()}}_findMediaSection(n){const t=this._midToIndex.get(n);if(t===void 0)throw new Error(`no media section found with mid '${n}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(n=>!n.closed).map(n=>n.mid).join(" "))}}cr.RemoteSdp=yU;var Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.parse=bU;const wU=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function bU(e){const n=wU.exec(e??"");return n?{spatialLayers:Number(n[1]),temporalLayers:Number(n[2])}:{spatialLayers:1,temporalLayers:1}}Object.defineProperty(Nf,"__esModule",{value:!0});Nf.Chrome111=void 0;const Io=At,xU=Ct,Lx=Pt,vs=dt,od=Bn,Ox=Ui,_U=Ac,SU=jt,CU=wn,RU=cr,kU=Wi,Ce=new xU.Logger("Chrome111"),EU="Chrome111",Fx={OS:1024,MIS:1024};class K0 extends CU.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new K0}get name(){return EU}close(){if(Ce.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){Ce.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const i=Io.parse(r.sdp),o=od.extractRtpCapabilities({sdpObject:i});return _U.addNackSupportForOpus(o),o}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Ce.debug("getNativeSctpCapabilities()"),{numStreams:Fx}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){this.assertNotClosed(),Ce.debug("run()"),this._direction=t,this._remoteSdp=new RU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:vs.getSendingRtpParameters("audio",d),video:vs.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:vs.getSendingRemoteRtpParameters("audio",d),video:vs.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(Ce.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(t){this.assertNotClosed(),Ce.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),Ce.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Ce.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ce.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o,onRtpSender:a}){if(this.assertNotClosed(),this.assertSendDirection(),Ce.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1){let v=1;for(const h of r){const w=h.scalabilityMode?(0,kU.parse)(h.scalabilityMode).temporalLayers:3;w>v&&(v=w)}r.forEach((h,w)=>{h.rid=`r${w}`,h.scalabilityMode=`L1T${v}`})}const s=Lx.clone(this._sendingRtpParametersByKind[t.kind]);s.codecs=vs.reduceCodecs(s.codecs,o);const c=Lx.clone(this._sendingRemoteRtpParametersByKind[t.kind]);c.codecs=vs.reduceCodecs(c.codecs,o);const u=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});a&&a(l.sender);const d=await this._pc.createOffer();let p=Io.parse(d.sdp);p.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p}),Ce.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const f=l.mid;s.mid=f,p=Io.parse(this._pc.localDescription.sdp);const m=p.media[u.idx];if(s.rtcp.cname=od.getCname({offerMediaObject:m}),!r)s.encodings=Ox.getRtpEncodings({offerMediaObject:m});else if(r.length===1){const v=Ox.getRtpEncodings({offerMediaObject:m});Object.assign(v[0],r[0]),s.encodings=v}else s.encodings=r;this._remoteSdp.send({offerMediaObject:m,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:i});const g={type:"answer",sdp:this._remoteSdp.getSdp()};return Ce.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g),this._mapMidTransceiver.set(f,l),{localId:f,rtpParameters:s,rtpSender:l.sender}}async stopSending(t){if(this.assertSendDirection(),Ce.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const o=await this._pc.createOffer();Ce.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const a={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),Ce.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();Ce.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),Ce.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();Ce.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?Ce.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Ce.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),Ce.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Ce.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),Ce.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Ce.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};Ce.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Fx.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=Io.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Ce.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Ce.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;Ce.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);for(const c of t){const{trackId:u,onRtpReceiver:l}=c;if(l){const d=i.get(u),p=this._pc.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("transceiver not found");l(p.receiver)}}let a=await this._pc.createAnswer();const s=Io.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);od.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:Io.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),Ce.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(d)this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){Ce.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ce.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Ce.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ce.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Ce.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ce.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};Ce.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};Ce.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=Io.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Ce.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=Io.parse(this._pc.localDescription.sdp));const i=od.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new SU.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Nf.Chrome111=K0;var Mf={};Object.defineProperty(Mf,"__esModule",{value:!0});Mf.Chrome74=void 0;const pi=At,TU=Ct,Bx=Pt,ys=dt,ad=Bn,Tm=Ui,DU=Ac,IU=jt,PU=wn,AU=cr,NU=Wi,_e=new TU.Logger("Chrome74"),MU="Chrome74",zx={OS:1024,MIS:1024};class X0 extends PU.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new X0}get name(){return MU}close(){if(_e.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){_e.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const i=pi.parse(r.sdp),o=ad.extractRtpCapabilities({sdpObject:i});return DU.addNackSupportForOpus(o),o}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return _e.debug("getNativeSctpCapabilities()"),{numStreams:zx}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){_e.debug("run()"),this._direction=t,this._remoteSdp=new AU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ys.getSendingRtpParameters("audio",d),video:ys.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ys.getSendingRemoteRtpParameters("audio",d),video:ys.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(_e.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(t){this.assertNotClosed(),_e.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),_e.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});_e.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();_e.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertNotClosed(),this.assertSendDirection(),_e.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1&&r.forEach((h,w)=>{h.rid=`r${w}`});const a=Bx.clone(this._sendingRtpParametersByKind[t.kind]);a.codecs=ys.reduceCodecs(a.codecs,o);const s=Bx.clone(this._sendingRemoteRtpParametersByKind[t.kind]);s.codecs=ys.reduceCodecs(s.codecs,o);const c=this._remoteSdp.getNextMediaSectionIdx(),u=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});let l=await this._pc.createOffer(),d=pi.parse(l.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let p;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d});let f=!1;const m=(0,NU.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&m.spatialLayers>1&&a.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(_e.debug("send() | enabling legacy simulcast for VP9 SVC"),f=!0,d=pi.parse(l.sdp),p=d.media[c.idx],Tm.addLegacySimulcast({offerMediaObject:p,numStreams:m.spatialLayers}),l={type:"offer",sdp:pi.write(d)}),_e.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const g=u.mid;if(a.mid=g,d=pi.parse(this._pc.localDescription.sdp),p=d.media[c.idx],a.rtcp.cname=ad.getCname({offerMediaObject:p}),!r)a.encodings=Tm.getRtpEncodings({offerMediaObject:p});else if(r.length===1){let h=Tm.getRtpEncodings({offerMediaObject:p});Object.assign(h[0],r[0]),f&&(h=[h[0]]),a.encodings=h}else a.encodings=r;if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const h of a.encodings)h.scalabilityMode?h.scalabilityMode=`L1T${m.temporalLayers}`:h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:p,reuseMid:c.reuseMid,offerRtpParameters:a,answerRtpParameters:s,codecOptions:i});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return _e.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(g,u),{localId:g,rtpParameters:a,rtpSender:u.sender}}async stopSending(t){if(this.assertSendDirection(),_e.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const o=await this._pc.createOffer();_e.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const a={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),_e.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();_e.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),_e.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();_e.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?_e.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):_e.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),_e.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();_e.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),_e.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();_e.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};_e.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%zx.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=pi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),_e.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};_e.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;_e.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let a=await this._pc.createAnswer();const s=pi.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);ad.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:pi.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),_e.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(d)this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){_e.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();_e.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){_e.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();_e.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){_e.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();_e.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};_e.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};_e.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=pi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}_e.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=pi.parse(this._pc.localDescription.sdp));const i=ad.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new IU.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Mf.Chrome74=X0;var Lf={};Object.defineProperty(Lf,"__esModule",{value:!0});Lf.Chrome70=void 0;const Er=At,LU=Ct,jx=Pt,ws=dt,sd=Bn,Dm=Ui,OU=wn,FU=cr,BU=Wi,Fe=new LU.Logger("Chrome70"),zU="Chrome70",$x={OS:1024,MIS:1024};class Q0 extends OU.HandlerInterface{constructor(){super();N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new Q0}get name(){return zU}close(){if(Fe.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){Fe.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const i=Er.parse(r.sdp);return sd.extractRtpCapabilities({sdpObject:i})}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Fe.debug("getNativeSctpCapabilities()"),{numStreams:$x}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){Fe.debug("run()"),this._direction=t,this._remoteSdp=new FU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ws.getSendingRtpParameters("audio",d),video:ws.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ws.getSendingRemoteRtpParameters("audio",d),video:ws.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Fe.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){Fe.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(Fe.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Fe.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Fe.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Fe.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Fe.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertSendDirection(),Fe.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);const a=jx.clone(this._sendingRtpParametersByKind[t.kind]);a.codecs=ws.reduceCodecs(a.codecs,o);const s=jx.clone(this._sendingRemoteRtpParametersByKind[t.kind]);s.codecs=ws.reduceCodecs(s.codecs,o);const c=this._remoteSdp.getNextMediaSectionIdx(),u=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream]});let l=await this._pc.createOffer(),d=Er.parse(l.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let p;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),r&&r.length>1&&(Fe.debug("send() | enabling legacy simulcast"),d=Er.parse(l.sdp),p=d.media[c.idx],Dm.addLegacySimulcast({offerMediaObject:p,numStreams:r.length}),l={type:"offer",sdp:Er.write(d)});let f=!1;const m=(0,BU.parse)((r??[{}])[0].scalabilityMode);if(r&&r.length===1&&m.spatialLayers>1&&a.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(Fe.debug("send() | enabling legacy simulcast for VP9 SVC"),f=!0,d=Er.parse(l.sdp),p=d.media[c.idx],Dm.addLegacySimulcast({offerMediaObject:p,numStreams:m.spatialLayers}),l={type:"offer",sdp:Er.write(d)}),Fe.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),r){Fe.debug("send() | applying given encodings");const h=u.sender.getParameters();for(let w=0;w<(h.encodings??[]).length;++w){const y=h.encodings[w],b=r[w];if(!b)break;h.encodings[w]=Object.assign(y,b)}await u.sender.setParameters(h)}const g=u.mid;if(a.mid=g,d=Er.parse(this._pc.localDescription.sdp),p=d.media[c.idx],a.rtcp.cname=sd.getCname({offerMediaObject:p}),a.encodings=Dm.getRtpEncodings({offerMediaObject:p}),r)for(let h=0;h<a.encodings.length;++h)r[h]&&Object.assign(a.encodings[h],r[h]);if(f&&(a.encodings=[a.encodings[0]]),a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const h of a.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:p,reuseMid:c.reuseMid,offerRtpParameters:a,answerRtpParameters:s,codecOptions:i});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return Fe.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(g,u),{localId:g,rtpParameters:a,rtpSender:u.sender}}async stopSending(t){this.assertSendDirection(),Fe.debug("stopSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const o=await this._pc.createOffer();Fe.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const a={type:"answer",sdp:this._remoteSdp.getSdp()};Fe.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){this.assertSendDirection(),r?Fe.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Fe.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertSendDirection(),Fe.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Fe.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fe.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertSendDirection(),Fe.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Fe.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Fe.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:i,protocol:a};Fe.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$x.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=Er.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Fe.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Fe.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;Fe.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Fe.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let a=await this._pc.createAnswer();const s=Er.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);sd.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:Er.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),Fe.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(!d)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver})}return r}async stopReceiving(t){this.assertRecvDirection();for(const o of t){Fe.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Fe.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Fe.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){}async resumeReceiving(t){}async getReceiverStats(t){this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i};Fe.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};Fe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=Er.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Fe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=Er.parse(this._pc.localDescription.sdp));const i=sd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Lf.Chrome70=Q0;var Of={},Ja={};Object.defineProperty(Ja,"__esModule",{value:!0});Ja.getRtpEncodings=jU;Ja.addLegacySimulcast=$U;function jU({offerMediaObject:e,track:n}){const t=new Set;for(const o of e.ssrcs??[]){if(o.attribute!=="msid")continue;if(o.value.split(" ")[1]===n.id){const s=o.id;t.add(s)}}if(t.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${n.id}]`);const r=new Map;for(const o of e.ssrcGroups??[]){if(o.semantics!=="FID")continue;let[a,s]=o.ssrcs.split(/\s+/);a=Number(a),s=Number(s),t.has(a)&&(t.delete(a),t.delete(s),r.set(a,s))}for(const o of t)r.set(o,null);const i=[];for(const[o,a]of r){const s={ssrc:o};a&&(s.rtx={ssrc:a}),i.push(s)}return i}function $U({offerMediaObject:e,track:n,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");let r,i,o;if(!(e.ssrcs??[]).find(d=>d.attribute!=="msid"?!1:d.value.split(" ")[1]===n.id?(r=d.id,o=d.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${n.id}]`);(e.ssrcGroups??[]).some(d=>{if(d.semantics!=="FID")return!1;const p=d.ssrcs.split(/\s+/);return Number(p[0])===r?(i=Number(p[1]),!0):!1});const s=e.ssrcs.find(d=>d.attribute==="cname"&&d.id===r);if(!s)throw new Error(`a=ssrc line with cname information not found [track.id:${n.id}]`);const c=s.value,u=[],l=[];for(let d=0;d<t;++d)u.push(r+d),i&&l.push(i+d);e.ssrcGroups=e.ssrcGroups??[],e.ssrcs=e.ssrcs??[],e.ssrcGroups.push({semantics:"SIM",ssrcs:u.join(" ")});for(const d of u)e.ssrcs.push({id:d,attribute:"cname",value:c}),e.ssrcs.push({id:d,attribute:"msid",value:`${o} ${n.id}`});for(let d=0;d<l.length;++d){const p=u[d],f=l[d];e.ssrcs.push({id:f,attribute:"cname",value:c}),e.ssrcs.push({id:f,attribute:"msid",value:`${o} ${n.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${f}`})}}Object.defineProperty(Of,"__esModule",{value:!0});Of.Chrome67=void 0;const fi=At,UU=Ct,Ux=Pt,bs=dt,cd=Bn,Wx=Ja,WU=wn,VU=cr,Ve=new UU.Logger("Chrome67"),HU="Chrome67",Vx={OS:1024,MIS:1024};class Y0 extends WU.HandlerInterface{constructor(){super();N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_sendStream",new MediaStream);N(this,"_mapSendLocalIdRtpSender",new Map);N(this,"_nextSendLocalId",0);N(this,"_mapRecvLocalIdInfo",new Map);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new Y0}get name(){return HU}close(){if(Ve.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){Ve.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch{}const i=fi.parse(r.sdp);return cd.extractRtpCapabilities({sdpObject:i})}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Ve.debug("getNativeSctpCapabilities()"),{numStreams:Vx}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){Ve.debug("run()"),this._direction=t,this._remoteSdp=new VU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:bs.getSendingRtpParameters("audio",d),video:bs.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:bs.getSendingRemoteRtpParameters("audio",d),video:bs.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Ve.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){Ve.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(Ve.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Ve.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Ve.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ve.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ve.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertSendDirection(),Ve.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),o&&Ve.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let a=await this._pc.createOffer(),s=fi.parse(a.sdp);s.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let c;const u=Ux.clone(this._sendingRtpParametersByKind[t.kind]);u.codecs=bs.reduceCodecs(u.codecs);const l=Ux.clone(this._sendingRemoteRtpParametersByKind[t.kind]);if(l.codecs=bs.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),t.kind==="video"&&r&&r.length>1&&(Ve.debug("send() | enabling simulcast"),s=fi.parse(a.sdp),c=s.media.find(m=>m.type==="video"),Wx.addLegacySimulcast({offerMediaObject:c,track:t,numStreams:r.length}),a={type:"offer",sdp:fi.write(s)}),Ve.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=fi.parse(this._pc.localDescription.sdp),c=s.media.find(m=>m.type===t.kind),u.rtcp.cname=cd.getCname({offerMediaObject:c}),u.encodings=Wx.getRtpEncodings({offerMediaObject:c,track:t}),r)for(let m=0;m<u.encodings.length;++m)r[m]&&Object.assign(u.encodings[m],r[m]);if(u.encodings.length>1&&u.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const m of u.encodings)m.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:u,answerRtpParameters:l,codecOptions:i});const d={type:"answer",sdp:this._remoteSdp.getSdp()};Ve.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d);const p=String(this._nextSendLocalId);this._nextSendLocalId++;const f=this._pc.getSenders().find(m=>m.track===t);return this._mapSendLocalIdRtpSender.set(p,f),{localId:p,rtpParameters:u,rtpSender:f}}async stopSending(t){this.assertSendDirection(),Ve.debug("stopSending() [localId:%s]",t);const r=this._mapSendLocalIdRtpSender.get(t);if(!r)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(r),r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t);const i=await this._pc.createOffer();Ve.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(a){if(this._sendStream.getTracks().length===0){Ve.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ve.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){this.assertSendDirection(),r?Ve.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Ve.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.track;await i.replaceTrack(r),o&&this._sendStream.removeTrack(o),r&&this._sendStream.addTrack(r)}async setMaxSpatialLayer(t,r){this.assertSendDirection(),Ve.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{s<=r?a.active=!0:a.active=!1}),await i.setParameters(o)}async setRtpEncodingParameters(t,r){this.assertSendDirection(),Ve.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{o.encodings[s]={...a,...r}}),await i.setParameters(o)}async getSenderStats(t){this.assertSendDirection();const r=this._mapSendLocalIdRtpSender.get(t);if(!r)throw new Error("associated RTCRtpSender not found");return r.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:i,protocol:a};Ve.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Vx.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=fi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Ve.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Ve.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertRecvDirection();const r=[];for(const s of t){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=s;Ve.debug("receive() [trackId:%s, kind:%s]",c,u);const p=u;this._remoteSdp.receive({mid:p,kind:u,offerRtpParameters:l,streamId:d??l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Ve.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const a=fi.parse(o.sdp);for(const s of t){const{kind:c,rtpParameters:u}=s,l=c,d=a.media.find(p=>String(p.mid)===l);cd.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}o={type:"answer",sdp:fi.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),Ve.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const s of t){const{kind:c,trackId:u,rtpParameters:l}=s,d=u,p=c,f=this._pc.getReceivers().find(m=>m.track&&m.track.id===d);if(!f)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(d,{mid:p,rtpParameters:l,rtpReceiver:f}),r.push({localId:d,track:f.track,rtpReceiver:f})}return r}async stopReceiving(t){this.assertRecvDirection();for(const o of t){Ve.debug("stopReceiving() [localId:%s]",o);const{mid:a,rtpParameters:s}=this._mapRecvLocalIdInfo.get(o)??{};this._mapRecvLocalIdInfo.delete(o),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:s})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ve.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ve.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async pauseReceiving(t){}async resumeReceiving(t){}async getReceiverStats(t){this.assertRecvDirection();const{rtpReceiver:r}=this._mapRecvLocalIdInfo.get(t)??{};if(!r)throw new Error("associated RTCRtpReceiver not found");return r.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i};Ve.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const d={type:"offer",sdp:this._remoteSdp.getSdp()};Ve.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=fi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Ve.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=fi.parse(this._pc.localDescription.sdp));const i=cd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Of.Chrome67=Y0;var Ff={};Object.defineProperty(Ff,"__esModule",{value:!0});Ff.Chrome55=void 0;const hi=At,GU=Ct,tu=jt,Hx=Pt,xs=dt,ud=Bn,Gx=Ja,qU=wn,KU=cr,et=new GU.Logger("Chrome55"),XU="Chrome55",qx={OS:1024,MIS:1024};class J0 extends qU.HandlerInterface{constructor(){super();N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_sendStream",new MediaStream);N(this,"_mapSendLocalIdTrack",new Map);N(this,"_nextSendLocalId",0);N(this,"_mapRecvLocalIdInfo",new Map);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new J0}get name(){return XU}close(){if(et.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){et.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch{}const i=hi.parse(r.sdp);return ud.extractRtpCapabilities({sdpObject:i})}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return et.debug("getNativeSctpCapabilities()"),{numStreams:qx}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){et.debug("run()"),this._direction=t,this._remoteSdp=new KU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:xs.getSendingRtpParameters("audio",d),video:xs.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:xs.getSendingRemoteRtpParameters("audio",d),video:xs.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(et.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){et.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(et.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});et.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};et.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};et.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();et.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertSendDirection(),et.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),o&&et.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),s=hi.parse(a.sdp);s.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let c;const u=Hx.clone(this._sendingRtpParametersByKind[t.kind]);u.codecs=xs.reduceCodecs(u.codecs);const l=Hx.clone(this._sendingRemoteRtpParametersByKind[t.kind]);if(l.codecs=xs.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),t.kind==="video"&&r&&r.length>1&&(et.debug("send() | enabling simulcast"),s=hi.parse(a.sdp),c=s.media.find(f=>f.type==="video"),Gx.addLegacySimulcast({offerMediaObject:c,track:t,numStreams:r.length}),a={type:"offer",sdp:hi.write(s)}),et.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=hi.parse(this._pc.localDescription.sdp),c=s.media.find(f=>f.type===t.kind),u.rtcp.cname=ud.getCname({offerMediaObject:c}),u.encodings=Gx.getRtpEncodings({offerMediaObject:c,track:t}),r)for(let f=0;f<u.encodings.length;++f)r[f]&&Object.assign(u.encodings[f],r[f]);if(u.encodings.length>1&&u.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const f of u.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:u,answerRtpParameters:l,codecOptions:i});const d={type:"answer",sdp:this._remoteSdp.getSdp()};et.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d);const p=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(p,t),{localId:p,rtpParameters:u}}async stopSending(t){this.assertSendDirection(),et.debug("stopSending() [localId:%s]",t);const r=this._mapSendLocalIdTrack.get(t);if(!r)throw new Error("track not found");this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();et.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(a){if(this._sendStream.getTracks().length===0){et.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;const o={type:"answer",sdp:this._remoteSdp.getSdp()};et.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){throw new tu.UnsupportedError("not implemented")}async setMaxSpatialLayer(t,r){throw new tu.UnsupportedError(" not implemented")}async setRtpEncodingParameters(t,r){throw new tu.UnsupportedError("not supported")}async getSenderStats(t){throw new tu.UnsupportedError("not implemented")}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:i,protocol:a};et.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%qx.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=hi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),et.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};et.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertRecvDirection();const r=[];for(const s of t){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=s;et.debug("receive() [trackId:%s, kind:%s]",c,u);const p=u;this._remoteSdp.receive({mid:p,kind:u,offerRtpParameters:l,streamId:d??l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};et.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const a=hi.parse(o.sdp);for(const s of t){const{kind:c,rtpParameters:u}=s,l=c,d=a.media.find(p=>String(p.mid)===l);ud.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}o={type:"answer",sdp:hi.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),et.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const s of t){const{kind:c,trackId:u,rtpParameters:l}=s,d=c,p=u,f=s.streamId??l.rtcp.cname,g=this._pc.getRemoteStreams().find(v=>v.id===f).getTrackById(p);if(!g)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(p,{mid:d,rtpParameters:l}),r.push({localId:p,track:g})}return r}async stopReceiving(t){this.assertRecvDirection();for(const o of t){et.debug("stopReceiving() [localId:%s]",o);const{mid:a,rtpParameters:s}=this._mapRecvLocalIdInfo.get(o)??{};this._mapRecvLocalIdInfo.delete(o),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:s})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};et.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();et.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async pauseReceiving(t){}async resumeReceiving(t){}async getReceiverStats(t){throw new tu.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i};et.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const d={type:"offer",sdp:this._remoteSdp.getSdp()};et.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=hi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}et.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=hi.parse(this._pc.localDescription.sdp));const i=ud.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Ff.Chrome55=J0;var Bf={};Object.defineProperty(Bf,"__esModule",{value:!0});Bf.Firefox120=void 0;const Po=At,QU=Ct,Kx=jt,Xx=Pt,_s=dt,ld=Bn,Qx=Ui,YU=wn,JU=cr,ZU=Wi,Ee=new QU.Logger("Firefox120"),eW="Firefox120",Yx={OS:16,MIS:2048};class Z0 extends YU.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new Z0}get name(){return eW}close(){if(Ee.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){Ee.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");const o=r.captureStream().getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"}),t.addTransceiver(o,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const a=await t.createOffer();try{r.remove()}catch{}try{o.stop()}catch{}try{t.close()}catch{}const s=Po.parse(a.sdp);return ld.extractRtpCapabilities({sdpObject:s})}catch(a){try{r.remove()}catch{}try{o.stop()}catch{}try{t.close()}catch{}throw a}}async getNativeSctpCapabilities(){return Ee.debug("getNativeSctpCapabilities()"),{numStreams:Yx}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){this.assertNotClosed(),Ee.debug("run()"),this._direction=t,this._remoteSdp=new JU.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:_s.getSendingRtpParameters("audio",d),video:_s.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:_s.getSendingRemoteRtpParameters("audio",d),video:_s.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Ee.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){throw this.assertNotClosed(),new Kx.UnsupportedError("not supported")}async restartIce(t){if(this.assertNotClosed(),Ee.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Ee.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ee.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),Ee.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1&&r.forEach((v,h)=>{v.rid=`r${h}`});const s=Xx.clone(this._sendingRtpParametersByKind[t.kind]);s.codecs=_s.reduceCodecs(s.codecs,o);const c=Xx.clone(this._sendingRemoteRtpParametersByKind[t.kind]);c.codecs=_s.reduceCodecs(c.codecs,o);const u=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});a&&a(u.sender);const l=await this._pc.createOffer();let d=Po.parse(l.sdp);d.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d});const p=(0,ZU.parse)((r??[{}])[0].scalabilityMode);Ee.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l);const f=u.mid;s.mid=f,d=Po.parse(this._pc.localDescription.sdp);const m=d.media[d.media.length-1];if(s.rtcp.cname=ld.getCname({offerMediaObject:m}),!r)s.encodings=Qx.getRtpEncodings({offerMediaObject:m});else if(r.length===1){const v=Qx.getRtpEncodings({offerMediaObject:m});Object.assign(v[0],r[0]),s.encodings=v}else s.encodings=r;if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const v of s.encodings)v.scalabilityMode?v.scalabilityMode=`L1T${p.temporalLayers}`:v.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:m,offerRtpParameters:s,answerRtpParameters:c,codecOptions:i});const g={type:"answer",sdp:this._remoteSdp.getSdp()};return Ee.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g),this._mapMidTransceiver.set(f,u),{localId:f,rtpParameters:s,rtpSender:u.sender}}async stopSending(t){if(this.assertSendDirection(),Ee.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated transceiver not found");r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid);const i=await this._pc.createOffer();Ee.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),Ee.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();Ee.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),Ee.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t);const i=await this._pc.createOffer();Ee.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?Ee.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Ee.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),Ee.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated transceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Ee.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),Ee.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Ee.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};Ee.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Yx.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=Po.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),Ee.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Ee.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;Ee.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);for(const c of t){const{trackId:u,onRtpReceiver:l}=c;if(l){const d=i.get(u),p=this._pc.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("transceiver not found");l(p.receiver)}}let a=await this._pc.createAnswer();const s=Po.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);ld.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p}),a={type:"answer",sdp:Po.write(s)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:s}),Ee.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(!d)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver})}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){Ee.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ee.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Ee.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ee.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Ee.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ee.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};Ee.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};Ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=Po.parse(p.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:f})}Ee.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=Po.parse(this._pc.localDescription.sdp));const i=ld.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Kx.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Bf.Firefox120=Z0;var zf={};Object.defineProperty(zf,"__esModule",{value:!0});zf.Firefox60=void 0;const Ao=At,tW=Ct,Jx=jt,Im=Pt,Ss=dt,dd=Bn,Zx=Ui,nW=wn,rW=cr,iW=Wi,Te=new tW.Logger("Firefox60"),oW="Firefox60",e_={OS:16,MIS:2048};class ew extends nW.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new ew}get name(){return oW}close(){if(Te.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){Te.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");const o=r.captureStream().getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"});const a=t.addTransceiver(o,{direction:"sendrecv"}),s=a.sender.getParameters(),c=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];s.encodings=c,await a.sender.setParameters(s);const u=await t.createOffer();try{r.remove()}catch{}try{o.stop()}catch{}try{t.close()}catch{}const l=Ao.parse(u.sdp);return dd.extractRtpCapabilities({sdpObject:l})}catch(a){try{r.remove()}catch{}try{o.stop()}catch{}try{t.close()}catch{}throw a}}async getNativeSctpCapabilities(){return Te.debug("getNativeSctpCapabilities()"),{numStreams:e_}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){this.assertNotClosed(),Te.debug("run()"),this._direction=t,this._remoteSdp=new rW.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:Ss.getSendingRtpParameters("audio",d),video:Ss.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Ss.getSendingRemoteRtpParameters("audio",d),video:Ss.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Te.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){throw this.assertNotClosed(),new Jx.UnsupportedError("not supported")}async restartIce(t){if(this.assertNotClosed(),Te.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Te.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Te.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertNotClosed(),this.assertSendDirection(),Te.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&(r=Im.clone(r),r.forEach((g,v)=>{g.rid=`r${v}`}),r.reverse());const a=Im.clone(this._sendingRtpParametersByKind[t.kind]);a.codecs=Ss.reduceCodecs(a.codecs,o);const s=Im.clone(this._sendingRemoteRtpParametersByKind[t.kind]);s.codecs=Ss.reduceCodecs(s.codecs,o);const c=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream]});if(r){const g=c.sender.getParameters();g.encodings=r,await c.sender.setParameters(g)}const u=await this._pc.createOffer();let l=Ao.parse(u.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l});const d=(0,iW.parse)((r??[{}])[0].scalabilityMode);Te.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u);const p=c.mid;a.mid=p,l=Ao.parse(this._pc.localDescription.sdp);const f=l.media[l.media.length-1];if(a.rtcp.cname=dd.getCname({offerMediaObject:f}),!r)a.encodings=Zx.getRtpEncodings({offerMediaObject:f});else if(r.length===1){const g=Zx.getRtpEncodings({offerMediaObject:f});Object.assign(g[0],r[0]),a.encodings=g}else a.encodings=r.reverse();if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const g of a.encodings)g.scalabilityMode?g.scalabilityMode=`L1T${d.temporalLayers}`:g.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,offerRtpParameters:a,answerRtpParameters:s,codecOptions:i});const m={type:"answer",sdp:this._remoteSdp.getSdp()};return Te.debug("send() | calling pc.setRemoteDescription() [answer:%o]",m),await this._pc.setRemoteDescription(m),this._mapMidTransceiver.set(p,c),{localId:p,rtpParameters:a,rtpSender:c.sender}}async stopSending(t){if(this.assertSendDirection(),Te.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated transceiver not found");r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid);const i=await this._pc.createOffer();Te.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),Te.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();Te.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),Te.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t);const i=await this._pc.createOffer();Te.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?Te.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Te.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),Te.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated transceiver not found");const o=i.sender.getParameters();r=o.encodings.length-1-r,o.encodings.forEach((c,u)=>{u>=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Te.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),Te.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Te.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};Te.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%e_.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=Ao.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),Te.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Te.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;Te.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let a=await this._pc.createAnswer();const s=Ao.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);dd.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p}),a={type:"answer",sdp:Ao.write(s)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:s}),Te.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(!d)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver})}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){Te.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Te.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Te.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Te.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Te.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Te.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};Te.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};Te.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=Ao.parse(p.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:f})}Te.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=Ao.parse(this._pc.localDescription.sdp));const i=dd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new Jx.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}zf.Firefox60=ew;var jf={};Object.defineProperty(jf,"__esModule",{value:!0});jf.Safari12=void 0;const mi=At,aW=Ct,t_=Pt,Cs=dt,pd=Bn,n_=Ui,sW=Ac,cW=jt,uW=wn,lW=cr,dW=Wi,Se=new aW.Logger("Safari12"),pW="Safari12",r_={OS:1024,MIS:1024};class tw extends uW.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new tw}get name(){return pW}close(){if(Se.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){Se.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const i=mi.parse(r.sdp),o=pd.extractRtpCapabilities({sdpObject:i});return sW.addNackSupportForOpus(o),o}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Se.debug("getNativeSctpCapabilities()"),{numStreams:r_}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){this.assertNotClosed(),Se.debug("run()"),this._direction=t,this._remoteSdp=new lW.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:Cs.getSendingRtpParameters("audio",d),video:Cs.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Cs.getSendingRemoteRtpParameters("audio",d),video:Cs.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Se.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){this.assertNotClosed(),Se.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),Se.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Se.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Se.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),Se.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);const s=t_.clone(this._sendingRtpParametersByKind[t.kind]);s.codecs=Cs.reduceCodecs(s.codecs,o);const c=t_.clone(this._sendingRemoteRtpParametersByKind[t.kind]);c.codecs=Cs.reduceCodecs(c.codecs,o);const u=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream]});a&&a(l.sender);let d=await this._pc.createOffer(),p=mi.parse(d.sdp);p.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let f;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p});const m=(0,dW.parse)((r??[{}])[0].scalabilityMode);r&&r.length>1&&(Se.debug("send() | enabling legacy simulcast"),p=mi.parse(d.sdp),f=p.media[u.idx],n_.addLegacySimulcast({offerMediaObject:f,numStreams:r.length}),d={type:"offer",sdp:mi.write(p)}),Se.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const g=l.mid;if(s.mid=g,p=mi.parse(this._pc.localDescription.sdp),f=p.media[u.idx],s.rtcp.cname=pd.getCname({offerMediaObject:f}),s.encodings=n_.getRtpEncodings({offerMediaObject:f}),r)for(let h=0;h<s.encodings.length;++h)r[h]&&Object.assign(s.encodings[h],r[h]);if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const h of s.encodings)h.scalabilityMode?h.scalabilityMode=`L1T${m.temporalLayers}`:h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:i});const v={type:"answer",sdp:this._remoteSdp.getSdp()};return Se.debug("send() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v),this._mapMidTransceiver.set(g,l),{localId:g,rtpParameters:s,rtpSender:l.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;Se.debug("stopSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const o=await this._pc.createOffer();Se.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const a={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),Se.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();Se.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),Se.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t);const i=await this._pc.createOffer();Se.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?Se.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Se.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),Se.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Se.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),Se.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();Se.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};Se.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%r_.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=mi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Se.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Se.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;Se.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);for(const c of t){const{trackId:u,onRtpReceiver:l}=c;if(l){const d=i.get(u),p=this._pc.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("transceiver not found");l(p.receiver)}}let a=await this._pc.createAnswer();const s=mi.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);pd.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:mi.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),Se.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(!d)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver})}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){Se.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Se.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Se.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Se.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){Se.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Se.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};Se.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};Se.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=mi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Se.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=mi.parse(this._pc.localDescription.sdp));const i=pd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new cW.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}jf.Safari12=tw;var $f={};Object.defineProperty($f,"__esModule",{value:!0});$f.Safari11=void 0;const gi=At,fW=Ct,i_=Pt,Rs=dt,fd=Bn,o_=Ja,hW=wn,mW=cr,Ge=new fW.Logger("Safari11"),gW="Safari11",a_={OS:1024,MIS:1024};class nw extends hW.HandlerInterface{constructor(){super();N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_sendStream",new MediaStream);N(this,"_mapSendLocalIdRtpSender",new Map);N(this,"_nextSendLocalId",0);N(this,"_mapRecvLocalIdInfo",new Map);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new nw}get name(){return gW}close(){if(Ge.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){Ge.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch{}const i=gi.parse(r.sdp);return fd.extractRtpCapabilities({sdpObject:i})}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Ge.debug("getNativeSctpCapabilities()"),{numStreams:a_}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){Ge.debug("run()"),this._direction=t,this._remoteSdp=new mW.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:Rs.getSendingRtpParameters("audio",d),video:Rs.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Rs.getSendingRemoteRtpParameters("audio",d),video:Rs.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Ge.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){Ge.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(Ge.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Ge.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Ge.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ge.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ge.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertSendDirection(),Ge.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),o&&Ge.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let a=await this._pc.createOffer(),s=gi.parse(a.sdp);s.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let c;const u=i_.clone(this._sendingRtpParametersByKind[t.kind]);u.codecs=Rs.reduceCodecs(u.codecs);const l=i_.clone(this._sendingRemoteRtpParametersByKind[t.kind]);if(l.codecs=Rs.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),t.kind==="video"&&r&&r.length>1&&(Ge.debug("send() | enabling simulcast"),s=gi.parse(a.sdp),c=s.media.find(m=>m.type==="video"),o_.addLegacySimulcast({offerMediaObject:c,track:t,numStreams:r.length}),a={type:"offer",sdp:gi.write(s)}),Ge.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=gi.parse(this._pc.localDescription.sdp),c=s.media.find(m=>m.type===t.kind),u.rtcp.cname=fd.getCname({offerMediaObject:c}),u.encodings=o_.getRtpEncodings({offerMediaObject:c,track:t}),r)for(let m=0;m<u.encodings.length;++m)r[m]&&Object.assign(u.encodings[m],r[m]);if(u.encodings.length>1&&u.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const m of u.encodings)m.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:u,answerRtpParameters:l,codecOptions:i});const d={type:"answer",sdp:this._remoteSdp.getSdp()};Ge.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d);const p=String(this._nextSendLocalId);this._nextSendLocalId++;const f=this._pc.getSenders().find(m=>m.track===t);return this._mapSendLocalIdRtpSender.set(p,f),{localId:p,rtpParameters:u,rtpSender:f}}async stopSending(t){this.assertSendDirection();const r=this._mapSendLocalIdRtpSender.get(t);if(!r)throw new Error("associated RTCRtpSender not found");r.track&&this._sendStream.removeTrack(r.track),this._mapSendLocalIdRtpSender.delete(t);const i=await this._pc.createOffer();Ge.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(a){if(this._sendStream.getTracks().length===0){Ge.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;const o={type:"answer",sdp:this._remoteSdp.getSdp()};Ge.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){this.assertSendDirection(),r?Ge.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Ge.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.track;await i.replaceTrack(r),o&&this._sendStream.removeTrack(o),r&&this._sendStream.addTrack(r)}async setMaxSpatialLayer(t,r){this.assertSendDirection(),Ge.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{s<=r?a.active=!0:a.active=!1}),await i.setParameters(o)}async setRtpEncodingParameters(t,r){this.assertSendDirection(),Ge.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapSendLocalIdRtpSender.get(t);if(!i)throw new Error("associated RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{o.encodings[s]={...a,...r}}),await i.setParameters(o)}async getSenderStats(t){this.assertSendDirection();const r=this._mapSendLocalIdRtpSender.get(t);if(!r)throw new Error("associated RTCRtpSender not found");return r.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};Ge.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%a_.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=gi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Ge.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Ge.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertRecvDirection();const r=[];for(const s of t){const{trackId:c,kind:u,rtpParameters:l,streamId:d}=s;Ge.debug("receive() [trackId:%s, kind:%s]",c,u);const p=u;this._remoteSdp.receive({mid:p,kind:u,offerRtpParameters:l,streamId:d??l.rtcp.cname,trackId:c})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};Ge.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let o=await this._pc.createAnswer();const a=gi.parse(o.sdp);for(const s of t){const{kind:c,rtpParameters:u}=s,l=c,d=a.media.find(p=>String(p.mid)===l);fd.applyCodecParameters({offerRtpParameters:u,answerMediaObject:d})}o={type:"answer",sdp:gi.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),Ge.debug("receive() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o);for(const s of t){const{kind:c,trackId:u,rtpParameters:l}=s,d=c,p=u,f=this._pc.getReceivers().find(m=>m.track&&m.track.id===p);if(!f)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(p,{mid:d,rtpParameters:l,rtpReceiver:f}),r.push({localId:p,track:f.track,rtpReceiver:f})}return r}async stopReceiving(t){this.assertRecvDirection();for(const o of t){Ge.debug("stopReceiving() [localId:%s]",o);const{mid:a,rtpParameters:s}=this._mapRecvLocalIdInfo.get(o)??{};this._mapRecvLocalIdInfo.delete(o),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:s})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Ge.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Ge.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertRecvDirection();const{rtpReceiver:r}=this._mapRecvLocalIdInfo.get(t)??{};if(!r)throw new Error("associated RTCRtpReceiver not found");return r.getStats()}async pauseReceiving(t){}async resumeReceiving(t){}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};Ge.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const d={type:"offer",sdp:this._remoteSdp.getSdp()};Ge.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=gi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Ge.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=gi.parse(this._pc.localDescription.sdp));const i=fd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}$f.Safari11=nw;var Uf={},Wf={};Object.defineProperty(Wf,"__esModule",{value:!0});Wf.getCapabilities=vW;Wf.mangleRtpParameters=yW;const EE=Pt;function vW(){const e=RTCRtpReceiver.getCapabilities(),n=EE.clone(e);for(const t of n.codecs??[]){if(t.channels=t.numChannels,delete t.numChannels,t.mimeType=t.mimeType??`${t.kind}/${t.name}`,t.parameters){const r=t.parameters;r.apt&&(r.apt=Number(r.apt)),r["packetization-mode"]&&(r["packetization-mode"]=Number(r["packetization-mode"]))}for(const r of t.rtcpFeedback??[])r.parameter||(r.parameter="")}return n}function yW(e){const n=EE.clone(e);n.mid&&(n.muxId=n.mid,delete n.mid);for(const t of n.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return n}Object.defineProperty(Uf,"__esModule",{value:!0});Uf.Edge11=void 0;const wW=Ct,Pm=jt,hd=Pt,Am=dt,Nm=Wf,bW=wn,it=new wW.Logger("Edge11"),xW="Edge11";class rw extends bW.HandlerInterface{constructor(){super();N(this,"_sendingRtpParametersByKind");N(this,"_remoteIceParameters");N(this,"_remoteIceCandidates");N(this,"_remoteDtlsParameters");N(this,"_iceGatherer");N(this,"_iceTransport");N(this,"_dtlsTransport");N(this,"_rtpSenders",new Map);N(this,"_rtpReceivers",new Map);N(this,"_nextSendLocalId",0);N(this,"_cname");N(this,"_transportReady",!1)}static createFactory(){return()=>new rw}get name(){return xW}close(){it.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const t of this._rtpSenders.values())try{t.stop()}catch{}for(const t of this._rtpReceivers.values())try{t.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return it.debug("getNativeRtpCapabilities()"),Nm.getCapabilities()}async getNativeSctpCapabilities(){return it.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){it.debug("run()"),this._sendingRtpParametersByKind={audio:Am.getSendingRtpParameters("audio",d),video:Am.getSendingRtpParameters("video",d)},this._remoteIceParameters=r,this._remoteIceCandidates=i,this._remoteDtlsParameters=o,this._cname=`CNAME-${hd.generateRandomNumber()}`,this.setIceGatherer({iceServers:s,iceTransportPolicy:c}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(t){throw new Pm.UnsupportedError("not supported")}async restartIce(t){if(it.debug("restartIce()"),this._remoteIceParameters=t,!!this._transportReady){it.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,t,"controlling");for(const r of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(r);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){it.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),it.debug("send() | calling new RTCRtpSender()");const a=new RTCRtpSender(t,this._dtlsTransport),s=hd.clone(this._sendingRtpParametersByKind[t.kind]);s.codecs=Am.reduceCodecs(s.codecs,o);const c=s.codecs.some(d=>/.+\/rtx$/i.test(d.mimeType));r||(r=[{}]);for(const d of r)d.ssrc=hd.generateRandomNumber(),c&&(d.rtx={ssrc:hd.generateRandomNumber()});s.encodings=r,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const u=Nm.mangleRtpParameters(s);it.debug("send() | calling rtpSender.send() [params:%o]",u),await a.send(u);const l=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(l,a),{localId:l,rtpParameters:s,rtpSender:a}}async stopSending(t){it.debug("stopSending() [localId:%s]",t);const r=this._rtpSenders.get(t);if(!r)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(t);try{it.debug("stopSending() | calling rtpSender.stop()"),r.stop()}catch(i){throw it.warn("stopSending() | rtpSender.stop() failed:%o",i),i}}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){r?it.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):it.debug("replaceTrack() [localId:%s, no track]",t);const i=this._rtpSenders.get(t);if(!i)throw new Error("RTCRtpSender not found");i.setTrack(r)}async setMaxSpatialLayer(t,r){it.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._rtpSenders.get(t);if(!i)throw new Error("RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{s<=r?a.active=!0:a.active=!1}),await i.setParameters(o)}async setRtpEncodingParameters(t,r){it.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._rtpSenders.get(t);if(!i)throw new Error("RTCRtpSender not found");const o=i.getParameters();o.encodings.forEach((a,s)=>{o.encodings[s]={...a,...r}}),await i.setParameters(o)}async getSenderStats(t){const r=this._rtpSenders.get(t);if(!r)throw new Error("RTCRtpSender not found");return r.getStats()}async sendDataChannel(t){throw new Pm.UnsupportedError("not implemented")}async receive(t){const r=[];for(const i of t){const{trackId:o,kind:a}=i;it.debug("receive() [trackId:%s, kind:%s]",o,a)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const i of t){const{trackId:o,kind:a,rtpParameters:s}=i;it.debug("receive() | calling new RTCRtpReceiver()");const c=new RTCRtpReceiver(this._dtlsTransport,a);c.addEventListener("error",d=>{it.error('rtpReceiver "error" event [event:%o]',d)});const u=Nm.mangleRtpParameters(s);it.debug("receive() | calling rtpReceiver.receive() [params:%o]",u),await c.receive(u);const l=o;this._rtpReceivers.set(l,c),r.push({localId:l,track:c.track,rtpReceiver:c})}return r}async stopReceiving(t){for(const r of t){it.debug("stopReceiving() [localId:%s]",r);const i=this._rtpReceivers.get(r);if(!i)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(r);try{it.debug("stopReceiving() | calling rtpReceiver.stop()"),i.stop()}catch(o){it.warn("stopReceiving() | rtpReceiver.stop() failed:%o",o)}}}async pauseReceiving(t){}async resumeReceiving(t){}async getReceiverStats(t){const r=this._rtpReceivers.get(t);if(!r)throw new Error("RTCRtpReceiver not found");return r.getStats()}async receiveDataChannel(t){throw new Pm.UnsupportedError("not implemented")}setIceGatherer({iceServers:t,iceTransportPolicy:r}){const i=new RTCIceGatherer({iceServers:t??[],gatherPolicy:r??"all"});i.addEventListener("error",o=>{it.error('iceGatherer "error" event [event:%o]',o)});try{i.gather()}catch(o){it.debug("setIceGatherer() | iceGatherer.gather() failed: %s",o.toString())}this._iceGatherer=i}setIceTransport(){const t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",()=>{switch(t.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),t.addEventListener("icestatechange",()=>{switch(t.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),t.addEventListener("candidatepairchange",r=>{it.debug('iceTransport "candidatepairchange" event [pair:%o]',r.pair)}),this._iceTransport=t}setDtlsTransport(){const t=new RTCDtlsTransport(this._iceTransport);t.addEventListener("statechange",()=>{it.debug('dtlsTransport "statechange" event [state:%s]',t.state)}),t.addEventListener("dtlsstatechange",()=>{it.debug('dtlsTransport "dtlsstatechange" event [state:%s]',t.state),t.state==="closed"&&this.emit("@connectionstatechange","closed")}),t.addEventListener("error",r=>{it.error('dtlsTransport "error" event [event:%o]',r)}),this._dtlsTransport=t}async setupTransport({localDtlsRole:t}){it.debug("setupTransport()");const r=this._dtlsTransport.getLocalParameters();r.role=t,await new Promise((i,o)=>{this.safeEmit("@connect",{dtlsParameters:r},i,o)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const i of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(i);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(i=>i.algorithm==="sha-256"||i.algorithm==="sha-384"||i.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}Uf.Edge11=rw;var Vf={};Object.defineProperty(Vf,"__esModule",{value:!0});Vf.ReactNativeUnifiedPlan=void 0;const vi=At,_W=Ct,s_=Pt,ks=dt,md=Bn,Mm=Ui,SW=Ac,CW=jt,RW=wn,kW=cr,EW=Wi,xe=new _W.Logger("ReactNativeUnifiedPlan"),TW="ReactNativeUnifiedPlan",c_={OS:1024,MIS:1024};class iw extends RW.HandlerInterface{constructor(){super();N(this,"_closed",!1);N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_mapMidTransceiver",new Map);N(this,"_sendStream",new MediaStream);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new iw}get name(){return TW}close(){if(xe.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){xe.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const i=vi.parse(r.sdp),o=md.extractRtpCapabilities({sdpObject:i});return SW.addNackSupportForOpus(o),o}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return xe.debug("getNativeSctpCapabilities()"),{numStreams:c_}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){this.assertNotClosed(),xe.debug("run()"),this._direction=t,this._remoteSdp=new kW.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ks.getSendingRtpParameters("audio",d),video:ks.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ks.getSendingRemoteRtpParameters("audio",d),video:ks.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(xe.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){this.assertNotClosed(),xe.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),xe.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});xe.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();xe.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),xe.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1&&r.forEach((w,y)=>{w.rid=`r${y}`});const s=s_.clone(this._sendingRtpParametersByKind[t.kind]);s.codecs=ks.reduceCodecs(s.codecs,o);const c=s_.clone(this._sendingRemoteRtpParametersByKind[t.kind]);c.codecs=ks.reduceCodecs(c.codecs,o);const u=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});a&&a(l.sender);let d=await this._pc.createOffer(),p=vi.parse(d.sdp);p.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let f;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:p});let m=!1;const g=(0,EW.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&g.spatialLayers>1&&s.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(xe.debug("send() | enabling legacy simulcast for VP9 SVC"),m=!0,p=vi.parse(d.sdp),f=p.media[u.idx],Mm.addLegacySimulcast({offerMediaObject:f,numStreams:g.spatialLayers}),d={type:"offer",sdp:vi.write(p)}),xe.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);let v=l.mid??void 0;if(v||xe.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),s.mid=v,p=vi.parse(this._pc.localDescription.sdp),f=p.media[u.idx],s.rtcp.cname=md.getCname({offerMediaObject:f}),!r)s.encodings=Mm.getRtpEncodings({offerMediaObject:f});else if(r.length===1){let w=Mm.getRtpEncodings({offerMediaObject:f});Object.assign(w[0],r[0]),m&&(w=[w[0]]),s.encodings=w}else s.encodings=r;if(s.encodings.length>1&&(s.codecs[0].mimeType.toLowerCase()==="video/vp8"||s.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const w of s.encodings)w.scalabilityMode?w.scalabilityMode=`L1T${g.temporalLayers}`:w.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:u.reuseMid,offerRtpParameters:s,answerRtpParameters:c,codecOptions:i});const h={type:"answer",sdp:this._remoteSdp.getSdp()};return xe.debug("send() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),v||(v=l.mid,s.mid=v),this._mapMidTransceiver.set(v,l),{localId:v,rtpParameters:s,rtpSender:l.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;xe.debug("stopSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const o=await this._pc.createOffer();xe.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const a={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),xe.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const i=await this._pc.createOffer();xe.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),xe.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const i=await this._pc.createOffer();xe.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const o={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?xe.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):xe.debug("replaceTrack() [localId:%s, no track]",t);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),xe.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{u<=r?c.active=!0:c.active=!1}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();xe.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),xe.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const i=this._mapMidTransceiver.get(t);if(!i)throw new Error("associated RTCRtpTransceiver not found");const o=i.sender.getParameters();o.encodings.forEach((c,u)=>{o.encodings[u]={...c,...r}}),await i.sender.setParameters(o),this._remoteSdp.muxMediaSectionSimulcast(t,o.encodings);const a=await this._pc.createOffer();xe.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const s={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};xe.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%c_.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=vi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),xe.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};xe.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d,streamId:p}=c;xe.debug("receive() [trackId:%s, kind:%s]",u,l);const f=d.mid??String(this._mapMidTransceiver.size);i.set(u,f),this._remoteSdp.receive({mid:f,kind:l,offerRtpParameters:d,streamId:p??d.rtcp.cname,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);for(const c of t){const{trackId:u,onRtpReceiver:l}=c;if(l){const d=i.get(u),p=this._pc.getTransceivers().find(f=>f.mid===d);if(!p)throw new Error("transceiver not found");l(p.receiver)}}let a=await this._pc.createAnswer();const s=vi.parse(a.sdp);for(const c of t){const{trackId:u,rtpParameters:l}=c,d=i.get(u),p=s.media.find(f=>String(f.mid)===d);md.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:vi.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),xe.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{trackId:u}=c,l=i.get(u),d=this._pc.getTransceivers().find(p=>p.mid===l);if(d)this._mapMidTransceiver.set(l,d),r.push({localId:l,track:d.receiver.track,rtpReceiver:d.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const o of t){xe.debug("stopReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();xe.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const o of t)this._mapMidTransceiver.delete(o)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){xe.debug("pauseReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();xe.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const o of t){xe.debug("resumeReceiving() [localId:%s]",o);const a=this._mapMidTransceiver.get(o);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(o)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();xe.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c,protocol:i};xe.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const d={type:"offer",sdp:this._remoteSdp.getSdp()};xe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=vi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}xe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=vi.parse(this._pc.localDescription.sdp));const i=md.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new CW.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Vf.ReactNativeUnifiedPlan=iw;var Hf={};Object.defineProperty(Hf,"__esModule",{value:!0});Hf.ReactNative=void 0;const yi=At,DW=Ct,nu=jt,Lm=Pt,Es=dt,gd=Bn,u_=Ja,IW=wn,PW=cr,Qe=new DW.Logger("ReactNative"),AW="ReactNative",l_={OS:1024,MIS:1024};class ow extends IW.HandlerInterface{constructor(){super();N(this,"_direction");N(this,"_remoteSdp");N(this,"_sendingRtpParametersByKind");N(this,"_sendingRemoteRtpParametersByKind");N(this,"_forcedLocalDtlsRole");N(this,"_pc");N(this,"_sendStream",new MediaStream);N(this,"_mapSendLocalIdTrack",new Map);N(this,"_nextSendLocalId",0);N(this,"_mapRecvLocalIdInfo",new Map);N(this,"_hasDataChannelMediaSection",!1);N(this,"_nextSendSctpStreamId",0);N(this,"_transportReady",!1)}static createFactory(){return()=>new ow}get name(){return AW}close(){if(Qe.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){Qe.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch{}const i=yi.parse(r.sdp);return gd.extractRtpCapabilities({sdpObject:i})}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return Qe.debug("getNativeSctpCapabilities()"),{numStreams:l_}}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,extendedRtpCapabilities:d}){Qe.debug("run()"),this._direction=t,this._remoteSdp=new PW.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:Es.getSendingRtpParameters("audio",d),video:Es.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Es.getSendingRemoteRtpParameters("audio",d),video:Es.getSendingRemoteRtpParameters("video",d)},o.role&&o.role!=="auto"&&(this._forcedLocalDtlsRole=o.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:s??[],iceTransportPolicy:c??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...u},l),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",p=>{this.emit("@icecandidateerror",p)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(Qe.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){Qe.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(Qe.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});Qe.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};Qe.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};Qe.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Qe.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertSendDirection(),Qe.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),o&&Qe.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),s=yi.parse(a.sdp);s.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let c;const u=Lm.clone(this._sendingRtpParametersByKind[t.kind]);u.codecs=Es.reduceCodecs(u.codecs);const l=Lm.clone(this._sendingRemoteRtpParametersByKind[t.kind]);if(l.codecs=Es.reduceCodecs(l.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),t.kind==="video"&&r&&r.length>1&&(Qe.debug("send() | enabling simulcast"),s=yi.parse(a.sdp),c=s.media.find(f=>f.type==="video"),u_.addLegacySimulcast({offerMediaObject:c,track:t,numStreams:r.length}),a={type:"offer",sdp:yi.write(s)}),Qe.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),s=yi.parse(this._pc.localDescription.sdp),c=s.media.find(f=>f.type===t.kind),u.rtcp.cname=gd.getCname({offerMediaObject:c}),u.encodings=u_.getRtpEncodings({offerMediaObject:c,track:t}),r)for(let f=0;f<u.encodings.length;++f)r[f]&&Object.assign(u.encodings[f],r[f]);if(u.encodings.length>1&&(u.codecs[0].mimeType.toLowerCase()==="video/vp8"||u.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const f of u.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:c,offerRtpParameters:u,answerRtpParameters:l,codecOptions:i});const d={type:"answer",sdp:this._remoteSdp.getSdp()};Qe.debug("send() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d);const p=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(p,t),{localId:p,rtpParameters:u}}async stopSending(t){this.assertSendDirection(),Qe.debug("stopSending() [localId:%s]",t);const r=this._mapSendLocalIdTrack.get(t);if(!r)throw new Error("track not found");this._mapSendLocalIdTrack.delete(t),this._sendStream.removeTrack(r),this._pc.addStream(this._sendStream);const i=await this._pc.createOffer();Qe.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(a){if(this._sendStream.getTracks().length===0){Qe.warn("stopSending() | ignoring expected error due no sending tracks: %s",a.toString());return}throw a}if(this._pc.signalingState==="stable")return;const o={type:"answer",sdp:this._remoteSdp.getSdp()};Qe.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}async pauseSending(t){}async resumeSending(t){}async replaceTrack(t,r){throw new nu.UnsupportedError("not implemented")}async setMaxSpatialLayer(t,r){throw new nu.UnsupportedError("not implemented")}async setRtpEncodingParameters(t,r){throw new nu.UnsupportedError("not implemented")}async getSenderStats(t){throw new nu.UnsupportedError("not implemented")}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertSendDirection();const s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:i,protocol:a};Qe.debug("sendDataChannel() [options:%o]",s);const c=this._pc.createDataChannel(o,s);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l_.MIS,!this._hasDataChannelMediaSection){const l=await this._pc.createOffer(),d=yi.parse(l.sdp),p=d.media.find(m=>m.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:d}),Qe.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",l),await this._pc.setLocalDescription(l),this._remoteSdp.sendSctpAssociation({offerMediaObject:p});const f={type:"answer",sdp:this._remoteSdp.getSdp()};Qe.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const u={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits};return{dataChannel:c,sctpStreamParameters:u}}async receive(t){this.assertRecvDirection();const r=[],i=new Map;for(const c of t){const{trackId:u,kind:l,rtpParameters:d}=c;Qe.debug("receive() [trackId:%s, kind:%s]",u,l);const p=l;let f=c.streamId??d.rtcp.cname;Qe.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),f+=`-hack-${Lm.generateRandomNumber()}`,i.set(u,f),this._remoteSdp.receive({mid:p,kind:l,offerRtpParameters:d,streamId:f,trackId:u})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};Qe.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let a=await this._pc.createAnswer();const s=yi.parse(a.sdp);for(const c of t){const{kind:u,rtpParameters:l}=c,d=u,p=s.media.find(f=>String(f.mid)===d);gd.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}a={type:"answer",sdp:yi.write(s)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:s}),Qe.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const c of t){const{kind:u,trackId:l,rtpParameters:d}=c,p=l,f=u,m=i.get(l),v=this._pc.getRemoteStreams().find(h=>h.id===m).getTrackById(p);if(!v)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(p,{mid:f,rtpParameters:d}),r.push({localId:p,track:v})}return r}async stopReceiving(t){this.assertRecvDirection();for(const o of t){Qe.debug("stopReceiving() [localId:%s]",o);const{mid:a,rtpParameters:s}=this._mapRecvLocalIdInfo.get(o)??{};this._mapRecvLocalIdInfo.delete(o),this._remoteSdp.planBStopReceiving({mid:a,offerRtpParameters:s})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};Qe.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();Qe.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async pauseReceiving(t){}async resumeReceiving(t){}async getReceiverStats(t){throw new nu.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){this.assertRecvDirection();const{streamId:o,ordered:a,maxPacketLifeTime:s,maxRetransmits:c}=t,u={negotiated:!0,id:o,ordered:a,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:c,protocol:i};Qe.debug("receiveDataChannel() [options:%o]",u);const l=this._pc.createDataChannel(r,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const d={type:"offer",sdp:this._remoteSdp.getSdp()};Qe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d);const p=await this._pc.createAnswer();if(!this._transportReady){const f=yi.parse(p.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}Qe.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",p),await this._pc.setLocalDescription(p),this._hasDataChannelMediaSection=!0}return{dataChannel:l}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=yi.parse(this._pc.localDescription.sdp));const i=gd.extractDtlsParameters({sdpObject:r});i.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((o,a)=>{this.safeEmit("@connect",{dtlsParameters:i},o,a)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}Hf.ReactNative=ow;Object.defineProperty(Pc,"__esModule",{value:!0});Pc.Device=void 0;Pc.detectDevice=TE;const NW=Aj,MW=Ct,LW=oi,Ts=jt,d_=Pt,No=dt,OW=ll,FW=Nf,BW=Mf,zW=Lf,jW=Of,$W=Ff,UW=Bf,WW=zf,VW=jf,HW=$f,GW=Uf,qW=Vf,KW=Hf,on=new MW.Logger("Device");function TE(e){var n,t,r,i;if(!e&&typeof navigator=="object"&&navigator.product==="ReactNative"){if(on.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"){on.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(on.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(on.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative")}else if(e||typeof navigator=="object"&&typeof navigator.userAgent=="string"){e??(e=navigator.userAgent);const o=new NW.UAParser(e);on.debug("detectDevice() | browser detected [userAgent:%s, parsed:%o]",e,o.getResult());const a=o.getBrowser(),s=(n=a.name)==null?void 0:n.toLowerCase(),c=parseInt(a.major??"0"),l=(t=o.getEngine().name)==null?void 0:t.toLowerCase(),d=o.getOS(),p=(r=d.name)==null?void 0:r.toLowerCase(),f=parseFloat(d.version??"0"),g=(i=o.getDevice().model)==null?void 0:i.toLowerCase(),v=p==="ios"||g==="ipad",h=s&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(s),w=s&&["firefox","mobile firefox","mobile focus"].includes(s),y=s&&["safari","mobile safari"].includes(s),b=s&&["edge"].includes(s);if((h||b)&&!v&&c>=111)return"Chrome111";if(h&&!v&&c>=74||b&&!v&&c>=88)return"Chrome74";if(h&&!v&&c>=70)return"Chrome70";if(h&&!v&&c>=67)return"Chrome67";if(h&&!v&&c>=55)return"Chrome55";if(w&&!v&&c>=120)return"Firefox120";if(w&&!v&&c>=60)return"Firefox60";if(w&&v&&f>=14.3)return"Safari12";if(y&&c>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(y&&c>=11)return"Safari11";if(b&&!v&&c>=11&&c<=18)return"Edge11";if(l==="webkit"&&v&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(l==="blink"){const x=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(x){const _=Number(x[1]);return _>=111?"Chrome111":_>=74?"Chrome74":_>=70?"Chrome70":_>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{on.warn("detectDevice() | browser not supported [name:%s, version:%s]",s,c);return}}else{on.warn("detectDevice() | unknown device");return}}class XW{constructor({handlerName:n,handlerFactory:t}={}){N(this,"_handlerFactory");N(this,"_handlerName");N(this,"_loaded",!1);N(this,"_extendedRtpCapabilities");N(this,"_recvRtpCapabilities");N(this,"_canProduceByKind");N(this,"_sctpCapabilities");N(this,"_observer",new LW.EnhancedEventEmitter);if(on.debug("constructor()"),n&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(n)on.debug("constructor() | handler given: %s",n);else if(n=TE(),n)on.debug("constructor() | detected handler: %s",n);else throw new Ts.UnsupportedError("device not supported");switch(n){case"Chrome111":{this._handlerFactory=FW.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=BW.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=zW.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=jW.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=$W.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=UW.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=WW.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=VW.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=HW.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=GW.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=qW.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=KW.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${n}"`)}}const r=this._handlerFactory();this._handlerName=r.name,r.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new Ts.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new Ts.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:n}){on.debug("load() [routerRtpCapabilities:%o]",n);let t;try{if(this._loaded)throw new Ts.InvalidStateError("already loaded");const r=d_.clone(n);No.validateRtpCapabilities(r),t=this._handlerFactory();const i=await t.getNativeRtpCapabilities();on.debug("load() | got native RTP capabilities:%o",i);const o=d_.clone(i);No.validateRtpCapabilities(o),this._extendedRtpCapabilities=No.getExtendedRtpCapabilities(o,r),on.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=No.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=No.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=No.getRecvRtpCapabilities(this._extendedRtpCapabilities),No.validateRtpCapabilities(this._recvRtpCapabilities),on.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),on.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),No.validateSctpCapabilities(this._sctpCapabilities),on.debug("load() succeeded"),this._loaded=!0,t.close()}catch(r){throw t&&t.close(),r}}canProduce(n){if(this._loaded){if(n!=="audio"&&n!=="video")throw new TypeError(`invalid kind "${n}"`)}else throw new Ts.InvalidStateError("not loaded");return this._canProduceByKind[n]}createSendTransport({id:n,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l}){return on.debug("createSendTransport()"),this.createTransport({direction:"send",id:n,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l})}createRecvTransport({id:n,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l}){return on.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:n,iceParameters:t,iceCandidates:r,dtlsParameters:i,sctpParameters:o,iceServers:a,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:u,appData:l})}createTransport({direction:n,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d}){if(this._loaded){if(typeof t!="string")throw new TypeError("missing id");if(typeof r!="object")throw new TypeError("missing iceParameters");if(Array.isArray(i)){if(typeof o!="object")throw new TypeError("missing dtlsParameters");if(a&&typeof a!="object")throw new TypeError("wrong sctpParameters");if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new Ts.InvalidStateError("not loaded");const p=new OW.Transport({direction:n,id:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,additionalSettings:u,proprietaryConstraints:l,appData:d,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",p),p}}Pc.Device=XW;var DE={};Object.defineProperty(DE,"__esModule",{value:!0});var IE={};Object.defineProperty(IE,"__esModule",{value:!0});(function(e){var n=oo&&oo.__createBinding||(Object.create?function(r,i,o,a){a===void 0&&(a=o);var s=Object.getOwnPropertyDescriptor(i,o);(!s||("get"in s?!i.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(r,a,s)}:function(r,i,o,a){a===void 0&&(a=o),r[a]=i[o]}),t=oo&&oo.__exportStar||function(r,i){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&n(i,r,o)};Object.defineProperty(e,"__esModule",{value:!0}),t(Pc,e),t(ll,e),t(dl,e),t(pl,e),t(fl,e),t(hl,e),t(DE,e),t(IE,e),t(wn,e),t(jt,e)})(uE);var Gf={},PE={},ai={};Object.defineProperty(ai,"__esModule",{value:!0});function ml(e,n,...t){if(!e)throw new TypeError(AE(n,t))}function AE(e,n){let t=0;return e.replace(/%[os]/gu,()=>NE(n[t++]))}function NE(e){return typeof e!="object"||e===null?String(e):Object.prototype.toString.call(e)}let Cv;function QW(e){ml(typeof e=="function"||e===void 0,"The error handler must be a function or undefined, but got %o.",e),Cv=e}function YW(e){try{const n=e instanceof Error?e:new Error(NE(e));if(Cv){Cv(n);return}if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:n,message:n.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)}catch{}}const ti=typeof window<"u"?window:typeof self<"u"?self:typeof oo<"u"?oo:typeof globalThis<"u"?globalThis:void 0;let Rv;function JW(e){ml(typeof e=="function"||e===void 0,"The warning handler must be a function or undefined, but got %o.",e),Rv=e}class xo{constructor(n,t){this.code=n,this.message=t}warn(...n){var t;try{if(Rv){Rv({...this,args:n});return}const r=((t=new Error().stack)!==null&&t!==void 0?t:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...n,r)}catch{}}}const ZW=new xo("W01","Unable to initialize event under dispatching."),e8=new xo("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),t8=new xo("W03","Assigning any truthy value to 'returnValue' property has no effect."),n8=new xo("W04","Unable to preventDefault on non-cancelable events."),r8=new xo("W05","Unable to preventDefault inside passive event listener invocation."),i8=new xo("W06","An event listener wasn't added because it has been added already: %o, %o"),Om=new xo("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),p_=new xo("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),o8=new xo("W09","Event attribute handler must be a function: %o");class Vi{static get NONE(){return f_}static get CAPTURING_PHASE(){return h_}static get AT_TARGET(){return m_}static get BUBBLING_PHASE(){return g_}constructor(n,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const r=t??{};kv.set(this,{type:String(n),bubbles:!!r.bubbles,cancelable:!!r.cancelable,composed:!!r.composed,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return $t(this).type}get target(){return $t(this).target}get srcElement(){return $t(this).target}get currentTarget(){return $t(this).currentTarget}composedPath(){const n=$t(this).currentTarget;return n?[n]:[]}get NONE(){return f_}get CAPTURING_PHASE(){return h_}get AT_TARGET(){return m_}get BUBBLING_PHASE(){return g_}get eventPhase(){return $t(this).dispatchFlag?2:0}stopPropagation(){$t(this).stopPropagationFlag=!0}get cancelBubble(){return $t(this).stopPropagationFlag}set cancelBubble(n){n?$t(this).stopPropagationFlag=!0:e8.warn()}stopImmediatePropagation(){const n=$t(this);n.stopPropagationFlag=n.stopImmediatePropagationFlag=!0}get bubbles(){return $t(this).bubbles}get cancelable(){return $t(this).cancelable}get returnValue(){return!$t(this).canceledFlag}set returnValue(n){n?t8.warn():v_($t(this))}preventDefault(){v_($t(this))}get defaultPrevented(){return $t(this).canceledFlag}get composed(){return $t(this).composed}get isTrusted(){return!1}get timeStamp(){return $t(this).timeStamp}initEvent(n,t=!1,r=!1){const i=$t(this);if(i.dispatchFlag){ZW.warn();return}kv.set(this,{...i,type:String(n),bubbles:!!t,cancelable:!!r,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}}const f_=0,h_=1,m_=2,g_=3,kv=new WeakMap;function $t(e,n="this"){const t=kv.get(e);return ml(t!=null,"'%s' must be an object that Event constructor created, but got another one: %o",n,e),t}function v_(e){if(e.inPassiveListenerFlag){r8.warn();return}if(!e.cancelable){n8.warn();return}e.canceledFlag=!0}Object.defineProperty(Vi,"NONE",{enumerable:!0});Object.defineProperty(Vi,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(Vi,"AT_TARGET",{enumerable:!0});Object.defineProperty(Vi,"BUBBLING_PHASE",{enumerable:!0});const Fm=Object.getOwnPropertyNames(Vi.prototype);for(let e=0;e<Fm.length;++e)Fm[e]!=="constructor"&&Object.defineProperty(Vi.prototype,Fm[e],{enumerable:!0});typeof ti<"u"&&typeof ti.Event<"u"&&Object.setPrototypeOf(Vi.prototype,ti.Event.prototype);function a8(e){return ti.DOMException?new ti.DOMException(e,"InvalidStateError"):(Ds==null&&(Ds=class ME extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,ME)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(Ds.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),w_(Ds),w_(Ds.prototype)),new Ds(e))}let Ds;const y_={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function w_(e){const n=Object.keys(y_);for(let t=0;t<n.length;++t){const r=n[t],i=y_[r];Object.defineProperty(e,r,{get(){return i},configurable:!0,enumerable:!0})}}class qf extends Vi{static wrap(n){return new(OE(n))(n)}constructor(n){super(n.type,{bubbles:n.bubbles,cancelable:n.cancelable,composed:n.composed}),n.cancelBubble&&super.stopPropagation(),n.defaultPrevented&&super.preventDefault(),LE.set(this,{original:n});const t=Object.keys(n);for(let r=0;r<t.length;++r){const i=t[r];i in this||Object.defineProperty(this,i,FE(n,i))}}stopPropagation(){super.stopPropagation();const{original:n}=Oo(this);"stopPropagation"in n&&n.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(n){super.cancelBubble=n;const{original:t}=Oo(this);"cancelBubble"in t&&(t.cancelBubble=n)}stopImmediatePropagation(){super.stopImmediatePropagation();const{original:n}=Oo(this);"stopImmediatePropagation"in n&&n.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(n){super.returnValue=n;const{original:t}=Oo(this);"returnValue"in t&&(t.returnValue=n)}preventDefault(){super.preventDefault();const{original:n}=Oo(this);"preventDefault"in n&&n.preventDefault()}get timeStamp(){const{original:n}=Oo(this);return"timeStamp"in n?n.timeStamp:super.timeStamp}}const LE=new WeakMap;function Oo(e){const n=LE.get(e);return ml(n!=null,"'this' is expected an Event object, but got",e),n}const Np=new WeakMap;Np.set(Object.prototype,qf);typeof ti<"u"&&typeof ti.Event<"u"&&Np.set(ti.Event.prototype,qf);function OE(e){const n=Object.getPrototypeOf(e);if(n==null)return qf;let t=Np.get(n);return t==null&&(t=s8(OE(n),n),Np.set(n,t)),t}function s8(e,n){class t extends e{}const r=Object.keys(n);for(let i=0;i<r.length;++i)Object.defineProperty(t.prototype,r[i],FE(n,r[i]));return t}function FE(e,n){const t=Object.getOwnPropertyDescriptor(e,n);return{get(){const r=Oo(this).original,i=r[n];return typeof i=="function"?i.bind(r):i},set(r){const i=Oo(this).original;i[n]=r},configurable:t.configurable,enumerable:t.enumerable}}function c8(e,n,t,r,i,o){return{callback:e,flags:(n?1:0)|(t?2:0)|(r?4:0),signal:i,signalListener:o}}function u8(e){e.flags|=8}function BE(e){return(e.flags&1)===1}function zE(e){return(e.flags&2)===2}function jE(e){return(e.flags&4)===4}function l8(e){return(e.flags&8)===8}function d8({callback:e},n,t){try{typeof e=="function"?e.call(n,t):typeof e.handleEvent=="function"&&e.handleEvent(t)}catch(r){YW(r)}}function $E({listeners:e},n,t){for(let r=0;r<e.length;++r)if(e[r].callback===n&&BE(e[r])===t)return r;return-1}function UE(e,n,t,r,i,o){let a;o&&(a=aw.bind(null,e,n,t),o.addEventListener("abort",a));const s=c8(n,t,r,i,o,a);return e.cow?(e.cow=!1,e.listeners=[...e.listeners,s]):e.listeners.push(s),s}function aw(e,n,t){const r=$E(e,n,t);return r!==-1?WE(e,r):!1}function WE(e,n,t=!1){const r=e.listeners[n];return u8(r),r.signal&&r.signal.removeEventListener("abort",r.signalListener),e.cow&&!t?(e.cow=!1,e.listeners=e.listeners.filter((i,o)=>o!==n),!1):(e.listeners.splice(n,1),!0)}function p8(){return Object.create(null)}function VE(e,n){var t;return(t=e[n])!==null&&t!==void 0?t:e[n]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}let Nc=class{constructor(){HE.set(this,p8())}addEventListener(n,t,r){const i=lc(this),{callback:o,capture:a,once:s,passive:c,signal:u,type:l}=f8(n,t,r);if(o==null||u!=null&&u.aborted)return;const d=VE(i,l),p=$E(d,o,a);if(p!==-1){m8(d.listeners[p],c,s,u);return}UE(d,o,a,c,s,u)}removeEventListener(n,t,r){const i=lc(this),{callback:o,capture:a,type:s}=h8(n,t,r),c=i[s];o!=null&&c&&aw(c,o,a)}dispatchEvent(n){const t=lc(this)[String(n.type)];if(t==null)return!0;const r=n instanceof Vi?n:qf.wrap(n),i=$t(r,"event");if(i.dispatchFlag)throw a8("This event has been in dispatching.");if(i.dispatchFlag=!0,i.target=i.currentTarget=this,!i.stopPropagationFlag){const{cow:o,listeners:a}=t;t.cow=!0;for(let s=0;s<a.length;++s){const c=a[s];if(!l8(c)&&(jE(c)&&WE(t,s,!o)&&(s-=1),i.inPassiveListenerFlag=zE(c),d8(c,this,r),i.inPassiveListenerFlag=!1,i.stopImmediatePropagationFlag))break}o||(t.cow=!1)}return i.target=null,i.currentTarget=null,i.stopImmediatePropagationFlag=!1,i.stopPropagationFlag=!1,i.dispatchFlag=!1,!i.canceledFlag}};const HE=new WeakMap;function lc(e,n="this"){const t=HE.get(e);return ml(t!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",n,e),t}function f8(e,n,t){var r;return GE(n),typeof t=="object"&&t!==null?{type:String(e),callback:n??void 0,capture:!!t.capture,passive:!!t.passive,once:!!t.once,signal:(r=t.signal)!==null&&r!==void 0?r:void 0}:{type:String(e),callback:n??void 0,capture:!!t,passive:!1,once:!1,signal:void 0}}function h8(e,n,t){return GE(n),typeof t=="object"&&t!==null?{type:String(e),callback:n??void 0,capture:!!t.capture}:{type:String(e),callback:n??void 0,capture:!!t}}function GE(e){if(!(typeof e=="function"||typeof e=="object"&&e!==null&&typeof e.handleEvent=="function")){if(e==null||typeof e=="object"){p_.warn(e);return}throw new TypeError(AE(p_.message,[e]))}}function m8(e,n,t,r){i8.warn(BE(e)?"capture":"bubble",e.callback),zE(e)!==n&&Om.warn("passive"),jE(e)!==t&&Om.warn("once"),e.signal!==r&&Om.warn("signal")}const Bm=Object.getOwnPropertyNames(Nc.prototype);for(let e=0;e<Bm.length;++e)Bm[e]!=="constructor"&&Object.defineProperty(Nc.prototype,Bm[e],{enumerable:!0});typeof ti<"u"&&typeof ti.EventTarget<"u"&&Object.setPrototypeOf(Nc.prototype,ti.EventTarget.prototype);function qE(e,n){var t,r;return(r=(t=lc(e,"target")[n])===null||t===void 0?void 0:t.attrCallback)!==null&&r!==void 0?r:null}function KE(e,n,t){t!=null&&typeof t!="function"&&o8.warn(t),typeof t=="function"||typeof t=="object"&&t!==null?g8(e,n,t):v8(e,n)}function g8(e,n,t){const r=VE(lc(e,"target"),String(n));r.attrCallback=t,r.attrListener==null&&(r.attrListener=UE(r,y8(r),!1,!1,!1,void 0))}function v8(e,n){const r=lc(e,"target")[String(n)];r&&r.attrListener&&(aw(r,r.attrListener.callback,!1),r.attrCallback=r.attrListener=void 0)}function y8(e){return function(n){const t=e.attrCallback;typeof t=="function"&&t.call(this,n)}}function w8(...e){class n extends Nc{}for(let t=0;t<e.length;++t)XE(n.prototype,e[t]);return n}function XE(e,n,t){Object.defineProperty(e,`on${n}`,{get(){return qE(this,n)},set(r){KE(this,n,r)},configurable:!0,enumerable:!0})}ai.Event=Vi;ai.EventTarget=Nc;ai.default=Nc;ai.defineCustomEventTarget=w8;ai.defineEventAttribute=XE;ai.getEventAttributeValue=qE;ai.setErrorHandler=QW;ai.setEventAttributeValue=KE;ai.setWarningHandler=JW;var QE={},Kf={},Xf={};Object.defineProperty(Xf,"__esModule",{value:!0});Xf.default=x8;let vd;const b8=new Uint8Array(16);function x8(){if(!vd&&(vd=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vd))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vd(b8)}var ma={},Za={},Qf={};Object.defineProperty(Qf,"__esModule",{value:!0});Qf.default=void 0;var _8=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;Qf.default=_8;Object.defineProperty(Za,"__esModule",{value:!0});Za.default=void 0;var S8=C8(Qf);function C8(e){return e&&e.__esModule?e:{default:e}}function R8(e){return typeof e=="string"&&S8.default.test(e)}var k8=R8;Za.default=k8;Object.defineProperty(ma,"__esModule",{value:!0});ma.default=void 0;ma.unsafeStringify=YE;var E8=T8(Za);function T8(e){return e&&e.__esModule?e:{default:e}}const dn=[];for(let e=0;e<256;++e)dn.push((e+256).toString(16).slice(1));function YE(e,n=0){return dn[e[n+0]]+dn[e[n+1]]+dn[e[n+2]]+dn[e[n+3]]+"-"+dn[e[n+4]]+dn[e[n+5]]+"-"+dn[e[n+6]]+dn[e[n+7]]+"-"+dn[e[n+8]]+dn[e[n+9]]+"-"+dn[e[n+10]]+dn[e[n+11]]+dn[e[n+12]]+dn[e[n+13]]+dn[e[n+14]]+dn[e[n+15]]}function D8(e,n=0){const t=YE(e,n);if(!(0,E8.default)(t))throw TypeError("Stringified UUID is invalid");return t}var I8=D8;ma.default=I8;Object.defineProperty(Kf,"__esModule",{value:!0});Kf.default=void 0;var P8=N8(Xf),A8=ma;function N8(e){return e&&e.__esModule?e:{default:e}}let b_,zm,jm=0,$m=0;function M8(e,n,t){let r=n&&t||0;const i=n||new Array(16);e=e||{};let o=e.node||b_,a=e.clockseq!==void 0?e.clockseq:zm;if(o==null||a==null){const p=e.random||(e.rng||P8.default)();o==null&&(o=b_=[p[0]|1,p[1],p[2],p[3],p[4],p[5]]),a==null&&(a=zm=(p[6]<<8|p[7])&16383)}let s=e.msecs!==void 0?e.msecs:Date.now(),c=e.nsecs!==void 0?e.nsecs:$m+1;const u=s-jm+(c-$m)/1e4;if(u<0&&e.clockseq===void 0&&(a=a+1&16383),(u<0||s>jm)&&e.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");jm=s,$m=c,zm=a,s+=122192928e5;const l=((s&268435455)*1e4+c)%4294967296;i[r++]=l>>>24&255,i[r++]=l>>>16&255,i[r++]=l>>>8&255,i[r++]=l&255;const d=s/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=d&255,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=a>>>8|128,i[r++]=a&255;for(let p=0;p<6;++p)i[r+p]=o[p];return n||(0,A8.unsafeStringify)(i)}var L8=M8;Kf.default=L8;var Yf={},sa={},gl={};Object.defineProperty(gl,"__esModule",{value:!0});gl.default=void 0;var O8=F8(Za);function F8(e){return e&&e.__esModule?e:{default:e}}function B8(e){if(!(0,O8.default)(e))throw TypeError("Invalid UUID");let n;const t=new Uint8Array(16);return t[0]=(n=parseInt(e.slice(0,8),16))>>>24,t[1]=n>>>16&255,t[2]=n>>>8&255,t[3]=n&255,t[4]=(n=parseInt(e.slice(9,13),16))>>>8,t[5]=n&255,t[6]=(n=parseInt(e.slice(14,18),16))>>>8,t[7]=n&255,t[8]=(n=parseInt(e.slice(19,23),16))>>>8,t[9]=n&255,t[10]=(n=parseInt(e.slice(24,36),16))/1099511627776&255,t[11]=n/4294967296&255,t[12]=n>>>24&255,t[13]=n>>>16&255,t[14]=n>>>8&255,t[15]=n&255,t}var z8=B8;gl.default=z8;Object.defineProperty(sa,"__esModule",{value:!0});sa.URL=sa.DNS=void 0;sa.default=V8;var j8=ma,$8=U8(gl);function U8(e){return e&&e.__esModule?e:{default:e}}function W8(e){e=unescape(encodeURIComponent(e));const n=[];for(let t=0;t<e.length;++t)n.push(e.charCodeAt(t));return n}const JE="6ba7b810-9dad-11d1-80b4-00c04fd430c8";sa.DNS=JE;const ZE="6ba7b811-9dad-11d1-80b4-00c04fd430c8";sa.URL=ZE;function V8(e,n,t){function r(i,o,a,s){var c;if(typeof i=="string"&&(i=W8(i)),typeof o=="string"&&(o=(0,$8.default)(o)),((c=o)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+i.length);if(u.set(o),u.set(i,o.length),u=t(u),u[6]=u[6]&15|n,u[8]=u[8]&63|128,a){s=s||0;for(let l=0;l<16;++l)a[s+l]=u[l];return a}return(0,j8.unsafeStringify)(u)}try{r.name=e}catch{}return r.DNS=JE,r.URL=ZE,r}var Jf={};Object.defineProperty(Jf,"__esModule",{value:!0});Jf.default=void 0;function H8(e){if(typeof e=="string"){const n=unescape(encodeURIComponent(e));e=new Uint8Array(n.length);for(let t=0;t<n.length;++t)e[t]=n.charCodeAt(t)}return G8(q8(K8(e),e.length*8))}function G8(e){const n=[],t=e.length*32,r="0123456789abcdef";for(let i=0;i<t;i+=8){const o=e[i>>5]>>>i%32&255,a=parseInt(r.charAt(o>>>4&15)+r.charAt(o&15),16);n.push(a)}return n}function eT(e){return(e+64>>>9<<4)+14+1}function q8(e,n){e[n>>5]|=128<<n%32,e[eT(n)-1]=n;let t=1732584193,r=-271733879,i=-1732584194,o=271733878;for(let a=0;a<e.length;a+=16){const s=t,c=r,u=i,l=o;t=Cn(t,r,i,o,e[a],7,-680876936),o=Cn(o,t,r,i,e[a+1],12,-389564586),i=Cn(i,o,t,r,e[a+2],17,606105819),r=Cn(r,i,o,t,e[a+3],22,-1044525330),t=Cn(t,r,i,o,e[a+4],7,-176418897),o=Cn(o,t,r,i,e[a+5],12,1200080426),i=Cn(i,o,t,r,e[a+6],17,-1473231341),r=Cn(r,i,o,t,e[a+7],22,-45705983),t=Cn(t,r,i,o,e[a+8],7,1770035416),o=Cn(o,t,r,i,e[a+9],12,-1958414417),i=Cn(i,o,t,r,e[a+10],17,-42063),r=Cn(r,i,o,t,e[a+11],22,-1990404162),t=Cn(t,r,i,o,e[a+12],7,1804603682),o=Cn(o,t,r,i,e[a+13],12,-40341101),i=Cn(i,o,t,r,e[a+14],17,-1502002290),r=Cn(r,i,o,t,e[a+15],22,1236535329),t=Rn(t,r,i,o,e[a+1],5,-165796510),o=Rn(o,t,r,i,e[a+6],9,-1069501632),i=Rn(i,o,t,r,e[a+11],14,643717713),r=Rn(r,i,o,t,e[a],20,-373897302),t=Rn(t,r,i,o,e[a+5],5,-701558691),o=Rn(o,t,r,i,e[a+10],9,38016083),i=Rn(i,o,t,r,e[a+15],14,-660478335),r=Rn(r,i,o,t,e[a+4],20,-405537848),t=Rn(t,r,i,o,e[a+9],5,568446438),o=Rn(o,t,r,i,e[a+14],9,-1019803690),i=Rn(i,o,t,r,e[a+3],14,-187363961),r=Rn(r,i,o,t,e[a+8],20,1163531501),t=Rn(t,r,i,o,e[a+13],5,-1444681467),o=Rn(o,t,r,i,e[a+2],9,-51403784),i=Rn(i,o,t,r,e[a+7],14,1735328473),r=Rn(r,i,o,t,e[a+12],20,-1926607734),t=kn(t,r,i,o,e[a+5],4,-378558),o=kn(o,t,r,i,e[a+8],11,-2022574463),i=kn(i,o,t,r,e[a+11],16,1839030562),r=kn(r,i,o,t,e[a+14],23,-35309556),t=kn(t,r,i,o,e[a+1],4,-1530992060),o=kn(o,t,r,i,e[a+4],11,1272893353),i=kn(i,o,t,r,e[a+7],16,-155497632),r=kn(r,i,o,t,e[a+10],23,-1094730640),t=kn(t,r,i,o,e[a+13],4,681279174),o=kn(o,t,r,i,e[a],11,-358537222),i=kn(i,o,t,r,e[a+3],16,-722521979),r=kn(r,i,o,t,e[a+6],23,76029189),t=kn(t,r,i,o,e[a+9],4,-640364487),o=kn(o,t,r,i,e[a+12],11,-421815835),i=kn(i,o,t,r,e[a+15],16,530742520),r=kn(r,i,o,t,e[a+2],23,-995338651),t=En(t,r,i,o,e[a],6,-198630844),o=En(o,t,r,i,e[a+7],10,1126891415),i=En(i,o,t,r,e[a+14],15,-1416354905),r=En(r,i,o,t,e[a+5],21,-57434055),t=En(t,r,i,o,e[a+12],6,1700485571),o=En(o,t,r,i,e[a+3],10,-1894986606),i=En(i,o,t,r,e[a+10],15,-1051523),r=En(r,i,o,t,e[a+1],21,-2054922799),t=En(t,r,i,o,e[a+8],6,1873313359),o=En(o,t,r,i,e[a+15],10,-30611744),i=En(i,o,t,r,e[a+6],15,-1560198380),r=En(r,i,o,t,e[a+13],21,1309151649),t=En(t,r,i,o,e[a+4],6,-145523070),o=En(o,t,r,i,e[a+11],10,-1120210379),i=En(i,o,t,r,e[a+2],15,718787259),r=En(r,i,o,t,e[a+9],21,-343485551),t=Wo(t,s),r=Wo(r,c),i=Wo(i,u),o=Wo(o,l)}return[t,r,i,o]}function K8(e){if(e.length===0)return[];const n=e.length*8,t=new Uint32Array(eT(n));for(let r=0;r<n;r+=8)t[r>>5]|=(e[r/8]&255)<<r%32;return t}function Wo(e,n){const t=(e&65535)+(n&65535);return(e>>16)+(n>>16)+(t>>16)<<16|t&65535}function X8(e,n){return e<<n|e>>>32-n}function Zf(e,n,t,r,i,o){return Wo(X8(Wo(Wo(n,e),Wo(r,o)),i),t)}function Cn(e,n,t,r,i,o,a){return Zf(n&t|~n&r,e,n,i,o,a)}function Rn(e,n,t,r,i,o,a){return Zf(n&r|t&~r,e,n,i,o,a)}function kn(e,n,t,r,i,o,a){return Zf(n^t^r,e,n,i,o,a)}function En(e,n,t,r,i,o,a){return Zf(t^(n|~r),e,n,i,o,a)}var Q8=H8;Jf.default=Q8;Object.defineProperty(Yf,"__esModule",{value:!0});Yf.default=void 0;var Y8=tT(sa),J8=tT(Jf);function tT(e){return e&&e.__esModule?e:{default:e}}const Z8=(0,Y8.default)("v3",48,J8.default);var eV=Z8;Yf.default=eV;var eh={},th={};Object.defineProperty(th,"__esModule",{value:!0});th.default=void 0;const tV=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var nV={randomUUID:tV};th.default=nV;Object.defineProperty(eh,"__esModule",{value:!0});eh.default=void 0;var x_=nT(th),rV=nT(Xf),iV=ma;function nT(e){return e&&e.__esModule?e:{default:e}}function oV(e,n,t){if(x_.default.randomUUID&&!n&&!e)return x_.default.randomUUID();e=e||{};const r=e.random||(e.rng||rV.default)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){t=t||0;for(let i=0;i<16;++i)n[t+i]=r[i];return n}return(0,iV.unsafeStringify)(r)}var aV=oV;eh.default=aV;var nh={},rh={};Object.defineProperty(rh,"__esModule",{value:!0});rh.default=void 0;function sV(e,n,t,r){switch(e){case 0:return n&t^~n&r;case 1:return n^t^r;case 2:return n&t^n&r^t&r;case 3:return n^t^r}}function Um(e,n){return e<<n|e>>>32-n}function cV(e){const n=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof e=="string"){const a=unescape(encodeURIComponent(e));e=[];for(let s=0;s<a.length;++s)e.push(a.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const r=e.length/4+2,i=Math.ceil(r/16),o=new Array(i);for(let a=0;a<i;++a){const s=new Uint32Array(16);for(let c=0;c<16;++c)s[c]=e[a*64+c*4]<<24|e[a*64+c*4+1]<<16|e[a*64+c*4+2]<<8|e[a*64+c*4+3];o[a]=s}o[i-1][14]=(e.length-1)*8/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=(e.length-1)*8&4294967295;for(let a=0;a<i;++a){const s=new Uint32Array(80);for(let f=0;f<16;++f)s[f]=o[a][f];for(let f=16;f<80;++f)s[f]=Um(s[f-3]^s[f-8]^s[f-14]^s[f-16],1);let c=t[0],u=t[1],l=t[2],d=t[3],p=t[4];for(let f=0;f<80;++f){const m=Math.floor(f/20),g=Um(c,5)+sV(m,u,l,d)+p+n[m]+s[f]>>>0;p=d,d=l,l=Um(u,30)>>>0,u=c,c=g}t[0]=t[0]+c>>>0,t[1]=t[1]+u>>>0,t[2]=t[2]+l>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+p>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var uV=cV;rh.default=uV;Object.defineProperty(nh,"__esModule",{value:!0});nh.default=void 0;var lV=rT(sa),dV=rT(rh);function rT(e){return e&&e.__esModule?e:{default:e}}const pV=(0,lV.default)("v5",80,dV.default);var fV=pV;nh.default=fV;var ih={};Object.defineProperty(ih,"__esModule",{value:!0});ih.default=void 0;var hV="00000000-0000-0000-0000-000000000000";ih.default=hV;var oh={};Object.defineProperty(oh,"__esModule",{value:!0});oh.default=void 0;var mV=gV(Za);function gV(e){return e&&e.__esModule?e:{default:e}}function vV(e){if(!(0,mV.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}var yV=vV;oh.default=yV;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return a.default}});var n=l(Kf),t=l(Yf),r=l(eh),i=l(nh),o=l(ih),a=l(oh),s=l(Za),c=l(ma),u=l(gl);function l(d){return d&&d.__esModule?d:{default:d}}})(QE);const{EventTarget:wV,defineEventAttribute:es}=ai,__=QE.v4;class Hi extends wV{constructor({kind:n,id:t,label:r,isolated:i,muted:o,readyState:a,constraints:s,data:c}={}){if(super(),!n)throw new TypeError("missing kind");this._id=t||__(),this._kind=n,this._label=r||"",this._isolated=i||!1,this._enabled=!0,this._muted=o||!1,this._readyState=a||"live",this._constraints=s||{},this._data=c||{}}get id(){return this._id}get kind(){return this._kind}get label(){return this._label}get isolated(){return this._isolated}get enabled(){return this._enabled}set enabled(n){const t=this._enabled!==n;this._enabled=n,t&&this.dispatchEvent({type:"@enabledchange"})}get muted(){return this._muted}get readyState(){return this._readyState}get data(){return this._data}set data(n){throw new TypeError("cannot replace data object")}clone({id:n,data:t}={}){return new Hi({id:n||__(),kind:this._kind,label:this._label,isolated:this._isolated,enabled:this._enabled,muted:this._muted,readyState:this._readyState,constraints:this._constraints,data:t!==void 0?t:this._data})}stop(){this._readyState!=="ended"&&(this._readyState="ended",this.dispatchEvent({type:"@stop"}))}getConstraints(){return this._constraints}applyConstraints(n){this._readyState!=="ended"&&(this._constraints=n)}remoteStop(){this._readyState!=="ended"&&(this._readyState="ended",this.dispatchEvent({type:"@stop"}),this.dispatchEvent({type:"ended"}))}remoteMute(){this._muted||(this._muted=!0,this.dispatchEvent({type:"mute"}))}remoteUnmute(){this._muted&&(this._muted=!1,this.dispatchEvent({type:"unmute"}))}}es(Hi.prototype,"ended");es(Hi.prototype,"mute");es(Hi.prototype,"unmute");es(Hi.prototype,"@enabledchange");es(Hi.prototype,"@stop");es(Hi.prototype,"isolationchange");es(Hi.prototype,"overconstrained");PE.FakeMediaStreamTrack=Hi;Object.defineProperty(Gf,"__esModule",{value:!0});Gf.FakeHandler=void 0;const bV=PE,xV=oi,_V=Ct,Is=Pt,S_=dt,SV=jt,CV=wn,Tn=new _V.Logger("FakeHandler"),RV="FakeHandler";class C_ extends xV.EnhancedEventEmitter{constructor({id:t,ordered:r,maxPacketLifeTime:i,maxRetransmits:o,label:a,protocol:s}){super();N(this,"id");N(this,"ordered");N(this,"maxPacketLifeTime");N(this,"maxRetransmits");N(this,"label");N(this,"protocol");this.id=t,this.ordered=r,this.maxPacketLifeTime=i,this.maxRetransmits=o,this.label=a,this.protocol=s}close(){this.safeEmit("close"),this.emit("@close")}send(t){this.safeEmit("message",t)}addEventListener(t,r){this.on(t,r)}}class sw extends CV.HandlerInterface{constructor(t){super();N(this,"_closed",!1);N(this,"fakeParameters");N(this,"_rtpParametersByKind");N(this,"_cname",`CNAME-${Is.generateRandomNumber()}`);N(this,"_transportReady",!1);N(this,"_nextLocalId",1);N(this,"_tracks",new Map);N(this,"_nextSctpStreamId",0);this.fakeParameters=t}static createFactory(t){return()=>new sw(t)}get name(){return RV}close(){Tn.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(t){this.emit("@icegatheringstatechange",t)}setConnectionState(t){this.emit("@connectionstatechange",t)}async getNativeRtpCapabilities(){return Tn.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return Tn.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:t,iceParameters:r,iceCandidates:i,dtlsParameters:o,sctpParameters:a,iceServers:s,iceTransportPolicy:c,proprietaryConstraints:u,extendedRtpCapabilities:l}){this.assertNotClosed(),Tn.debug("run()"),this._rtpParametersByKind={audio:S_.getSendingRtpParameters("audio",l),video:S_.getSendingRtpParameters("video",l)}}async updateIceServers(t){this.assertNotClosed(),Tn.debug("updateIceServers()")}async restartIce(t){this.assertNotClosed(),Tn.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:t,encodings:r,codecOptions:i,codec:o}){this.assertNotClosed(),Tn.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const a=Is.clone(this._rtpParametersByKind[t.kind]),s=a.codecs.some(u=>/.+\/rtx$/i.test(u.mimeType));a.mid=`mid-${Is.generateRandomNumber()}`,r||(r=[{}]);for(const u of r)u.ssrc=Is.generateRandomNumber(),s&&(u.rtx={ssrc:Is.generateRandomNumber()});a.encodings=r,a.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const c=this._nextLocalId++;return this._tracks.set(c,t),{localId:String(c),rtpParameters:a}}async stopSending(t){if(Tn.debug("stopSending() [localId:%s]",t),!this._closed){if(!this._tracks.has(Number(t)))throw new Error("local track not found");this._tracks.delete(Number(t))}}async pauseSending(t){this.assertNotClosed()}async resumeSending(t){this.assertNotClosed()}async replaceTrack(t,r){this.assertNotClosed(),r?Tn.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):Tn.debug("replaceTrack() [localId:%s, no track]",t),this._tracks.delete(Number(t)),this._tracks.set(Number(t),r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),Tn.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),Tn.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r)}async getSenderStats(t){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),Tn.debug("sendDataChannel()");const s=new C_({id:this._nextSctpStreamId++,ordered:t,maxPacketLifeTime:r,maxRetransmits:i,label:o,protocol:a}),c={streamId:this._nextSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:i};return{dataChannel:s,sctpStreamParameters:c}}async receive(t){this.assertNotClosed();const r=[];for(const i of t){const{trackId:o,kind:a}=i;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Tn.debug("receive() [trackId:%s, kind:%s]",o,a);const s=this._nextLocalId++,c=new bV.FakeMediaStreamTrack({kind:a});this._tracks.set(s,c),r.push({localId:String(s),track:c})}return r}async stopReceiving(t){if(!this._closed)for(const r of t)Tn.debug("stopReceiving() [localId:%s]",r),this._tracks.delete(Number(r))}async pauseReceiving(t){this.assertNotClosed()}async resumeReceiving(t){this.assertNotClosed()}async getReceiverStats(t){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:i}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),Tn.debug("receiveDataChannel()"),{dataChannel:new C_({id:t.streamId,ordered:t.ordered,maxPacketLifeTime:t.maxPacketLifeTime,maxRetransmits:t.maxRetransmits,label:r,protocol:i})}}async setupTransport({localDtlsRole:t,localSdpObject:r}){const i=Is.clone(this.fakeParameters.generateLocalDtlsParameters());t&&(i.role=t),this.emit("@connectionstatechange","connecting"),await new Promise((o,a)=>this.emit("@connect",{dtlsParameters:i},o,a)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new SV.InvalidStateError("method called in a closed handler")}}Gf.FakeHandler=sw;var si={};Object.defineProperty(si,"__esModule",{value:!0});si.generateRouterRtpCapabilities=kV;si.generateNativeRtpCapabilities=EV;si.generateNativeSctpCapabilities=TV;si.generateLocalDtlsParameters=DV;si.generateTransportRemoteParameters=IV;si.generateProducerRemoteParameters=PV;si.generateConsumerRemoteParameters=AV;si.generateDataProducerRemoteParameters=NV;si.generateDataConsumerRemoteParameters=MV;const Ln=Pt;function pr(){return String(Ln.generateRandomNumber())}function kV(){return Ln.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function EV(){return Ln.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function TV(){return Ln.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function DV(){return Ln.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function IV(){return{id:pr(),iceParameters:Ln.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:Ln.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:Ln.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:Ln.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function PV(){return Ln.deepFreeze({id:pr()})}function AV({id:e,codecMimeType:n}={}){switch(n){case"audio/opus":return{id:e??pr(),producerId:pr(),kind:"audio",rtpParameters:Ln.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:e??pr(),producerId:pr(),kind:"audio",rtpParameters:Ln.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:e??pr(),producerId:pr(),kind:"video",rtpParameters:Ln.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:e??pr(),producerId:pr(),kind:"video",rtpParameters:Ln.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${n}'`)}}function NV(){return Ln.deepFreeze({id:pr()})}function MV({id:e}={}){return{id:e??pr(),dataProducerId:pr(),sctpStreamParameters:Ln.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.ortc=e.parseScalabilityMode=e.detectDevice=e.Device=e.version=e.types=void 0;const n=Ef;e.debug=n.default,e.types=uE,e.version="3.9.5";var t=Pc;Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return t.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return t.detectDevice}});var r=Wi;Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=dt;var i=Gf;Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=si})(cE);async function LV(){await navigator.mediaDevices.getUserMedia({audio:!0});const n=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput");let t;return n.forEach(r=>{r.label.includes("Web")&&(t=r.deviceId)}),t}const R_=(e,n)=>new Promise(async(t,r)=>{const i=await e.emitWithAck("requestTransport",{type:"producer"}),o=n.createSendTransport(i);o.on("connect",async({dtlsParameters:a},s,c)=>{console.log("Connect running on produce...");const u=await e.emitWithAck("connectTransport",{dtlsParameters:a,type:"producer"});console.log(u,"connectResp is back"),u==="success"?s():u==="error"&&c()}),o.on("produce",async(a,s,c)=>{console.log("Produce event is now running");const{kind:u,rtpParameters:l}=a,d=await e.emitWithAck("startProducing",{kind:u,rtpParameters:l});console.log(d,"produceResp is back!"),d==="error"?c():s({id:d})}),t(o)}),k_=(e,n)=>new Promise(async(t,r)=>{const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0];try{console.log("Calling produce on video");const a=await n.produce({track:i});console.log("Calling produce on audio");const s=await n.produce({track:o});console.log("finished producing!"),t({audioProducer:s,videoProducer:a})}catch(a){console.log(a,"error producing"),r(a)}}),E_=(e,n,t,r,i,o)=>new Promise(async(a,s)=>{const c=await r.emitWithAck("consumeMedia",{rtpCapabilities:t.rtpCapabilities,pid:n,kind:i});if(console.log(c),c==="cannotConsume")console.log("Cannot consume"),a();else if(c==="consumeFailed")console.log("Consume failed..."),a();else{const u=await e.consume(c);console.log("consume() has finished");const{track:l}=u;await r.emitWithAck("unpauseConsumer",{pid:n,kind:i}),a(u)}}),OV=(e,n,t,r)=>{const i=n.createRecvTransport(e);return i.on("connectionstatechange",o=>{console.log("==connectionstatechange=="),console.log(o)}),i.on("icegatheringstatechange",o=>{console.log("==icegatheringstatechange=="),console.log(o)}),i.on("connect",async({dtlsParameters:o},a,s)=>{console.log("Transport connect event has fired!");const c=await t.emitWithAck("connectTransport",{dtlsParameters:o,type:"consumer",audioPid:r});console.log(c,"connectResp is back!"),c==="success"?a():s()}),i},T_=(e,n,t,r,i)=>{e.audioPidsToCreate.forEach(async(o,a)=>{const s=e.videoPidsToCreate[a],c=await n.emitWithAck("requestTransport",{type:"consumer",audioPid:o});console.log(c);const u=OV(c,t,n,o),[l,d]=await Promise.all([E_(u,o,t,n,"audio"),E_(u,s,t,n,"video")]);console.log(l),console.log(d);const p=new MediaStream([l==null?void 0:l.track,d==null?void 0:d.track]),f=c.producerSocketId,m=c.producerRole||(e.associatedUserRoles?e.associatedUserRoles[a]:"candidate");i(o,{combinedStream:p,userName:e.associatedUserNames[a],socketId:f,userRole:m,consumerTransport:u,audioConsumer:l,videoConsumer:d})})},FV=()=>{const[e,n]=oe.useState(null),[t,r]=oe.useState(null),[i,o]=oe.useState(null),[a,s]=oe.useState(null),[c,u]=oe.useState(null),[l,d]=oe.useState(null),[p,f]=oe.useState({}),[m,g]=oe.useState([]),[v,h]=oe.useState([]),[w,y]=oe.useState("candidate"),[b,x]=oe.useState(!1),[_,C]=oe.useState(!1),[R,S]=oe.useState(!1),[E,T]=oe.useState(!1),[I,F]=oe.useState(!0);oe.useEffect(()=>{const U=Fd.connect("https://meetings.aiiventure.com");return U.on("connect",()=>{console.log("Connected to socket server")}),n(U),()=>{U.disconnect()}},[]),oe.useEffect(()=>{if(!e)return;const U=X=>{console.log("Active speakers updated:",X),g(X)};return e.on("updateActiveSpeakers",U),()=>{e.off("updateActiveSpeakers",U)}},[e,l]),oe.useEffect(()=>{if(!e)return;const U=X=>{console.log("User left:",X),f(se=>{const te={...se};return Object.keys(te).forEach(ce=>{te[ce].socketId===X.socketId&&(te[ce].transport&&te[ce].transport.close(),te[ce].audioConsumer&&te[ce].audioConsumer.close(),te[ce].videoConsumer&&te[ce].videoConsumer.close(),delete te[ce])}),te});const P=Date.now(),ne={id:P,type:"userLeft",message:`${X.userName} has left the meeting`,timestamp:new Date};h(se=>[...se,ne]),setTimeout(()=>{h(se=>se.filter(te=>te.id!==P))},5e3)};return e.on("userLeft",U),()=>{e.off("userLeft",U)}},[e]),oe.useEffect(()=>{if(!e||!t)return;const U=X=>{console.log("New producers to consume:",X),T_(X,e,t,p,(ne,se)=>{f(te=>({...te,[ne]:se}))})};return e.on("newProducersToConsume",U),()=>{e.off("newProducersToConsume",U)}},[e,t,p]);const z=oe.useCallback(async(U,X,P=null)=>{if(e)try{P&&P.localStream&&(o(P.localStream),C(!0),P.isMicEnabled||T(!0),P.isCameraEnabled||F(!1),P.userRole&&y(P.userRole));const ne=await e.emitWithAck("joinRoom",{userName:X,roomName:U,userRole:(P==null?void 0:P.userRole)||"candidate"});console.log("Join room response:",ne);const se=new cE.Device;await se.load({routerRtpCapabilities:ne.routerRtpCapabilities}),r(se),T_(ne,e,se,{},(ce,ye)=>{f(Re=>({...Re,[ce]:ye}))}),x(!0),P&&P.localStream&&setTimeout(async()=>{try{const ce=await R_(e,se);s(ce);const ye=await k_(P.localStream,ce);d(ye.audioProducer),u(ye.videoProducer),S(!0),!P.isMicEnabled&&ye.audioProducer&&(ye.audioProducer.pause(),e.emit("audioChange","mute")),!P.isCameraEnabled&&ye.videoProducer&&(ye.videoProducer.pause(),e.emit("videoChange","pause"));const Re=Date.now(),Je={id:Re,type:"userJoined",message:"You have joined the meeting",timestamp:new Date};h(Pe=>[...Pe,Je]),setTimeout(()=>{h(Pe=>Pe.filter(He=>He.id!==Re))},5e3)}catch(ce){console.error("Error auto-starting feed:",ce)}},1e3)}catch(ne){console.error("Error joining room:",ne)}},[e]),j=oe.useCallback(async()=>{try{if(!i){const U=await LV(),X=await navigator.mediaDevices.getUserMedia({video:!0,audio:{deviceId:{exact:U}}});o(X)}C(!0)}catch(U){console.error("Error enabling feed:",U)}},[i]),H=oe.useCallback(async()=>{if(!(!e||!t||!i))try{const U=await R_(e,t);s(U);const X=await k_(i,U);d(X.audioProducer),u(X.videoProducer),S(!0)}catch(U){console.error("Error sending feed:",U)}},[e,t,i]),W=oe.useCallback(()=>{l&&(l.paused?(l.resume(),e.emit("audioChange","unmute"),T(!1)):(l.pause(),e.emit("audioChange","mute"),T(!0)))},[l,e]),L=oe.useCallback(()=>{if(!c||!i)return;const U=i.getVideoTracks()[0];U&&(I?(c.pause(),U.enabled=!1,e&&e.emit("videoChange","pause"),F(!1)):(c.resume(),U.enabled=!0,e&&e.emit("videoChange","resume"),F(!0)))},[c,i,I,e]),$=oe.useCallback(()=>{if(e)try{l&&l.close(),c&&c.close(),a&&a.close(),Object.values(p).forEach(U=>{U.transport&&U.transport.close(),U.audioConsumer&&U.audioConsumer.close(),U.videoConsumer&&U.videoConsumer.close()}),i&&i.getTracks().forEach(U=>{U.stop()}),e.emit("leaveRoom"),s(null),u(null),d(null),f({}),g([]),o(null),S(!1),C(!1),T(!1),F(!0),x(!1),y("candidate"),console.log("Call ended successfully")}catch(U){console.error("Error ending call:",U)}},[e,a,c,l,p,i]),k=oe.useCallback(U=>{h(X=>X.filter(P=>P.id!==U))},[]);return{joinRoom:z,enableFeed:j,sendFeed:H,muteAudio:W,toggleCamera:L,endCall:$,clearNotification:k,isJoined:b,isFeedEnabled:_,isFeedSending:R,isAudioMuted:E,isCameraEnabled:I,localStream:i,consumers:p,activeSpeakers:m,notifications:v,userRole:w}},BV=({localStream:e})=>{const[n,t]=oe.useState(!1),r=async i=>{try{const a=await(await fetch("https://meetings.aiiventure.com/api/transcription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:i,timestamp:new Date().toISOString(),sender:"candidate"})})).json();return console.log("[Candidate] Transcription sent to backend:",a),!0}catch(o){return console.error("[Candidate] Error sending transcription:",o),!1}};return oe.useEffect(()=>{if(!e)return;const i=e.getAudioTracks()[0];if(!i){console.error("No audio track found in stream");return}const o=new MediaStream([i]),a=MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":null;if(!a){console.error("No supported audio MIME type found");return}const s=new MediaRecorder(o,{mimeType:a,audioBitsPerSecond:128e3}),c=new WebSocket("wss://api.deepgram.com/v1/listen",["token","1f3fc83e4559e5e5db749b92a75fbd0d66813d3e"]);return c.onopen=()=>{t(!0),console.log("[Candidate] Connected to Deepgram"),s.addEventListener("dataavailable",async u=>{u.data.size>0&&c.readyState===1&&c.send(u.data)});try{s.start(1e3),console.log("[Candidate] MediaRecorder started successfully")}catch(u){console.error("[Candidate] Error starting MediaRecorder:",u)}},c.onmessage=u=>{try{const l=JSON.parse(u.data);if(l&&l.channel&&l.channel.alternatives&&l.channel.alternatives.length>0){const d=l.channel.alternatives[0].transcript;d&&l.is_final&&(console.log("[Candidate Transcript]:",d),r(d))}else console.log("[Candidate] Received unexpected Deepgram data format:",l)}catch(l){console.error("[Candidate] Error processing transcript:",l)}},c.onclose=()=>{t(!1),console.log("[Candidate] Disconnected from Deepgram")},c.onerror=u=>{console.error("[Candidate] Deepgram WebSocket error:",u)},()=>{if(s.state!=="inactive")try{s.stop()}catch(u){console.error("[Candidate] Error stopping MediaRecorder:",u)}c.readyState===1&&c.close()}},[e]),null};function zV(){const[e,n]=oe.useState(!1),[t,r]=oe.useState(!1),{joinRoom:i,muteAudio:o,toggleCamera:a,endCall:s,clearNotification:c,isJoined:u,isFeedSending:l,isAudioMuted:d,isCameraEnabled:p,localStream:f,consumers:m,activeSpeakers:g,notifications:v,userRole:h}=FV();oe.useEffect(()=>{(async()=>{try{const b=await gF();n(b),b||r(!0)}catch(b){console.error("Error initializing face-api:",b),r(!0)}})()},[]);const w=h==="interviewer"||h==="recruiter";return B.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 text-white",children:[B.jsx(Mz,{notifications:v,clearNotification:c}),u?B.jsxs("div",{className:"h-screen flex flex-col",children:[B.jsx("div",{className:"bg-slate-900 p-3 border-b border-slate-700",children:B.jsx(GI,{onMuteAudio:o,onToggleCamera:a,onEndCall:s,isAudioMuted:d,isCameraEnabled:p,isFeedSending:l,userRole:h})}),B.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[B.jsxs("div",{className:`flex flex-col bg-slate-900 overflow-auto ${w?"flex-1":"w-full"}`,children:[B.jsx("div",{className:"flex-1 p-4",children:B.jsx(xF,{consumers:m,activeSpeakers:g})}),B.jsx("div",{className:"p-4 border-t border-slate-700",children:B.jsx(_F,{localStream:f,isCameraEnabled:p,userRole:h})})]}),f&&w&&B.jsx("div",{className:"w-1/2 flex flex-col overflow-hidden",children:B.jsx(Nz,{localStream:f})}),f&&h==="candidate"&&B.jsx(BV,{localStream:f})]})]}):B.jsxs("div",{className:"container mx-auto px-4 py-8",children:[B.jsxs("header",{className:"mb-8",children:[B.jsx("h1",{className:"text-3xl font-bold text-center bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-400",children:"Technical Interview Assistant"}),t&&B.jsx("div",{className:"mt-2 text-center text-red-400 text-sm",children:"Failed to load facial recognition models. Emotion detection may not work."})]}),B.jsx("div",{className:"flex justify-center items-center min-h-[70vh]",children:B.jsx(HI,{onJoinRoom:i})}),B.jsx("footer",{className:"mt-8 text-center text-sm text-slate-400",children:B.jsx("p",{children:"Powered by MediaSoup, React & Groq LLM"})})]})]})}Wm.createRoot(document.getElementById("root")).render(B.jsx(Ia.StrictMode,{children:B.jsx(zV,{})}))});export default jV();
